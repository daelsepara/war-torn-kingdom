; "The War Torn Kingdom (ZIL)"
; ---------------------------------------------------------------------------------------------

<CONSTANT GAME-TITLE "||The War-Torn Kingdom">
<CONSTANT GAME-DESCRIPTION "|Dave Morris and Jamie Thomson (1995, 2010)||Implemented in ZIL by SD Separa (2020)|">
<CONSTANT RELEASEID 1>
<CONSTANT IFID "ADECB9D4-B91D-4C0A-8912-A6195F7A81A0">
<VERSION XZIP>

<INSERT-FILE "minilib">

<ROUTINE GO ()
	<V-VERSION>
	<TELL CR "IFID: ">
	<TELL IFID>
	<CRLF>
	<GAME-BOOK>
	<QUIT-MESSAGE>>

; "GLOBALS"
; ---------------------------------------------------------------------------------------------

<CONSTANT NONE <>>
<CONSTANT F <>>

<GLOBAL PERIOD-CR ".|">
<GLOBAL EXCLAMATION-CR "!|">

<CONSTANT TEXT-AFFLICTED "afflicted">
<CONSTANT TEXT-EXCELLENT "Excellent!">
<CONSTANT TEXT-INFECTED "infected">
<CONSTANT TEXT-POISONED "poisoned">
<CONSTANT TEXT-SURE "Are you sure?">
<CONSTANT TEXT-NEXT-TIME "See you next time!">
<CONSTANT TEXT-RANDOM-EVENT "Random Event">
<CONSTANT TEXT-BYE "Bye">
<CONSTANT TEXT-BACK "Go back">
<CONSTANT TEXT-GOODBYE "Goodbye!">

; "CHOICES"
; ---------------------------------------------------------------------------------------------

<CONSTANT SELECT-CHOICES <LTABLE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE>>
<CONSTANT TEMP-LIST <LTABLE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE NONE>>

<CONSTANT R-NONE 0> 
<CONSTANT R-ABILITY 1> ; "tests whether ABILITY exceeds certain score"
<CONSTANT R-TEST-ABILITY 2> ; "test ABILITY versus difficulty roll"
<CONSTANT R-RANDOM 3> ; "rolls a number of dice and choose destination based on threshold"
<CONSTANT R-CODEWORD 4> ; "presence of codeword(s)"
<CONSTANT R-CODEWORDS 5> ; "presence of codeword(s)"
<CONSTANT R-ITEM 6> ; "possession of item (s)"
<CONSTANT R-ALL 7> ; "possession of all these item (s)"
<CONSTANT R-ANY 8> ; "possession of any of the item (s)"
<CONSTANT R-MONEY 9> ; "tests ability to pay indicated amount"
<CONSTANT R-CODEWORD-ITEM 10> ; "presence of codeword and item"
<CONSTANT R-DISCHARGE 11> ; "discharge a weapon"
<CONSTANT R-TITLE 12> ; "check for presence of titles"
<CONSTANT R-VISITS 13> ; "check if location was visited multiple times"
<CONSTANT R-RANK 14> ; "check if location was visited multiple times"
<CONSTANT R-GAIN-CODEWORD 15> ; "gain codeword (s)"
<CONSTANT R-PROFESSION 16> ; "check profession"
<CONSTANT R-TAKE-MISSION 17> ; "take mission"
<CONSTANT R-DOCK 18> ; "dock at port"
<CONSTANT R-LOCATION 19> ; "test current location"
<CONSTANT R-LOSE-ITEM 20> ; "lose item"

; "No requirements"
<CONSTANT TWO-CHOICES <LTABLE R-NONE R-NONE>>
<CONSTANT THREE-CHOICES <LTABLE R-NONE R-NONE R-NONE>>
<CONSTANT FOUR-CHOICES <LTABLE R-NONE R-NONE R-NONE R-NONE>>
<CONSTANT FIVE-CHOICES <LTABLE R-NONE R-NONE R-NONE R-NONE R-NONE>>
<CONSTANT SIX-CHOICES <LTABLE R-NONE R-NONE R-NONE R-NONE R-NONE R-NONE>>
<CONSTANT SEVEN-CHOICES <LTABLE R-NONE R-NONE R-NONE R-NONE R-NONE R-NONE R-NONE>>
<CONSTANT EIGHT-CHOICES <LTABLE R-NONE R-NONE R-NONE R-NONE R-NONE R-NONE R-NONE R-NONE>>

; "ABILITIES"
; ---------------------------------------------------------------------------------------------

; "ability types"
<CONSTANT ABILITY-CHARISMA 1>
<CONSTANT ABILITY-COMBAT 2>
<CONSTANT ABILITY-MAGIC 3>
<CONSTANT ABILITY-SANCTITY 4>
<CONSTANT ABILITY-SCOUTING 5>
<CONSTANT ABILITY-THIEVERY 6>

; "computed abilities"
<CONSTANT ABILITY-DEFENSE 7>
<CONSTANT ABILITY-STAMINA 8>

; "ability labels"
<CONSTANT ABILITIES <LTABLE "CHARISMA" "COMBAT" "MAGIC" "SANCTITY" "SCOUTING" "THIEVERY" "DEFENSE" "STAMINA">>

; "PLAYER / CHARACTER / NPC"
; ---------------------------------------------------------------------------------------------

; "Globals"

<CONSTANT LIMIT-POSSESSIONS 12>
<GLOBAL CURRENT-SHIP NONE>
<GLOBAL MONEY 0>
<GLOBAL MAX-STAMINA 9>
<GLOBAL STAMINA 0>

; "For situations that require ransom"
<GLOBAL RANSOM 0>

<GLOBAL BEST-WEAPON NONE>
<GLOBAL BEST-ARMOUR NONE>
<GLOBAL PREVIOUS-STAMINA 0>

; "Current Character"
<GLOBAL CURRENT-CHARACTER NONE>

; "GOD worshipped"
<GLOBAL GOD NONE>

; "resurrection arrangement"
<GLOBAL RESURRECTION-ARRANGEMENTS NONE>

; "diseases and aliments"
<OBJECT AILMENTS (DESC "ailments/diseases/curses") (FLAGS CONTBIT OPENBIT)>

; "object to refer to all of your money"
<OBJECT ALL-MONEY (DESC "all your money") (FLAGS TAKEBIT NDESCBIT)>

; "container for blessings"
<OBJECT BLESSINGS (DESC "blessings") (FLAGS CONTBIT OPENBIT)>

; "container for ship's cargo"
<OBJECT CARGO (DESC "cargo") (FLAGS CONTBIT OPENBIT)>

; "container for codewords"
<OBJECT CODEWORDS (DESC "codewords") (FLAGS CONTBIT OPENBIT)>

; "currency description"
<OBJECT CURRENCY (DESC "shards")>

; "lost stuff"
<OBJECT LOST-STUFF (DESC "things lost") (FLAGS CONTBIT OPENBIT)>

; "missions"
<OBJECT MISSIONS (DESC "missions") (FLAGS CONTBIT OPENBIT)>

; "container for titles and honours acquired"
<OBJECT TITLES-AND-HONOURS (DESC "Titles and Honours") (FLAGS CONTBIT OPENBIT)>

; "container for ships owned"
<OBJECT SHIPS (DESC "ships") (FLAGS CONTBIT OPENBIT)>

; "townhouses and/secret caches"
<OBJECT TOWNHOUSES (DESC "townhouses/secret caches") (FLAGS CONTBIT OPENBIT)>

; "Townhouses"
; ---------------------------------------------------------------------------------------------

<OBJECT TOWNHOUSE-CARAN-BARU
	(DESC "Townhouse at Caran Baru")
	(MONEY 0)
	(FLAGS CONTBIT OPENBIT)>

<OBJECT TOWNHOUSE-YELLOWPORT
	(DESC "Townhouse at Yellowport")
	(MONEY 0)
	(FLAGS CONTBIT OPENBIT)>

<OBJECT TOWNHOUSE-MARLOCK
	(DESC "Townhouse at Marlock City")
	(MONEY 0)
	(FLAGS CONTBIT OPENBIT)>

<OBJECT CACHE-YELLOWPORT
	(DESC "Cache at Yellowport")
	(MONEY 0)
	(FLAGS CONTBIT OPENBIT CACHEBIT)>

; "NON-PERSON OBJECTS Properties"
; ---------------------------------------------------------------------------------------------

<PROPDEF QUANTITY -1>
<PROPDEF CHARGES -1>
<PROPDEF STARS -1>
<PROPDEF CONDITION -1>

; "STORY"
; ---------------------------------------------------------------------------------------------

<GLOBAL CURRENT-STORY NONE>
<GLOBAL PREVIOUS-STORY NONE>
<GLOBAL CONTINUE-TO-CHOICES T>
<GLOBAL RUN-ONCE F>
<GLOBAL STARTING-POINT STORY001>
<GLOBAL CURRENT-LOCATION LOCATION-SOKARA>

<CONSTANT LOCATIONS <LTABLE "Sokara" "Marlock City" "Yellowport" "Venefax" "The City of Trefoille" "Curstmoor" "Shadar Tor" "The River Grimm" "The Pass of the Eagles" "Fort Mereth" "The Isle of Druids" "The Stinking River" "The Forest of Larun" "The City of Trees" "Caran Baru" "Bronze Hills" "Fort Brilon" "Scorpion Bight" "Disaster Bay" "The Village of Blessed Springs">>

<CONSTANT LOCATION-SOKARA 1>
<CONSTANT LOCATION-MARLOCK 2>
<CONSTANT LOCATION-YELLOWPORT 3>
<CONSTANT LOCATION-VENEFAX 4>
<CONSTANT LOCATION-TREFOILLE 5>
<CONSTANT LOCATION-CURSTMOOR 6>
<CONSTANT LOCATION-SHADAR 7>
<CONSTANT LOCATION-GRIMM 8>
<CONSTANT LOCATION-EAGLES 9>
<CONSTANT LOCATION-MERETH 10>
<CONSTANT LOCATION-TRADING 11>
<CONSTANT LOCATION-STINKING 12>
<CONSTANT LOCATION-LARUN 13>
<CONSTANT LOCATION-TREES 14>
<CONSTANT LOCATION-CARAN 15>
<CONSTANT LOCATION-BRONZE 16>
<CONSTANT LOCATION-BRILON 17>
<CONSTANT LOCATION-SCORPION 18>
<CONSTANT LOCATION-DISASTER 19>
<CONSTANT LOCATION-BLESSED 20>

; "Gamebook loop"
; ---------------------------------------------------------------------------------------------

<ROUTINE GAME-BOOK ("AUX" KEY)
	<INSTRUCTIONS>
	<RESET-PLAYER>
	<RESET-OBJECTS>
	<RESET-SELECTIONS>
	<RESET-STORY>
	<CHOOSE-CHARACTER>
	<SETG HERE ,STARTING-POINT>
	<REPEAT ()
		<CRLF>
		<RESET-CHOICES>
		<COND (,RUN-ONCE
			<MARK-VISITS>
			<CHECK-BACKGROUND>
		)>
		<SETG CURRENT-STORY ,HERE>
		<GOTO ,HERE>
		<MARK-LOCATION>
		<UPDATE-STATUS-LINE>
		<PRINT-SECTION>
		<CHECK-EVENTS>
		<COND (<EQUAL? ,CURRENT-STORY ,HERE>
			<CHECK-DOOM>
			<CHECK-VICTORY>
		)>
		<COND (,RUN-ONCE
			<GAIN-ITEMS>
			<GAIN-CODEWORDS>
			<GAIN-BLESSINGS>
			<GAIN-TITLES>
		)>
		<COND (,CONTINUE-TO-CHOICES
			<SET KEY <PROCESS-STORY>>
			<COND (<EQUAL? .KEY !\c !\C> <DESCRIBE-PLAYER> <PRESS-A-KEY> <SET KEY NONE>)>
			<COND (<EQUAL? .KEY !\h !\H !\?> <DISPLAY-HELP> <PRESS-A-KEY> <SET KEY NONE>)>
			<COND (<EQUAL? .KEY !\i !\I> <DESCRIBE-INVENTORY> <PRESS-A-KEY> <SET KEY NONE>)>
			<COND (<EQUAL? .KEY !\p !\P> <DESCRIBE-PLAYER> <PRESS-A-KEY> <SET KEY NONE>)>
			<COND (<EQUAL? .KEY !\q !\Q> <CRLF> <TELL "Are you sure you want to quit the game?"> <COND(<YES?> <RETURN>)>)>
			<COND (<EQUAL? .KEY !\r !\R> <CRLF> <TELL "Restore from a previous save?"> <COND (<YES?> <COND (<NOT <RESTORE>> <EMPHASIZE "Restore failed."> <PRESS-A-KEY>)>)>)>
			<COND (<EQUAL? .KEY !\s !\S> <CRLF> <TELL "Save current progress?"> <COND (<YES?> <COND (<NOT <SAVE>> <EMPHASIZE "Save failed."> <PRESS-A-KEY>)>)>)>
			<COND (<EQUAL? .KEY !\x !\X> <RETURN>)>
		)>
		<UPDATE-STATUS-LINE>
	>>

; "Gamebook Engine Routines"
; ---------------------------------------------------------------------------------------------

; "generic D6 roller"
<GLOBAL LAST-ROLL 0>

<ROUTINE ROLL-DICE ("OPT" DIE "AUX" RESULT)
	<SET RESULT 0>
	<COND (<NOT .DIE> <SET DIE 1>)>
	<DO (I 1 .DIE)
		<SET RESULT <+ .RESULT <RANDOM 6>>>
	>
	<SETG LAST-ROLL .RESULT>
	<RETURN .RESULT>>

; "Story Routines - print story, process choices, triggers"
; ---------------------------------------------------------------------------------------------

<ROUTINE CHECK-BACKGROUND ("AUX" BACKGROUND STORY)
	<SET BACKGROUND <GETP ,HERE ,P?BACKGROUND>>
	<COND (.BACKGROUND
		<SET STORY <APPLY .BACKGROUND>>
		<COND (.STORY <SETG HERE .STORY>)>
		<UPDATE-STATUS-LINE>
	)>>

<ROUTINE CHECK-DOOM ("AUX" DOOM HAS-ROYAL-RING)
	<SET DOOM <GETP ,HERE ,P?DOOM>>
	<COND (.DOOM
		<COND (,RESURRECTION-ARRANGEMENTS
			<SET HAS-ROYAL-RING <CHECK-ITEM ,ROYAL-RING>>
			<STORY-LOSE-EVERYTHING F>
			<COND (.HAS-ROYAL-RING
				<EMPHASIZE "Through a quirk of magical fate, somehow the royal ring has travelled with you through the lands of the dead.">
				<MOVE ,ROYAL-RING ,PLAYER>
			)>
			<SETG STAMINA ,MAX-STAMINA>
			<STORY-JUMP <GETP ,RESURRECTION-ARRANGEMENTS ,P?CONTINUE>>
			<SETG RESURRECTION-ARRANGEMENTS NONE>
		)(ELSE
			<PRINT-ENDING BAD-ENDING 3>
		)>
		<SETG CONTINUE-TO-CHOICES F>
	)>>

<ROUTINE CHECK-EVENTS ("AUX" EVENTS)
	<SET EVENTS <GETP ,HERE ,P?EVENTS>>
	<COND (.EVENTS <APPLY .EVENTS>)>>

<ROUTINE CHECK-GOD (GOD)
	<RETURN <AND ,GOD <EQUAL? ,GOD .GOD>>>>

<ROUTINE CHECK-PROFESSION (IS-PROFESSION "AUX" PROFESSION)
	<SET PROFESSION <GETP ,CURRENT-CHARACTER ,P?PROFESSION>>
	<COND (.PROFESSION <RETURN <EQUAL? .IS-PROFESSION .PROFESSION>>)>
	<RETURN <EQUAL? ,CURRENT-CHARACTER .IS-PROFESSION>>>

<ROUTINE CHECK-VICTORY ("AUX" VICTORY)
	<SET VICTORY <GETP ,HERE ,P?VICTORY>>
	<COND (.VICTORY
		<COND (<EQUAL? .VICTORY T>
			<PRINT-ENDING GOOD-ENDING 4>
		)(ELSE
			<PRINT-ENDING .VICTORY 6>
		)>
		<SETG CONTINUE-TO-CHOICES F>
	)>>

<ROUTINE CODEWORD-JUMP (CODEWORD STORY)
	<COND (<CHECK-CODEWORD .CODEWORD> <STORY-JUMP .STORY>)>>

<ROUTINE GAIN-BLESSINGS ("OPT" BLESSINGS)
	<COND (<NOT .BLESSINGS> <SET BLESSINGS <GETP ,CURRENT-STORY ,P?BLESSINGS>>)>
	<GAIN-OBJECTS .BLESSINGS GAIN-BLESSING>>

<ROUTINE GAIN-CODEWORDS ("OPT" CODEWORDS)
	<COND (<NOT .CODEWORDS> <SET CODEWORDS <GETP ,CURRENT-STORY ,P?CODEWORDS>>)>
	<GAIN-OBJECTS .CODEWORDS GAIN-CODEWORD>>

<ROUTINE GAIN-ITEMS ("OPT" ITEMS)
	<COND (<NOT .ITEMS> <SET ITEMS <GETP ,CURRENT-STORY ,P?ITEMS>>)>
	<GAIN-OBJECTS .ITEMS ,TAKE-ITEM>>

<ROUTINE GAIN-OBJECTS (OBJECTS GAIN-ROUTINE "AUX" COUNT)
	<COND (<NOT .OBJECTS> <RETURN>)>
	<COND (.OBJECTS
		<SET COUNT <GET .OBJECTS 0>>
		<DO (I 1 .COUNT)
			<APPLY .GAIN-ROUTINE <GET .OBJECTS .I>>
		>
	)>>

<ROUTINE GAIN-TITLES ("OPT" TITLES)
	<COND (<NOT .TITLES> <SET TITLES <GETP ,CURRENT-STORY ,P?TITLES>>)>
	<GAIN-OBJECTS .TITLES GAIN-TITLE>>

<ROUTINE IF-ALIVE (TEXT)
	<COND (<IS-ALIVE> <TELL CR .TEXT CR>)>>

<ROUTINE IS-ALIVE ("OPT" THRESHOLD)
	<COND (<NOT .THRESHOLD> <SET THRESHOLD 0>)>
	<COND (<G? ,STAMINA .THRESHOLD> <RTRUE>)>
	<RFALSE>>

<ROUTINE ITEM-JUMP (ITEM STORY)
	<COND (<CHECK-ITEM .ITEM> <STORY-JUMP .STORY>)>>

<ROUTINE MARK-LOCATION ("OPT" SECTION "AUX" LOCATION)
	<COND (<NOT .SECTION> <SET .SECTION ,HERE>)>
	<SET LOCATION <GETP .SECTION ,P?LOCATION>>
	<COND (.LOCATION
		<SET-LOCATION .LOCATION>
	)>>

<ROUTINE MARK-VISITS ("OPT" SECTION VISITS)
	<COND (<NOT .SECTION> <SET .SECTION ,HERE>)>
	<SET VISITS <GETP .SECTION ,P?VISITS>>
	<COND (.VISITS
		<INC .VISITS>
		<PUTP .SECTION ,P?VISITS .VISITS>
	)>>

<ROUTINE PREVENT-DOOM ("OPT" STORY)
	<COND (<NOT .STORY> <SET STORY ,HERE>)>
	<COND (<GETP .STORY ,P?DOOM> <PUTP .STORY ,P?DOOM F>)>>

<ROUTINE PRINT-SECTION ("OPT" SECTION "AUX" TEXT)
	<COND (<NOT .SECTION> <SET SECTION ,HERE>)>
	<SET TEXT <GETP .SECTION ,P?STORY>>
	<COND (.TEXT
		<CRLF>
		<TELL .TEXT>
		<CRLF>
	)>>

<ROUTINE PROCESS-CHOICES (CHOICES "AUX" DESTINATIONS REQUIREMENTS TYPES KEY CHOICE TYPE LIST)
	<SET DESTINATIONS <GETP ,HERE ,P?DESTINATIONS>>
	<SET REQUIREMENTS <GETP ,HERE ,P?REQUIREMENTS>>
	<SET TYPES <GETP ,HERE ,P?TYPES>>
	<TELL CR "What will you choose? ">
	<REPEAT ()
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (
				<OR
					<AND <G=? .KEY !\1> <L=? .KEY !\9>>
					<AND <G=? .KEY !\A> <L=? .KEY !\J> <G? <GET .CHOICES 0> 9>>
					<AND <G=? .KEY !\a> <L=? .KEY !\j> <G? <GET .CHOICES 0> 9>>
					<AND <EQUAL? .KEY !\C !\c> <L? <GET .CHOICES 0> 12>>
					<AND <EQUAL? .KEY !\H !\h> <L? <GET .CHOICES 0> 17>>
					<AND <EQUAL? .KEY !\I !\i> <L? <GET .CHOICES 0> 18>> <EQUAL? .KEY !\? !\Q !\q !\P !\p !\R !\r !\S !\s>
				>
				<RETURN>
			)>
		>
		<COND (
			<OR
				<AND <G=? .KEY !\1> <L=? .KEY !\9>>
				<AND <G=? .KEY !\A> <L=? .KEY !\J> <G? <GET .CHOICES 0> 9>>
				<AND <G=? .KEY !\a> <L=? .KEY !\j> <G? <GET .CHOICES 0> 9>>
			>
			<COND (<AND <G=? .KEY !\1> <L=? .KEY !\9>> <SET CHOICE <- .KEY !\0>>)>
			<COND (<AND <G=? .KEY !\A> <L=? .KEY !\J>> <SET CHOICE <+ <- .KEY !\A> 10>>)>
			<COND (<AND <G=? .KEY !\a> <L=? .KEY !\j>> <SET CHOICE <+ <- .KEY !\a> 10>>)>
			<COND (<AND <G=? <GET .CHOICES 0> 1> <L=? .CHOICE <GET .CHOICES 0>>>
				<COND (.REQUIREMENTS <SET LIST <GET .REQUIREMENTS .CHOICE>>)>
				<COND (<AND <G=? .CHOICE 1> <L=? .CHOICE <GET .DESTINATIONS 0>> <L=? .CHOICE <GET .TYPES 0>>>
					<SET TYPE <GET .TYPES .CHOICE>>
					<COND (<EQUAL? .TYPE ,R-NONE>
						<SETG HERE <GET .DESTINATIONS .CHOICE>>
						<CRLF>
					)(<AND <EQUAL? .TYPE ,R-TEST-ABILITY> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<CRLF>
						<CRLF>
						<COND (<TEST-ABILITY ,CURRENT-CHARACTER <GET .LIST 1> <GET .LIST 2>>
							<SETG HERE <GET <GET .DESTINATIONS .CHOICE> 1>>
						)(ELSE
							<SETG HERE <GET <GET .DESTINATIONS .CHOICE> 2>>
						)>
						<PRESS-A-KEY>
					)(<AND <EQUAL? .TYPE ,R-CODEWORD> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<CHECK-CODEWORD .LIST>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<CRLF>
						)(ELSE
							<HLIGHT ,H-BOLD>
							<CRLF>
							<TELL CR "You do not have " T .LIST " codeword" ,EXCLAMATION-CR>
							<HLIGHT 0>
							<PRESS-A-KEY>
						)>
					)(<AND <EQUAL? .TYPE ,R-CODEWORDS> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<CHECK-CODEWORDS .LIST>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<CRLF>
						)(ELSE
							<NOT-ALL-ANY ,R-ALL .LIST ,CODEWORDS>
						)>
					)(<AND <EQUAL? .TYPE ,R-ANY> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<CHECK-ANY .LIST>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<CRLF>
						)(ELSE
							<NOT-ALL-ANY ,R-ANY .LIST>
						)>
					)(<AND <EQUAL? .TYPE ,R-ALL> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<CHECK-ALL .LIST>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<CRLF>
						)(ELSE
							<NOT-ALL-ANY ,R-ALL .LIST>
						)>
					)(<AND <EQUAL? .TYPE ,R-ITEM ,R-DISCHARGE> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<CHECK-ITEM .LIST>
							<COND (<CHECK-CHARGES .LIST>
								<COND (<EQUAL? .TYPE ,R-DISCHARGE> <DISCHARGE-ITEM .LIST 1>)>
								<SETG HERE <GET .DESTINATIONS .CHOICE>>
								<CRLF>
							)(ELSE
								<NOT-CHARGED <GET .REQUIREMENTS .CHOICE>>
							)>
						)(ELSE
							<NOT-POSSESSED .LIST>
						)>
					)(<AND <EQUAL? .TYPE ,R-CODEWORD-ITEM> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<AND <CHECK-CODEWORD <GET .LIST 1>> <CHECK-ITEM <GET .LIST 2>>>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<CRLF>
						)(ELSE
							<HLIGHT ,H-BOLD>
							<CRLF>
							<TELL CR "You do not have " T <GET .LIST 1> " codeword or ">
							<COND (<FSET? <GET .LIST 2> ,NARTICLEBIT>
								<TELL "the">
							)(<FSET? <GET .LIST 2> ,VOWELBIT>
								<TELL "an">
							)(ELSE
								<TELL "a">
							)>
							<TELL " " D <GET .LIST 2> ,EXCLAMATION-CR>
							<HLIGHT 0>
							<PRESS-A-KEY>
						)>
					)(<AND <EQUAL? .TYPE ,R-MONEY> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<CHECK-MONEY .LIST>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<CRLF>
							<COND (<G? .LIST 0>
								<COST-MONEY .LIST ,TEXT-PAID>
								<PRESS-A-KEY>
							)>
						)>
					)(<AND <EQUAL? .TYPE ,R-RANK> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<CHECK-RANK .LIST>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<CRLF>
						)>
					)(<AND <EQUAL? .TYPE ,R-RANDOM> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<SETG HERE <PROCESS-RANDOM .LIST <GET .DESTINATIONS .CHOICE>>>
					)(<AND <EQUAL? .TYPE ,R-GAIN-CODEWORD> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<CRLF>
						<GAIN-CODEWORD .LIST>
						<PRESS-A-KEY>
						<SETG HERE <GET .DESTINATIONS .CHOICE>>
					)(<AND <EQUAL? .TYPE ,R-PROFESSION> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<CHECK-PROFESSION .LIST>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<CRLF>
						)(ELSE
							<CRLF>
							<CRLF>
							<HLIGHT ,H-BOLD>
							<TELL "You are not a " D .LIST ,EXCLAMATION-CR>
							<HLIGHT 0>
						)>
					)(<AND <EQUAL? .TYPE ,R-TAKE-MISSION> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<CRLF>
						<TAKE-MISSION .LIST>
						<PRESS-A-KEY>
						<SETG HERE <GET .DESTINATIONS .CHOICE>>
					)(<AND <EQUAL? .TYPE ,R-DOCK> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<CRLF>
						<COND (,CURRENT-SHIP
							<CRLF>
							<TELL "Your " D ,CURRENT-SHIP " docks at " <GET ,DOCKS .LIST> ,PERIOD-CR>
							<PUTP ,CURRENT-SHIP ,P?DOCKED .LIST>
							<PRESS-A-KEY>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<SETG CURRENT-SHIP NONE>
						)(ELSE
							<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
								<EMPHASIZE "Your ships are docked elsewhere!">
							)(ELSE
								<EMPHASIZE "You have no ship!">
							)>
						)>
					)(<AND <EQUAL? .TYPE ,R-LOCATION> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<CHECK-LOCATION .LIST>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<CRLF>
						)(ELSE
							<CRLF>
							<CRLF>
							<HLIGHT ,H-BOLD>
							<TELL "You are not in " <GET-LOCATION .LIST> ,EXCLAMATION-CR>
							<HLIGHT 0>
							<PRESS-A-KEY>
						)>
					)(<AND <EQUAL? .TYPE ,R-LOSE-ITEM> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<CHECK-ITEM <GET .REQUIREMENTS .CHOICE>>
							<CRLF>
							<LOSE-ITEM <GET .REQUIREMENTS .CHOICE>>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<CRLF>
						)(ELSE
							<NOT-POSSESSED .LIST>
						)>
					)(<AND <EQUAL? .TYPE ,R-TITLE> .REQUIREMENTS <L=? .CHOICE <GET .REQUIREMENTS 0>>>
						<COND (<CHECK-TITLE .LIST>
							<SETG HERE <GET .DESTINATIONS .CHOICE>>
							<CRLF>
						)(ELSE
							<HLIGHT ,H-BOLD>
							<CRLF>
							<TELL CR "You are not ">
							<COND (<FSET? .LIST ,NARTICLEBIT>
								<TELL "the">
							)(<FSET? .LIST ,VOWELBIT>
								<TELL "an">
							)(ELSE
								<TELL "a">
							)>
							<TELL " " D .LIST ,EXCLAMATION-CR>
							<HLIGHT 0>
							<PRESS-A-KEY>
						)>
					)>
					<RETURN>
				)(ELSE
					<CRLF>
					<TELL CR "Internal Error" ,PERIOD-CR>
					<SET KEY !\q>
					<RETURN>
				)>
			)>
		)>
		<COND (
			<OR
				<AND <G=? .KEY !\A> <L=? .KEY !\Z>>
				<AND <G=? .KEY !\a> <L=? .KEY !\z>>
			>
			<COND (<AND <G=? .KEY !\A> <L=? .KEY !\Z> <G=? <GET .CHOICES 0> <+ <- .KEY !\A> 10>>
				<SPECIAL-INTERRUPT-ROUTINE .KEY>>
				<RETURN>
			)(<AND <G=? .KEY !\a> <L=? .KEY !\z> <G=? <GET .CHOICES 0> <+ <- .KEY !\a> 10>>
				<SPECIAL-INTERRUPT-ROUTINE .KEY>>
				<RETURN>
			)>
		)>
		<COND (<EQUAL? .KEY !\? !\P !\p !\q !\Q !\r !\R !\s !\S> <CRLF> <RETURN>)>
		<COND (<AND <EQUAL? .KEY !\c !\C> <L? <GET .CHOICES 0> 12>> <CRLF> <RETURN>)>
		<COND (<AND <EQUAL? .KEY !\h !\H> <L? <GET .CHOICES 0> 17>> <CRLF> <RETURN>)>
		<COND (<AND <EQUAL? .KEY !\i !\I> <L? <GET .CHOICES 0> 18>> <CRLF> <RETURN>)>
	>
	<RETURN .KEY>>

<ROUTINE PROCESS-STORY ("AUX" COUNT CHOICES TYPES REQUIREMENTS LIST CONTINUE CHOICE CHOICE-TYPE)
	<SET CHOICES <GETP ,HERE ,P?CHOICES>>
	<SET TYPES <GETP ,HERE ,P?TYPES>>
	<SET REQUIREMENTS <GETP ,HERE ,P?REQUIREMENTS>>
	<SET CONTINUE <GETP ,HERE ,P?CONTINUE>>
	<SETG CURRENT-STORY ,HERE>
	<SETG RUN-ONCE T>
	<COND (.CHOICES
		<REPEAT ()
			<CRLF>
			<SET COUNT <GET .CHOICES 0>>
			<DO (I 1 .COUNT)
				<SET CHOICE-TYPE <GET .TYPES .I>>
				<COND (.REQUIREMENTS <SET LIST <GET .REQUIREMENTS .I>>)>
				<HLIGHT ,H-BOLD>
				<COND (<L? .I 10>
					<TELL N .I>
				)(ELSE
					<TELL C <+ !\A <- .I 10>>>
				)>
				<TELL ") ">
				<HLIGHT 0>
				<TELL <GET .CHOICES .I>>
				<COND (<AND <EQUAL? .CHOICE-TYPE ,R-TEST-ABILITY> .REQUIREMENTS> <TELL " (Difficulty: "> <HLIGHT ,H-BOLD> <TELL N <GET .LIST 2>> <HLIGHT 0> <TELL")">)>
				<COND (<AND <EQUAL? .CHOICE-TYPE ,R-ITEM ,R-CODEWORD ,R-DISCHARGE ,R-TAKE-MISSION ,R-TITLE> .REQUIREMENTS> <TELL " ("> <COND (<EQUAL? .CHOICE-TYPE ,R-ITEM ,R-DISCHARGE> <HLIGHT ,H-BOLD>)(ELSE <HLIGHT ,H-ITALIC>)> <TELL D .LIST> <HLIGHT 0> <TELL ")">)>
				<COND (<AND <EQUAL? .CHOICE-TYPE ,R-CODEWORD-ITEM> .REQUIREMENTS> <TELL " Codeword "> <HLIGHT ,H-ITALIC> <TELL D <GET .LIST 1>> <HLIGHT 0> <TELL " and "> <COND (<FSET? <GET .LIST 2> ,NARTICLEBIT> <TELL "the">)(<FSET? <GET .LIST 2> ,VOWELBIT> <TELL "an">)(ELSE TELL "a")> <TELL " "> <PRINT-ITEM <GET .LIST 2> T>)>
				<COND (<AND <EQUAL? .CHOICE-TYPE ,R-MONEY> .REQUIREMENTS> <COND (<G? .LIST 0> <TELL " (" N .LIST " " D ,CURRENCY ")">)>)>
				<COND (<AND <EQUAL? .CHOICE-TYPE ,R-RANK> .REQUIREMENTS> <COND (<G? .LIST 0> <TELL " (Rank "> <HLIGHT ,H-BOLD> <TELL N .LIST> <HLIGHT 0> <TELL ")">)>)>
				<COND (<AND <EQUAL? .CHOICE-TYPE ,R-ANY> .REQUIREMENTS> <PRINT-ANY .LIST>)>
				<COND (<AND <EQUAL? .CHOICE-TYPE ,R-ALL> .REQUIREMENTS> <PRINT-ALL .LIST>)>
				<COND (<AND <EQUAL? .CHOICE-TYPE ,R-VISITS> .REQUIREMENTS> <COND (<G? .LIST 0> <TELL " (visited > " N .LIST " times)">)>)>
				<COND (<AND <EQUAL? .CHOICE-TYPE ,R-PROFESSION> .REQUIREMENTS> <COND (<G? .LIST 0> <TELL " (" D .LIST ")">)>)>
				<COND (<AND <EQUAL? .CHOICE-TYPE ,R-DOCK> .REQUIREMENTS> <COND (<G? .LIST 0> <TELL " (ship docks at " <GET ,DOCKS .LIST> ")">)>)>
				<CRLF>
			>
			<SET CHOICE <PROCESS-CHOICES .CHOICES>>
			<COND (.CHOICE
				<COND (<AND <G=? .CHOICE !\A> <L=? .CHOICE !\Z> <G=? <GET .CHOICES 0> <+ <- .CHOICE !\A> 10>>> <SET .CHOICE NONE> <RETURN>)>
				<COND (<AND <G=? .CHOICE !\a> <L=? .CHOICE !\z> <G=? <GET .CHOICES 0> <+ <- .CHOICE !\a> 10>>> <SET .CHOICE NONE> <RETURN>)>
				<RETURN>
			)>
		>
		<COND (<EQUAL? ,CURRENT-STORY ,HERE>
			<SETG RUN-ONCE F>
		)(ELSE
			<SETG PREVIOUS-STORY ,CURRENT-STORY>
			<SETG RUN-ONCE T>
		)>
		<RETURN .CHOICE>
	)(.CONTINUE
		<SETG HERE .CONTINUE>
		<SETG PREVIOUS-STORY ,CURRENT-STORY>
		<PRESS-A-KEY>
		<SETG RUN-ONCE T>
		<RETURN>
	)>
	<RETURN !\x>>

<ROUTINE RANDOM-EVENT ("OPT" DICE (MODIFIER 0) (SILENT F) "AUX" ROLL)
	<COND (<NOT .DICE> <SET DICE 1>)>
	<EMPHASIZE ,TEXT-RANDOM-EVENT>
	<PRESS-A-KEY>
	<REPEAT ()
		<SET ROLL <ROLL-DICE .DICE>>
		<CRLF>
		<TELL "You rolled ">
		<HLIGHT ,H-BOLD>
		<TELL N .ROLL>
		<HLIGHT 0>
		<COND (<N=? .MODIFIER 0>
			<TELL " (">
			<HLIGHT ,H-BOLD>
			<COND (<G? .MODIFIER 0>
				<TELL "+">
			)>
			<TELL N .MODIFIER>
			<HLIGHT 0>
			<TELL ") = ">
			<SET .ROLL <+ .ROLL .MODIFIER>>
			<HLIGHT ,H-BOLD>
			<COND (<L? .ROLL 0> <SET .ROLL 0>)>
			<TELL N .ROLL>
			<HLIGHT 0>
		)>
		<CRLF>
		<COND (<NOT .SILENT>
			<PRESS-A-KEY>
		)>
		<COND (<NOT <PROCESS-RANDOM-BLESSING>> <RETURN>)>
	>
	<SETG LAST-ROLL .ROLL>
	<RETURN .ROLL>>

<ROUTINE STORY-JUMP (STORY)
	<COND (.STORY
		<SETG HERE .STORY>
		<SETG CONTINUE-TO-CHOICES F>
		<SETG RUN-ONCE T>
		<PRESS-A-KEY>
	)>>

<ROUTINE TITLE-JUMP (TITLE STORY "AUX")
	<COND (<CHECK-TITLE .TITLE> <STORY-JUMP .STORY>)>>

<ROUTINE TITLES-JUMP (TITLES STORY "AUX")
	<COND (<CHECK-TITLES .TITLES> <STORY-JUMP .STORY>)>>

; "Story - Choice Requirements Validations"
; ---------------------------------------------------------------------------------------------

<ROUTINE CHECK-AILMENT (DISEASE)
	<COND (<NOT .DISEASE> <RTRUE>)>
	<RETURN <IN? .DISEASE ,AILMENTS>>>

<ROUTINE CHECK-ALL (ITEMS "OPT" CONTAINER "AUX" COUNT)
	<COND (<NOT .CONTAINER> <SET CONTAINER ,PLAYER>)>
	<COND (.ITEMS
		<SET COUNT <GET .ITEMS 0>>
		<DO (I 1 .COUNT)
			<COND (<NOT <IN? <GET .ITEMS .I> .CONTAINER>> <RFALSE>)>
		>
	)>
	<RTRUE>>

<ROUTINE CHECK-ANY (ITEMS "OPT" CONTAINER "AUX" COUNT)
	<COND (<NOT .CONTAINER> <SET CONTAINER ,PLAYER>)>
	<COND (.ITEMS
		<SET COUNT <GET .ITEMS 0>>
		<DO (I 1 .COUNT)
			<COND (<IN? <GET .ITEMS .I> .CONTAINER> <RTRUE>)>
		>
		<RFALSE>
	)>
	<RTRUE>>

<ROUTINE CHECK-BLESSING (BLESS)
	<COND (<NOT .BLESS> <RTRUE>)>
	<RETURN <IN? .BLESS ,BLESSINGS>>>

<ROUTINE CHECK-CHARGES (ITEM "AUX" CHARGES)
	<COND (<NOT .ITEM> <RTRUE>)>
	<SET CHARGES <GETP .ITEM ,P?CHARGES>>
	<COND (<L? .CHARGES 0>
		<RTRUE>
	)(<G? .CHARGES 0>
		<RTRUE>
	)>
	<RFALSE>>

<ROUTINE CHECK-CODEWORD (CODEWORD)
	<COND (<NOT .CODEWORD> <RTRUE>)>
	<RETURN <IN? .CODEWORD ,CODEWORDS>>>

<ROUTINE CHECK-CODEWORDS (CODEWORDS)
	<RETURN <CHECK-ALL .CODEWORDS ,CODEWORDS>>>

<ROUTINE CHECK-CREW (THIS-CONDITION "AUX" CONDITION)
	<COND (,CURRENT-SHIP
		<SET CONDITION <GETP ,CURRENT-SHIP ,P?CONDITION>>
		<RETURN <AND <CHECK-SHIP ,CURRENT-SHIP> <G=? .CONDITION .THIS-CONDITION>>>
	)>
	<RFALSE>>

<ROUTINE CHECK-ITEM (ITEM "AUX" QUANTITY)
	<COND (<NOT .ITEM> <RTRUE>)>
	<SET QUANTITY <GETP .ITEM ,P?QUANTITY>>
	<COND (<L? .QUANTITY 0>
		<RETURN <IN? .ITEM ,PLAYER>>
	)(ELSE
		<RETURN <AND <IN? .ITEM ,PLAYER> <G? .QUANTITY 0>>>
	)>>

<ROUTINE CHECK-LOCATION (LOCATION)
	<RETURN <AND ,CURRENT-LOCATION <EQUAL? ,CURRENT-LOCATION .LOCATION>>>>

<ROUTINE CHECK-MONEY (AMOUNT)
	<COND (<OR <AND <G? .AMOUNT 0> <L? ,MONEY .AMOUNT>> <L=? ,MONEY 0>>
		<CRLF>
		<CRLF>
		<HLIGHT ,H-BOLD>
		<TELL "You do not have enough " D ,CURRENCY ,PERIOD-CR>
		<HLIGHT 0>
		<PRESS-A-KEY>
		<RFALSE>
	)>
	<RTRUE>>

<ROUTINE CHECK-MISSION (MISSION)
	<COND (<NOT .MISSION> <RTRUE>)>
	<RETURN <IN? .MISSION ,MISSIONS>>>

<ROUTINE CHECK-RANK (LEVEL "OPT" CHARACTER "AUX" RANK)
	<COND (<NOT .CHARACTER> <SET CHARACTER ,CURRENT-CHARACTER>)>
	<SET RANK <GET-RANK .CHARACTER>>
	<COND (<AND .RANK <G=? .RANK .LEVEL>>
		<RTRUE>
	)(ELSE
		<CRLF>
		<EMPHASIZE "Your Rank is not high enough!">
		<PRESS-A-KEY>
	)>
	<RFALSE>>

<ROUTINE CHECK-STAMINA (AMOUNT)
	<COND (<G? .AMOUNT 0>
		<COND (<L=? ,STAMINA .AMOUNT>
			<CRLF>
			<EMPHASIZE "You'll die if you do that!">
			<PRESS-A-KEY>
			<RFALSE>
		)>
	)>
	<RTRUE>>

<ROUTINE CHECK-TITLE (TITLE)
	<COND (<NOT .TITLE> <RTRUE>)>
	<RETURN <IN? .TITLE ,TITLES-AND-HONOURS>>>

<ROUTINE CHECK-TITLES (TITLES "AUX" COUNT)
	<SET COUNT <GET .TITLES 0>>
	<DO (I 1 .COUNT)
		<COND (<NOT <CHECK-TITLE <GET .TITLES .I>>> <RFALSE>)>
	>
	<RTRUE>>

<ROUTINE CHECK-SHIP (THIS-SHIP)
	<COND (,CURRENT-SHIP
		<RETURN <AND <IN? .THIS-SHIP ,SHIPS> <EQUAL? ,CURRENT-SHIP .THIS-SHIP>>>
	)>
	<RFALSE>>

<ROUTINE CHECK-TOWNHOUSE (TOWNHOUSE)
	<COND (<NOT .TOWNHOUSE> <RTRUE>)>
	<RETURN <IN? .TOWNHOUSE ,TOWNHOUSES>>>

<ROUTINE CHECK-VISITS-EQUAL ("OPT" LOCATION COUNTER "AUX" VISITS)
	<COND (<NOT .LOCATION> <SET LOCATION ,HERE>)>
	<COND (<NOT .COUNTER> <SET .COUNTER 1>)>
	<SET VISITS <GETP .LOCATION ,P?VISITS>>
	<COND (<G=? .VISITS 0>
		<RETURN <EQUAL? .VISITS .COUNTER>>
	)>
	<RFALSE>>

<ROUTINE CHECK-VISITS-MORE ("OPT" LOCATION COUNTER "AUX" VISITS)
	<COND (<NOT .LOCATION> <SET LOCATION ,HERE>)>
	<COND (<NOT .COUNTER> <SET .COUNTER 1>)>
	<SET VISITS <GETP .LOCATION ,P?VISITS>>
	<COND (.VISITS <RETURN <G? .VISITS .COUNTER>>)>
	<RFALSE>>

<ROUTINE COMPLETE-MISSION (MISSION "AUX" CODEWORD)
	<COND (<NOT .MISSION> <RETURN>)>
	<SET CODEWORD <GETP .MISSION ,P?CODEWORD>>
	<COND (<OR <CHECK-CODEWORD .CODEWORD> <CHECK-MISSION .MISSION>>
		<PUTP .MISSION ,P?COMPLETED T>
	)>>

<ROUTINE GET-DIFFICULTY (STORY INDEX "AUX" ODDS)
	<SET ODDS <GET <GETP .STORY ,P?REQUIREMENTS> .INDEX>>
	<RETURN <GET .ODDS 2>>>

<ROUTINE GET-RANK ("OPT" CHARACTER "AUX" (RANK 1))
	<COND (<NOT .CHARACTER> <SET CHARACTER ,CURRENT-CHARACTER>)>
	<COND (.CHARACTER <SET RANK <GETP .CHARACTER ,P?RANK>>)>
	<RETURN .RANK>>

<ROUTINE MISSION-COMPLETED (MISSION "AUX" COMPLETED)
	<COND (<NOT .MISSION> <RTRUE>)>
	<SET COMPLETED <GETP .MISSION ,P?COMPLETED>>
	<COND (.COMPLETED <RTRUE>)>
	<RFALSE>>

<ROUTINE NOT-ALL-ANY (TYPE LIST "OPT" CONTAINER "AUX" COUNT)
	<COND (<NOT .CONTAINER> <SET CONTAINER ,PLAYER>)>
	<COND (<EQUAL? .TYPE R-ANY R-ALL>
		<SET COUNT <GET .LIST 0>>
		<HLIGHT ,H-BOLD>
		<CRLF>
		<TELL CR "You do not have ">
		<COND (<G? .COUNT 1>
			<COND (<EQUAL? .TYPE R-ANY>
				<TELL "any">
			)(<EQUAL? .TYPE R-ALL>
				<TELL "all">
			)>
			<TELL " of the">
		)(<EQUAL? .CONTAINER ,CODEWORDS>
			<TELL "the">
		)(<FSET? <GET .LIST 1> ,VOWELBIT>
			<TELL "an">
		)(ELSE
			<TELL "a">
		)>
		<TELL " ">
		<COND (<EQUAL? .CONTAINER ,CODEWORDS>
			<TELL "codeword">
			<COND (<G? .COUNT 1>
				<TELL "s">
				<HLIGHT 0>
				<PRINT-CODEWORDS .LIST>
			)(ELSE
				<TELL " ">
				<HLIGHT 0>
				<HLIGHT ,H-ITALIC>
				<TELL D <GET .LIST 1>>
				<HLIGHT 0>
				<TELL ,PERIOD-CR>
			)>
		)(ELSE
			<COND (<G? .COUNT 1>
				<TELL "items">
				<HLIGHT 0>
				<COND (<EQUAL? .TYPE R-ANY>
					<PRINT-ANY .LIST>
				)(<EQUAL? .TYPE R-ALL>
					<PRINT-ALL .LIST>
				)>
			)(ELSE
				<HLIGHT 0>
				<HLIGHT ,H-ITALIC>
				<TELL D <GET .LIST 1>>
				<HLIGHT 0>
				<TELL ,PERIOD-CR>
			)>
		)>
		<HLIGHT 0>
		<CRLF>
		<PRESS-A-KEY>
	)>>

<ROUTINE NOT-CHARGED (OBJECT)
	<CRLF>
	<CRLF>
	<HLIGHT ,H-BOLD>
	<TELL CT .OBJECT " has no charges left" ,PERIOD-CR>
	<HLIGHT 0>
	<PRESS-A-KEY>>

<ROUTINE NOT-POSSESSED (OBJECT)
	<HLIGHT ,H-BOLD>
	<CRLF>
	<TELL CR "You do not have ">
	<COND (<FSET? .OBJECT ,NARTICLEBIT>
		<TELL "the">
	)(ELSE
		<TELL "a">
		<COND (<FSET? .OBJECT ,VOWELBIT> <TELL "n">)>
	)>
	<TELL " " D .OBJECT ,EXCLAMATION-CR>
	<HLIGHT 0>
	<PRESS-A-KEY>>

<ROUTINE PROCESS-RANDOM (LIST DESTINATIONS "AUX" ODDS (EVENTS 0) RESULT (DESTINATION NONE) (MODIFIERS 0) (OUTCOMES NONE) (HAS-DESTINATION F))
	<SET ODDS <GET .LIST 3>>
	<COND (.ODDS <SET EVENTS <GET .ODDS 0>>)>
	<SET DESTINATION ,HERE>
	<CRLF>
	<COND (<G? .EVENTS 0>
		<REPEAT ()
			<SET HAS-DESTINATION F>
			<CRLF>
			<TELL "Rolling (" N <GET .LIST 1> ") and triggering events with " N .EVENTS " possible outcomes ">
			<SET MODIFIERS <GET .LIST 2>>
			<SET OUTCOMES <GET .LIST 4>>
			<COND (<N=? .MODIFIERS 0>
				<TELL "(">
				<COND (<G? .MODIFIERS 0> <TELL "+">)>
				<TELL N .MODIFIERS " to rolls)">
			)>
			<TELL ".." ,PERIOD-CR>
			<PRESS-A-KEY>
			<SET RESULT <ROLL-DICE <GET .LIST 1>>> ; "roll # of dice"
			<SET RESULT <+ .RESULT <GET .LIST 2>>> ; "add/subtract modifiers"
			<CRLF>
			<TELL "You rolled " N .RESULT "." CR>
			<SETG LAST-ROLL .RESULT>
			<DO (I 1 .EVENTS)
				<COND (<L=? .RESULT <GET .ODDS .I>>
					<SET DESTINATION <GET .DESTINATIONS .I>>
					<EMPHASIZE <GET .OUTCOMES .I> "Outcome">
					<PRESS-A-KEY>
					<COND (<NOT <PROCESS-RANDOM-BLESSING>>
						<SET HAS-DESTINATION T>
					)>
					<RETURN>
				)>
			>
			<COND (.HAS-DESTINATION <RETURN>)>
		>
	)>
	<RETURN .DESTINATION>>

<ROUTINE PROCESS-RANDOM-BLESSING ("AUX" RESULT)
	<SET RESULT F>
	<COND (<CHECK-BLESSING ,BLESSING-LUCK>
		<CRLF>
		<TELL "Change the outcome with " T ,BLESSING-LUCK " blessing?">
		<COND (<YES?>
			<DELETE-BLESSING ,BLESSING-LUCK>
			<SET RESULT T>
		)>
	)>
	<RETURN .RESULT>>

<ROUTINE RESET-DIFFICULTY (STORY INDEX DIFFICULTY "AUX" ODDS)
	<SET ODDS <GET <GETP .STORY ,P?REQUIREMENTS> .INDEX>>
	<PUT .ODDS 2 .DIFFICULTY>>

<ROUTINE RESET-ODDS (DICE MODIFIERS "OPT" STORY "AUX" REQUIREMENTS)
	<COND (<NOT .STORY> <SET .STORY ,HERE>)>
	<SET REQUIREMENTS <GETP .STORY ,P?REQUIREMENTS>>
	<COND (.REQUIREMENTS
		<PUT <GET .REQUIREMENTS 1> 1 .DICE>
		<PUT <GET .REQUIREMENTS 1> 2 .MODIFIERS>
	)>>

; "Story - Support Routines (display)"
; ---------------------------------------------------------------------------------------------

<ROUTINE PRINT-ALL (ITEMS)
	<PRINT-LIST .ITEMS "and ">>

<ROUTINE PRINT-ANY (ITEMS)
	<PRINT-LIST .ITEMS "or ">>

<ROUTINE PRINT-CODEWORDS (CODEWORDS)
	<PRINT-LIST .CODEWORDS "and ">>

<ROUTINE PRINT-LIST (ITEMS "OPT" LASTFIX "AUX" COUNT)
	<COND (.ITEMS
		<SET COUNT <GET .ITEMS 0>>
		<COND (<G? .COUNT 0>
			<TELL " (">
			<DO (I 1 .COUNT)
				<COND (<G? .I 1>
					<COND (<NOT <EQUAL? .COUNT 2>>
						<TELL ", ">
					)(ELSE
						<TELL " ">
					)>
				)>
				<COND (<AND <G? .COUNT 1> <EQUAL? .I .COUNT> .LASTFIX> <TELL .LASTFIX>)>
				<HLIGHT ,H-ITALIC>
				<TELL D <GET .ITEMS .I>>
				<HLIGHT 0>
			>
			<TELL ")">
		)>
	)>>

; "Choose Character / Profession"
; ---------------------------------------------------------------------------------------------

<ROUTINE CHOOSE-CHARACTER ("AUX" COUNT KEY CHOICE CHARACTER POSSESSIONS)
	<SET COUNT <GET CHARACTERS 0>>
	<COND (<G? .COUNT 0>
		<REPEAT ()
			<SET COUNT <GET CHARACTERS 0>>
			<CRLF>
			<HLIGHT ,H-BOLD>
			<TELL "Choose a character:">
			<HLIGHT 0>
			<CRLF>
			<PRINT-MENU ,CHARACTERS T F>
			<HLIGHT ,H-BOLD>
			<TELL "C">
			<HLIGHT 0>
			<TELL " - Choose a Profession" CR>
			<HLIGHT ,H-BOLD>
			<TELL "R">
			<HLIGHT 0>
			<TELL " - Restore from previous save" CR>
			<HLIGHT ,H-BOLD>
			<TELL "Q">
			<HLIGHT 0>
			<TELL " - Quit the game" CR>
			<TELL "Select which character?">
			<REPEAT ()
				<SET KEY <INPUT 1>>
				<COND (<OR <AND <G=? .KEY !\1> <L=? .KEY !\9> <L=? <- .KEY !\0> .COUNT>> <EQUAL? .KEY !\C !\c !\Q !\q !\R !\r>> <RETURN>)>
			>
			<COND (<AND <G=? .KEY !\1> <L=? .KEY !\9>>
				<SET CHOICE <- .KEY !\0>>
				<COND (<AND <G=? <GET CHARACTERS 0> 1> <G=? .CHOICE 1> <L=? .CHOICE <GET CHARACTERS 0>>>
				<SET CHARACTER <GET CHARACTERS .CHOICE>>
					<CRLF>
					<DESCRIBE-CHARACTER .CHARACTER>
					<CRLF>
					<TELL "Select this character?">
					<COND (<YES?>
						<SETG CURRENT-CHARACTER .CHARACTER>
						<SET POSSESSIONS <GETP .CHARACTER ,P?POSSESSIONS>>
						<COND (.POSSESSIONS
							<SET COUNT <GET .POSSESSIONS 0>>
							<DO (I 1 .COUNT)
								<MOVE <GET .POSSESSIONS .I> ,PLAYER>
							>
						)>
						<SETG CURRENT-CHARACTER .CHARACTER>
						<SETG MONEY <GETP .CHARACTER ,P?MONEY>>
						<SETG STAMINA <GETP .CHARACTER ,P?STAMINA>>
						<SETG MAX-STAMINA ,STAMINA>
						<MOVE ,ALL-MONEY ,PLAYER>
						<TELL CR "You have selected " CT ,CURRENT-CHARACTER CR>
						<TELL CR "[Press a key to begin]" CR>
						<INPUT 1>
						<RETURN>
					)>
				)(ELSE
					<CRLF>
				)>
			)(<EQUAL? .KEY !\C !\c>
				<COND (<CHOOSE-PROFESSION> <RETURN>)>
			)(<EQUAL? .KEY !\R !\r>
				<COND (<NOT <RESTORE>>
					<EMPHASIZE "Restore failed.">
				)>
			)(<EQUAL? .KEY !\Q !\q>
				<CRLF>
				<TELL CR ,TEXT-SURE>
				<COND (<YES?>
					<QUIT-MESSAGE>
				)>
			)(ELSE
				<CRLF>
			)>
		>
	)>>

<ROUTINE CHOOSE-PROFESSION ("AUX" COUNT KEY CHOICE PROFESSION POSSESSIONS (RESULT F))
	<CRLF>
	<TELL CR ,INSTRUCTIONS-PROFESSIONS>
	<CRLF>
	<SET COUNT <GET ,PROFESSIONS 0>>
	<COND (<G? .COUNT 0>
		<REPEAT ()
			<SET COUNT <GET ,PROFESSIONS 0>>
			<CRLF>
			<HLIGHT ,H-BOLD>
			<TELL "Choose a professions:">
			<HLIGHT 0>
			<CRLF>
			<PRINT-MENU ,PROFESSIONS T F>
			<HLIGHT ,H-BOLD>
			<TELL "R">
			<HLIGHT 0>
			<TELL " - Return to character selection" CR>
			<HLIGHT ,H-BOLD>
			<TELL "Q">
			<HLIGHT 0>
			<TELL " - Quit the game" CR>
			<TELL "Select which profession?">
			<REPEAT ()
				<SET KEY <INPUT 1>>
				<COND (<OR <AND <G=? .KEY !\1> <L=? .KEY !\9> <L=? <- .KEY !\0> .COUNT>> <EQUAL? .KEY !\Q !\q !\R !\r>> <RETURN>)>
			>
			<COND (<AND <G=? .KEY !\1> <L=? .KEY !\9>>
				<SET CHOICE <- .KEY !\0>>
				<COND (<AND <G=? <GET ,PROFESSIONS 0> 1> <G=? .CHOICE 1> <L=? .CHOICE <GET ,PROFESSIONS 0>>>
					<SET PROFESSION <GET ,PROFESSIONS .CHOICE>>
					<CRLF>
					<DESCRIBE-CHARACTER .PROFESSION>
					<CRLF>
					<TELL "Select this profession?">
					<COND (<YES?>
						<SETG CURRENT-CHARACTER .PROFESSION>
						<SET POSSESSIONS <GETP .PROFESSION ,P?POSSESSIONS>>
						<COND (.POSSESSIONS
							<SET COUNT <GET .POSSESSIONS 0>>
							<DO (I 1 .COUNT)
								<MOVE <GET .POSSESSIONS .I> ,PLAYER>
							>
						)>
						<SETG CURRENT-CHARACTER .PROFESSION>
						<SETG MONEY <GETP .PROFESSION ,P?MONEY>>
						<SETG STAMINA <GETP .PROFESSION ,P?STAMINA>>
						<SETG MAX-STAMINA ,STAMINA>
						<MOVE ,ALL-MONEY ,PLAYER>
						<TELL CR "You have selected " T ,CURRENT-CHARACTER CR>
						<TELL CR "[Press a key to begin]" CR>
						<INPUT 1>
						<SET RESULT T>
						<RETURN>
					)>
				)(ELSE
					<CRLF>
				)>
			)(<EQUAL? .KEY !\R !\r>
				<CRLF>
				<RETURN>
			)(<EQUAL? .KEY !\Q !\q>
				<CRLF>
				<TELL CR ,TEXT-SURE>
				<COND (<YES?>
					<QUIT-MESSAGE>
				)>
			)>
		>
	)>
	<RETURN .RESULT>>

<ROUTINE DESCRIBE-CHARACTER (CHARACTER "AUX" COUNT ITEM POSSESSIONS)
	<COND (.CHARACTER
		<CRLF>
		<HLIGHT ,H-BOLD>
		<TELL CT .CHARACTER CR>
		<HLIGHT 0>
		<COND (<GETP .CHARACTER ,P?LDESC>
			<CRLF>
			<TELL <GETP .CHARACTER ,P?LDESC> ,PERIOD-CR>
		)>
		<DESCRIBE-PLAYER-STATS .CHARACTER .CHARACTER>
		<CRLF>
		<HLIGHT ,H-BOLD>
		<TELL "Possessions: ">
		<HLIGHT 0>
		<SET POSSESSIONS <GETP .CHARACTER ,P?POSSESSIONS>>
		<COND (.POSSESSIONS
			<SET COUNT <GET .POSSESSIONS 0>>
			<COND (<G? .COUNT 0>
				<DO (I 1 .COUNT)
					<SET ITEM <GET .POSSESSIONS .I>>
					<COND (<G? .I 1> <TELL ", ">)>
					<PRINT-ITEM .ITEM>
				>
			)>
		)(ELSE
			<TELL "None">
		)>
		<CRLF>
	)>>

; "Container routines"
; ---------------------------------------------------------------------------------------------

<ROUTINE COUNT-CONTAINER (CONTAINER "OPT" (FLAG NONE) "AUX" COUNT ITEM QUANTITY REMOVE)
	<SET COUNT 0>
	<SET ITEM <FIRST? .CONTAINER>>
	<REPEAT ()
		<SET REMOVE NONE>
		<COND (<NOT .ITEM> <RETURN>)>
		<COND (<NOT <FSET? .ITEM ,NDESCBIT>>
			<COND (<OR <NOT .FLAG> <FSET? .ITEM .FLAG>>
				<SET QUANTITY <GETP .ITEM ,P?QUANTITY>>
				<COND (<G? .QUANTITY 0>
					<SET COUNT <+ .COUNT .QUANTITY>>
				)(<EQUAL? .QUANTITY 0>
					<PUTP .ITEM ,P?QUANTITY 1>
					<SET REMOVE .ITEM>
				)(ELSE
					<INC .COUNT>
				)>
			)>
		)>
		<SET ITEM <NEXT? .ITEM>>
		<COND (.REMOVE <REMOVE .REMOVE>)> ; "remove objects with 0 quantities"
	>
	<RETURN .COUNT>>

<ROUTINE PRINT-CONTAINER (CONTAINER "OPT" (FLAG NONE) "AUX" COUNT ITEMS)
	<COND (<EQUAL? .CONTAINER ,PLAYER> <FIND-BEST-GEAR>)>
	<SET COUNT 0>
	<SET ITEMS <FIRST? .CONTAINER>>
	<COND (.ITEMS
		<REPEAT ()
			<COND (.ITEMS
				<COND (<NOT <FSET? .ITEMS ,NDESCBIT>>
					<COND (.FLAG
						<COND (<FSET? .ITEMS .FLAG>
							<PRINT-ITEM .ITEMS F .COUNT>
							<INC .COUNT>
						)>
					)(ELSE
						<PRINT-ITEM .ITEMS F .COUNT>
						<INC .COUNT>
					)>
				)>
			)(ELSE
				<RETURN>
			)>
			<SET ITEMS <NEXT? .ITEMS>>
		>
	)>
	<COND (<G? .COUNT 0>
		<CRLF>
	)(ELSE
		<TELL "None" CR>
	)>>

<ROUTINE TRANSFER-CONTAINER (FROM TO "AUX" ITEM NEXT)
	<COND (<COUNT-CONTAINER .FROM>
		<SET ITEM <FIRST? .FROM>>
		<REPEAT ()
			<COND (<NOT .ITEM> <RETURN>)>
			<SET NEXT <NEXT? .ITEM>>
			<MOVE .ITEM .TO>
			<SET ITEM .NEXT>
		>
	)>>

; "Player or Item routines"
; ---------------------------------------------------------------------------------------------

<ROUTINE ADD-QUANTITY (OBJECT "OPT" AMOUNT CONTAINER (BUY F) "AUX" QUANTITY CURRENT)
	<COND (<NOT .OBJECT> <RETURN>)>
	<COND (<L=? .AMOUNT 0> <RETURN>)>
	<COND (<NOT .CONTAINER> <SET CONTAINER ,PLAYER>)>
	<COND (<EQUAL? .CONTAINER ,PLAYER>
		<COND (<G? .AMOUNT 0>
			<DO (I 1 .AMOUNT)
				<TAKE-ITEM .OBJECT>
			>
		)>
	)(ELSE
		<SET CURRENT <GETP .OBJECT ,P?QUANTITY>>
		<SET QUANTITY <+ .CURRENT .AMOUNT>>
		<PUTP .OBJECT ,P?QUANTITY .QUANTITY>
	)>>

<ROUTINE AFFLICTED-WITH (DISEASE "OPT" EFFECT)
	<COND (<NOT .EFFECT> <SET EFFECT ,TEXT-AFFLICTED>)>
	<COND (<NOT <CHECK-AILMENT .DISEASE>>
		<COND (<OR <FSET? .DISEASE ,POISONBIT> <FSET? .DISEASE ,DISEASEBIT>>
			<COND (<CHECK-BLESSING ,BLESSING-IMMUNITY-POISON-DISEASE>
				<CRLF>
				<TELL "Use the blessing ">
				<PRINT-ITEM ,BLESSING-IMMUNITY-POISON-DISEASE T>
				<TELL " to counter the ">
				<PRINT-ITEM .DISEASE T>
				<TELL "?">
				<COND (<YES?>
					<DELETE-BLESSING ,BLESSING-IMMUNITY-POISON-DISEASE>
					<RETURN>
				)>
			)>
		)>
		<COND (<AND <EQUAL? .DISEASE ,POISON-SCORPION> <CHECK-ITEM ,SCORPION-ANTIDOTE>>
			<CRLF>
			<TELL "Use the ">
			<PRINT-ITEM ,SCORPION-ANTIDOTE T>
			<TELL " to counter the">
			<PRINT-ITEM .DISEASE T>
			<TELL "?">
			<COND (<YES?>
				<REMOVE-ITEM ,SCORPION-ANTIDOTE "used" T T>
				<RETURN>
			)>
		)>
		<CRLF>
		<TELL "You are " .EFFECT " with the ">
		<PRINT-ITEM .DISEASE T>
		<TELL ,PERIOD-CR>
		<MOVE .DISEASE ,AILMENTS>
	)>>

<ROUTINE BUY-ITEM (ITEM FEE)
	<COND (<AND <G=? ,MONEY .FEE> <NOT <CHECK-ITEM .ITEM>>>
		<CRLF>
		<TELL "Do you want to buy ">
		<PRINT-ITEM .ITEM T>
		<TELL " for ">
		<HLIGHT ,H-BOLD>
		<TELL N .FEE " shards?">
		<HLIGHT 0>
		<COND (<YES?>
			<COST-MONEY .FEE ,TEXT-PAID>
			<TAKE-ITEM .ITEM>
		)>
	)>>

<ROUTINE BUY-ITEMS (ITEM PRICE "OPT" MAX "AUX" NUMBER)
	<COND (<NOT .MAX> <SET MAX 1>)>
	<COND (<G=? ,MONEY .PRICE>
		<REPEAT ()
			<COND (<L=? ,MONEY .PRICE> <RETURN>)>
			<CRLF>
			<COND (<FSET? .ITEM ,NARTICLEBIT>
				<TELL "The">
			)(ELSE
				<TELL "A">
				<COND (<FSET? .ITEM ,VOWELBIT> <TELL "n">)>
			)>
			<TELL " ">
			<PRINT-ITEM .ITEM T>
			<TELL " sells at ">
			<HLIGHT ,H-BOLD>
			<TELL N .PRICE " " D ,CURRENCY>
			<HLIGHT 0>
			<TELL " each.">
			<SET NUMBER <GET-NUMBER "How many will you buy?" 0 .MAX>>
			<COND (<G? .NUMBER 0>
				<COND (<G=? ,MONEY <* .PRICE .NUMBER>>
					<CRLF>
					<TELL "Are you sure?">
					<COND (<YES?>
						<COST-MONEY <* .PRICE .NUMBER> "paid">
						<DO (I 1 .NUMBER)
							<TAKE-ITEM .ITEM T>
						>
						<COND (<G=? .NUMBER .MAX>
							<RETURN>
						)(ELSE
							<SET MAX <- .MAX .NUMBER>>
						)>
					)>
				)(ELSE
					<EMPHASIZE "You can't afford that!">
				)>
			)(ELSE
				<RETURN>
			)>
		>
	)>>

<ROUTINE COST-MONEY (COST "OPT" REASON)
	<CRLF>
	<HLIGHT ,H-BOLD>
	<TELL "You ">
	<COND (.REASON
		<TELL .REASON>
	)(ELSE
		<TELL "are charged">
	)>
	<TELL " " N .COST " " D ,CURRENCY ,PERIOD-CR>
	<HLIGHT 0>
	<SETG MONEY <- ,MONEY .COST>>
	<COND (<L? ,MONEY 0> <SETG MONEY 0>)>
	<UPDATE-STATUS-LINE>>

<ROUTINE COUNT-BLESSINGS (ITEM "AUX" (ITEMS 0) (BLESSINGS 0) (PROPERTY NONE))
	<COND (.ITEM
		<SET ITEMS <GET ,ABILITIES 0>>
		<DO (I 1 .ITEMS)
			<SET PROPERTY <GET-ABILITY-PROPERTY .I>>
			<COND (<AND .PROPERTY <GETP .ITEM .PROPERTY> <G? <GETP .ITEM .PROPERTY> 0>>
				<INC .BLESSINGS>
			)>
		>
	)>
	<RETURN .BLESSINGS>>

<ROUTINE COUNT-POSSESSIONS ()
	<RETURN <COUNT-CONTAINER ,PLAYER>>>

<ROUTINE CURE-AILMENTS (FEE FLAG "OPT" (FLAG2 NONE) "AUX" COUNT)
	<COND (<NOT .FLAG> <RETURN>)>
	<COND (<G=? ,MONEY .FEE>
		<SET COUNT <COUNT-CONTAINER ,AILMENTS .FLAG>>
		<COND (.FLAG2 <SET COUNT <+ .COUNT <COUNT-CONTAINER ,AILMENTS .FLAG2>>>)>
		<COND (<G? .COUNT 0>
			<CRLF>
			<COND (<G? .FEE 0>
				<TELL "Pay ">
				<HLIGHT ,H-BOLD>
				<TELL N .FEE " " D ,CURRENCY>
				<HLIGHT 0>
			)(<EQUAL? .FEE 0>
				<TELL "Do you wish">
			)>
			<TELL " to be cured?">
			<COND (<YES?>
				<COND (<G? .FEE 0> <COST-MONEY .FEE TEXT-PAID>)>
				<COND (<G? <COUNT-CONTAINER ,AILMENTS .FLAG> 0>
					<CRLF>
					<TELL "You are cured of: ">
					<PRINT-CONTAINER ,AILMENTS .FLAG>
					<RESET-CONTAINER ,AILMENTS .FLAG>
				)>
				<COND (.FLAG2
					<COND (<G? <COUNT-CONTAINER ,AILMENTS .FLAG2> 0>
						<CRLF>
						<TELL "You are cured of: ">
						<PRINT-CONTAINER ,AILMENTS .FLAG2>
						<RESET-CONTAINER ,AILMENTS .FLAG2>
					)>
				)>
			)>
		)(ELSE
			<COND (<EQUAL? .FLAG ,CURSEBIT ,CURSEBIT>
				<EMPHASIZE "There are no curses to lift!">
			)(<EQUAL? .FLAG ,POISONBIT ,POISONBIT>
				<EMPHASIZE "You are not poisoned!">
			)(<EQUAL? .FLAG ,DISEASEBIT ,DISEASEBIT>
				<EMPHASIZE "There are no diseases to cure!">
			)>
		)>
	)(ELSE
		<EMPHASIZE "You cannot afford a cure at this time!">
	)>>

<ROUTINE DELETE-AILMENT (AILMENT FLAG TYPE FIX)
	<COND (<CHECK-AILMENT .AILMENT>
		<COND (<FSET? .AILMENT .FLAG>
			<CRLF>
			<TELL "The " .TYPE ": ">
			<PRINT-ITEM .AILMENT T>
			<TELL " has been " .FIX ,EXCLAMATION-CR>
			<REMOVE .AILMENT>
		)>
	)>>

<ROUTINE DELETE-BLESSING (BLESSING)
	<DELETE-OBJECT .BLESSING CHECK-BLESSING "blessing of">>

<ROUTINE DELETE-CODEWORD (CODEWORD)
	<DELETE-OBJECT .CODEWORD CHECK-CODEWORD "codeword">>

<ROUTINE DELETE-CURSE (CURSE)
	<DELETE-AILMENT .CURSE ,CURSEBIT "curse" "lifted">>

<ROUTINE DELETE-DISEASE (DISEASE)
	<DELETE-AILMENT .DISEASE ,DISEASEBIT "disease" "cured">>

<ROUTINE DELETE-POISON (POISON)
	<DELETE-AILMENT .POISON ,POISONBIT "poison" "remedied">>

<ROUTINE DELETE-TITLE (TITLE)
	<DELETE-OBJECT .TITLE CHECK-TITLE "title of">>

<ROUTINE DELETE-OBJECT (OBJECT CHECK-ROUTINE DESCRIPTION "OPT" (RENDER H-BOLD))
	<COND (<AND .OBJECT <APPLY .CHECK-ROUTINE .OBJECT>>
		<CRLF>
		<TELL "You lose the " .DESCRIPTION " ">
		<HLIGHT .RENDER>
		<TELL D .OBJECT>
		<HLIGHT 0>
		<TELL ,PERIOD-CR>
		<REMOVE .OBJECT>
	)>>

<ROUTINE DESCRIBE-INVENTORY-MAIN ("AUX" COUNT)
	<SET COUNT <COUNT-POSSESSIONS>>
	<TELL "You are carrying " N .COUNT " items">
	<COND (<G? .COUNT 0>
		<TELL ": ">
		<PRINT-CONTAINER ,PLAYER>
	)(ELSE
		<TELL ,PERIOD-CR>
	)>>

<ROUTINE DESCRIBE-INVENTORY ()
	<COND (,CURRENT-CHARACTER
		<CRLF>
		<DESCRIBE-INVENTORY-MAIN>
	)>>

<ROUTINE DESCRIBE-PLAYER ()
	<COND (,CURRENT-CHARACTER
		<DESCRIBE-PLAYER-BACKGROUND>
		<DESCRIBE-PLAYER-STATS>
		<DESCRIBE-PLAYER-LOCATION>
		<DESCRIBE-PLAYER-TOWNHOUSES>
		<DESCRIBE-PLAYER-POSSESSIONS>
		<DESCRIBE-PLAYER-CODEWORDS>
		<DESCRIBE-PLAYER-SHIPS>
		<DESCRIBE-PLAYER-TITLES>
		<DESCRIBE-PLAYER-BLESSINGS>
		<DESCRIBE-PLAYER-WORSHIP>
		<DESCRIBE-PLAYER-RESURRECTIONS>
		<DESCRIBE-PLAYER-AILMENTS>
		<DESCRIBE-PLAYER-MISSIONS>
		<DESCRIBE-PLAYER-CURRENCY>
	)>>

<ROUTINE DESCRIBE-PLAYER-AILMENTS ()
	<COND (<G? <COUNT-CONTAINER ,AILMENTS> 0>
		<HLIGHT ,H-BOLD>
		<PRINT-CAP-OBJ ,AILMENTS>
		<TELL ": ">
		<HLIGHT 0>
		<PRINT-CONTAINER ,AILMENTS>
	)>>

<ROUTINE DESCRIBE-PLAYER-BACKGROUND ()
	<CRLF>
	<HLIGHT ,H-BOLD>
	<TELL CT ,CURRENT-CHARACTER CR>
	<HLIGHT 0>
	<COND (<GETP ,CURRENT-CHARACTER, P?LDESC>
		<CRLF>
		<TELL <GETP ,CURRENT-CHARACTER ,P?LDESC> CR>
	)>>

<ROUTINE DESCRIBE-PLAYER-BLESSINGS ()
	<COND (<G? <COUNT-CONTAINER ,BLESSINGS> 0>
		<HLIGHT ,H-BOLD>
		<PRINT-CAP-OBJ ,BLESSINGS>
		<TELL ": ">
		<HLIGHT 0>
		<PRINT-CONTAINER ,BLESSINGS>
	)>>

<ROUTINE DESCRIBE-PLAYER-CODEWORDS ()
	<COND (<G? <COUNT-CONTAINER ,CODEWORDS> 0>
		<HLIGHT ,H-BOLD>
		<PRINT-CAP-OBJ ,CODEWORDS>
		<TELL ": ">
		<HLIGHT 0>
		<PRINT-CONTAINER ,CODEWORDS>
	)>>

<ROUTINE DESCRIBE-PLAYER-CURRENCY ()
	<HLIGHT ,H-BOLD>
	<PRINT-CAP-OBJ ,CURRENCY>
	<TELL ": ">
	<HLIGHT 0>
	<TELL N ,MONEY CR>>

<ROUTINE DESCRIBE-PLAYER-LOCATION ()
	<CRLF>
	<HLIGHT ,H-BOLD>
	<TELL "Current Location: ">
	<HLIGHT 0>
	<TELL "Somewhere in " <GET-LOCATION ,CURRENT-LOCATION> CR>>

<ROUTINE DESCRIBE-PLAYER-MISSIONS ()
	<COND (<G? <COUNT-CONTAINER ,MISSIONS> 0>
		<HLIGHT ,H-BOLD>
		<PRINT-CAP-OBJ ,MISSIONS>
		<TELL ": ">
		<HLIGHT 0>
		<PRINT-CONTAINER ,MISSIONS>
	)>>

<ROUTINE DESCRIBE-PLAYER-POSSESSIONS ()
	<COND (<L=? <COUNT-CONTAINER ,TOWNHOUSES> 0> <CRLF>)>
	<HLIGHT ,H-BOLD>
	<TELL "Possessions: ">
	<HLIGHT 0>
	<PRINT-CONTAINER ,PLAYER>
	<COND (<OR ,BEST-ARMOUR ,BEST-WEAPON>
		<COND (,BEST-ARMOUR
			<HLIGHT ,H-BOLD>
			<TELL "Best Armour: ">
			<HLIGHT 0>
			<PRINT-ITEM ,BEST-ARMOUR>
			<COND (,BEST-WEAPON <TELL " ">)>
		)>
		<COND (,BEST-WEAPON
			<HLIGHT ,H-BOLD>
			<TELL "Best Weapon: ">
			<HLIGHT 0>
			<PRINT-ITEM ,BEST-WEAPON>
		)>
		<CRLF>
	)>>

<ROUTINE DESCRIBE-PLAYER-RESURRECTIONS ()
	<COND (,RESURRECTION-ARRANGEMENTS
		<HLIGHT ,H-BOLD>
		<TELL "Resurrection Arrangements: ">
		<HLIGHT 0>
		<TELL D ,RESURRECTION-ARRANGEMENTS>
		<CRLF>
	)>>

<ROUTINE DESCRIBE-PLAYER-STATS ("OPT" CHARACTER CONTAINER)
	<COND (<NOT .CHARACTER> <SET CHARACTER ,CURRENT-CHARACTER>)>
	<COND (<NOT .CONTAINER> <SET CONTAINER ,PLAYER>)>
	<CRLF>
	<TELL "RANK: " N <GET-RANK .CHARACTER> CR>
	<COND (<GETP .CHARACTER ,P?PROFESSION>
		<TELL "PROFESSION: " D <GETP .CHARACTER ,P?PROFESSION> CR>
	)>
	<COND (<NOT ,CURRENT-CHARACTER>
		<TELL "STAMINA: " N <GETP .CHARACTER ,P?STAMINA> CR>
	)(ELSE
		<TELL "STAMINA: " N ,STAMINA CR>
	)>
	<TELL "DEFENSE: " N <CALCULATE-DEFENSE .CHARACTER .CONTAINER> CR>
	<TELL "CHARISMA: " N <CALCULATE-ABILITY .CHARACTER ABILITY-CHARISMA .CONTAINER> CR>
	<TELL "COMBAT: " N <CALCULATE-ABILITY .CHARACTER ABILITY-COMBAT .CONTAINER> CR>
	<TELL "MAGIC: " N <CALCULATE-ABILITY .CHARACTER ABILITY-MAGIC .CONTAINER> CR>
	<TELL "SANCTITY: " N <CALCULATE-ABILITY .CHARACTER ABILITY-SANCTITY .CONTAINER> CR>
	<TELL "SCOUTING: " N <CALCULATE-ABILITY .CHARACTER ABILITY-SCOUTING .CONTAINER> CR>
	<TELL "THIEVERY: " N <CALCULATE-ABILITY .CHARACTER ABILITY-THIEVERY .CONTAINER> CR>>

<ROUTINE DESCRIBE-PLAYER-SHIPS ()
	<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
		<HLIGHT ,H-BOLD>
		<PRINT-CAP-OBJ ,SHIPS>
		<TELL ": ">
		<HLIGHT 0>
		<PRINT-CONTAINER ,SHIPS>
		<HLIGHT ,H-BOLD>
		<PRINT-CAP-OBJ ,CARGO>
		<TELL ": ">
		<HLIGHT 0>
		<PRINT-CONTAINER ,CARGO>
	)>>

<ROUTINE DESCRIBE-PLAYER-TITLES ()
	<COND (<G? <COUNT-CONTAINER ,TITLES-AND-HONOURS> 0>
		<HLIGHT ,H-BOLD>
		<PRINT-CAP-OBJ ,TITLES-AND-HONOURS>
		<TELL ": ">
		<HLIGHT 0>
		<PRINT-CONTAINER ,TITLES-AND-HONOURS>
	)>>

<ROUTINE DESCRIBE-PLAYER-TOWNHOUSES ()
	<COND (<G? <COUNT-CONTAINER ,TOWNHOUSES> 0>
		<CRLF>
		<HLIGHT ,H-BOLD>
		<PRINT-CAP-OBJ ,TOWNHOUSES>
		<TELL ": ">
		<HLIGHT 0>
		<PRINT-CONTAINER ,TOWNHOUSES>
	)>>

<ROUTINE DESCRIBE-PLAYER-WORSHIP ()
	<COND (,GOD
	<HLIGHT ,H-BOLD>
	<TELL "God: ">
	<HLIGHT 0>
	<TELL D ,GOD>
	<CRLF>
	)>>

<ROUTINE DISCHARGE-ITEM (ITEM "OPT" AMOUNT "AUX" (CHARGES 0))
	<SET CHARGES <GETP .ITEM ,P?CHARGES>>
	<COND (<G? .CHARGES 0>
		<COND (<NOT .AMOUNT> <SET AMOUNT 1>)>
		<SET CHARGES <- .CHARGES .AMOUNT>>
		<COND (<L? .CHARGES 1> <SET CHARGES 0>)>
		<PUTP .ITEM ,P?CHARGES .CHARGES>
	)>>

<ROUTINE DROP-REPLACE-ITEM (OBJ "AUX" KEY COUNT ITEM CHOICE QUANTITY)
	<COND (<AND .OBJ <G=? <COUNT-POSSESSIONS> ,LIMIT-POSSESSIONS>>
		<REPEAT ()
			<CRLF>
			<TELL "Please choose an item to drop:" CR>
			<SET COUNT 0>
			<SET ITEM <FIRST? ,PLAYER>>
			<REPEAT ()
				<COND (<NOT .ITEM> <RETURN>)>
				<COND (<NOT <FSET? .ITEM ,NDESCBIT>>
					<INC .COUNT>
					<HLIGHT ,H-BOLD>
					<TELL N .COUNT>
					<HLIGHT 0>
					<TELL " - " T .ITEM>
					<SET QUANTITY <GETP .ITEM ,P?QUANTITY>>
					<COND (<G? .QUANTITY 0> <TELL " (" N .QUANTITY ")">)>
					<CRLF>
				)>
				<SET ITEM <NEXT? .ITEM>>
			>
			<HLIGHT ,H-BOLD>
			<TELL N <+ .COUNT 1>>
			<HLIGHT 0>
			<TELL " - drop " T .OBJ " instead" ,PERIOD-CR>
			<REPEAT ()
				<SET KEY <INPUT 1>>
				<COND (<AND <G? .KEY !\0> <L=? .KEY <+ .COUNT 49>>> <RETURN>)>
			>
			<COND (<AND <G? .KEY 48> <L? .KEY <+ .COUNT 49>>>
				<SET CHOICE <- .KEY 48>>
				<SET ITEM <GET-ITEM .CHOICE>>
				<COND (.ITEM
					<CRLF>
					<TELL "Drop " T .ITEM "?">
					<COND (<YES?>
						<HLIGHT 0>
						<TELL CR "You dropped ">
						<HLIGHT ,H-BOLD>
						<TELL T .ITEM>
						<HLIGHT 0>
						<TELL " and took ">
						<HLIGHT ,H-BOLD>
						<TELL T .OBJ>
						<HLIGHT 0>
						<TELL ,PERIOD-CR>
						<COND (<NOT <EQUAL? .ITEM .OBJ>>
							<SET QUANTITY <GETP .ITEM ,P?QUANTITY>>
							<COND (<G? .QUANTITY 0>
								<DEC .QUANTITY>
								<COND (<G? .QUANTITY 0>
									<PUTP .ITEM ,P?QUANTITY .QUANTITY>
								)(ELSE
									<PUTP .ITEM ,P?QUANTITY 1>
									<REMOVE .ITEM>
								)>
							)(<EQUAL? .QUANTITY 0>
								<PUTP .ITEM ,P?QUANTITY 1>
								<REMOVE .ITEM>
							)(ELSE
								<REMOVE .ITEM>
							)>
							<COND (<IN? .OBJ ,PLAYER>
								<SET QUANTITY <GETP .OBJ ,P?QUANTITY>>
								<COND (<G=? .QUANTITY 0> <PUTP .OBJ ,P?QUANTITY <+ .QUANTITY 1>>)>
							)>
							<MOVE .OBJ ,PLAYER>
						)>
						<RETURN>
					)>
				)>
			)(<EQUAL? .KEY <+ .COUNT 49>>
				<CRLF>
				<TELL "Drop " T .OBJ "?">
				<COND (<YES?>
					<HLIGHT 0>
					<TELL CR "You dropped ">
					<HLIGHT ,H-BOLD>
					<TELL T .OBJ>
					<HLIGHT 0>
					<TELL ,PERIOD-CR>
					<SET QUANTITY <GETP .OBJ ,P?QUANTITY>>
					<COND (<L? .QUANTITY 0> <REMOVE .OBJ>)>
					<RETURN>
				)>
			)>
		>
	)>>

<ROUTINE GAIN-BLESSING (BLESSING)
	<GAIN-OBJECT .BLESSING ,BLESSINGS "blessing" CHECK-BLESSING>>

<ROUTINE GAIN-CODEWORD (CODEWORD)
	<GAIN-OBJECT .CODEWORD ,CODEWORDS "codeword" CHECK-CODEWORD>>

<ROUTINE GAIN-MONEY (AMOUNT)
	<CRLF>
	<TELL "You gain ">
	<HLIGHT ,H-BOLD>
	<TELL N .AMOUNT " " D ,CURRENCY>
	<HLIGHT 0>
	<TELL ,PERIOD-CR>
	<SETG MONEY <+ ,MONEY .AMOUNT>>
	<UPDATE-STATUS-LINE>>

<ROUTINE GAIN-OBJECT (OBJECT CONTAINER DESCRIPTION CHECK-ROUTINE)
	<COND (<NOT <APPLY .CHECK-ROUTINE .OBJECT>>
		<CRLF>
		<TELL "You gained the " .DESCRIPTION " ">
		<PRINT-ITEM .OBJECT <NOT <EQUAL? .CONTAINER ,CODEWORDS>>>
		<TELL ,PERIOD-CR>
		<MOVE .OBJECT .CONTAINER>
	)>>

<ROUTINE GAIN-RANK ("OPT" (GAIN 1) "AUX" RANK)
	<COND (,CURRENT-CHARACTER
		<CRLF>
		<SET RANK <GET-RANK ,CURRENT-CHARACTER>>
		<SET RANK <+ .RANK .GAIN>>
		<TELL "You've gained a rank! Your rank is now is now: ">
		<HLIGHT ,H-BOLD>
		<TELL N .RANK>
		<HLIGHT 0>
		<TELL ,PERIOD-CR>
		<PUTP ,CURRENT-CHARACTER ,P?RANK .RANK>
	)>>

<ROUTINE GAIN-CACHE (CACHE)
	<GAIN-OBJECT .CACHE ,TOWNHOUSES "secret cache" CHECK-TOWNHOUSE>>

<ROUTINE GAIN-STAMINA (POINTS "AUX" DIFFERENCE)
	<COND (<L? ,STAMINA ,MAX-STAMINA>
		<SET DIFFERENCE <- ,MAX-STAMINA ,STAMINA>>
		<CRLF>
		<SETG STAMINA <+ ,STAMINA .POINTS>>
		<HLIGHT ,H-BOLD>
		<TELL "You gained ">
		<COND (<G? ,STAMINA ,MAX-STAMINA>
			<SETG STAMINA ,MAX-STAMINA>
			<TELL N .DIFFERENCE>
		)(ELSE
			<TELL N .POINTS>
		)>
		<TELL " stamina" ,PERIOD-CR>
		<HLIGHT 0>
    )>>

<ROUTINE GAIN-TITLE (TITLE)
	<GAIN-OBJECT .TITLE ,TITLES-AND-HONOURS "title" CHECK-TITLE>>

<ROUTINE GAIN-TOWNHOUSE (TOWNHOUSE)
	<GAIN-OBJECT .TOWNHOUSE ,TOWNHOUSES "townhouse" CHECK-TOWNHOUSE>>

<ROUTINE GET-ITEM (ITEM "OPT" CONTAINER "AUX" ITEMS COUNT)
	<COND (<NOT .CONTAINER> <SET CONTAINER ,PLAYER>)>
	<COND(<AND .ITEM <G=? <COUNT-CONTAINER .CONTAINER> 0>>
		<SET COUNT 0>
		<SET ITEMS <FIRST? .CONTAINER>>
		<REPEAT ()
			<COND (.ITEMS
				<COND (<NOT <FSET? .ITEMS ,NDESCBIT>>
					<INC .COUNT>
					<COND (<EQUAL? .COUNT .ITEM> <RETURN>)>
				)>
			)(ELSE
				<RETURN>
			)>
			<SET ITEMS <NEXT? .ITEMS>>
		>
		<RETURN .ITEMS>
	)>>

<ROUTINE GET-LOCATION (LOCATION)
	<COND (<L=? .LOCATION 20>
		<RETURN <GET ,LOCATIONS .LOCATION>>
	)>>

<ROUTINE GIVE-ITEM (ITEM "OPT" (SILENT F))
	<REMOVE-ITEM .ITEM "gave" F .SILENT>>

<ROUTINE KEEP-ITEM (ITEM "OPT" JUMP)
	<CRLF>
	<TELL "Keep " T .ITEM "?">
	<COND (<YES?>
		<COND (<NOT <CHECK-ITEM .ITEM>> <TAKE-ITEM .ITEM>)>
		<COND (.JUMP <STORY-JUMP .JUMP>)>
		<RTRUE>
	)>
	<COND (<CHECK-ITEM .ITEM> <LOSE-ITEM .ITEM>)>
	<RFALSE>>

<ROUTINE LOSE-ITEM (ITEM "OPT" (SILENT F))
	<REMOVE-ITEM .ITEM "lost" F .SILENT>>

<ROUTINE LOSE-MONEY (COST)
	<COST-MONEY .COST "lose">>

<ROUTINE LOSE-STAMINA (DAMAGE MESSAGE STORY)
	<SETG STAMINA <- ,STAMINA .DAMAGE>>
	<COND (<L? ,STAMINA 0> <SETG STAMINA 0>)>
	<UPDATE-STATUS-LINE>
	<CRLF>
	<HLIGHT ,H-BOLD>
	<COND (<L? ,STAMINA 1>
		<PUTP .STORY ,P?DOOM T>
		<TELL .MESSAGE>
		<SETG CONTINUE-TO-CHOICES F>
	)(ELSE
		<PUTP .STORY ,P?DOOM F>
		<TELL "You lost " N .DAMAGE " stamina">
	)>
	<HLIGHT 0>
	<TELL ,PERIOD-CR>>

<ROUTINE LOSE-STUFF (CONTAINER LOST-CONTAINER ITEM "OPT" MAX ACTION "AUX" (COUNT 0) ITEMS)
	<COND (<NOT .MAX> <SET MAX 1>)>
	<RESET-CONTAINER .LOST-CONTAINER>
	<COND (<G? <COUNT-CONTAINER .CONTAINER> .MAX>
		<RESET-TEMP-LIST>
		<SET ITEMS <COUNT-CONTAINER .CONTAINER>>
		<DO (I 1 .ITEMS)
			<SET COUNT <+ .COUNT 1>>
			<COND (<L=? .COUNT .ITEMS>
				<PUT ,TEMP-LIST .COUNT <GET-ITEM .I .CONTAINER>>
			)>
		>
		<REPEAT ()
			<COND (.ACTION <APPLY .ACTION>)>
			<SELECT-FROM-LIST ,TEMP-LIST .COUNT .MAX .ITEM .CONTAINER "retain">
			<COND (<EQUAL? <COUNT-CONTAINER .CONTAINER> .MAX>
				<CRLF>
				<TELL "You have selected: ">
				<PRINT-CONTAINER .CONTAINER>
				<CRLF>
				<TELL "Do you agree?">
				<COND (<YES?> <RETURN>)>
			)(ELSE
				<CRLF>
				<HLIGHT ,H-BOLD>
				<TELL "You must select " N .MAX " " .ITEM>
				<COND (<G? .MAX 1> <TELL "s">)>
				<TELL ,PERIOD-CR>
				<HLIGHT 0>
			)>
		>
		<DO (I 1 .COUNT)
			<COND (<NOT <IN? <GET ,TEMP-LIST .I> .CONTAINER>>
				<MOVE <GET ,TEMP-LIST .I> .LOST-CONTAINER>
			)>
		>
	)>>

<ROUTINE POISONED-WITH (POISON)
	<AFFLICTED-WITH .POISON ,TEXT-POISONED>>

<ROUTINE PRINT-BLESSINGS (ITEM "OPT"  "AUX" (COUNT 0) (ITEMS 0) (SCORE 0) (PROPERTY NONE))
	<COND (<G? <COUNT-BLESSINGS .ITEM> 0>
		<SET ITEMS <GET ,ABILITIES 0>>
		<DO (I 1 .ITEMS)
			<SET PROPERTY <GET-ABILITY-PROPERTY .I>>
			<COND (<G? .PROPERTY 0>
				<SET SCORE <GETP .ITEM .PROPERTY>>
				<COND (<AND .SCORE <G? .SCORE 0>>
					<INC .COUNT>
					<COND (<G? .COUNT 1> <TELL ", ">)>
					<TELL "+" N .SCORE " " <GET ,ABILITIES .I>>
				)>
			)>
		>
	)>>

<ROUTINE PRINT-ITEM (ITEMS "OPT" (BOLD F) (COUNT 0) (NO-QUANTITY F) "AUX" (QUANTITY 1) CHARGES BLESSINGS STARS (WORN F) (EFFECTS NONE) CONDITION)
	<COND (.ITEMS
		<COND (<NOT <FSET? .ITEMS ,NDESCBIT>>
			<SET BLESSINGS <COUNT-BLESSINGS .ITEMS>>
			<COND (<NOT .NO-QUANTITY>
				<SET QUANTITY <GETP .ITEMS ,P?QUANTITY>>
			)>
			<SET CHARGES <GETP .ITEMS ,P?CHARGES>>
			<SET STARS <GETP .ITEMS ,P?STARS>>
			<SET WORN <AND <FSET? .ITEMS ,WEARBIT> <FSET? .ITEMS ,WORNBIT>>>
			<SET EFFECTS <GETP .ITEMS ,P?EFFECTS>>
			<SET CONDITION <GETP .ITEMS ,P?CONDITION>>
			<COND (<G? .COUNT 0> <TELL ", ">)>
			<COND (.BOLD <HLIGHT ,H-BOLD>)(ELSE <HLIGHT ,H-ITALIC>)>
			<TELL D .ITEMS>
			<HLIGHT 0>
			<COND (<OR <G? .BLESSINGS 0> <G? .QUANTITY 1> <G? .CHARGES 0> <G? .STARS 0> .WORN .EFFECTS <G=? .CONDITION 0>> <TELL " (">)>
			<COND (<G? .BLESSINGS 0> <PRINT-BLESSINGS .ITEMS>)>
			<COND (<G? .QUANTITY 1>
				<COND (<G? .BLESSINGS 0>
					<TELL ", quantity: ">
				)(<OR <G? .STARS 0> <G? .CHARGES 0> .WORN>
					<TELL "quantity: ">
				)>
				<TELL N .QUANTITY>
			)>
			<COND (<G=? .CHARGES 1>
				<COND (<OR <G? .BLESSINGS 0> <G? .QUANTITY 1>> <TELL ", ">)>
				<TELL "charges: " N .CHARGES>
			)>
			<COND (<G=? .STARS 0>
				<COND (<OR <G? .BLESSINGS 0> <G? .QUANTITY 1> <G? .CHARGES 0>> <TELL ", ">)>
				<TELL "stars: " N .STARS>
			)>
			<COND (.WORN
				<COND (<OR <G? .BLESSINGS 0> <G? .QUANTITY 1> <G? .CHARGES 0> <G? .STARS 0>> <TELL ", ">)>
				<TELL "worn">
			)>
			<COND (.EFFECTS
				<COND (<OR <G? .BLESSINGS 0> <G? .QUANTITY 1> <G? .CHARGES 0> <G? .STARS 0> .WORN> <TELL ", ">)>
				<PRINT-MODIFIERS .ITEMS>
			)>
			<COND (<G=? .CONDITION 0>
				<COND (<OR <G? .BLESSINGS 0> <G? .QUANTITY 1> <G? .CHARGES 0> <G? .STARS 0> .WORN .EFFECTS> <TELL ", ">)>
				<TELL "condition: " <GET ,CONDITIONS <+ .CONDITION 1>>>
				<COND (<GETP .ITEMS ,P?DOCKED> <TELL ", docked at: " <GET ,DOCKS <GETP .ITEMS ,P?DOCKED>>>)>
			)>
			<COND (<OR <G? .BLESSINGS 0> <G? .QUANTITY 1> <G? .CHARGES 0> <G? .STARS 0> .WORN .EFFECTS <G=? .CONDITION 0>> <TELL ")">)>
		)>
	)>>

<ROUTINE PRINT-MODIFIERS (ITEM "AUX" (EFFECTS NONE) (EFFECT 0) (MODIFIERS 0))
	<COND (<NOT .ITEM> <RETURN>)>
	<SET EFFECTS <GETP .ITEM ,P?EFFECTS>>
	<COND (.EFFECTS
		<DO (I 1 6)
			<SET EFFECT <GET .EFFECTS .I>>
			<COND (<AND <G? .MODIFIERS 0> <G? .EFFECT 0>> <TELL ", ">)>
			<COND (<N=? .EFFECT 0>
				<COND (<G? .EFFECT 0> <TELL "+">)>
				<TELL N .EFFECT " " <GET ,ABILITIES .I>>
				<INC .MODIFIERS>
			)>
		>
	)>>

<ROUTINE REMOVE-ITEM (ITEM REASON "OPT" (USE-THE F) (SILENT F) "AUX" QUANTITY)
	<SET QUANTITY <GETP .ITEM ,P?QUANTITY>>
	<CRLF>
	<TELL "You " .REASON " ">
	<COND (<L? .QUANTITY 0>
		<REMOVE .ITEM>
	)(ELSE
		<COND (<G? .QUANTITY 0>
			<DEC .QUANTITY>
			<COND (<G? .QUANTITY 0>
				<PUTP .ITEM ,P?QUANTITY .QUANTITY>
			)(ELSE
				<PUTP .ITEM ,P?QUANTITY 1>
				<REMOVE .ITEM>
			)>
		)(ELSE
			<PUTP .ITEM ,P?QUANTITY 1>
			<REMOVE .ITEM>
		)>
	)>
    <COND (<OR .USE-THE <L? .QUANTITY 0>>
        <TELL "the ">
	)(ELSE
		<TELL "a">
		<COND (<FSET? .ITEM ,VOWELBIT> <TELL "n">)>
		<TELL " ">
	)>
	<PRINT-ITEM .ITEM T>
	<TELL ,PERIOD-CR>
	<COND (<NOT .SILENT> <PRESS-A-KEY>)>
	<WEAR-BEST>
	<FIND-BEST-GEAR>>

<ROUTINE RETURN-ITEM (ITEM "OPT" (SILENT F))
	<REMOVE-ITEM .ITEM "returned" T .SILENT>>

<ROUTINE SELECT-FROM-LIST (LIST ITEMS MAX "OPT" DESC CONTAINER ACTION "AUX" KEY COUNT CHOICE)
	<COND (<NOT .CONTAINER> <SET CONTAINER ,PLAYER>)>
	<COND (<NOT .ACTION> <SET ACTION "take">)>
	<SET COUNT 0>
	<COND (<NOT .DESC> <SET DESC "item">)>
	<RESET-SELECTIONS>
	<REPEAT ()
		<CRLF>
		<COND (<EQUAL? .CONTAINER ,PLAYER>
			<TELL "You are already carrying " N <COUNT-POSSESSIONS> " items in your inventory" ,PERIOD-CR>
		)>
		<TELL "You can select up to " N .MAX " " .DESC "s from:" CR>
		<DO (I 1 .ITEMS)
			<HLIGHT ,H-BOLD>
			<COND (<L? .I 10>
				<TELL N .I>
			)(ELSE
				<TELL C <+ <- .I 10> !\A>>
			)>
			<HLIGHT 0>
			<TELL " - [">
			<COND (<INTBL? <GET .LIST .I> ,SELECT-CHOICES 21> <TELL "X">)(ELSE <TELL " ">)>
			<TELL "] - ">
			<PRINT-ITEM <GET .LIST .I> T>
			<CRLF>
		>
		<COND (<AND <OR <EQUAL? .CONTAINER ,PLAYER>> <L? .ITEMS 12>>
			<HLIGHT ,H-BOLD>
			<TELL "C">
			<HLIGHT 0>
			<TELL " - View your character (" D ,CURRENT-CHARACTER ")" CR>
		)>
		<HLIGHT ,H-BOLD>
		<TELL "0">
		<HLIGHT 0>
		<TELL " - I'm alright with my choices" ,PERIOD-CR>
		<TELL "Select which " .DESC "(s) to ">
		<TELL .ACTION>
		<TELL ":" CR>
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (
				<OR
					<AND <EQUAL? .CONTAINER ,PLAYER> <L? .ITEMS 12> <EQUAL? .KEY !\c !\C>>
					<AND <EQUAL? .CONTAINER ,PLAYER> <L? .ITEMS 18> <EQUAL? .KEY !\i !\I>>
					<AND <G=? .KEY !\A> <L=? .KEY !\F> <L=? <+ <- .KEY !\A> 10> .ITEMS>>
					<AND <G=? .KEY !\a> <L=? .KEY !\f> <L=? <+ <- .KEY !\a> 10> .ITEMS>>
					<AND <G=? .KEY !\1> <L=? .KEY !\9> <L=? <- .KEY !\0> .ITEMS>>
					<AND <EQUAL? .KEY !\h !\H> <L? .ITEMS 17>>
					<EQUAL? .KEY !\0 !\?>
				>
				<RETURN>
			)>
		>
		<COND (<EQUAL? .KEY !\0>
			<COND (<L? .COUNT .MAX>
				<CRLF>
				<TELL ,TEXT-SURE>
				<COND(<YES?> <RETURN>)>
			)(ELSE
				<RETURN>
			)>
		)>
		<COND (<AND <EQUAL? .CONTAINER ,PLAYER> <L? .ITEMS 12> <EQUAL? .KEY !\c !\C>> <DESCRIBE-PLAYER> <PRESS-A-KEY>)>
		<COND (<AND <EQUAL? .CONTAINER ,PLAYER> <L? .ITEMS 18> <EQUAL? .KEY !\i !\I>> <DESCRIBE-INVENTORY> <PRESS-A-KEY>)>
		<COND (<OR <EQUAL? .KEY !\?> <AND <EQUAL? .KEY !\h !\H> <L? .ITEMS 17>>> <DISPLAY-HELP> <PRESS-A-KEY>)>
		<COND (<OR <AND <G=? .KEY !\1> <L=? .KEY !\9>> <AND <G=? .KEY !\a> <L=? .KEY !\f>> <AND <G=? .KEY !\A> <L=? .KEY !\F>>>
			<COND (<AND <G=? .KEY !\a> <L=? .KEY !\f>>
				<SET CHOICE <+ <- .KEY !\a> 10>>
			)(<AND <G=? .KEY !\A> <L=? .KEY !\F>>
				<SET CHOICE <+ <- .KEY !\A> 10>>
			)(ELSE
				<SET CHOICE <- .KEY !\0>>
			)>
			<COND (<L=? .CHOICE .ITEMS>
				<COND (<INTBL? <GET .LIST .CHOICE> ,SELECT-CHOICES 21>
					<PUT ,SELECT-CHOICES <GET-INDEX ,SELECT-CHOICES <GET .LIST .CHOICE>> NONE>
					<DEC .COUNT>
				)(ELSE
					<COND (<EQUAL? .COUNT .MAX>
						<CRLF>
						<HLIGHT ,H-BOLD>
						<TELL "You have already selected " N .MAX " " .DESC "s" ,EXCLAMATION-CR>
						<HLIGHT 0>
					)(ELSE
						<INC .COUNT>
						<PUT ,SELECT-CHOICES <GET-INDEX ,SELECT-CHOICES NONE> <GET .LIST .CHOICE>>
					)>
				)>
			)>
		)>
	>
	<COND (<G? .COUNT 0>
		<DO (I 1 20)
			<COND (<GET ,SELECT-CHOICES .I>
				<COND (<EQUAL? .CONTAINER ,PLAYER>
					<TAKE-ITEM <GET ,SELECT-CHOICES .I>>
				)(ELSE
					<MOVE <GET ,SELECT-CHOICES .I> .CONTAINER>
				)>
			)>
		>
	)>>

<ROUTINE SET-DESTINATION (STORY DESTINATION NEW)
	<PUT <GETP .STORY ,P?DESTINATIONS> .DESTINATION .NEW>>

<ROUTINE SET-LOCATION (LOCATION)
	<SETG CURRENT-LOCATION .LOCATION>>

<ROUTINE STORM-AT-SEA (STORY JUMP "AUX" (DICE 1) (ODDS NONE) (PARAMETERS NONE) (CONDITION 0))
	<COND (<NOT .STORY> <SET STORY ,HERE>)>
	<COND (<CHECK-BLESSING ,BLESSING-SAFETY-FROM-STORMS>
		<CRLF>
		<TELL "Use the blessing ">
		<PRINT-ITEM ,BLESSING-SAFETY-FROM-STORMS T>
		<TELL " for safe passage?">
		<COND (<YES?>
			<CRLF>
			<TELL ,TEXT-BLESSING-STORM-SAFETY>
			<DELETE-BLESSING ,BLESSING-SAFETY-FROM-STORMS>
			<TELL ,PERIOD-CR>
			<STORY-JUMP .JUMP>
			<RETURN>
		)>
	)>
	<RESET-ODDS 1 0 .STORY>
	<SET ODDS <GETP .STORY ,P?REQUIREMENTS>>
	<SET PARAMETERS <GET .ODDS 1>>
	<COND (<EQUAL? ,CURRENT-SHIP ,SHIP-BRIGANTINE>
		<SET DICE 2>
	)(<EQUAL? ,CURRENT-SHIP ,SHIP-GALLEON>
		<SET DICE 3>
	)>
	<PUT .PARAMETERS 1 .DICE>
	<COND (,CURRENT-SHIP
		<SET CONDITION <GETP ,CURRENT-SHIP ,P?CONDITION>>
		<COND (.CONDITION
			<COND (<EQUAL? .CONDITION ,CONDITION-EXCELLENT>
				<PUT .PARAMETERS 2 2>
			)(<EQUAL? .CONDITION ,CONDITION-GOOD>
				<PUT .PARAMETERS 2 1>
			)>
		)>
	)>
	>

<ROUTINE TAKE-ITEM (ITEM "OPT" (BUY F) "AUX" QUANTITY)
	<COND (.ITEM
		<CRLF>
		<COND (.BUY
			<TELL "You bought ">
		)(ELSE
			<TELL "You gained ">
		)>
		<COND (<FSET? .ITEM ,NARTICLEBIT>
			<TELL "the">
		)(ELSE
			<TELL "a">
			<COND (<FSET? .ITEM ,VOWELBIT> <TELL "n">)>
		)>
		<TELL " ">
		<PRINT-ITEM .ITEM T 0 .BUY>
		<TELL ,PERIOD-CR>
		<COND (<G=? <COUNT-POSSESSIONS> ,LIMIT-POSSESSIONS>
			<EMPHASIZE "You are carrying too many items!">
			<DROP-REPLACE-ITEM .ITEM>
		)(ELSE
			; "check if object has the QUANTITY property"
			<SET QUANTITY <GETP .ITEM ,P?QUANTITY>>
			<COND (<L? .QUANTITY 0>
				<COND (<NOT <CHECK-ITEM .ITEM>> <MOVE .ITEM ,PLAYER>)>
			)(ELSE
				<COND (<IN? .ITEM ,PLAYER>
					<PUTP .ITEM ,P?QUANTITY <+ .QUANTITY 1>>
				)(ELSE
					<PUTP .ITEM ,P?QUANTITY 1>
					<MOVE .ITEM ,PLAYER>
				)>
			)>
		)>
	)>
	<WEAR-BEST>
	<FIND-BEST-GEAR>>

<ROUTINE TAKE-MISSION (MISSION "OPT" CODEWORD)
	<GAIN-OBJECT .MISSION ,MISSIONS "mission" CHECK-MISSION>
	<SET CODEWORD <GETP .MISSION ,P?CODEWORD>>
	<COND (.CODEWORD <GAIN-CODEWORD .CODEWORD>)>>

<ROUTINE TAKE-QUANTITIES (OBJECT PLURAL MESSAGE "OPT" AMOUNT)
	<CRLF>
	<TELL "Take the " .PLURAL "?">
	<COND (<YES?> <ADD-QUANTITY .OBJECT <GET-NUMBER .MESSAGE 0 .AMOUNT> ,PLAYER>)>>

<ROUTINE UPGRADE-ABILITIES (POINTS "AUX" KEY ABILITY CURRENT)
	<COND (<NOT ,CURRENT-CHARACTER> <RETURN>)>
	<REPEAT ()
		<COND (<L=? .POINTS 0> <RETURN>)>
		<CRLF>
		<TELL "You have " N .POINTS " point">
		<COND (<G? .POINTS 1> <TELL "s">)>
		<TELL " to allocate:" CR>
		<DO (I 1 6)
			<HLIGHT ,H-BOLD>
			<TELL N .I>
			<HLIGHT 0>
			<TELL " - " <GET ,ABILITIES .I> " (" N <GET-ABILITY-SCORE ,CURRENT-CHARACTER .I> ")" CR>
		>
		<TELL "Select ability to improve:">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<AND <G=? .KEY !\1> <L=? .KEY !\8>> <RETURN>)>
		>
		<CRLF>
		<SET ABILITY <- .KEY !\0>>
		<SET CURRENT <GET-ABILITY-SCORE ,CURRENT-CHARACTER .ABILITY>>
		<COND (<L? .CURRENT 12>
			<CRLF>
			<TELL "Add +1 to " <GET ,ABILITIES .ABILITY> "?">
			<COND (<YES?>
				<CRLF>
				<TELL "Your ">
				<HLIGHT ,H-BOLD>
				<TELL <GET ,ABILITIES .ABILITY>>
				<HLIGHT 0>
				<TELL " score improved from ">
				<HLIGHT ,H-BOLD>
				<TELL N .CURRENT>
				<HLIGHT 0>
				<TELL " -> ">
				<HLIGHT ,H-BOLD>
				<INC .CURRENT>
				<TELL N .CURRENT ,EXCLAMATION-CR>
				<HLIGHT 0>
				<PUTP ,CURRENT-CHARACTER <GET-ABILITY-PROPERTY .ABILITY> .CURRENT>
				<DEC .POINTS>
			)>
		)(ELSE
			<CRLF>
			<TELL "Your ">
			<HLIGHT ,H-BOLD>
			<TELL <GET ,ABILITIES .ABILITY>>
			<HLIGHT 0>
			<TELL " score is already at a maximum" ,EXCLAMATION-CR>
		)>
	>>

<ROUTINE UPGRADE-ABILITY (ABILITY "OPT" UPGRADE "AUX" SCORE PROPERTY)
	<COND (<NOT ,CURRENT-CHARACTER> <RETURN>)>
	<COND (<NOT .UPGRADE> <SET UPGRADE 1>)>
	<SET SCORE <GET-ABILITY-SCORE ,CURRENT-CHARACTER .ABILITY>>
	<CRLF>
	<TELL "Your " <GET ,ABILITIES .ABILITY> " score has improved from ">
	<HLIGHT ,H-BOLD>
	<TELL N .SCORE>
	<HLIGHT 0>
	<SET PROPERTY <GET-ABILITY-PROPERTY .ABILITY>>
	<COND (.PROPERTY <PUTP ,CURRENT-CHARACTER .PROPERTY .SCORE>)>
	<TELL " to ">
	<SET SCORE <+ .SCORE .UPGRADE>>
	<HLIGHT ,H-BOLD>
	<TELL N .SCORE ,EXCLAMATION-CR>
	<HLIGHT 0>>

<ROUTINE UPGRADE-STAMINA ("OPT" UPGRADE)
	<COND (<NOT .UPGRADE> <SET UPGRADE 1>)>
	<CRLF>
	<TELL "You've gained ">
	<HLIGHT ,H-BOLD>
	<TELL "+" N .UPGRADE>
	<HLIGHT 0>
	<TELL " stamina permanently!" CR>
	<SETG MAX-STAMINA <+ ,MAX-STAMINA .UPGRADE>>
	<SETG STAMINA <+ ,STAMINA .UPGRADE>>
	<COND (<G? ,STAMINA ,MAX-STAMINA> <SETG STAMINA ,MAX-STAMINA>)>
	<UPDATE-STATUS-LINE>>

<ROUTINE WEAR-BEST ("AUX" ITEMS DEFENSE (SCORE 0))
	<SET ITEMS <FIRST? ,PLAYER>>
	<REPEAT ()
		<COND (<NOT .ITEMS> <RETURN>)>
		<COND (<FSET? .ITEMS ,WEARBIT>
			<FCLEAR .ITEMS ,WORNBIT>
			<SET DEFENSE <GETP .ITEMS ,P?DEFENSE>>
			<COND (<AND <G? .DEFENSE 0> <G? .DEFENSE .SCORE>>
				<SET SCORE .DEFENSE>
			)>
		)>
		<SET .ITEMS <NEXT? .ITEMS>>
	>
	<COND (<G? .SCORE 0>
		<SET ITEMS <FIRST? ,PLAYER>>
		<REPEAT ()
			<COND (<NOT .ITEMS> <RETURN>)>
			<COND (<FSET? .ITEMS ,WEARBIT>
				<SET DEFENSE <GETP .ITEMS ,P?DEFENSE>>
				<COND (<AND <G? .DEFENSE 0> <EQUAL? .DEFENSE .SCORE>>
					<FSET .ITEMS ,WORNBIT>
					<SET-BEST-GEAR .ITEMS>
					<RETURN>
				)>
			)>
			<SET .ITEMS <NEXT? .ITEMS>>
		>
	)>>

; "Story - Merchant routines (display)"
; ---------------------------------------------------------------------------------------------

<ROUTINE MERCHANT (WARES PRICELIST "OPT" CONTAINER (SELL F) (LIMIT 0) "AUX" ITEM ITEMS KEY QUANTITY)
	<COND (<NOT .CONTAINER> <SET CONTAINER ,PLAYER>)>
	<COND (<OR <NOT .WARES> <NOT .PRICELIST>> <RETURN>)>
	<SET ITEMS <GET .WARES 0>>
	<REPEAT MAIN ()
		<CRLF>
		<COND (<NOT .SELL>
			<TELL "You can buy anything you have money for:">
		)(ELSE
			<TELL "You can sell these items at these prices if you have them:">
		)>
		<CRLF>
		<PRINT-MENU .WARES T T NONE NONE .PRICELIST T>
		<COND (<L? .ITEMS 12>
			<HLIGHT ,H-BOLD>
			<TELL "C">
			<HLIGHT 0>
			<COND (<EQUAL? .CONTAINER ,PLAYER>
				<TELL " - View your character (" D ,CURRENT-CHARACTER ")">
			)(<EQUAL? .CONTAINER ,CARGO>
				<TELL " - View cargo">
				<COND (,CURRENT-SHIP <TELL " (" D ,CURRENT-SHIP ")">)>
			)>
			<CRLF>
		)>
		<COND (<AND <EQUAL? .CONTAINER ,PLAYER> <L? .ITEMS 18>>
			<HLIGHT ,H-BOLD>
			<TELL "I">
			<HLIGHT 0>
			<TELL " - Display inventory" CR>
		)>
		<HLIGHT ,H-BOLD>
		<TELL "0">
		<HLIGHT 0>
		<TELL " - Bye" CR>
		<TELL "You are carrying " N ,MONEY " " D ,CURRENCY ": ">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (
				<OR
					<AND <EQUAL? .KEY !\c !\C> <L? .ITEMS 12> <EQUAL? .CONTAINER ,PLAYER ,CARGO>>
					<AND <EQUAL? .KEY !\i !\I> <L? .ITEMS 18> <EQUAL? .CONTAINER ,PLAYER>>
					<AND <EQUAL? .KEY !\h !\H> <L? .ITEMS 17>>
					<AND <G=? .KEY !\1> <L=? .KEY !\9> <L=? <- .KEY !\0> .ITEMS>>
					<AND <G=? .KEY !\A> <L=? .KEY !\J> <G? .ITEMS 9> <L=? <+ <- .KEY !\A> 10> .ITEMS>>
					<AND <G=? .KEY !\a> <L=? .KEY !\j> <G? .ITEMS 9> <L=? <+ <- .KEY !\a> 10> .ITEMS>>
					<EQUAL? .KEY !\? !\0>
				>
				<RETURN>
			)>
		>
		<CRLF>
		<COND (<AND <EQUAL? .KEY !\c !\C> <EQUAL? .CONTAINER ,PLAYER ,CARGO> <L? .ITEMS 12>>
			<COND (<EQUAL? .CONTAINER ,PLAYER>
				<DESCRIBE-PLAYER>
			)(ELSE
				<TELL CR "Current designated ship: ">
				<COND (,CURRENT-SHIP <PRINT-ITEM ,CURRENT-SHIP T>)(ELSE <TELL "None">)>
				<CRLF>
				<TELL "Cargo: ">
				<PRINT-CONTAINER ,CARGO>
			)>
			<PRESS-A-KEY>
		)>
		<COND (<AND <EQUAL? .KEY !\i !\I> <EQUAL? .CONTAINER ,PLAYER> <L? .ITEMS 18>> <DESCRIBE-INVENTORY> <PRESS-A-KEY>)>
		<COND (<AND <EQUAL? .KEY !\h !\H> <L? .ITEMS 17>> <DISPLAY-HELP> <PRESS-A-KEY>)>
		<COND (<EQUAL? .KEY !\?> <DISPLAY-HELP> <PRESS-A-KEY>)>
		<COND (
			<OR
				<AND <G=? .KEY !\1> <L=? .KEY !\9> <L=? <- .KEY !\0> .ITEMS>>
				<AND <G=? .KEY !\A> <L=? .KEY !\J> <G? .ITEMS 9> <L=? <+ <- .KEY !\A> 10> .ITEMS>>
				<AND <G=? .KEY !\a> <L=? .KEY !\j> <G? .ITEMS 9> <L=? <+ <- .KEY !\a> 10> .ITEMS>>
			>
			<COND (<AND <G=? .KEY !\1> <L=? .KEY !\9> <L=? <- .KEY !\0> .ITEMS>>
				<SET ITEM <- .KEY !\0>>
			)(<AND <G=? .KEY !\A> <L=? .KEY !\J> <G? .ITEMS 9> <L=? <+ <- .KEY !\A> 10> .ITEMS>>
				<SET ITEM <+ <- .KEY !\A> 10>>
			)(<AND <G=? .KEY !\a> <L=? .KEY !\j> <G? .ITEMS 9> <L=? <+ <- .KEY !\a> 10> .ITEMS>>
				<SET ITEM <+ <- .KEY !\a> 10>>
			)>
			<CRLF>
			<COND (<NOT .SELL>
				<COND (<AND <G? .LIMIT 0> <N=? .CONTAINER ,PLAYER> <G=? <COUNT-CONTAINER .CONTAINER> .LIMIT>>
					<HLIGHT ,H-BOLD>
					<TELL "Your " D .CONTAINER " is already at full capacity" ,EXCLAMATION-CR>
					<HLIGHT 0>
					<PRESS-A-KEY>
					<AGAIN .MAIN>
				)(<L=? <GET .PRICELIST .ITEM> 0>
					<HLIGHT ,H-BOLD>
					<TELL <GET .WARES .ITEM> " not available here" ,PERIOD-CR>
					<HLIGHT 0>
					<PRESS-A-KEY>
					<AGAIN .MAIN>
				)>
				<TELL "Purchase ">
				<PRINT-ITEM <GET .WARES .ITEM> T>
				<TELL " (" N <GET .PRICELIST .ITEM> " " D ,CURRENCY ")?">
			)(ELSE
				<TELL "Sell ">
				<PRINT-ITEM <GET .WARES .ITEM> T>
				<TELL " (" N <GET .PRICELIST .ITEM> " " D ,CURRENCY ")?">
			)>
			<COND (<YES?>
				<COND (<NOT .SELL>
					<CRLF>
					<COND (<L? ,MONEY <GET .PRICELIST .ITEM>>
						<TELL "You can't afford the ">
						<PRINT-ITEM <GET .WARES .ITEM> T>
						<TELL ,EXCLAMATION-CR>
						<PRESS-A-KEY>
					)(ELSE
						<COND (<FSET? <GET .WARES .ITEM> ,TAKEBIT>
							<COND (<IN? <GET .WARES .ITEM> .CONTAINER>
								<SET QUANTITY <GETP <GET .WARES .ITEM> ,P?QUANTITY>>
								<COND (<L=? .QUANTITY 0>
									<TELL "You already have the ">
									<PRINT-ITEM <GET .WARES .ITEM> T>
									<TELL ,EXCLAMATION-CR>
									<PRESS-A-KEY>
								)(ELSE
									<SETG MONEY <- ,MONEY <GET .PRICELIST .ITEM>>>
									<ADD-QUANTITY <GET .WARES .ITEM> 1 .CONTAINER T>
								)>
							)(ELSE
								<SETG MONEY <- ,MONEY <GET .PRICELIST .ITEM>>>
								<TELL "You bought ">
								<COND (<FSET? <GET .WARES .ITEM> ,NARTICLEBIT>
									<TELL "the">
								)(ELSE
									<TELL "a">
									<COND (<FSET? <GET .WARES .ITEM> ,VOWELBIT> <TELL "n">)>
								)>
								<TELL " ">
								<PRINT-ITEM <GET .WARES .ITEM> T>
								<TELL ,PERIOD-CR>
								<COND (<AND <EQUAL? .CONTAINER ,PLAYER> <EQUAL? <COUNT-POSSESSIONS> ,LIMIT-POSSESSIONS> <NOT <IN? <GET .WARES .ITEM> .CONTAINER>>>
									<EMPHASIZE "You are carrying too many items.">
									<DROP-REPLACE-ITEM <GET .WARES .ITEM>>
								)(ELSE
									<MOVE <GET .WARES .ITEM> .CONTAINER>
								)>
							)>
						)(ELSE
							<TELL "You can't have that" ,EXCLAMATION-CR>
							<PRESS-A-KEY>
						)>
					)>
				)(ELSE
					<COND (<OR <AND <EQUAL? .CONTAINER ,PLAYER> <CHECK-ITEM <GET .WARES .ITEM>>> <IN? <GET .WARES .ITEM> .CONTAINER>>
						<REMOVE-ITEM <GET .WARES .ITEM> "sold" F T>
						<SETG MONEY <+ ,MONEY <GET .PRICELIST .ITEM>>>
						<REMOVE-ITEM <GET .WARES .ITEM> "sold" F T>
					)(ELSE
						<CRLF>
						<TELL "You do not have any ">
						<PRINT-ITEM <GET .WARES .ITEM> T>
						<TELL ,EXCLAMATION-CR>
						<PRESS-A-KEY>
					)>
				)>
			)>
		)>
		<UPDATE-STATUS-LINE>
		<COND (<EQUAL? .KEY !\0>
			<CRLF>
			<TELL ,TEXT-SURE>
			<COND (<YES?> <RTRUE>)>
		)>
	>>

; "Reset routines"
; ---------------------------------------------------------------------------------------------

<ROUTINE RESET-AILMENTS ()
	<RESET-CONTAINER ,AILMENTS>>

<ROUTINE RESET-BLESSINGS ()
	<RESET-CONTAINER ,BLESSINGS>>

<ROUTINE RESET-CARGO ()
	<RESET-CONTAINER ,CARGO>>

<ROUTINE RESET-CHOICES ()
	<SETG CONTINUE-TO-CHOICES T>>

<ROUTINE RESET-CODEWORDS ()
	<RESET-CONTAINER ,CODEWORDS>>

<ROUTINE RESET-CONTAINER (CONTAINER "OPT" (FLAG) "AUX" ITEM NEXT)
	<SET ITEM <FIRST? .CONTAINER>>
	<REPEAT ()
		<COND (<NOT .ITEM> <RETURN>)>
		<SET NEXT <NEXT? .ITEM>>
		<COND (.FLAG
			<COND (<FSET? .ITEM .FLAG> <REMOVE .ITEM>)>
		)(ELSE
			<REMOVE .ITEM>
		)>
		<SET ITEM .NEXT>
	>
	<COND (<EQUAL? .CONTAINER ,PLAYER>
		<MOVE ,ALL-MONEY .CONTAINER>
		<SETG BEST-WEAPON NONE>
		<SETG BEST-ARMOUR NONE>
	)>>

<ROUTINE RESET-MISSIONS ()
	<PUTP ,MISSION-BOOK-SAGES ,P?COMPLETED F>
	<PUTP ,MISSION-CITADEL-VELIS ,P?COMPLETED F>
	<PUTP ,MISSION-GHOUL-HEAD ,P?COMPLETED F>
	<PUTP ,MISSION-GOLDEN-NET ,P?COMPLETED F>
	<PUTP ,MISSION-NEGRAN-CORIN ,P?COMPLETED F>
	<RESET-CONTAINER ,MISSIONS>>

<ROUTINE RESET-PLAYER ()
	<SETG LAST-ROLL 0>
	<SETG CURRENT-CHARACTER NONE>
	<SETG CURRENT-SHIP NONE>
	<SETG GOD NONE>
	<SETG MAX-STAMINA 0>
	<SETG MONEY 0>
	<SETG RESURRECTION-ARRANGEMENTS NONE>
	<SETG STAMINA 0>
	<SETG RANSOM 0>
	<RESET-AILMENTS>
	<RESET-BLESSINGS>
	<RESET-CARGO>
	<RESET-CODEWORDS>
	<RESET-MISSIONS>
	<RESET-POSSESSIONS>
	<RESET-TITLES>
	<RESET-TOWNHOUSES>
	<RESET-SHIPS>>

<ROUTINE RESET-POSSESSIONS ()
	<RESET-CONTAINER ,PLAYER>>

<ROUTINE RESET-SELECTIONS ()
	<DO (I 1 20) <PUT ,SELECT-CHOICES .I NONE>>>

<ROUTINE RESET-TEMP-LIST ("AUX" ITEMS)
	<SET ITEMS <GET ,TEMP-LIST 0>>
	<DO (I 1 .ITEMS)
		<PUT ,TEMP-LIST .I NONE>
	>>

<ROUTINE RESET-TITLES ()
	<RESET-CONTAINER ,TITLES-AND-HONOURS>>

<ROUTINE RESET-TOWNHOUSES ()
	<PUTP ,TOWNHOUSE-YELLOWPORT ,P?MONEY 0>
	<PUTP ,TOWNHOUSE-MARLOCK ,P?MONEY 0>
	<PUTP ,TOWNHOUSE-CARAN-BARU ,P?MONEY 0>
	<PUTP ,CACHE-YELLOWPORT ,P?MONEY 0>
	<RESET-CONTAINER ,TOWNHOUSE-YELLOWPORT>
	<RESET-CONTAINER ,TOWNHOUSE-MARLOCK>
	<RESET-CONTAINER ,TOWNHOUSE-CARAN-BARU>
	<RESET-CONTAINER ,CACHE-YELLOWPORT>
	<RESET-CONTAINER ,TOWNHOUSES>>

<ROUTINE RESET-SHIPS ()
	<RESET-CONTAINER ,SHIPS>>

; "System/Utility/Miscellaneous routines"
; ---------------------------------------------------------------------------------------------

<ROUTINE EMPHASIZE (TEXT "OPT" SPEAKER)
	<COND (.TEXT
		<CRLF>
		<HLIGHT ,H-BOLD>
		<COND (<ASSIGNED? SPEAKER>
			<TELL .SPEAKER ": ">
			<HLIGHT 0>
		)>
		<TELL .TEXT>
		<HLIGHT 0>
		<CRLF>
	)>>

<ROUTINE GET-INDEX (LIST ITEM "AUX" COUNT)
	<COND (.LIST
		<SET COUNT <GET .LIST 0>>
		<DO (I 1 .COUNT)
			<COND (<EQUAL? .ITEM <GET .LIST .I>>
				<RETURN .I>
			)>
		>
	)>
	<RETURN 0>>

<ROUTINE GET-NUMBER (MESSAGE "OPT" MINIMUM MAXIMUM "AUX" COUNT)
	<REPEAT ()
		<CRLF>
		<TELL .MESSAGE>
		<COND (<AND <OR <ASSIGNED? MINIMUM> <ASSIGNED? MAXIMUM>> <G? .MAXIMUM .MINIMUM>>
			<TELL " (" N .MINIMUM "-" N .MAXIMUM ")">
		)>
		<TELL "? ">
		<READLINE>
		<COND (<EQUAL? <GETB ,LEXBUF 1> 1> <SET COUNT <CONVERT-TO-NUMBER 1 10>>
			<COND (<OR .MINIMUM .MAXIMUM>
				<COND (<AND <G=? .COUNT .MINIMUM> <L=? .COUNT .MAXIMUM>> <RETURN>)>
			)(<G? .COUNT 0>
				<RETURN>
			)>
		)>
	>
	<RETURN .COUNT>>

<ROUTINE PRESS-A-KEY ()
	<TELL CR "[Press a key to continue]" CR>
	<INPUT 1>>

<ROUTINE PRINT-MENU (CHOICES ITEM-MENU SHOW-STATS "OPT" EXIT-KEY EXIT-TEXT PRICES (NO-QUANTITY F)"AUX" ITEMS)
	<COND (<NOT .CHOICES> <RETURN>)>
	<SET ITEMS <GET .CHOICES 0>>
	<DO (I 1 .ITEMS)
		<HLIGHT ,H-BOLD>
		<COND (<L? .I 10>
			<TELL N .I>
		)(ELSE
			<TELL C <+ !\A <- .I 10>>>
		)>
		<HLIGHT 0>
		<TELL " - ">
		<COND (.ITEM-MENU
			<COND (.SHOW-STATS
				<PRINT-ITEM <GET .CHOICES .I> T 0 .NO-QUANTITY>
			)(ELSE
				<TELL D <GET .CHOICES .I>>
			)>
		)(ELSE
			<TELL <GET .CHOICES .I>>
		)>
		<COND (.PRICES
			<COND (<G? <GET .PRICES .I> 0>
				<TELL " (">
				<HLIGHT ,H-BOLD>
				<TELL N <GET .PRICES .I>>
				<HLIGHT 0>
				<TELL " " D ,CURRENCY ")">
			)>
		)>
		<CRLF>
	>
	<COND (<AND .EXIT-KEY .EXIT-TEXT>
		<HLIGHT ,H-BOLD>
		<TELL C .EXIT-KEY>
		<HLIGHT 0>
		<TELL " - " .EXIT-TEXT>
		<CRLF>
	)>>

<ROUTINE PRINT-CONTAINER-MENU ("OPT" CONTAINER EXIT-KEY EXIT-TEXT "AUX" ITEMS COUNT)
	<COND (<NOT .CONTAINER> <SET CONTAINER ,PLAYER>)>
	<COND (<L=? <COUNT-CONTAINER .CONTAINER> 0> <RETURN>)>
	<SET ITEMS <FIRST? .CONTAINER>>
	<SET COUNT 0>
	<REPEAT ()
		<COND (<NOT .ITEMS> <RETURN>)>
		<COND (<NOT <FSET? .ITEMS ,NDESCBIT>>
			<INC .COUNT>
			<HLIGHT ,H-BOLD>
			<COND (<L? .COUNT 10>
				<TELL N .COUNT>
			)(ELSE
				<TELL C <+ !\A <- .COUNT 10>>>
			)>
			<HLIGHT 0>
			<TELL " - ">
			<PRINT-ITEM .ITEMS>
			<CRLF>
		)>
		<SET .ITEMS <NEXT? .ITEMS>>
	>
	<COND (<AND .EXIT-KEY .EXIT-TEXT>
		<HLIGHT ,H-BOLD>
		<TELL C .EXIT-KEY>
		<HLIGHT 0>
		<TELL " - " .EXIT-TEXT>
		<CRLF>
	)>>

; "Status Line routines"
; ---------------------------------------------------------------------------------------------

<ROUTINE LINE-ERASE (ROW)
	<CURSET .ROW 1>
	<DO (I <LOWCORE SCRH> 1 -1) <PRINTC !\ >>
	<CURSET .ROW 1>>

<ROUTINE UPDATE-STATUS-LINE ("AUX" WIDTH)
	<SPLIT 2>
	<SCREEN 1>
	<SET WIDTH <LOWCORE SCRH>>
	<HLIGHT ,H-INVERSE>
	<LINE-ERASE 1>
	<COND (,HERE
		<CURSET 1 1>
		<TELL D ,HERE>
		<COND (<G? <GETP ,HERE ,P?VISITS> 1>
			<TELL " (Visited " N <GETP ,HERE ,P?VISITS> " times)">
		)>
		<COND (,CURRENT-CHARACTER
			<COND (,CURRENT-SHIP <TELL " "> <PRINT-CAP-OBJ ,CURRENT-SHIP>)>
			<CURSET 1 <- .WIDTH 20>>
			<TELL "Stamina: " N ,STAMINA "/" N ,MAX-STAMINA>
			<LINE-ERASE 2>
			<CURSET 2 1>
			<PRINT-CAP-OBJ ,CURRENT-CHARACTER>
			<CURSET 2 <- .WIDTH 20>>
			<PRINT-CAP-OBJ ,CURRENCY>
			<COND (<G? ,MONEY 9999>
				<TELL ": lots">
			)(ELSE
				<TELL ": " N ,MONEY>
			)>
		)>
	)>
	<SCREEN 0>
	<HLIGHT 0>>

; "Gamebook loop routines"
; ---------------------------------------------------------------------------------------------

<ROUTINE GAMES-UP ("OPT" TEXT "AUX" W)
	<COND (.TEXT <TELL .TEXT CR>)>
	<CRLF>
	<PRINT-GAME-OVER>
	<CRLF>
	<REPEAT PROMPT ()
		<PRINTI "Would you like to RESTART or QUIT? > ">
		<REPEAT ()
			<READLINE>
			<SET W <AND <GETB ,LEXBUF 1> <GET ,LEXBUF 1>>>
			<COND (<EQUAL? .W ,W?RESTART>
				<RESTART>
			)(<EQUAL? .W ,W?QUIT>
				<QUIT-MESSAGE>
			)(T
				<TELL CR "(Please type RESTART or QUIT) > ">
			)>
		>
	>>

<ROUTINE PRINT-ENDING (MESSAGE "OPT" COLOR)
	<COND (<NOT .COLOR> <SET COLOR 1>)>
	<CRLF>
	<HLIGHT ,H-BOLD>
	<COLOR .COLOR 0>
	<TELL .MESSAGE>
	<COLOR 1 0>
	<HLIGHT 0>
	<GAMES-UP>>

<ROUTINE QUIT-MESSAGE ()
	<TELL CR "Thanks for playing" ,PERIOD-CR>
	<QUIT>>

; "Characters for War-Torn Kingdom"
; ---------------------------------------------------------------------------------------------

<CONSTANT CHARACTERS <LTABLE CHARACTER-LIANA CHARACTER-CHALOR CHARACTER-ANDRIEL CHARACTER-MARANA CHARACTER-IGNATIUS CHARACTER-ASTARIEL>>
<CONSTANT PROFESSIONS <LTABLE PROFESSION-PRIEST PROFESSION-MAGE PROFESSION-ROGUE PROFESSION-TROUBADOUR PROFESSION-WARRIOR PROFESSION-WAYFARER>>

<OBJECT CHARACTER-LIANA
	(DESC "Liana The Swift")
	(LDESC "Liana prefers to make her home in mountain grottos and woodland groves rather than in the squalid streets of cities. She has the agility of a gazelle, the cunning of a fox and the ferocity of an eagle. She has heard of a City of Trees, deep within the forest of the Isle of Druids.")
	(RANK 1)
	(PROFESSION PROFESSION-WAYFARER)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 2)
	(COMBAT 5)
	(MAGIC 2)
	(SANCTITY 3)
	(SCOUTING 6)
	(THIEVERY 4)
	(POSSESSIONS <LTABLE SPEAR LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT NARTICLEBIT)>

<OBJECT CHARACTER-CHALOR
	(DESC "Chalor The Exiled One")
	(LDESC "Chalor is an outcast by choice, shunning his native land and the family who spurned him, driven by a burning desire for secret knowledge. His goal is to become one of the mightiest wizards of the world, and nothing will stand in his way. For now, he is looking for the Gold Dust tavern in Yellowport, where adventure awaits.")
	(RANK 1)
	(PROFESSION PROFESSION-MAGE)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 2)
	(COMBAT 2)
	(MAGIC 6)
	(SANCTITY 1)
	(SCOUTING 5)
	(THIEVERY 3)
	(POSSESSIONS <LTABLE STAFF LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT NARTICLEBIT)>

<OBJECT CHARACTER-ANDRIEL
	(DESC "Andriel The Hammer")
	(LDESC "Andriel seeks frame through adventure and the glory of battle. He left his homeland when an extended outbreak of peace made his skills redundant there. He is blunt and outspoken, but scrupulously follows the warrior's code. He knows that the merchants' guild in Yellowport needs assistance.")
	(RANK 1)
	(PROFESSION PROFESSION-WARRIOR)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 3)
	(COMBAT 6)
	(MAGIC 2)
	(SANCTITY 4)
	(SCOUTING 3)
	(THIEVERY 2)
	(POSSESSIONS <LTABLE BATTLE-AXE LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT NARTICLEBIT)>

<OBJECT CHARACTER-MARANA
	(DESC "Marana Fireheart")
	(LDESC "Marana is a fiercely independent woman who grew up in the backstreets of her home town. Forced to flee because she was too active in her chosen profession, she has come to new lands to seek her fortune. Devious and resourceful, she can break in almost anywhere. She has heard that the Temple of Sig in Marlock City needs the services of a rogue.")
	(RANK 1)
	(PROFESSION PROFESSION-ROGUE)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 5)
	(COMBAT 4)
	(MAGIC 4)
	(SANCTITY 1)
	(SCOUTING 2)
	(THIEVERY 6)
	(POSSESSIONS <LTABLE SWORD LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT NARTICLEBIT)>

<OBJECT CHARACTER-IGNATIUS
	(DESC "Ignatius The Devout")
	(LDESC "Ignatius is a traveller whose desire is to learn all he can about the deities of the Fabled Lands. His strong beliefs give his sermons added zest, and he has enthralled many a crowd with his impassioned speeches. He is looking for the house of priests in Marlock City.")
	(RANK 1)
	(PROFESSION PROFESSION-PRIEST)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 4)
	(COMBAT 2)
	(MAGIC 3)
	(SANCTITY 6)
	(SCOUTING 4)
	(THIEVERY 2)
	(POSSESSIONS <LTABLE MACE LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT NARTICLEBIT)>

<OBJECT CHARACTER-ASTARIEL
	(DESC "Astariel Skysong")
	(LDESC "Astariel has the wanderlust, and chafes if he has to remain in one place for any length of time. He enjoys the freedom of the open road and the thought that he never knows what adventures each new day will bring. He lives by his wits and is a familiar figure at tavern firesides, where he regales travellers with his tales.")
	(RANK 1)
	(PROFESSION PROFESSION-TROUBADOUR)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 6)
	(COMBAT 3)
	(MAGIC 4)
	(SANCTITY 3)
	(SCOUTING 2)
	(THIEVERY 4)
	(POSSESSIONS <LTABLE SWORD LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT NARTICLEBIT)>

; "Professions and default stats"
; ---------------------------------------------------------------------------------------------

<OBJECT PROFESSION-PRIEST
	(DESC "Priest")
	(RANK 1)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 4)
	(COMBAT 2)
	(MAGIC 3)
	(SANCTITY 6)
	(SCOUTING 4)
	(THIEVERY 2)
	(POSSESSIONS <LTABLE SWORD LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT)>

<OBJECT PROFESSION-MAGE
	(DESC "Mage")
	(RANK 1)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 2)
	(COMBAT 2)
	(MAGIC 6)
	(SANCTITY 1)
	(SCOUTING 5)
	(THIEVERY 3)
	(POSSESSIONS <LTABLE SWORD LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT)>

<OBJECT PROFESSION-ROGUE
	(DESC "Rouge")
	(RANK 1)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 5)
	(COMBAT 4)
	(MAGIC 4)
	(SANCTITY 1)
	(SCOUTING 2)
	(THIEVERY 6)
	(POSSESSIONS <LTABLE SWORD LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT)>

<OBJECT PROFESSION-TROUBADOUR
	(DESC "Troubadour")
	(RANK 1)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 6)
	(COMBAT 3)
	(MAGIC 4)
	(SANCTITY 3)
	(SCOUTING 2)
	(THIEVERY 4)
	(POSSESSIONS <LTABLE SWORD LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT)>

<OBJECT PROFESSION-WARRIOR
	(DESC "Warrior")
	(RANK 1)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 3)
	(COMBAT 6)
	(MAGIC 2)
	(SANCTITY 4)
	(SCOUTING 3)
	(THIEVERY 2)
	(POSSESSIONS <LTABLE SWORD LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT)>

<OBJECT PROFESSION-WAYFARER
	(DESC "Wayfarer")
	(RANK 1)
	(STAMINA 9)
	(MONEY 16)
	(CHARISMA 2)
	(COMBAT 5)
	(MAGIC 2)
	(SANCTITY 3)
	(SCOUTING 6)
	(THIEVERY 4)
	(POSSESSIONS <LTABLE SWORD LEATHER-JERKIN MAP>)
	(FLAGS PERSONBIT)>

; "Codewords for War-Torn-Kingdom"
; ---------------------------------------------------------------------------------------------

<OBJECT CODEWORD-ABIDE (DESC "Abide")>
<OBJECT CODEWORD-ACID (DESC "Acid")>
<OBJECT CODEWORD-AEGIS (DESC "Aegis")>
<OBJECT CODEWORD-AFRAID (DESC "Afraid")>
<OBJECT CODEWORD-AGUE (DESC "Ague")>
<OBJECT CODEWORD-AID (DESC "Aid")>
<OBJECT CODEWORD-AJAR (DESC "Ajar")>
<OBJECT CODEWORD-AKLAR (DESC "Aklar")>
<OBJECT CODEWORD-ALISSIA (DESC "Alissia")>
<OBJECT CODEWORD-ALMANAC (DESC "Almanac")>
<OBJECT CODEWORD-ALOFT (DESC "Aloft")>
<OBJECT CODEWORD-ALTITUDE (DESC "Altitude")>
<OBJECT CODEWORD-AMBUSCADE (DESC "Ambuscade")>
<OBJECT CODEWORD-AMCHA (DESC "Amcha")>
<OBJECT CODEWORD-AMENDS (DESC "Amends")>
<OBJECT CODEWORD-ANCHOR (DESC "Anchor")>
<OBJECT CODEWORD-ANIMAL (DESC "Animal")>
<OBJECT CODEWORD-ANTHEM (DESC "Anthem")>
<OBJECT CODEWORD-ANVIL (DESC "Anvil")>
<OBJECT CODEWORD-APACHE (DESC "Apache")>
<OBJECT CODEWORD-APPLE (DESC "Apple")>
<OBJECT CODEWORD-APPEASE (DESC "Appease")>
<OBJECT CODEWORD-AQUA (DESC "Aqua")>
<OBJECT CODEWORD-ARK (DESC "Ark")>
<OBJECT CODEWORD-ARMOUR (DESC "Armour")>
<OBJECT CODEWORD-ARTERY (DESC "Artery")>
<OBJECT CODEWORD-ARTIFACT (DESC "Artifact")>
<OBJECT CODEWORD-ASHEN (DESC "Ashen")>
<OBJECT CODEWORD-ASPEN (DESC "Aspen")>
<OBJECT CODEWORD-ASSASSIN (DESC "Assassin")>
<OBJECT CODEWORD-ASSAULT (DESC "Assault")>
<OBJECT CODEWORD-ATTAR (DESC "Attar")>
<OBJECT CODEWORD-AURIC (DESC "Auric")>
<OBJECT CODEWORD-AVENGE (DESC "Avenge")>
<OBJECT CODEWORD-AXE (DESC "Axe")>
<OBJECT CODEWORD-AZURE (DESC "Azure")>

; "codewords from other books. Included here only for completeness"
; ---------------------------------------------------------------------------------------------

<OBJECT CODEWORD-BARNACLE (DESC "Barnacle")>
<OBJECT CODEWORD-BRUSH (DESC "Brush")>
<OBJECT CODEWORD-CUTLASS (DESC "Cutlass")>
<OBJECT CODEWORD-DEFEND (DESC "Defend")>
<OBJECT CODEWORD-DELIVER (DESC "Deliver")>
<OBJECT CODEWORD-DOTAGE (DESC "Dotage")>
<OBJECT CODEWORD-ELDRITCH (DESC "Eldritch")>

; "Weapons"
; ---------------------------------------------------------------------------------------------

<OBJECT AXE
	(DESC "axe")
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT AXE1
	(DESC "axe")
	(COMBAT 1)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT AXE2
	(DESC "axe")
	(COMBAT 2)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT AXE3
	(DESC "axe")
	(COMBAT 3)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT BATTLE-AXE
	(DESC "battle-axe")
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT BATTLE-AXE1
	(DESC "battle-axe")
	(COMBAT 1)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT BATTLE-AXE2
	(DESC "battle-axe")
	(COMBAT 2)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT BATTLE-AXE3
	(DESC "battle-axe")
	(COMBAT 3)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT MACE
	(DESC "mace")
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT MACE1
	(DESC "mace")
	(COMBAT 1)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT MACE2
	(DESC "mace")
	(COMBAT 2)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT MACE3
	(DESC "mace")
	(COMBAT 3)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT MAGIC-SPEAR
	(DESC "magic spear")
	(COMBAT 2)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT SPEAR
	(DESC "spear")
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT SPEAR1
	(DESC "spear")
	(COMBAT 1)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT SPEAR2
	(DESC "spear")
	(COMBAT 2)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT SPEAR3
	(DESC "spear")
	(COMBAT 3)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT STAFF
	(DESC "staff")
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT STAFF1
	(DESC "staff")
	(COMBAT 1)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT STAFF2
	(DESC "staff")
	(COMBAT 2)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT STAFF3
	(DESC "staff")
	(COMBAT 3)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT SWORD
	(DESC "sword")
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT SWORD1
	(DESC "sword")
	(COMBAT 1)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT SWORD2
	(DESC "sword")
	(COMBAT 2)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT SWORD3
	(DESC "sword")
	(COMBAT 3)
	(FLAGS TAKEBIT WEAPONBIT)>

<OBJECT TRIDENT
	(DESC "trident")
	(COMBAT 1)
	(FLAGS TAKEBIT WEAPONBIT)>

; "Armours"
; ---------------------------------------------------------------------------------------------

<OBJECT CHAIN-MAIL
	(DESC "chain mail")
	(DEFENSE 3)
	(FLAGS TAKEBIT WEARBIT)>

<OBJECT HEAVY-PLATE
	(DESC "heavy plate")
	(DEFENSE 6)
	(FLAGS TAKEBIT WEARBIT)>

<OBJECT LEATHER-ARMOUR
	(DESC "leather armour")
	(DEFENSE 1)
	(FLAGS TAKEBIT WEARBIT)>

<OBJECT LEATHER-JERKIN
	(DESC "leather jerkin")
	(DEFENSE 1)
	(FLAGS TAKEBIT WEARBIT WORNBIT)>

<OBJECT PLATE-ARMOUR
	(DESC "plate armour")
	(DEFENSE 5)
	(FLAGS TAKEBIT WEARBIT)>

<OBJECT RING-MAIL
	(DESC "ring mail")
	(DEFENSE 2)
	(FLAGS TAKEBIT WEARBIT)>

<OBJECT SPLINT-ARMOUR
	(DESC "splint armour")
	(DEFENSE 4)
	(FLAGS TAKEBIT WEARBIT)>

; Wands
; ---------------------------------------------------------------------------------------------

<OBJECT AMBER-WAND
	(DESC "amber wand")
	(MAGIC 1)
	(FLAGS TAKEBIT)>

<OBJECT COBALT-WAND
	(DESC "cobalt wand")
	(MAGIC 3)
	(FLAGS TAKEBIT)>

<OBJECT EBONY-WAND
	(DESC "ebony wand")
	(MAGIC 2)
	(FLAGS TAKEBIT)>

<OBJECT SELENIUM-WAND
	(DESC "selenium wand")
	(MAGIC 3)
	(FLAGS TAKEBIT)>

; "other objects"
; ---------------------------------------------------------------------------------------------

<OBJECT AMCHAS-HEAD
	(DESC "Amcha's head")
	(FLAGS TAKEBIT VOWELBIT)>

<OBJECT AMULET-OF-PROTECTION
	(DESC "amulet of protection")
	(FLAGS TAKEBIT VOWELBIT)>

<OBJECT ASHES
	(DESC "ashes")
	(FLAGS TAKEBIT VOWELBIT)>

<OBJECT BAG-OF-PEARLS
	(DESC "bag of pearls")
	(FLAGS TAKEBIT)>

<OBJECT BLACK-DRAGON-SHIELD
	(DESC "black dragon shield")
	(FLAGS TAKEBIT)>

<OBJECT BOARS-TUSK
	(DESC "boar's tusk")
	(FLAGS TAKEBIT)>

<OBJECT BOOK-SEVEN-SAGES
	(DESC "Book of the Seven Sages")
	(FLAGS TAKEBIT NARTICLEBIT)>

<OBJECT CLIMBING-GEAR
	(DESC "climbing gear")
	(FLAGS TAKEBIT)>

<OBJECT CODED-MISSIVE
	(DESC "coded missive")
	(FLAGS TAKEBIT)>

<OBJECT COMPASS
	(DESC "compass")
	(SCOUTING 1)
	(FLAGS TAKEBIT)>

<OBJECT COPPER-AMULET
	(DESC "copper-amulet")
	(FLAGS TAKEBIT)>

<OBJECT FLAME-OPAL-EYE
	(DESC "flame opal eye")
	(FLAGS TAKEBIT)>

<OBJECT FOREST-FORSAKEN-MAP
	(DESC "Forest of the Forsaken map")
	(FLAGS TAKEBIT)>

<OBJECT GHOULS-HEAD
	(DESC "ghoul's head")
	(FLAGS TAKEBIT)>

<OBJECT GOLD-CHAIN-MAIL
	(DESC "gold chain mail of Tyrnai")
	(FLAGS TAKEBIT)>

<OBJECT GOLD-COMPASS
	(DESC "gold compass")
	(SCOUTING 2)
	(FLAGS TAKEBIT)>

<OBJECT GOLDEN-NET
	(DESC "golden net")
	(FLAGS TAKEBIT)>

<OBJECT HOLY-SYMBOL
	(DESC "holy symbol")
	(SANCTITY 1)
	(FLAGS TAKEBIT)>

<OBJECT INK-SAC
	(DESC "ink sac")
	(QUANTITY 1)
	(FLAGS TAKEBIT VOWELBIT)>

<OBJECT LANTERN
	(DESC "lantern")
	(QUANTITY 1)
	(FLAGS TAKEBIT)>

<OBJECT LOCKPICKS
	(DESC "lockpicks")
	(THIEVERY 1)
	(FLAGS TAKEBIT)>

<OBJECT MANDOLIN
	(DESC "mandolin")
	(CHARISMA 1)
	(FLAGS TAKEBIT)>

<OBJECT MANBEASTS-HELMET
	(DESC "manbeast's helmet")
	(FLAGS TAKEBIT)>

<OBJECT MAP
	(DESC "map")
	(FLAGS TAKEBIT)>

<OBJECT MOONSTONE-OF-TELEPORTATION
	(DESC "moonstone of teleportation")
	(FLAGS TAKEBIT)>

<OBJECT OAK-STAFF
	(DESC "oak staff")
	(FLAGS TAKEBIT VOWELBIT)>

<OBJECT OFFICERS-PASS
	(DESC "officer's pass")
	(FLAGS TAKEBIT VOWELBIT)>

<OBJECT PICKAXE
	(DESC "pickaxe")
	(FLAGS TAKEBIT)>

<OBJECT PIRATE-CAPTAINS-HEAD
	(DESC "pirate captain's head")
	(FLAGS TAKEBIT)>

<OBJECT PLATINUM-EARRING
	(DESC "platinum earring")
	(FLAGS TAKEBIT)>

<OBJECT POTION-OF-COMELINESS
	(DESC "potion of comeliness")
	(QUANTITY 1)
	(CHARISMA 1)
	(FLAGS TAKEBIT)>

<OBJECT POTION-OF-GODLINESS
	(DESC "potion of godliness")
	(QUANTITY 1)
	(SANCTITY 1)
	(FLAGS TAKEBIT)>

<OBJECT POTION-OF-HEALING
	(DESC "potion of healing")
	(FLAGS TAKEBIT)>

<OBJECT POTION-OF-INTELLECT
	(DESC "potion of intellect")
	(QUANTITY 1)
	(MAGIC 1)
	(FLAGS TAKEBIT)>

<OBJECT POTION-OF-NATURE
	(DESC "potion of nature")
	(QUANTITY 1)
	(SCOUTING 1)
	(FLAGS TAKEBIT)>

<OBJECT POTION-OF-RESTORATION
	(DESC "potion of restoration")
	(QUANTITY 1)
	(FLAGS TAKEBIT)>

<OBJECT POTION-OF-STEALTH
	(DESC "potion of godliness")
	(QUANTITY 1)
	(THIEVERY 1)
	(FLAGS TAKEBIT)>

<OBJECT POTION-OF-STRENGTH
	(DESC "potion of strength")
	(QUANTITY 1)
	(COMBAT 1)
	(FLAGS TAKEBIT)>

<OBJECT RAT-POISON
	(DESC "rat poison")
	(FLAGS TAKEBIT)>

<OBJECT ROPE
	(DESC "rope")
	(FLAGS TAKEBIT)>

<OBJECT ROYAL-RING
	(DESC "royal ring")
	(FLAGS TAKEBIT)>

<OBJECT SALT-IRON-FILINGS
	(DESC "salt and iron filings")
	(FLAGS TAKEBIT)>

<OBJECT SCORPION-ANTIDOTE
	(DESC "scorpion antidote")
	(FLAGS TAKEBIT)>

<OBJECT SCROLL-OF-EBRON
	(DESC "scroll of Ebron")
	(FLAGS TAKEBIT)>

<OBJECT SILVER-FLUTE
	(DESC "silver flute")
	(CHARISMA 2)
	(FLAGS TAKEBIT)>

<OBJECT SILVER-HOLY-SYMBOL
	(DESC "silver holy symbol")
	(SANCTITY 2)
	(FLAGS TAKEBIT)>

<OBJECT SILVER-MEDALLION
	(DESC "silver medallion")
	(FLAGS TAKEBIT)>

<OBJECT SILVER-NUGGET
	(DESC "silver nugget")
	(FLAGS TAKEBIT)>

<OBJECT SMOLDER-FISH
	(DESC "smolder fish")
	(QUANTITY 1)
	(FLAGS TAKEBIT)>

<OBJECT TREASURE-MAP
	(DESC "treasure map")
	(FLAGS TAKEBIT)>

<OBJECT VERDIGRIS-KEY
	(DESC "verdigris key")
	(FLAGS TAKEBIT)>

<OBJECT VIAL-YELLOW-DUST
	(DESC "vial of yellow dust")
	(FLAGS TAKEBIT)>

<OBJECT WILLOW-STAFF
	(DESC "willow staff")
	(FLAGS TAKEBIT)>

<OBJECT WOLF-PELT
	(DESC "wolf pelt")
	(FLAGS TAKEBIT)>

; "Resurrections"
; ---------------------------------------------------------------------------------------------

<OBJECT RESURRECTION-TYRNAI
	(DESC "Temple of Tyrnai, The War-Torn Kingdom")
	(CONTINUE STORY640)
	(FLAGS TAKEBIT)>

<OBJECT RESURRECTION-NAGIL
	(DESC "Temple of Nagil, The War-Torn Kingdom")
	(CONTINUE STORY350)
	(FLAGS TAKEBIT)>

<OBJECT RESURRECTION-ANY
	(DESC "Any resurrection arrangement")
	(FLAGS TAKEBIT)>

; GODS
; ---------------------------------------------------------------------------------------------

<OBJECT GOD-ALVIR-VALMIR
	(DESC "Alvir and Valmir the Twin Gods")>

<OBJECT GOD-ELNIR
	(DESC "Elnir the Sky God")>

<OBJECT GOD-LACUNA
	(DESC "Lacuna")>

<OBJECT GOD-MAKA
	(DESC "Maka")>

<OBJECT GOD-NAGIL
	(DESC "Nagil, the God of Death")
	(RESURRECTION RESURRECTION-ANY)>

<OBJECT GOD-THREE-FORTUNES
	(DESC "Three Fortunes")>

<OBJECT GOD-SIG
	(DESC "Sig the Cunning")>

<OBJECT GOD-TYRNAI
	(DESC "Tyrnai the War God")
	(RESURRECTION RESURRECTION-TYRNAI)>

; Blessings
; ---------------------------------------------------------------------------------------------

<OBJECT BLESSING-CHARISMA (DESC "CHARISMA")>
<OBJECT BLESSING-COMBAT (DESC "COMBAT")>
<OBJECT BLESSING-MAGIC (DESC "MAGIC")>
<OBJECT BLESSING-SANCTITY (DESC "SANCTITY")>
<OBJECT BLESSING-SCOUTING (DESC "SCOUTING")>
<OBJECT BLESSING-THIEVERY (DESC "THIEVERY")>
<OBJECT BLESSING-LUCK (DESC "LUCK")>
<OBJECT BLESSING-SAFETY-FROM-STORMS (DESC "Safety from Storms")>
<OBJECT BLESSING-IMMUNITY-POISON-DISEASE (DESC "Immunity to Disease and Poison")>

; Ships
; ---------------------------------------------------------------------------------------------

<CONSTANT CONDITIONS <LTABLE "poor" "average" "good" "excellent">>
<CONSTANT CONDITION-POOR 0>
<CONSTANT CONDITION-AVERAGE 1>
<CONSTANT CONDITION-GOOD 2>
<CONSTANT CONDITION-EXCELLENT 3>

<CONSTANT DOCK-YELLOWPORT 1>
<CONSTANT DOCK-MARLOCK 2>
<CONSTANT DOCK-TRADING 3>
<CONSTANT DOCKS <LTABLE "Yellowport" "Marlock City" "Isle of Druids">>

<OBJECT SHIP-BARQUE
	(DESC "barque")
	(CAPACITY 1)
	(DOCKED NONE)
	(CONDITION CONDITION-POOR)>

<OBJECT SHIP-BRIGANTINE
	(DESC "brigantine")
	(CAPACITY 2)
	(DOCKED NONE)
	(CONDITION CONDITION-POOR)>

<OBJECT SHIP-GALLEON
	(DESC "galleon")
	(CAPACITY 3)
	(DOCKED NONE)
	(CONDITION CONDITION-POOR)>

; "Disease/Poison EFFECTS (CHARISMA COMBAT MAGIC SANCTITY SCOUTING THIEVERY)"
; ---------------------------------------------------------------------------------------------

<OBJECT CURSE-TYRNAI
	(DESC "Tyrnai's Curse")
	(EFFECTS <LTABLE 0 -1 0 0 0 0>)
	(FLAGS CURSEBIT)>

<OBJECT DISADVANTAGE-COMBAT1
	(DESC "COMBAT disadvantage")
	(EFFECTS <LTABLE 0 -1 0 0 0 0>)>

<OBJECT DISADVANTAGE-COMBAT2
	(DESC "COMBAT disadvantage")
	(EFFECTS <LTABLE 0 -2 0 0 0 0>)>

<OBJECT DISEASE-GHOULBITE
	(DESC "ghoulbite")
	(EFFECTS <LTABLE -1 -1 0 -1 0 0>)
	(FLAGS DISEASEBIT)>

<OBJECT POISON-COMBAT
	(DESC "poison")
	(EFFECTS <LTABLE 0 -1 0 0 0 0>)
	(FLAGS POISONBIT)>

<OBJECT POISON-SCORPION
	(DESC "scorpion's venom")
	(EFFECTS <LTABLE 0 -1 0 0 -1 -1>)
	(FLAGS POISONBIT)>

; "Monsters"
; ---------------------------------------------------------------------------------------------

<OBJECT MONSTER-BANDIT
	(DESC "Bandit")
	(COMBAT 3)
	(DEFENSE 4)
	(STAMINA 6)>

<OBJECT MONSTER-BLUE-DRAGON
	(DESC "Blue Dragon Knight")
	(COMBAT 3)
	(DEFENSE 8)
	(STAMINA 6)>

<OBJECT MONSTER-BLACK-DRAGON
	(DESC "Black Dragon Knight")
	(COMBAT 5)
	(DEFENSE 9)
	(STAMINA 11)>

<OBJECT MONSTER-CULTIST
	(DESC "Cultist")
	(COMBAT 3)
	(DEFENSE 5)
	(STAMINA 7)>

<OBJECT MONSTER-DRUNKEN-SOLDIER
	(DESC "Drunken soldier")
	(COMBAT 4)
	(DEFENSE 6)
	(STAMINA 7)>

<OBJECT MONSTER-GHOUL
	(DESC "Ghoul")
	(COMBAT 3)
	(DEFENSE 7)
	(STAMINA 15)>

<OBJECT MONSTER-GOLEM
	(DESC "Golem")
	(COMBAT 5)
	(DEFENSE 10)
	(STAMINA 10)>

<OBJECT MONSTER-GORLOCK
	(DESC "Gorlock")
	(COMBAT 4)
	(DEFENSE 6)
	(STAMINA 7)>

<OBJECT MONSTER-GREEN-DRAGON
	(DESC "Green Dragon Knight")
	(COMBAT 4)
	(DEFENSE 8)
	(STAMINA 8)>

<OBJECT MONSTER-KER-ILK
	(DESC "Ker'ilk")
	(COMBAT 4)
	(DEFENSE 9)
	(STAMINA 8)>

<OBJECT MONSTER-KING-SKABB
	(DESC "King Skabb")
	(COMBAT 5)
	(DEFENSE 7)
	(STAMINA 10)>

<OBJECT MONSTER-MAD-PILGRIM
	(DESC "Mad pilgrim")
	(COMBAT 3)
	(DEFENSE 5)
	(STAMINA 6)>

<OBJECT MONSTER-MAN-EYEPATCH
	(DESC "Man with eyepatch")
	(COMBAT 5)
	(DEFENSE 8)
	(STAMINA 12)>

<OBJECT MONSTER-MILITIAMAN
	(DESC "Militiaman")
	(COMBAT 4)
	(DEFENSE 7)
	(STAMINA 5)>

<OBJECT MONSTER-RATMAN
	(DESC "Ratman")
	(COMBAT 3)
	(DEFENSE 6)
	(STAMINA 6)>

<OBJECT MONSTER-RED-DRAGON
	(DESC "Red Dragon Knight")
	(COMBAT 5)
	(DEFENSE 8)
	(STAMINA 10)>

<OBJECT MONSTER-REPULSIVE-ONE
	(DESC "Repulsive One")
	(COMBAT 4)
	(DEFENSE 6)
	(STAMINA 10)>

<OBJECT MONSTER-SCORPION-SHAMAN
	(DESC "Scorpion Shaman")
	(COMBAT 5)
	(DEFENSE 8)
	(STAMINA 9)>

<OBJECT MONSTER-SCORPION-MAN
	(DESC "Scorpion Man")
	(COMBAT 3)
	(DEFENSE 6)
	(STAMINA 8)>

<OBJECT MONSTER-STORM-DEMON
	(DESC "Storm demon")
	(COMBAT 3)
	(DEFENSE 6)
	(STAMINA 8)>

<OBJECT MONSTER-THUG
	(DESC "Thug")
	(COMBAT 3)
	(DEFENSE 6)
	(STAMINA 13)>

<OBJECT MONSTER-TOMB-GUARDIAN
	(DESC "Tomb Guardian")
	(COMBAT 6)
	(DEFENSE 8)
	(STAMINA 12)>

<OBJECT MONSTER-TRICKSTER
	(DESC "Trickster")
	(COMBAT 2)
	(DEFENSE 3)
	(STAMINA 3)>

<OBJECT MONSTER-TREE-GUARD
	(DESC "Tree Guard")
	(COMBAT 3)
	(DEFENSE 7)
	(STAMINA 10)
	(FLAGS PLURALBIT)>

<OBJECT MONSTER-TWO-RATMEN
	(DESC "Two Ratmen")
	(COMBAT 6)
	(DEFENSE 9)
	(STAMINA 9)
	(FLAGS PLURALBIT)>

<OBJECT MONSTER-WOLF
	(DESC "Wolf")
	(COMBAT 3)
	(DEFENSE 5)
	(STAMINA 7)>

; "Missions"
; ---------------------------------------------------------------------------------------------

<OBJECT MISSION-BOOK-SAGES
	(DESC "Pyletes the Sage: Retrieve the Book of the Seven Sages")
	(CODEWORD CODEWORD-ARTIFACT)
	(COMPLETED F)>

<OBJECT MISSION-CITADEL-VELIS
	(DESC "The King: Citadel of Velis")
	(CODEWORD CODEWORD-ASSAULT)
	(COMPLETED F)>

<OBJECT MISSION-GHOUL-HEAD
	(DESC "Warden: Retrieve ghoul's head")
	(CODEWORD CODEWORD-AGUE)
	(COMPLETED F)>

<OBJECT MISSION-GOLDEN-NET
	(DESC "High Priest: Retrieve the Golden net")
	(CODEWORD CODEWORD-ANCHOR)
	(COMPLETED F)>

<OBJECT MISSION-NEGRAN-CORIN
	(DESC "Provost Marshal: Slay Nergan Corin")
	(CODEWORD CODEWORD-ARTERY)
	(COMPLETED F)>

; "Titles and Honours for War-Torn Kingdom"
; ---------------------------------------------------------------------------------------------

<OBJECT TITLE-PROTECTOR-SOKARA (DESC "Protector of Sokara")>
<OBJECT TITLE-ILLUMINATE-MOLHERN (DESC "Illuminate of Molhern") (FLAGS VOWELBIT)>
<OBJECT TITLE-KINGS-CHAMPION (DESC "King's Champion") (FLAGS NARTICLEBIT)>
<OBJECT TITLE-UNSPEAKABLE-CULTIST (DESC "Unspeakable Cultist") (EFFECTS <LTABLE 0 0 0 -1 0 0>) (FLAGS VOWELBIT)>

; "Abilities and Combat"
; ---------------------------------------------------------------------------------------------

<CONSTANT LOOKUP-ABILITY <LTABLE P?CHARISMA P?COMBAT P?MAGIC P?SANCTITY P?SCOUTING P?THIEVERY P?DEFENSE P?STAMINA>>

<ROUTINE APPLY-EFFECTS (ABILITY "OPT" CONTAINER "AUX" ITEM (EFFECTS NONE) (SCORE 0))
	<COND (<NOT .CONTAINER> <SET CONTAINER ,AILMENTS>)>
	<SET SCORE 0>
	<COND (<G? <COUNT-CONTAINER .CONTAINER> 0>
		<SET ITEM <FIRST? .CONTAINER>>
		<REPEAT ()
			<COND (<NOT .ITEM> <RETURN>)>
			<SET EFFECTS <GETP .ITEM ,P?EFFECTS>>
			<COND (.EFFECTS <SET SCORE <+ .SCORE <GET .EFFECTS .ABILITY>>>)>
			<SET ITEM <NEXT? .ITEM>>
		>
	)>
	<RETURN .SCORE>>

; "Calculates ability scores"

<ROUTINE CALCULATE-ABILITY (CHARACTER ABILITY "OPT" CONTAINER "AUX" SCORE PROPERTY)
	<COND (<NOT .CONTAINER> <SET .CONTAINER ,PLAYER>)>
	<SET PROPERTY <GET-ABILITY-PROPERTY .ABILITY>>
	<SET SCORE <GET-ABILITY-SCORE .CHARACTER .ABILITY>>
	<COND (<EQUAL? .ABILITY ABILITY-COMBAT>
		<SET SCORE <+ .SCORE <FIND-BEST .PROPERTY ,WEAPONBIT .CONTAINER>>>
	)(<N=? .ABILITY ABILITY-DEFENSE>
		<SET SCORE <+ .SCORE <FIND-BEST .PROPERTY NONE .CONTAINER>>>
	)>
	<SET SCORE <+ .SCORE <APPLY-EFFECTS .ABILITY ,AILMENTS>>>
	<SET SCORE <+ .SCORE <APPLY-EFFECTS .ABILITY ,TITLES-AND-HONOURS>>>
	<COND (<G? .SCORE 12> <SET SCORE 12>)>
	<COND (<L? .SCORE 1> <SET SCORE 1>)>
	<RETURN .SCORE>>

; "Get object property that is associated to ability"
<ROUTINE GET-ABILITY-PROPERTY (ABILITY "AUX" (PROPERTY NONE))
	<SET PROPERTY <GET ,LOOKUP-ABILITY .ABILITY>>
	<RETURN .PROPERTY>>

; "Get ability score"
<ROUTINE GET-ABILITY-SCORE (CHARACTER ABILITY "AUX" PROPERTY RESULT)
	<SET PROPERTY <GET-ABILITY-PROPERTY .ABILITY>>
	<COND (.PROPERTY
		<SET RESULT <GETP .CHARACTER .PROPERTY>>
		<RETURN .RESULT>
	)>
	<RETURN 1>>

; "Finds the item with the best PROPERTY score"
<ROUTINE FIND-BEST (PROPERTY "OPT" (FLAG NONE) CONTAINER (MATCH 0) "AUX" (SCORE 0) (ITEM NONE) (RESULT 0))
	<SET RESULT 0>
	<SET SCORE 0>
	<COND (<NOT .CONTAINER> <SET .CONTAINER ,PLAYER>)>
	<SET ITEM <FIRST? .CONTAINER>>
	<REPEAT ()
		<COND (<NOT .ITEM> <RETURN>)>
		<SET SCORE <GETP .ITEM .PROPERTY>>
		<COND (<G? .MATCH 0>
			<COND (.FLAG
				<COND (<AND <FSET? .ITEM .FLAG> <FSET? .ITEM ,NDESCBIT>>
					<COND (<EQUAL? .SCORE .MATCH>
						<SET .RESULT .SCORE>
						<SET-BEST-GEAR .ITEM>
						<RETURN>
					)>
				)>
			)(<AND <NOT <FSET? .ITEM ,NDESCBIT>> <EQUAL? .SCORE .MATCH>>
				<SET .RESULT .SCORE>
				<SET-BEST-GEAR .ITEM>
				<RETURN>
			)>
		)(.FLAG
			<COND (<AND <NOT <FSET? .ITEM ,NDESCBIT>> <FSET? .ITEM .FLAG>>
				<COND (<G=? .SCORE .RESULT>
					<SET .RESULT .SCORE>
					<SET-BEST-GEAR .ITEM>
				)>
			)>
		)(<AND <NOT <FSET? .ITEM ,NDESCBIT>> <G=? .SCORE .RESULT>>
			<SET-BEST-GEAR .ITEM>
			<SET .RESULT .SCORE>
		)>
		<SET ITEM <NEXT? .ITEM>>
	>
	<RETURN .RESULT>>

; "as above but find in list"
<ROUTINE FIND-BEST-LIST (PROPERTY "OPT" (FLAG NONE) LIST "AUX" COUNT SCORE ITEM RESULT)
	<COND (<NOT .LIST> <RETURN 0>)>
	<SET SCORE 0>
	<SET RESULT 0>
	<SET COUNT <GET .LIST 0>>
	<DO (I 1 .COUNT)
		<SET ITEM <GET .LIST .I>>
		<SET SCORE <GETP .ITEM .PROPERTY>>
		<COND (<AND .FLAG <NOT <FSET? .ITEM ,NDESCBIT>>>
			<COND (<FSET? .ITEM .FLAG>
				<COND (<G=? .SCORE .RESULT>
					<SET .RESULT .SCORE>
					<SET-BEST-GEAR .ITEM>
				)>
			)>
		)(<AND <G=? .SCORE .RESULT> <NOT <FSET? .ITEM ,NDESCBIT>>>
			<SET-BEST-GEAR .ITEM>
			<SET .RESULT .SCORE>
		)>
	>
	<RETURN .RESULT>>

<ROUTINE FIND-BEST-GEAR ()
	<SETG BEST-WEAPON NONE>
	<SETG BEST-ARMOUR NONE>
	<FIND-BEST ,P?COMBAT ,WEAPONBIT ,PLAYER>
	<FIND-BEST ,P?DEFENSE ,WEARBIT ,PLAYER>>

<ROUTINE SET-BEST-GEAR (ITEM)
	<COND (<FSET? .ITEM ,WEAPONBIT>
		<SETG BEST-WEAPON .ITEM>
	)(<FSET? .ITEM ,WEARBIT>
		<SETG BEST-ARMOUR .ITEM>
	)>>

; "Fighting routines"
; ---------------------------------------------------------------------------------------------

; "messages during rounds of combat"
<ROUTINE ATTACK-INEFFECTIVE (ATTACKER)
	<CRLF>
	<HLIGHT ,H-BOLD>
	<COND (<EQUAL? .ATTACKER ,CURRENT-CHARACTER>
		<TELL D .ATTACKER>
	)(ELSE
		<TELL CT .ATTACKER>
	)>
	<TELL "'s attack was ineffective" ,EXCLAMATION-CR>
	<HLIGHT 0>>

<ROUTINE ATTACK-MESSAGE (ATTACKER DEFENDER ATTACK DAMAGE)
	<CRLF>
	<HLIGHT ,H-BOLD>
	<COND (<EQUAL? .ATTACKER ,CURRENT-CHARACTER>
		<TELL D .ATTACKER "'s">
	)(ELSE
		<TELL CT .ATTACKER "'s">
	)>
	<HLIGHT 0>
	<TELL " attack (" N .ATTACK ") hits ">
	<HLIGHT ,H-BOLD>
	<COND (<EQUAL? .DEFENDER ,CURRENT-CHARACTER>
		<TELL D .DEFENDER>
	)(ELSE
		<TELL T .DEFENDER>
	)>
	<HLIGHT 0>
	<TELL " for ">
	<HLIGHT ,H-BOLD>
	<TELL N .DAMAGE " damage">
	<HLIGHT 0>
	<TELL ,PERIOD-CR>>

; "Calculate combat score"
<ROUTINE CALCULATE-COMBAT (CHARACTER "OPT" CONTAINER)
	<COND (<NOT .CONTAINER> <SET CONTAINER ,PLAYER>)>
	<RETURN <CALCULATE-ABILITY .CHARACTER ABILITY-COMBAT .CONTAINER>>>

; "Calculate defense score"
<ROUTINE CALCULATE-DEFENSE (CHARACTER "OPT" CONTAINER "AUX" RESULT)
	<COND (<NOT .CONTAINER> <SET CONTAINER ,PLAYER>)>
	<SET RESULT <GET-RANK .CHARACTER>>
	<SET RESULT <+ .RESULT <CALCULATE-ABILITY .CHARACTER ABILITY-COMBAT .CONTAINER>>>
	<COND (<AND <N=? .CONTAINER ,PLAYER> <N=? .CHARACTER ,CURRENT-CHARACTER>>
		<SET RESULT <+ .RESULT <FIND-BEST-LIST P?DEFENSE ,WEARBIT <GETP .CHARACTER ,P?POSSESSIONS>>>>
	)(ELSE
		<SET RESULT <+ .RESULT <FIND-BEST ,P?DEFENSE ,WEARBIT .CONTAINER>>>
	)>
	<COND (<L? .RESULT 1> <SET RESULT 1>)>
	<RETURN .RESULT>>

; "Wrapper for combat. Sets DOOM on result"
<ROUTINE CHECK-COMBAT (MONSTER "OPT" STORY (MODIFIER 0) (LOOT NONE) (THRESHOLD 0))
	<COND (<NOT .STORY> <SET STORY ,HERE>)>
	<COND (<FIGHT .MONSTER .MODIFIER .THRESHOLD>
		<PREVENT-DOOM .STORY>
		<COND (.LOOT <TAKE-ITEM .LOOT>)>
		<RTRUE>
	)(ELSE
		<PUTP .STORY ,P?DOOM T>
		<RFALSE>
	)>>

; "Initialize Monster Stats"
<ROUTINE COMBAT-MONSTER (MONSTER COMBAT DEFENSE STAMINA)
	<PUT .MONSTER ,P?COMBAT .COMBAT>
	<PUT .MONSTER ,P?DEFENSE .DEFENSE>
	<PUT .MONSTER ,P?DEFENSE .STAMINA>>

; "Display combatants' status"
<ROUTINE COMBAT-STATUS (ROUND MONSTER STAMINA-PLAYER STAMINA-MONSTER)
	<CRLF>
	<HLIGHT ,H-BOLD>
	<TELL "Round " N .ROUND ": ">
	<HLIGHT 0>
	<HLIGHT ,H-ITALIC>
	<TELL D ,CURRENT-CHARACTER> 
	<HLIGHT 0>
	<TELL " (STAMINA: " N .STAMINA-PLAYER "), ">
	<HLIGHT ,H-ITALIC>
	<TELL CT .MONSTER>
	<HLIGHT 0>
	<TELL " (STAMINA: " N .STAMINA-MONSTER ")">
	<TELL ,PERIOD-CR>
	<UPDATE-STATUS-LINE>>

<ROUTINE FIGHT (MONSTER "OPT" (MODIFIER 0) (THRESHOLD 0) "AUX" RESULT ATTACK STAMINA-PLAYER COMBAT-PLAYER DEFENSE-PLAYER STAMINA-MONSTER COMBAT-MONSTER DEFENSE-MONSTER (ROUND 0))
	<SET STAMINA-PLAYER ,STAMINA>
	<COND (<L=? .STAMINA-PLAYER 0> <HAS-PREVAILED .MONSTER> <RETURN>)>
	<SET DEFENSE-PLAYER <CALCULATE-DEFENSE ,CURRENT-CHARACTER>>
	<SET COMBAT-PLAYER <CALCULATE-COMBAT ,CURRENT-CHARACTER>>
	<COND (<CHECK-ITEM ,POTION-OF-STRENGTH>
		<CRLF>
		<TELL "Use the ">
		<PRINT-ITEM ,POTION-OF-STRENGTH T>
		<TELL " in this fight (Current COMBAT score: ">
		<HLIGHT ,H-BOLD>
		<TELL N .COMBAT-PLAYER>
		<HLIGHT 0>
		<TELL ")?">
		<COND (<YES?>
			<REMOVE-ITEM ,POTION-OF-STRENGTH "used" F T>
			<INC .COMBAT-PLAYER>
		)>
	)>
	<COND (<G? .COMBAT-PLAYER 12> <SET .COMBAT-PLAYER 12>)>
	<SET STAMINA-MONSTER <GETP .MONSTER ,P?STAMINA>>
	<SET DEFENSE-MONSTER <GETP .MONSTER ,P?DEFENSE>>
	<SET COMBAT-MONSTER <GETP .MONSTER ,P?COMBAT>>
	<COND (<G? .COMBAT-MONSTER 12> <SET .COMBAT-MONSTER 12>)>
	<CRLF>
	<TELL "Resolving combat between ">
	<HLIGHT ,H-BOLD>
	<TELL D ,CURRENT-CHARACTER>
	<HLIGHT 0>
	<TELL " (COMBAT: " N .COMBAT-PLAYER " DEFENSE: " N .DEFENSE-PLAYER>
	<COND (<G? .MODIFIER 0> <TELL ", +" N .MODIFIER " to rolls">)>
	<TELL ") and ">
	<HLIGHT ,H-BOLD>
	<TELL T .MONSTER>
	<HLIGHT 0>
	<TELL " (COMBAT: " N .COMBAT-MONSTER " DEFENSE: " N .DEFENSE-MONSTER ")">
	<TELL ,PERIOD-CR>
	; "Track Previous Stamina"
	<SETG PREVIOUS-STAMINA .STAMINA-PLAYER> 
	<REPEAT ()
		<INC .ROUND>
		<COMBAT-STATUS .ROUND .MONSTER .STAMINA-PLAYER .STAMINA-MONSTER>
		<PRESS-A-KEY>
		<SET ATTACK <+ <ROLL-DICE 2> .COMBAT-PLAYER .MODIFIER>>
		<SET RESULT <- .ATTACK .DEFENSE-MONSTER>>
		<COND (<G? .RESULT 0>
			<ATTACK-MESSAGE ,CURRENT-CHARACTER .MONSTER .ATTACK .RESULT>
			<SET STAMINA-MONSTER <- .STAMINA-MONSTER .RESULT>>
			<COND (<L=? .STAMINA-MONSTER .THRESHOLD> <RETURN>)>
		)(ELSE
			<ATTACK-INEFFECTIVE ,CURRENT-CHARACTER>
		)>
		<PRESS-A-KEY>
		<SET ATTACK <+ <ROLL-DICE 2> .COMBAT-MONSTER>>
		<SET RESULT <- .ATTACK .DEFENSE-PLAYER>>
		<COND (<G? .RESULT 0>
			<ATTACK-MESSAGE .MONSTER ,CURRENT-CHARACTER .ATTACK .RESULT>
			<SET STAMINA-PLAYER <- .STAMINA-PLAYER .RESULT>>
			<COND (<L? .STAMINA-PLAYER 1> <RETURN>)>
		)(ELSE
			<ATTACK-INEFFECTIVE .MONSTER>
		)>
		<PRESS-A-KEY>
		<UPDATE-STATUS-LINE>
	>
	<COND (<L? .STAMINA-PLAYER 0> <SET .STAMINA-PLAYER 0>)>
	<SETG STAMINA .STAMINA-PLAYER>
	<UPDATE-STATUS-LINE>
	<COND (<L=? .STAMINA-MONSTER .THRESHOLD>
		<HAS-PREVAILED ,CURRENT-CHARACTER>
		<RTRUE>
	)>
	<HAS-PREVAILED .MONSTER>
	<RFALSE>>

<ROUTINE HAS-PREVAILED (CHARACTER)
	<CRLF>
	<HLIGHT ,H-BOLD>
	<COND (<EQUAL? .CHARACTER ,CURRENT-CHARACTER>
		<TELL D .CHARACTER>
	)(ELSE
		<TELL CT .CHARACTER>
	)>
	<TELL " ">
	<COND (<FSET? .CHARACTER ,PLURALBIT> <TELL "have">)(ELSE <TELL "has">)>
	<TELL " prevailed">
	<HLIGHT 0>
	<TELL ,PERIOD-CR>>

<ROUTINE TEST-ABILITY (CHARACTER ABILITY DIFFICULTY "OPT" (MODIFIER 0) "AUX" SCORE (ROLL 0) (RESULT F) (TOTAL 0))
	<REPEAT ()
		<SET SCORE <CALCULATE-ABILITY .CHARACTER .ABILITY>>
		<TELL "Making a ">
		<HLIGHT ,H-BOLD>
		<TELL <GET ,ABILITIES .ABILITY>>
		<HLIGHT 0>
		<TELL " (" >
		<HLIGHT ,H-BOLD>
		<TELL N .SCORE>
		<HLIGHT 0>
		<TELL ") roll at ">
		<HLIGHT ,H-BOLD>
		<TELL N .DIFFICULTY>
		<HLIGHT 0>
		<TELL " difficulty.." ,PERIOD-CR>
		<SET MODIFIER <+ .MODIFIER <TEST-ABILITY-GOD .ABILITY>>>
		<SET MODIFIER <+ .MODIFIER <TEST-ABILITY-POTION .ABILITY>>>
		<COND (<L=? .MODIFIER 0> <PRESS-A-KEY>)>
		<SET ROLL <ROLL-DICE 2>>
		<SET TOTAL <+ .SCORE .ROLL .MODIFIER>>
		<CRLF>
		<TELL "Rolled (">
		<HLIGHT ,H-BOLD>
		<TELL <GET ,ABILITIES .ABILITY> " " N .SCORE>
		<HLIGHT 0>
		<TELL ") + ">
		<HLIGHT ,H-BOLD>
		<TELL N .ROLL>
		<HLIGHT 0>
		<COND (<N=? .MODIFIER 0>
			<TELL " ">
			<COND (<G? .MODIFIER 0>
				<TELL "+ ">
			)(ELSE
				<TELL "- ">
			)>
			<HLIGHT ,H-BOLD>
			<COND (<G? .MODIFIER 0>
				<TELL N .MODIFIER>
			)(ELSE
				<TELL N <* .MODIFIER -1>>
			)>
			<HLIGHT 0>
		)>
		<TELL " = ">
		<HLIGHT ,H-BOLD>
		<TELL N .TOTAL>
		<HLIGHT 0>
		<TELL " ... ">
		<COND (<G? .TOTAL .DIFFICULTY>
			<HLIGHT ,H-BOLD>
			<TELL "Success!">
			<SET RESULT T>
			<HLIGHT 0>
			<CRLF>
			<RETURN>
		)(ELSE
			<HLIGHT ,H-BOLD>
			<TELL "Failed!">
			<HLIGHT 0>
			<SET RESULT F>
			<COND (<NOT <TEST-ABILITY-BLESSING .ABILITY>>
				<RETURN>
			)>
			<CRLF>
		)>
	>
	<RETURN .RESULT>>

<ROUTINE TEST-ABILITY-BLESSING (ABILITY "AUX" HAS-BLESSING BLESSING RESULT)
	<SET RESULT F>
	<SET HAS-BLESSING T>
	<COND (<AND <EQUAL? .ABILITY ,ABILITY-CHARISMA> <CHECK-BLESSING ,BLESSING-CHARISMA>>
		<SET BLESSING ,BLESSING-CHARISMA>
	)(<AND <EQUAL? .ABILITY ,ABILITY-COMBAT> <CHECK-BLESSING ,BLESSING-COMBAT>>
		<SET BLESSING ,BLESSING-COMBAT>
	)(<AND <EQUAL? .ABILITY ,ABILITY-MAGIC> <CHECK-BLESSING ,BLESSING-MAGIC>>
		<SET BLESSING ,BLESSING-MAGIC>
	)(<AND <EQUAL? .ABILITY ,ABILITY-SANCTITY> <CHECK-BLESSING ,BLESSING-SANCTITY>>
		<SET BLESSING ,BLESSING-SANCTITY>
	)(<AND <EQUAL? .ABILITY ,ABILITY-SCOUTING> <CHECK-BLESSING ,BLESSING-SCOUTING>>
		<SET BLESSING ,BLESSING-SCOUTING>
	)(<AND <EQUAL? .ABILITY ,ABILITY-THIEVERY> <CHECK-BLESSING ,BLESSING-THIEVERY>>
		<SET BLESSING ,BLESSING-THIEVERY>
	)(<CHECK-BLESSING ,BLESSING-LUCK>
		<SET BLESSING ,BLESSING-LUCK>
	)(ELSE
		<SET HAS-BLESSING F>
	)>
	<COND (.HAS-BLESSING
		<CRLF>
		<TELL CR "Use " T .BLESSING " blessing to reroll?">
		<COND (<YES?>
			<DELETE-BLESSING .BLESSING>
			<SET .RESULT T>
		)>
	)(ELSE
		<CRLF>
	)>
	<RETURN .RESULT>>

<ROUTINE TEST-ABILITY-GOD (ABILITY "AUX" RESULT)
	<SET RESULT 0>
	<COND (<EQUAL? .ABILITY ,ABILITY-THIEVERY>
		<COND (<CHECK-GOD ,GOD-SIG> <INC .RESULT>)>
	)>
	<RETURN .RESULT>>

<ROUTINE TEST-ABILITY-POTION (ABILITY "AUX" HAS-POTION POTION RESULT)
	<SET RESULT 0>
	<SET HAS-POTION T>
	<COND (<AND <EQUAL? .ABILITY ,ABILITY-CHARISMA> <CHECK-ITEM ,POTION-OF-COMELINESS>>
		<SET POTION ,POTION-OF-COMELINESS>
	)(<AND <EQUAL? .ABILITY ,ABILITY-COMBAT> <CHECK-ITEM ,POTION-OF-STRENGTH>>
		<SET POTION ,POTION-OF-STRENGTH>
	)(<AND <EQUAL? .ABILITY ,ABILITY-MAGIC> <CHECK-ITEM ,POTION-OF-INTELLECT>>
		<SET POTION ,POTION-OF-INTELLECT>
	)(<AND <EQUAL? .ABILITY ,ABILITY-SANCTITY> <CHECK-ITEM ,POTION-OF-GODLINESS>>
		<SET POTION ,POTION-OF-GODLINESS>
	)(<AND <EQUAL? .ABILITY ,ABILITY-SCOUTING> <CHECK-ITEM ,POTION-OF-NATURE>>
		<SET POTION ,POTION-OF-NATURE>
	)(<AND <EQUAL? .ABILITY ,ABILITY-THIEVERY> <CHECK-ITEM ,POTION-OF-STEALTH>>
		<SET POTION ,BLESSING-THIEVERY>
	)(ELSE
		<SET HAS-POTION F>
	)>
	<COND (.HAS-POTION
		<TELL CR "Use the ">
		<PRINT-ITEM .POTION T>
		<TELL " to add to the roll?">
		<COND (<YES?>
			<REMOVE-ITEM .POTION "used" T T>
			<SET RESULT 1>
		)>
	)>
	<RETURN .RESULT>>

; "Number conversion routines"
; ---------------------------------------------------------------------------------------------

<ROUTINE CONVERT-TO-NUMBER (N "OPT" BASE "AUX" INDEX START LEN)
	<COND (<NOT .BASE> <SET BASE 10>)>
	<COND (<0? <GETB ,LEXBUF 1>> <RETURN 0>)>
	<SET INDEX <* .N 4>>
	<SET START <- <GETB ,LEXBUF <+ .INDEX 1>> 1>>
	<SET LEN <GETB ,LEXBUF .INDEX>>
	<RETURN <TO-INTEGER .START .LEN .BASE>>>

<ROUTINE GET-DIGIT (CHARACTER "OPT" BASE "AUX" DIGIT)
	<COND (<NOT .BASE> <SET BASE 10>)>
	<SET DIGIT 0>
	<COND (<AND <G? .BASE 10> <G=? .CHARACTER !\A> <L=? .CHARACTER !\Z>>
		<SET DIGIT <+ <- .CHARACTER !\A> 10>>
	)(<AND <G? .BASE 10> <G=? .CHARACTER !\a> <L=? .CHARACTER !\z>>
		<SET DIGIT <+ <- .CHARACTER !\a> 10>>
	)(<AND <G=? .CHARACTER !\0> <L=? .CHARACTER !\9>>
		<SET DIGIT <- .CHARACTER !\0>>
	)>
	<COND (<OR <G? .DIGIT <- .BASE 1>> <L? .DIGIT 0>> <RETURN 0>)>
	<RETURN .DIGIT>>

<ROUTINE POWER (BASE EXPONENT)
	<COND (<G? .EXPONENT 0>
		<RETURN <* .BASE <POWER .BASE <- .EXPONENT 1>>>>
	)(ELSE
		<RETURN 1>
	)>>

<ROUTINE TO-INTEGER (START LENGTH "OPT" BASE "AUX" NUMBER CHARACTER SIGN)
	<COND (<NOT .BASE> <SET BASE 10>)>
	<SET SIGN 1>
	<SET NUMBER 0>
	<DO (I 1 .LENGTH)
		<SET CHARACTER <GETB ,READBUF <+ .START .I>>>
		<COND (<OR
			<AND <G=? .CHARACTER !\0> <L=? .CHARACTER !\9>>
			<AND <G? .BASE 10> <L=? .BASE 36>
				<OR 
					<AND <G=? .CHARACTER !\A> <L=? .CHARACTER !\Z>>
					<AND <G=? .CHARACTER !\a> <L=? .CHARACTER !\z>>
				>
			>>
			<SET NUMBER <+ .NUMBER <* <GET-DIGIT .CHARACTER .BASE> <POWER .BASE <- .LENGTH .I>>>>>
		)(<AND <EQUAL? .I 1> <EQUAL? .CHARACTER !\- !\+>>
			<COND (<EQUAL? .CHARACTER !\->
				<SET SIGN -1>
			)>
		)(ELSE
			<RETURN 0>
		)>
	>
	<RETURN <* .SIGN .NUMBER>>>

; "Guild routines"
; ---------------------------------------------------------------------------------------------

<CONSTANT TEXT-GUILD "Guild">
<CONSTANT TEXT-GUILD-NONE "You have not made any investments!">
<CONSTANT TEXT-GUILD-BROKE "You do not have enough money!">

<CONSTANT TEXT-INVESTMENT-LOST "You lost the entire sum!">
<CONSTANT TEXT-INVESTMENT-LOSE50 "You lost 50%">
<CONSTANT TEXT-INVESTMENT-LOSE10 "You lost 10%">
<CONSTANT TEXT-INVESTMENT-UNCHANGED "Your investments remain unchanged.">
<CONSTANT TEXT-INVESTMENT-PROFIT10 "You gain a 10% profit!">
<CONSTANT TEXT-INVESTMENT-PROFIT50 "You gain a 50% profit!">
<CONSTANT TEXT-INVESTMENT-DOUBLED "Your investments are doubled!">

<ROUTINE CHECK-INVESTMENTS (STORY "AUX" INVESTMENTS ROLL)
	<SET INVESTMENTS <GETP .STORY ,P?INVESTMENTS>>
	<COND (.INVESTMENTS
		<SET ROLL <ROLL-DICE 2>>
		<COND (<CHECK-GOD ,GOD-THREE-FORTUNES> <INC .ROLL>)>
		<COND (<CHECK-CODEWORD ,CODEWORD-ALMANAC> <INC .ROLL>)>
		<COND (<CHECK-CODEWORD ,CODEWORD-BRUSH> <SET ROLL <+ .ROLL 2>>)>
		<COND (<CHECK-CODEWORD ,CODEWORD-ELDRITCH> <SET ROLL <+ .ROLL 3>>)>
		<COND (<L=? .ROLL 4>
			<EMPHASIZE ,TEXT-INVESTMENT-LOST ,TEXT-GUILD>
			<SET .INVESTMENTS 0>
		)(<L=? .ROLL 6>
			<EMPHASIZE ,TEXT-INVESTMENT-LOSE50 ,TEXT-GUILD>
			<SET .INVESTMENTS </ .INVESTMENTS 2>>
		)(<L=? .ROLL 8>
			<EMPHASIZE ,TEXT-INVESTMENT-LOSE10 ,TEXT-GUILD>
			<SET .INVESTMENTS <- </ .INVESTMENTS 10>>>
		)(<L=? .ROLL 10>
			<EMPHASIZE ,TEXT-INVESTMENT-UNCHANGED ,TEXT-GUILD>
		)(<L=? .ROLL 12>
			<EMPHASIZE ,TEXT-INVESTMENT-PROFIT10 ,TEXT-GUILD>
			<SET .INVESTMENTS <+ </ .INVESTMENTS 10>>>
		)(<L=? .ROLL 14>
			<EMPHASIZE ,TEXT-INVESTMENT-PROFIT50 ,TEXT-GUILD>
			<SET .INVESTMENTS <+ </ .INVESTMENTS 2>>>
		)(ELSE
			<EMPHASIZE ,TEXT-INVESTMENT-DOUBLED ,TEXT-GUILD>
			<SET .INVESTMENTS <* .INVESTMENTS 2>>
		)>
		<COND (<L? .INVESTMENTS 0> <SET .INVESTMENTS 0>)>
		<PUTP .STORY ,P?INVESTMENTS .INVESTMENTS>
	)(ELSE
		<EMPHASIZE "You have no investments here!" ,TEXT-GUILD>
	)>>

<ROUTINE GUILD-ACTIVITY ("OPT" STORY (INVEST T) "AUX" KEY MONEY NUMBER PROPERTY FEE)
	<DELETE-CODEWORD ,CODEWORD-ALMANAC>
	<DELETE-CODEWORD ,CODEWORD-BRUSH>
	<DELETE-CODEWORD ,CODEWORD-ELDRITCH>
	<COND (<NOT .STORY> <SET STORY ,HERE>)>
	<COND (.INVEST
		<SET PROPERTY ,P?INVESTMENTS>
	)(ELSE
		<SET PROPERTY ,P?MONEY>
	)>
	<REPEAT ()
		<SET MONEY <GETP .STORY .PROPERTY>>
		<CRLF>
		<TELL "Current ">
		<COND (.INVEST
			<TELL "investments: " N .MONEY CR>
		)(ELSE
			<TELL "banked money: " N .MONEY CR>
		)>
		<CRLF>
		<HLIGHT ,H-BOLD>
		<TELL "1">
		<HLIGHT 0>
		<COND (.INVEST
			<TELL " - Invest (in multiples of 100 " D ,CURRENCY ")" CR>
		)(ELSE
			<TELL " - Deposit " D ,CURRENCY CR>
		)>
		<HLIGHT ,H-BOLD>
		<TELL "2">
		<HLIGHT 0>
		<TELL " - Withdraw ">
		<COND (.INVEST
			<TELL "investments" CR>
		)(ELSE
			<TELL D ,CURRENCY " (Guild charges 10%)" CR>
		)>
		<HLIGHT ,H-BOLD>
		<TELL "0">
		<HLIGHT 0>
		<TELL " - Bye" CR>
		<TELL "You are currently carrying: " N ,MONEY " " D ,CURRENCY "." CR>
		<TELL "Select what to do next: ">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<EQUAL? .KEY !\0 !\1 !\2> <RETURN>)>
		>
		<COND (<EQUAL? .KEY !\1>
			<CRLF>
			<COND (<OR <AND .INVEST <G=? ,MONEY 100>> <NOT .INVEST>>
				<REPEAT ()
					<COND (.INVEST
						<SET NUMBER <GET-NUMBER "How much will you invest" 0 ,MONEY>>
					)(ELSE
						<SET NUMBER <GET-NUMBER "How much will you deposit" 0 ,MONEY>>
					)>
					<COND (<G? .NUMBER 0>
						<COND (<AND .INVEST <OR <L? .NUMBER 100> <G? <MOD .NUMBER 100> 0>>>
							<EMPHASIZE "Only amounts that are multiples of 100 are accepted!">
							<PRESS-A-KEY>
						)(ELSE
							<CRLF>
							<TELL ,TEXT-SURE>
							<COND (<YES?>
								<PUTP .STORY .PROPERTY <+ .MONEY .NUMBER>>
								<SETG MONEY <- ,MONEY .NUMBER>>
								<EMPHASIZE ,TEXT-EXCELLENT ,TEXT-GUILD>
								<UPDATE-STATUS-LINE>
								<PRESS-A-KEY>
								<RETURN>
							)>
						)>
					)(ELSE
						<RETURN>
					)>
				>
			)(.INVEST
				<CRLF>
				<EMPHASIZE ,TEXT-GUILD-BROKE ,TEXT-GUILD>
			)>
		)(<EQUAL? .KEY !\2>
			<COND (<G? .MONEY 0>
				<CRLF>
				<REPEAT ()
					<SET NUMBER <GET-NUMBER "How much will you withdraw" 0 .MONEY>>
					<COND (<G? .NUMBER 0>
						<CRLF>
						<TELL ,TEXT-SURE>
						<COND (<YES?>
							<PUTP .STORY .PROPERTY <- .MONEY .NUMBER>>
							<SETG MONEY <+ ,MONEY .NUMBER>>
							<COND (<NOT .INVEST>
								<SET FEE </ .NUMBER 10>>
								<COND (<L? .FEE 0> <SET FEE 1>)>
								<COST-MONEY .FEE>
							)>
							<COND (.INVEST
								<EMPHASIZE "Please consider investing again in the future!" ,TEXT-GUILD>
							)(ELSE
								<EMPHASIZE "Please consider banking with us again in the future!" ,TEXT-GUILD>
							)>
							<UPDATE-STATUS-LINE>
							<PRESS-A-KEY>
						)>
					)>
					<RETURN>
				>
			)(ELSE
				<EMPHASIZE ,TEXT-GUILD-NONE ,TEXT-GUILD>
				<PRESS-A-KEY>
			)>
		)(<EQUAL? .KEY !\0>
			<CRLF>
			<TELL CR ,TEXT-SURE>
			<COND (<YES?>
				<EMPHASIZE ,TEXT-NEXT-TIME ,TEXT-GUILD>
				<RETURN>
			)(ELSE
				<EMPHASIZE ,TEXT-EXCELLENT ,TEXT-GUILD>
			)>
		)>
		<COND (<L? ,MONEY 100>
			<EMPHASIZE "Thank you for doing business with us!" ,TEXT-GUILD>
			<RETURN>
		)>
	>>

; "Harbour Master routines"
; ---------------------------------------------------------------------------------------------

<CONSTANT SHIPS-LIST <LTABLE SHIP-BARQUE SHIP-BRIGANTINE SHIP-GALLEON>>

<OBJECT CARGO-FURS
	(DESC "Furs")
	(TYPE 1)
	(FLAGS TAKEBIT)>

<OBJECT CARGO-GRAINS
	(DESC "Grains")
	(TYPE 2)
	(FLAGS TAKEBIT)>

<OBJECT CARGO-METALS
	(DESC "Metals")
	(TYPE 3)
	(FLAGS TAKEBIT)>

<OBJECT CARGO-MINERALS
	(DESC "Minerals")
	(TYPE 4)
	(FLAGS TAKEBIT)>

<OBJECT CARGO-SPICES
	(DESC "Spices")
	(TYPE 5)
	(FLAGS TAKEBIT)>

<OBJECT CARGO-TEXTILES
	(DESC "Textiles")
	(TYPE 6)
	(FLAGS TAKEBIT)>

<OBJECT CARGO-TIMBER
	(DESC "Timber")
	(TYPE 7)
	(FLAGS TAKEBIT)>

<CONSTANT CARGO-LIST <LTABLE CARGO-FURS CARGO-GRAINS CARGO-METALS CARGO-MINERALS CARGO-SPICES CARGO-TEXTILES CARGO-TIMBER>>

<CONSTANT DESTINATION-COPPER-ISLAND "Copper Island (Over the Blood-Dark Sea)">
<CONSTANT DESTINATION-ISLE-DRUIDS "Isle of Druids (War-Torn Kingdom)">
<CONSTANT DESTINATION-MARLOCK "Marlock City (War-Torn Kingdom)">
<CONSTANT DESTINATION-SORCERERS-ISLE "Sorcerer's Isle (Over the Blood-Dark Sea)">
<CONSTANT DESTINATION-WISHPORT "Wishport (Cities of Gold and Glory)">
<CONSTANT DESTINATION-YELLOWPORT "Yellowport (War-Torn Kingdom)">

<CONSTANT BUY-SELL-CARGO-MENU <LTABLE "Buy goods" "Sell goods">>
<CONSTANT BUY-SELL-UPGRADE-MENU <LTABLE "Buy ship" "Sell ship" "Upgrade ship">>

<CONSTANT TEXT-NO-SHIPS "You don't own any ships!">
<CONSTANT TEXT-SHIP-NOT-OWNER "You don't own that ship!">

<CONSTANT HARBOUR-MASTER-MENU <LTABLE "Go to the shipyard" "Book a passage" "View ship manifest" "Visit the market" "Set sail">>
<CONSTANT TEXT-HARBOUR-MASTER "Harbour Master">

<ROUTINE BOOK-PASSAGE (PASSAGES PRICES DESTINATIONS "AUX" KEY COUNT CHOICE DESTINATION)
	<SET COUNT <GET .PASSAGES 0>>
	<SET DESTINATION NONE>
	<REPEAT ()
		<EMPHASIZE "You can buy a one-way passage on a ship to the following destinations:">
		<PRINT-MENU .PASSAGES F F !\0 "Go back" .PRICES>
		<TELL "Select destination:">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<OR <EQUAL? .KEY !\0> <AND <G=? .KEY !\1> <L=? .KEY <+ .COUNT !\0>>>> <RETURN>)>
		>
		<CRLF>
		<COND (<EQUAL? .KEY !\0>
			<TELL CR ,TEXT-SURE>
			<COND (<YES?>
				<SET DESTINATION NONE>
				<RETURN>
			)>
		)(ELSE
			<CRLF>
			<SET CHOICE <- .KEY !\0>>
			<COND (<G=? ,MONEY <GET .PRICES .CHOICE>>
				<TELL "Book a passage to ">
				<HLIGHT ,H-BOLD>
				<TELL <GET .PASSAGES .CHOICE>>
				<HLIGHT 0>
				<COND (<G? <GET .PRICES .CHOICE> 0>
					<TELL " for " N <GET .PRICES .CHOICE> " " D ,CURRENCY "?">
				)(ELSE
					<TELL "?">
				)>
				<COND (<YES?>
					<COND (<G? <GET .PRICES .CHOICE> 0>
						<COST-MONEY <GET .PRICES .CHOICE> ,TEXT-PAID>
					)>
					<SET DESTINATION <GET .DESTINATIONS .CHOICE>>
					<RETURN>
				)>
			)(ELSE
				<CRLF>
				<HLIGHT ,H-BOLD>
				<TELL "You cannot afford to book a passage to " <GET .PASSAGES .CHOICE> ,EXCLAMATION-CR>
				<HLIGHT 0>
			)>
		)>
	>
	<RETURN .DESTINATION>>

<ROUTINE BUY-CARGO (BUY-PRICES "AUX" (LIMIT 3))
	<COND (.BUY-PRICES
		<COND (,CURRENT-SHIP
			<SET LIMIT <GETP ,CURRENT-SHIP ,P?CAPACITY>>
		)>
		<MERCHANT ,CARGO-LIST .BUY-PRICES ,CARGO F .LIMIT>
	)>>

<ROUTINE BUY-SELL-CARGO (BUY-PRICES SELL-PRICES "AUX" KEY)
	<REPEAT ()
		<EMPHASIZE "Market">
		<PRINT-MENU ,BUY-SELL-CARGO-MENU F F !\0 "Go back">
		<TELL "What do you want to do?">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<EQUAL? .KEY !\0 !\1 !\2> <RETURN>)>
		>
		<COND (<EQUAL? .KEY !\0>
			<CRLF>
			<TELL CR ,TEXT-SURE>
			<COND (<YES?> <RETURN>)>
		)(<EQUAL? .KEY !\1>
			<CRLF>
			<BUY-CARGO .BUY-PRICES>
		)(<EQUAL? .KEY !\2>
			<CRLF>
			<COND (<G? <COUNT-CONTAINER ,CARGO> 0>
				<SELL-CARGO .SELL-PRICES>
			)(ELSE
				<EMPHASIZE "You have nothing to sell!">
			)>
		)>
	>>

<ROUTINE BUY-SELL-UPGRADE-SHIP (BUY-PRICES SELL-PRICES UPGRADE-PRICES CARGO-PRICES DOCK "AUX" KEY)
	<REPEAT ()
		<EMPHASIZE "Shipyard">
		<PRINT-MENU ,BUY-SELL-UPGRADE-MENU F F !\0 "Go back">
		<TELL "What do you want to do?">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<EQUAL? .KEY !\0 !\1 !\2 !\3> <RETURN>)>
		>
		<COND (<EQUAL? .KEY !\0>
			<CRLF>
			<TELL CR ,TEXT-SURE>
			<COND (<YES?> <RETURN>)>
		)(<EQUAL? .KEY !\1>
			<CRLF>
			<BUY-SHIP .BUY-PRICES .DOCK>
		)(<EQUAL? .KEY !\2>
			<CRLF>
			<SELL-SHIP .SELL-PRICES .CARGO-PRICES>
		)(<EQUAL? .KEY !\3>
			<CRLF>
			<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
				<UPGRADE-SHIP .UPGRADE-PRICES>
			)(ELSE
				<EMPHASIZE ,TEXT-NO-SHIPS>
			)>
		)>
	>>

<ROUTINE BUY-SHIP (BUY-PRICES "OPT" DOCK "AUX" KEY ITEM)
	<REPEAT ()
		<EMPHASIZE "Shipyard">
		<PRINT-MENU ,SHIPS-LIST T T !\0 ,TEXT-BACK .BUY-PRICES>
		<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
			<DESCRIBE-PLAYER-SHIPS>
			<CRLF>
		)>
		<TELL "You are carrying " N ,MONEY " " D ,CURRENCY ,PERIOD-CR>
		<TELL "Which ship shall you buy?">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<EQUAL? .KEY !\0 !\1 !\2 !\3> <RETURN>)>
		>
		<COND (<EQUAL? .KEY !\0>
			<CRLF>
			<TELL CR ,TEXT-SURE>
			<COND (<YES?> <RETURN>)>
		)(ELSE
			<SET ITEM <- .KEY !\0>>
			<COND (<IN? <GET ,SHIPS-LIST .ITEM> ,SHIPS>
				<CRLF>
				<EMPHASIZE "You already own that ship!">
			)(<G=? ,MONEY <GET .BUY-PRICES .ITEM>>
				<CRLF>
				<TELL CR "Buy a " D <GET ,SHIPS-LIST .ITEM> "?">
				<COND (<YES?>
					<COST-MONEY <GET .BUY-PRICES .ITEM> ,TEXT-PAID>
					<MOVE <GET ,SHIPS-LIST .ITEM> ,SHIPS>
					<PUTP <GET ,SHIPS-LIST .ITEM> ,P?DOCKED .DOCK>
					<COND (<NOT ,CURRENT-SHIP> <SETG CURRENT-SHIP <GET ,SHIPS-LIST .ITEM>>)>
					<CRLF>
					<TELL "You bought a ">
					<PRINT-ITEM <GET ,SHIPS-LIST .ITEM> T>
					<TELL ,PERIOD-CR>
					<UPDATE-STATUS-LINE>
				)>
			)(ELSE
				<CRLF>
				<EMPHASIZE "You can't afford that ship!">
			)>
		)>
	>>

<ROUTINE SELL-ALL-CARGO (CARGO-PRICES "OPT" CONTAINER "AUX" ITEM TYPE PROFIT)
	<COND (<NOT .CONTAINER> <SET .CONTAINER ,CARGO>)>
	<COND (<G? <COUNT-CONTAINER .CONTAINER> 0>
		<SET PROFIT 0>
		<SET ITEM <FIRST? .CONTAINER>>
		<REPEAT ()
			<COND (<NOT .ITEM> <RETURN>)>
			<SET TYPE <GETP .ITEM ,P?TYPE>>
			<COND (<G? .TYPE 0>
				<SET PROFIT <+ .PROFIT <GET .CARGO-PRICES .TYPE>>>
			)>
			<SET ITEM <NEXT? .ITEM>>
		>
		<COND (<G? .PROFIT 0>
			<CRLF>
			<TELL "You sold: ">
			<PRINT-CONTAINER .CONTAINER>
			<RESET-CONTAINER .CONTAINER>
			<GAIN-MONEY .PROFIT>
		)>
	)>>

<ROUTINE SELL-CARGO (SELL-PRICES)
	<COND (.SELL-PRICES
		<MERCHANT ,CARGO-LIST .SELL-PRICES ,CARGO T>
	)>>

<ROUTINE SELL-SHIP (SELL-PRICES CARGO-PRICES "AUX" KEY ITEM)
	<REPEAT ()
		<EMPHASIZE "You can sell your ships at these prices" "Shipyard">
		<PRINT-MENU ,SHIPS-LIST T T !\0 ,TEXT-BACK .SELL-PRICES>
		<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
			<DESCRIBE-PLAYER-SHIPS>
			<CRLF>
		)>
		<TELL "Which ship will you sell?">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<EQUAL? .KEY !\0 !\1 !\2 !\3> <RETURN>)>
		>
		<COND (<EQUAL? .KEY !\0>
			<CRLF>
			<TELL CR ,TEXT-SURE>
			<COND (<YES?> <RETURN>)>
		)(ELSE
			<SET ITEM <- .KEY !\0>>
			<COND (<NOT <IN? <GET ,SHIPS-LIST .ITEM> ,SHIPS>>
				<CRLF>
				<EMPHASIZE ,TEXT-SHIP-NOT-OWNER>
			)(ELSE
				<CRLF>
				<TELL CR "Sell " T <GET ,SHIPS-LIST .ITEM> "?">
				<COND (<YES?>
					<REMOVE <GET ,SHIPS-LIST .ITEM>>
					<COND (<EQUAL? ,CURRENT-SHIP <GET ,SHIPS-LIST .ITEM>>
						<SETG CURRENT-SHIP NONE>
					)>
					<CRLF>
					<TELL "You sold the ">
					<PRINT-ITEM <GET ,SHIPS-LIST .ITEM> T>
					<TELL ,PERIOD-CR>
					<GAIN-MONEY <GET .SELL-PRICES .ITEM>>
					<COND (<L=? <COUNT-CONTAINER ,SHIPS> 0> <SELL-ALL-CARGO .CARGO-PRICES>)>
					<PUTP <GET ,SHIPS-LIST .ITEM> ,P?CONDITION ,CONDITION-POOR>
					<UPDATE-STATUS-LINE>
				)>
			)>
		)>
	>>

<ROUTINE UPGRADE-SHIP (UPGRADE-PRICES "AUX" CONDITION KEY UPGRADES ITEM)
	<SET UPGRADES <LTABLE 0 0 0>>
	<REPEAT ()
		<DO (I 1 3)
			<COND (<IN? <GET ,SHIPS-LIST .I> ,SHIPS>
				<SET CONDITION <GETP <GET ,SHIPS-LIST .I> ,P?CONDITION>>
				<COND (<N=? .CONDITION ,CONDITION-EXCELLENT>
					<COND (<L=? .CONDITION <GET .UPGRADE-PRICES 0>>
						<PUT .UPGRADES .I <GET .UPGRADE-PRICES <+ .CONDITION 1>>>
					)(ELSE
						<PUT .UPGRADES .I 0>
					)>
				)(ELSE
					<PUT .UPGRADES .I 0>
				)>
			)(ELSE
				<PUT .UPGRADES .I 0>
			)>
		>
		<EMPHASIZE "You can upgrade ships at the following prices" "Shipyard">
		<PRINT-MENU ,SHIPS-LIST T T !\0 ,TEXT-BACK .UPGRADES>
		<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
			<DESCRIBE-PLAYER-SHIPS>
			<CRLF>
		)>
		<TELL "You are carrying " N ,MONEY " " D ,CURRENCY ,PERIOD-CR>
		<TELL "Which ship shall you upgrade?">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<EQUAL? .KEY !\0 !\1 !\2 !\3> <RETURN>)>
		>
		<COND (<EQUAL? .KEY !\0>
			<CRLF>
			<TELL CR ,TEXT-SURE>
			<COND (<YES?>
				<RETURN>
			)>
		)(ELSE
			<CRLF>
			<SET .ITEM <- .KEY !\0>>
			<COND (<IN? <GET ,SHIPS-LIST .ITEM> ,SHIPS>
				<COND (<EQUAL? <GET .UPGRADES .ITEM> 0>
					<EMPHASIZE "That ship can no longer be upgraded!">
				)(<G=? ,MONEY <GET .UPGRADES .ITEM>>
					<CRLF>
					<TELL "Upgrade " T <GET ,SHIPS-LIST .ITEM> "?">
					<COND (<YES?>
						<CRLF>
						<SET CONDITION <GETP <GET ,SHIPS-LIST .ITEM> ,P?CONDITION>>
						<COND (<G=? .CONDITION ,CONDITION-EXCELLENT>
							<EMPHASIZE "This ship can no longer be upgraded!">
						)(ELSE
							<INC .CONDITION>
							<PUTP <GET ,SHIPS-LIST .ITEM> ,P?CONDITION .CONDITION>
							<TELL "You upgraded the ">
							<PRINT-ITEM <GET ,SHIPS-LIST .ITEM> T>
							<TELL ,PERIOD-CR>
							<COST-MONEY <GET .UPGRADES .ITEM> ,TEXT-PAID>
							<UPDATE-STATUS-LINE>
						)>
					)>
				)(ELSE
					<EMPHASIZE "You can't afford to upgrade this ship!">
				)>
			)(ELSE
				<EMPHASIZE ,TEXT-SHIP-NOT-OWNER>
			)>
		)>
	>>

<ROUTINE VALIDATE-CARGO (SELL-PRICES "AUX" CAPACITY CARGO)
	<COND (<NOT ,CURRENT-SHIP> <RETURN>)>
	<SET CAPACITY <GETP ,CURRENT-SHIP ,P?CAPACITY>>
	<SET CARGO <COUNT-CONTAINER ,CARGO>>
	<COND (<G? .CARGO .CAPACITY>
		<EMPHASIZE "Your cargo has exceeded the maximum capacity of your designated ship!">
		<CRLF>
		<TELL "Sell the excess cargo?">
		<COND (<YES?>
			<STORY-LOSE-CARGO <- .CARGO .CAPACITY>>
			<SELL-ALL-CARGO .SELL-PRICES ,LOST-STUFF>
			<RTRUE>
		)>
		<RFALSE>
	)>
	<RTRUE>>

<ROUTINE VIEW-SHIP-MANIFEST ("AUX" LIST COUNT SHIP KEY)
	<COND (<L=? <COUNT-CONTAINER ,SHIPS> 0> <RETURN>)>
	<SET LIST <LTABLE NONE NONE NONE>>
	<REPEAT ()
		<EMPHASIZE "Ship manifest">
		<SET COUNT 0>
		<DO (I 1 3)
			<SET SHIP <GET ,SHIPS-LIST .I>>
			<COND (<IN? .SHIP ,SHIPS>
				<INC .COUNT>
				<PUT .LIST .COUNT .SHIP>
				<HLIGHT ,H-BOLD>
				<TELL N .COUNT>
				<HLIGHT 0>
				<TELL " [">
				<COND (<EQUAL? ,CURRENT-SHIP .SHIP>
					<HLIGHT ,H-BOLD>
					<TELL "X">
					<HLIGHT 0>
				)(ELSE
					<TELL " ">
				)>
				<TELL "] - ">
				<PRINT-ITEM <GET .LIST .COUNT> F>
				<CRLF>
			)>
		>
		<HLIGHT ,H-BOLD>
		<TELL "C">
		<HLIGHT 0>
		<TELL " - View Cargo" CR>
		<HLIGHT ,H-BOLD>
		<TELL "0">
		<HLIGHT 0>
		<TELL " - Back" CR>
		<TELL "Select primary ship: ">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<OR <EQUAL? .KEY !\0 !\C !\c> <AND <G=? .KEY !\1> <L=? .KEY <+ .COUNT !\0>>>> <RETURN>)>
		>
		<CRLF>
		<COND (<EQUAL? .KEY !\0>
			<TELL CR ,TEXT-SURE>
			<COND (<YES?>
				<RETURN>
			)>
		)(<EQUAL? .KEY !\V !\v>
			<CRLF>
			<DESCRIBE-PLAYER-SHIPS>
			<PRESS-A-KEY>
		)(ELSE
			<SET KEY <- .KEY !\0>>
			<COND (<EQUAL? ,CURRENT-SHIP <GET .LIST .KEY>>
				<SETG CURRENT-SHIP NONE>
			)(ELSE
				<SETG CURRENT-SHIP <GET .LIST .KEY>>
			)>
		)>
		<UPDATE-STATUS-LINE>
	>>

; "Harbour - Marlock City"
; ---------------------------------------------------------------------------------------------

<CONSTANT MARLOCK-CARGO-BUY <LTABLE 190 190 700 500 820 325 190>>
<CONSTANT MARLOCK-CARGO-SELL <LTABLE 180 180 635 460 760 285 180>>
<CONSTANT MARLOCK-SHIP-BUY <LTABLE 250 450 900>>
<CONSTANT MARLOCK-SHIP-SELL <LTABLE 125 225 450>>
<CONSTANT MARLOCK-UPGRADE-PRICES <LTABLE 50 100 150>>
<CONSTANT MARLOCK-TICKETS <LTABLE 10 0 0 0>>
<CONSTANT MARLOCK-TRAVEL <LTABLE STORY372 STORY455 STORY234 STORY424>>
<CONSTANT MARLOCK-PASSAGES
	<LTABLE
		DESTINATION-YELLOWPORT
		DESTINATION-WISHPORT
		DESTINATION-SORCERERS-ISLE
		DESTINATION-COPPER-ISLAND
	>>

<ROUTINE HARBOUR-MARLOCK ("AUX" KEY CHOICE ITEMS DESTINATION)
	<COND (,CURRENT-SHIP <PUTP ,CURRENT-SHIP ,P?DOCKED ,DOCK-MARLOCK>)>
	<DO (I 1 3)
		<COND (<NOT <IN? <GET ,SHIPS-LIST .I> ,SHIPS>>
			<STORY-RESET-CREW ,CONDITION-AVERAGE>
		)>
	>
	<SET ITEMS <GET ,HARBOUR-MASTER-MENU 0>>
	<REPEAT ()
		<EMPHASIZE ,TEXT-HARBOUR-MASTER>
		<PRINT-MENU ,HARBOUR-MASTER-MENU F F>
		<HLIGHT ,H-BOLD>
		<TELL "C">
		<HLIGHT 0>
		<TELL " - View your character (" D ,CURRENT-CHARACTER ")" CR>
		<HLIGHT ,H-BOLD>
		<TELL "0">
		<HLIGHT 0>
		<TELL " - Go to the city centre" CR>
		<TELL "What do you wish to do next?">
		<REPEAT ()
			<SET .KEY <INPUT 1>>
			<COND (<OR <EQUAL? .KEY !\C !\c !\P !\p> <AND <G=? .KEY !\0> <L=? .KEY <+ .ITEMS !\0>>>> <RETURN>)>
		>
		<CRLF>
		<SET .CHOICE <- .KEY !\0>>
		<COND (<EQUAL? .KEY !\C !\c !\P !\p>
			<DESCRIBE-PLAYER>
			<PRESS-A-KEY>
		)(<EQUAL? .CHOICE 0>
			<CRLF>
			<TELL ,TEXT-SURE>
			<COND (<YES?> <RETURN>)>
		)(<EQUAL? .CHOICE 1>
			<BUY-SELL-UPGRADE-SHIP ,MARLOCK-SHIP-BUY ,MARLOCK-SHIP-SELL ,MARLOCK-UPGRADE-PRICES ,MARLOCK-CARGO-SELL ,DOCK-MARLOCK>
		)(<EQUAL? .CHOICE 2>
			<SET DESTINATION <BOOK-PASSAGE ,MARLOCK-PASSAGES ,MARLOCK-TICKETS ,MARLOCK-TRAVEL>>
			<COND (.DESTINATION
				<STORY-JUMP .DESTINATION>
				<RETURN>
			)>
		)(<EQUAL? .CHOICE 3>
			<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
				<EMPHASIZE "You have not designated a primary ship!">
				<VIEW-SHIP-MANIFEST>
			)(ELSE
				<EMPHASIZE ,TEXT-NO-SHIPS>
			)>
		)(<EQUAL? .CHOICE 4>
			<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
				<BUY-SELL-CARGO ,MARLOCK-CARGO-BUY ,MARLOCK-CARGO-SELL>
			)(ELSE
				<EMPHASIZE ,TEXT-NO-SHIPS>
			)>
		)(<EQUAL? .CHOICE 5>
			<COND (,CURRENT-SHIP
				<COND (<VALIDATE-CARGO ,MARLOCK-CARGO-SELL>
					<STORY-JUMP ,STORY084>
					<RETURN>
				)>
			)(ELSE
				<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
					<VIEW-SHIP-MANIFEST>
				)(ELSE
					<EMPHASIZE ,TEXT-NO-SHIPS>
				)>
			)>
		)>
	>>

; "Harbour - Trading Post"
; ---------------------------------------------------------------------------------------------

<CONSTANT HARBOUR-TRADING-MENU <LTABLE "Book a passage" "View ship manifest" "Visit the market" "Set sail">>
<CONSTANT TRADING-POST-PASSAGES	<LTABLE	DESTINATION-YELLOWPORT>>
<CONSTANT TRADING-POST-TICKETS	<LTABLE	15>>
<CONSTANT TRADING-POST-TRAVEL	<LTABLE	STORY074>>

<CONSTANT TRADING-POST-CARGO-BUY <LTABLE 135 220 600 400 900 325 120>>
<CONSTANT TRADING-POST-CARGO-SELL <LTABLE 130 210 570 310 820 285 100>>

<ROUTINE HARBOUR-TRADING-POST ("AUX" KEY CHOICE ITEMS DESTINATION)
	<COND (,CURRENT-SHIP <PUTP ,CURRENT-SHIP ,P?DOCKED ,DOCK-TRADING>)>
	<SET ITEMS <GET ,HARBOUR-TRADING-MENU 0>>
	<REPEAT ()
		<EMPHASIZE ,TEXT-HARBOUR-MASTER>
		<PRINT-MENU ,HARBOUR-TRADING-MENU F F>
		<HLIGHT ,H-BOLD>
		<TELL "C">
		<HLIGHT 0>
		<TELL " - View your character (" D ,CURRENT-CHARACTER ")" CR>
		<HLIGHT ,H-BOLD>
		<TELL "0">
		<HLIGHT 0>
		<TELL " - Go back to the village" CR>
		<TELL "What do you wish to do next?">
		<REPEAT ()
			<SET .KEY <INPUT 1>>
			<COND (<OR <EQUAL? .KEY !\C !\c !\P !\p> <AND <G=? .KEY !\0> <L=? .KEY <+ .ITEMS !\0>>>> <RETURN>)>
		>
		<CRLF>
		<SET .CHOICE <- .KEY !\0>>
		<COND (<EQUAL? .KEY !\C !\c !\P !\p>
			<DESCRIBE-PLAYER>
			<PRESS-A-KEY>
		)(<EQUAL? .CHOICE 0>
			<CRLF>
			<TELL ,TEXT-SURE>
			<COND (<YES?> <RETURN>)>
		)(<EQUAL? .CHOICE 1>
			<SET DESTINATION <BOOK-PASSAGE ,TRADING-POST-PASSAGES ,TRADING-POST-TICKETS ,TRADING-POST-TRAVEL>>
			<COND (.DESTINATION
				<STORY-JUMP .DESTINATION>
				<RETURN>
			)>
		)(<EQUAL? .CHOICE 2>
			<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
				<EMPHASIZE "You have not designated a primary ship!">
				<VIEW-SHIP-MANIFEST>
			)(ELSE
				<EMPHASIZE ,TEXT-NO-SHIPS>
			)>
		)(<EQUAL? .CHOICE 3>
			<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
				<BUY-SELL-CARGO ,TRADING-POST-CARGO-BUY ,TRADING-POST-CARGO-SELL>
			)(ELSE
				<EMPHASIZE ,TEXT-NO-SHIPS>
			)>
		)(<EQUAL? .CHOICE 4>
			<COND (,CURRENT-SHIP
				<COND (<VALIDATE-CARGO ,TRADING-POST-CARGO-SELL>
					<STORY-JUMP ,STORY155>
					<RETURN>
				)>
			)(ELSE
				<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
					<VIEW-SHIP-MANIFEST>
				)(ELSE
					<EMPHASIZE ,TEXT-NO-SHIPS>
				)>
			)>
		)>
	>>

; "Harbour - Yellowport"
; ---------------------------------------------------------------------------------------------

<CONSTANT YELLOWPORT-CARGO-BUY <LTABLE 190 200 600 350 900 350 180>>
<CONSTANT YELLOWPORT-CARGO-SELL <LTABLE 170 180 500 250 810 300 160>>
<CONSTANT YELLOWPORT-SHIP-BUY <LTABLE 250 450 900>>
<CONSTANT YELLOWPORT-SHIP-SELL <LTABLE 125 225 450>>
<CONSTANT YELLOWPORT-UPGRADE-PRICES <LTABLE 50 100>>
<CONSTANT YELLOWPORT-TICKETS <LTABLE 10 15 0 0>>
<CONSTANT YELLOWPORT-TRAVEL <LTABLE STORY150 STORY301 STORY234 STORY424>>
<CONSTANT YELLOWPORT-PASSAGES
	<LTABLE
		DESTINATION-MARLOCK
		DESTINATION-ISLE-DRUIDS
		DESTINATION-SORCERERS-ISLE
		DESTINATION-COPPER-ISLAND
	>>

<ROUTINE HARBOUR-YELLOWPORT ("AUX" KEY CHOICE ITEMS DESTINATION)
	<COND (,CURRENT-SHIP <PUTP ,CURRENT-SHIP ,P?DOCKED ,DOCK-YELLOWPORT>)>
	<DO (I 1 3)
		<COND (<NOT <IN? <GET ,SHIPS-LIST .I> ,SHIPS>>
			<STORY-RESET-CREW ,CONDITION-POOR>
		)>
	>
	<SET ITEMS <GET ,HARBOUR-MASTER-MENU 0>>
	<REPEAT ()
		<EMPHASIZE ,TEXT-HARBOUR-MASTER>
		<PRINT-MENU ,HARBOUR-MASTER-MENU F F>
		<HLIGHT ,H-BOLD>
		<TELL "C">
		<HLIGHT 0>
		<TELL " - View your character (" D ,CURRENT-CHARACTER ")" CR>
		<HLIGHT ,H-BOLD>
		<TELL "0">
		<HLIGHT 0>
		<TELL " - Go to the city centre" CR>
		<TELL "What do you wish to do next?">
		<REPEAT ()
			<SET .KEY <INPUT 1>>
			<COND (<OR <EQUAL? .KEY !\C !\c !\P !\p> <AND <G=? .KEY !\0> <L=? .KEY <+ .ITEMS !\0>>>> <RETURN>)>
		>
		<CRLF>
		<SET .CHOICE <- .KEY !\0>>
		<COND (<EQUAL? .KEY !\C !\c !\P !\p>
			<DESCRIBE-PLAYER>
			<PRESS-A-KEY>
		)(<EQUAL? .CHOICE 0>
			<CRLF>
			<TELL ,TEXT-SURE>
			<COND (<YES?> <RETURN>)>
		)(<EQUAL? .CHOICE 1>
			<BUY-SELL-UPGRADE-SHIP ,YELLOWPORT-SHIP-BUY ,YELLOWPORT-SHIP-SELL ,YELLOWPORT-UPGRADE-PRICES ,YELLOWPORT-CARGO-SELL ,DOCK-YELLOWPORT>
		)(<EQUAL? .CHOICE 2>
			<SET DESTINATION <BOOK-PASSAGE ,YELLOWPORT-PASSAGES ,YELLOWPORT-TICKETS ,YELLOWPORT-TRAVEL>>
			<COND (.DESTINATION
				<STORY-JUMP .DESTINATION>
				<RETURN>
			)>
		)(<EQUAL? .CHOICE 3>
			<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
				<EMPHASIZE "You have not designated a primary ship!">
				<VIEW-SHIP-MANIFEST>
			)(ELSE
				<EMPHASIZE ,TEXT-NO-SHIPS>
			)>
		)(<EQUAL? .CHOICE 4>
			<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
				<BUY-SELL-CARGO ,YELLOWPORT-CARGO-BUY ,YELLOWPORT-CARGO-SELL>
			)(ELSE
				<EMPHASIZE ,TEXT-NO-SHIPS>
			)>
		)(<EQUAL? .CHOICE 5>
			<COND (,CURRENT-SHIP
				<COND (<VALIDATE-CARGO ,YELLOWPORT-CARGO-SELL>
					<STORY-JUMP ,STORY499>
					<RETURN>
				)>
			)(ELSE
				<COND (<G? <COUNT-CONTAINER ,SHIPS> 0>
					<VIEW-SHIP-MANIFEST>
				)(ELSE
					<EMPHASIZE ,TEXT-NO-SHIPS>
				)>
			)>
		)>
	>>

; "Townhouse routines"
; ---------------------------------------------------------------------------------------------

<CONSTANT CACHE-MENU <LTABLE "Leave/Take your possessions.">>
<CONSTANT TEXT-TOWNHOUSE "You can leave possessions and money here to save having to carry them around with you. You can also rest here safely, and recover any Stamina points you have lost.">
<CONSTANT TOWNHOUSE-MENU <LTABLE "Leave/Take your possessions." "Leave/Withdraw money.">>
<CONSTANT TOWNHOUSE-MENU-MONEY <LTABLE "Leave some your money here." "Take the money that was kept here.">>
<CONSTANT TOWNHOUSE-MENU-POSSESSIONS <LTABLE "Leave some of your possessions here." "Take the  items that are kept here.">>

<ROUTINE TOWNHOUSE-MONEY (STORY TOWNHOUSE "AUX" KEY NUMBER MONEY)
	<REPEAT ()
		<CRLF>
		<HLIGHT ,H-BOLD>
		<TELL D .TOWNHOUSE>
		<HLIGHT 0>
		<CRLF>
		<PRINT-MENU ,TOWNHOUSE-MENU-MONEY F F !\0 "Back">
		<SET .MONEY <GETP .TOWNHOUSE ,P?MONEY>>
		<COND (<G? .MONEY 0>
			<TELL "There are ">
			<HLIGHT ,H-BOLD>
			<TELL N .MONEY>
			<HLIGHT 0>
			<TELL " " D ,CURRENCY " kept here at ">
			<HLIGHT ,H-BOLD>
			<TELL T .TOWNHOUSE ,PERIOD-CR>
			<HLIGHT 0>
		)>
		<TELL "You are carrying " N ,MONEY " " D ,CURRENCY ": ">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<EQUAL? .KEY !\0 !\1 !\2> <RETURN>)>
		>
		<CRLF>
		<COND (<EQUAL? .KEY !\0>
			<RETURN>
		)(<EQUAL? .KEY !\1>
			<COND (<G? ,MONEY 0>
				<SET NUMBER <GET-NUMBER "How much will you leave here" 0 ,MONEY>>
				<COND (<G? .NUMBER 0>
					<PUTP .TOWNHOUSE ,P?MONEY <+ .MONEY .NUMBER>>
					<COST-MONEY .NUMBER "left">
				)>
			)(ELSE
				<CRLF>
				<HLIGHT ,H-BOLD>
				<TELL "You are not carrying any " D, CURRENCY ,EXCLAMATION-CR>
				<HLIGHT 0>
				<PRESS-A-KEY>
			)>
		)(<EQUAL? .KEY !\2>
			<COND (<G? .MONEY 0>
				<SET NUMBER <GET-NUMBER "How much will you withdraw" 0 .MONEY>>
				<COND (<G? .NUMBER 0>
					<PUTP .TOWNHOUSE ,P?MONEY <- .MONEY .NUMBER>>
					<GAIN-MONEY .NUMBER>
				)>
			)(ELSE
				<EMPHASIZE "There is nothing to withdraw here!">
				<PRESS-A-KEY>
			)>
		)>
	>>

<ROUTINE TOWNHOUSE-POSSESSIONS (STORY TOWNHOUSE "AUX" KEY)
	<REPEAT ()
		<CRLF>
		<HLIGHT ,H-BOLD>
		<TELL D .TOWNHOUSE>
		<HLIGHT 0>
		<CRLF>
		<PRINT-MENU ,TOWNHOUSE-MENU-POSSESSIONS F F !\0 "Back">
		<DESCRIBE-INVENTORY-MAIN>
		<TELL "What will you do next?">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<EQUAL? .KEY !\0 !\1 !\2> <RETURN>)>
		>
		<CRLF>
		<COND (<EQUAL? .KEY !\0>
			<RETURN>
		)(<EQUAL? .KEY !\1>
			<COND (<G? <COUNT-CONTAINER ,PLAYER> 0>
				<TOWNHOUSE-STORAGE ,PLAYER .TOWNHOUSE "leave" T>
			)(ELSE
				<EMPHASIZE "You are not carrying anything!">
				<PRESS-A-KEY>
			)>
		)(<EQUAL? .KEY !\2>
			<COND (<G? <COUNT-CONTAINER .TOWNHOUSE> 0>
				<TOWNHOUSE-STORAGE .TOWNHOUSE ,PLAYER  "take">
			)(ELSE
				<EMPHASIZE "Nothing is being kept here!">
				<PRESS-A-KEY>
			)>
		)>
	>>

<ROUTINE TOWNHOUSE-STORAGE (FROM TO MESSAGE "OPT" (LEAVE F) "AUX" ITEMS KEY CHOICE)
	<REPEAT ()
		<SET ITEMS <COUNT-CONTAINER .FROM>>
		<COND (<L=? .ITEMS 0> <RETURN>)>
		<CRLF>
		<HLIGHT ,H-BOLD>
		<COND (.LEAVE
			<TELL "You are carrying:">
		)(ELSE
			<TELL D .FROM>
		)>
		<HLIGHT 0>
		<CRLF>
		<PRINT-CONTAINER-MENU .FROM !\0 "Back">
		<TELL "Choose what items to " .MESSAGE>
		<COND (.LEAVE
			<TELL " at ">
			<HLIGHT ,H-BOLD>
			<TELL D .TO>
			<HLIGHT 0>
			<TELL ": ">
		)(ELSE
			<TELL " from ">
			<HLIGHT ,H-BOLD>
			<TELL T .FROM>
			<HLIGHT 0>
			<TELL ": ">
		)>
		<REPEAT ()
			<SET .KEY <INPUT 1>>
			<COND (
				<OR
					<EQUAL? .KEY !\0>
					<AND <G=? .KEY !\1> <L=? .KEY !\9> <L=? <- .KEY !\0> .ITEMS>>
					<AND <G=? .KEY !\A> <L=? .KEY !\J> <L=? <+ <- .KEY !\A> 10> .ITEMS>>
					<AND <G=? .KEY !\a> <L=? .KEY !\j> <L=? <+ <- .KEY !\a> 10> .ITEMS>>
				>
				<RETURN>
			)>
		>
		<CRLF>
		<COND (<EQUAL? .KEY !\0>
			<RETURN>
		)(<OR <AND <G=? .KEY !\1> <L=? .KEY !\9> <L=? <- .KEY !\0> .ITEMS>> <AND <G=? .KEY !\A> <L=? .KEY !\J> <L=? <+ <- .KEY !\A> 10> .ITEMS>> <AND <G=? .KEY !\a> <L=? .KEY !\j> <L=? <+ <- .KEY !\a> 10> .ITEMS>>>
			<COND (<AND <G=? .KEY !\1> <L=? .KEY !\9> <L=? <- .KEY !\0> .ITEMS>>
				<SET CHOICE <- .KEY !\0>>
			)(<AND <G=? .KEY !\A> <L=? .KEY !\J> <L=? <+ <- .KEY !\A> 10> .ITEMS>>
				<SET CHOICE <+ <- .KEY !\A> 10>>
			)(<AND <G=? .KEY !\a> <L=? .KEY !\j> <L=? <+ <- .KEY !\a> 10> .ITEMS>>
				<SET CHOICE <+ <- .KEY !\a> 10>>
			)>
			<CRLF>
			<PRINT-CAP-STR .MESSAGE>
			<TELL " ">
			<HLIGHT ,H-BOLD>
			<PRINT-ITEM <GET-ITEM .CHOICE .FROM> T>
			<HLIGHT 0>
			<COND (.LEAVE
				<TELL " at ">
				<HLIGHT ,H-BOLD>
				<TELL T .TO "?">
			)(ELSE
				<TELL " from ">
				<HLIGHT ,H-BOLD>
				<TELL T .FROM "?">
			)>
			<HLIGHT 0>
			<COND (<YES?>
				<COND (.LEAVE
					<MOVE <GET-ITEM .CHOICE .FROM> .TO>	
				)(ELSE
					<COND (<EQUAL? .TO ,PLAYER>
						<COND (<G=? <COUNT-CONTAINER .TO> ,LIMIT-POSSESSIONS>
							<EMPHASIZE "You are already carrying too many items!">
						)(ELSE
							<MOVE <GET-ITEM .CHOICE .FROM> .TO>	
						)>
					)>
				)>
			)>
		)>
	>>

<ROUTINE VISIT-TOWNHOUSE (STORY TOWNHOUSE "OPT" (FATAL F) (CODEWORD NONE) "AUX" ROLL KEY)
	<COND (<L? ,STAMINA ,MAX-STAMINA> <GAIN-STAMINA <- ,MAX-STAMINA ,STAMINA>>)>
	<UPDATE-STATUS-LINE>
	<COND (<NOT <FSET? .TOWNHOUSE ,CACHEBIT>>
		<SET ROLL <RANDOM-EVENT 2 0 T>>
		<COND (<L=? .ROLL 9>
			<COND (<G? <COUNT-CONTAINER .TOWNHOUSE> 0>
				<EMPHASIZE "Your possessions are safe.">
			)(ELSE
				<EMPHASIZE ,NOTHING-HAPPENS>
			)>
		)(<L=? .ROLL 11>
			<COND (<G? <GETP .TOWNHOUSE ,P?MONEY> 0>
				<EMPHASIZE "A break-in! All the money left here is gone!">
				<PUTP .TOWNHOUSE ,P?MONEY 0>
			)(ELSE
				<EMPHASIZE "Robbers did not find any money here!">
			)>
		)(<L=? .ROLL 12>
			<COND (.FATAL
				<EMPHASIZE "Earthquake! You lose all possessions you left here and the townhouse is destroyed.">
				<COND (.CODEWORD <DELETE-CODEWORD .CODEWORD>)>
				<RESET-CONTAINER .TOWNHOUSE>
				<GAIN-MONEY <GETP .TOWNHOUSE ,P?MONEY>>
				<PUTP .TOWNHOUSE ,P?MONEY 0>
				<RETURN>
			)(ELSE
				<COND (<G? <COUNT-CONTAINER .TOWNHOUSE> 0>
					<EMPHASIZE "Raiding nomads take all your possessions!">
					<RESET-CONTAINER .TOWNHOUSE>
				)(ELSE
					<EMPHASIZE "Raiding nomads did not find anything of value here!">
				)>
			)>
		)>
		<PRESS-A-KEY>
	)>
	<REPEAT ()
		<CRLF>
		<HLIGHT ,H-BOLD>
		<TELL D .TOWNHOUSE>
		<HLIGHT 0>
		<CRLF>
		<PRINT-MENU ,TOWNHOUSE-MENU F F !\0 "You're done here">
		<TELL "What do you want to do?">
		<REPEAT ()
			<SET KEY <INPUT 1>>
			<COND (<EQUAL? .KEY !\0 !\1 !\2 !\0> <RETURN>)>
		>
		<CRLF>
		<COND (<EQUAL? .KEY !\0>
			<CRLF>
			<TELL ,TEXT-SURE>
			<COND(<YES?>
				<CRLF>
				<TELL "You leave your ">
				<HLIGHT ,H-BOLD>
				<TELL D .TOWNHOUSE>
				<HLIGHT 0>
				<TELL ,PERIOD-CR>
				<RETURN>
			)>
		)(<EQUAL? .KEY !\1>
			<TOWNHOUSE-POSSESSIONS .STORY .TOWNHOUSE>
		)(<EQUAL? .KEY !\2>
			<TOWNHOUSE-MONEY .STORY .TOWNHOUSE>
		)>
	>>

; "Inns"
; ---------------------------------------------------------------------------------------------

<ROUTINE VISIT-INN ("OPT" (STORY NONE) (FEE 1) (GAIN 1) "AUX" (DAYS 0) (DIFFERENCE 0) (VISITS))
	<COND (<NOT .STORY> <SET STORY ,HERE>)>
	<COND (<L? ,STAMINA ,MAX-STAMINA>
		<SET DIFFERENCE <- ,MAX-STAMINA ,STAMINA>>
		<COND (<G=? ,MONEY .FEE>
			<REPEAT ()
				<CRLF>
				<TELL "It costs " N .FEE " per day to regain " N .GAIN " stamina" ,PERIOD-CR>
				<SET DAYS <GET-NUMBER "How many days will you spend here" 0 12>>
				<COND (<G? .DAYS 0>
					<COND (<G=? ,MONEY <* .DAYS .FEE>>
						<GAIN-STAMINA <* .DAYS .GAIN>>
						<COST-MONEY <* .DAYS .FEE> ,TEXT-PAID>
						<SET VISITS <GETP .STORY ,P?VISITS>>
						<SET VISITS <+ .VISITS .DAYS>>
						<PUTP .STORY ,P?VISITS .VISITS>
						<RETURN>
					)(ELSE
						<EMPHASIZE "You can't afford that!">
					)>
				)(ELSE
					<EMPHASIZE "You left the bar.">
					<RETURN>
				)>
			>
		)(ELSE
			<EMPHASIZE "You are turned away at the bar">
		)>
	)(ELSE
		<EMPHASIZE "You are fully recovered.">
	)>>

; "Gambling Den routines"
; ---------------------------------------------------------------------------------------------

<ROUTINE GAMBLING-DEN (MAX "AUX" BET ROLL)
	<COND (<G=? ,MONEY .MAX>
		<CRLF>
		<TELL "Do you wish to gamble (" N .MAX " " D ,CURRENCY " maximum)?">
		<COND (<YES?>
			<REPEAT ()
				<SET BET <GET-NUMBER "How much will you bet" 1 .MAX>>
				<REPEAT ()
					<SET ROLL <ROLL-DICE 2>>
					<CRLF>
					<TELL "You rolled " N .ROLL CR>
					<PRESS-A-KEY>
					<COND (<NOT <PROCESS-RANDOM-BLESSING>> <RETURN>)>
				>
				<COND (<L=? .ROLL 2>
					<EMPHASIZE "You win five times your bet!">
					<SETG MONEY <+ ,MONEY <* .BET 5>>>
				)(<L=? .ROLL 4>
					<EMPHASIZE "You win twice your bet!">
					<SETG MONEY <+ ,MONEY <* .BET 2>>>
				)(<L=? .ROLL 9>
					<EMPHASIZE "You lost your bet!">
					<SETG MONEY <- ,MONEY .BET>>
				)(<L=? .ROLL 11>
					<EMPHASIZE "You win twice your bet!">
					<SETG MONEY <+ ,MONEY <* .BET 2>>>
				)(ELSE
					<EMPHASIZE "You win five times your bet!">
					<SETG MONEY <+ ,MONEY <* .BET 5>>>
				)>
				<COND (<L? ,MONEY 0> <SETG MONEY 0>)>
				<UPDATE-STATUS-LINE>
				<COND (<L? ,MONEY .MAX>
					<EMPHASIZE "You are thrown out of the Gambling Den!">
					<RETURN>
				)>
				<CRLF>
				<TELL "Are you ready to leave?">
				<COND (<YES?> <RETURN>)>
			>
		)>
	)>>

; "Temple Routines"
; ---------------------------------------------------------------------------------------------

<ROUTINE BECOME-INITIATE (FEE WORSHIP)
	<COND (<NOT ,GOD>
		<COND (<G=? ,MONEY .FEE>
			<CRLF>
			<TELL ,TEXT-BECOME-INITIATE>
			<TELL " of " D .WORSHIP "?">
			<COND (<YES?>
				<COST-MONEY .FEE ,TEXT-PAID>
				<SETG GOD .WORSHIP>
				<UPDATE-STATUS-LINE>
			)>
		)(ELSE
			<CRLF>
			<HLIGHT ,H-BOLD>
			<TELL "You cannot afford to become an initiate of " D .WORSHIP " at this time" ,EXCLAMATION-CR>
			<HLIGHT 0>
		)>
	)(ELSE
		<CRLF>
		<HLIGHT ,H-BOLD>
		<TELL "You are already an initiate of " D ,GOD ,EXCLAMATION-CR>
		<HLIGHT 0>
	)>>

<ROUTINE GOD-CURE (FEE DISCOUNT INITIATE FLAG "OPT" FLAG2)
	<COND (<CHECK-GOD .INITIATE> <SET FEE .DISCOUNT>)>
	<CURE-AILMENTS .FEE .FLAG .FLAG2>>

<ROUTINE PURCHASE-BLESSING (FEE DISCOUNT INITIATE BLESSING)
	<COND (<NOT .BLESSING> <RETURN>)>
	<COND (<NOT .INITIATE> <RETURN>)>
	<COND (<CHECK-GOD .INITIATE> <SET FEE .DISCOUNT>)>
	<COND (<CHECK-BLESSING .BLESSING>
		<CRLF>
		<TELL "You already have the ">
		<PRINT-ITEM .BLESSING T>
		<TELL ,EXCLAMATION-CR>
	)(<G=? ,MONEY .FEE>
		<CRLF>
		<TELL "Purchase this blessing for " N .FEE " " D ,CURRENCY "?">
		<COND (<YES?>
			<COST-MONEY .FEE ,TEXT-PAID>
			<GAIN-BLESSING .BLESSING>
		)>
	)(ELSE
		<EMPHASIZE "You cannot afford this blessing at this time.">
	)>>

; "TO-DO: Allow cancellation of previous resurrection arrangement"
<ROUTINE PURCHASE-RESURRECTION (FEE DISCOUNT INITIATE RESURRECTION "OPT" STORY)
	<COND (<NOT .RESURRECTION> <RETURN>)>
	<COND (<NOT .INITIATE> <RETURN>)>
	<COND (<CHECK-GOD .INITIATE> <SET FEE .DISCOUNT>)>
	<COND (,RESURRECTION-ARRANGEMENTS
		<CRLF>
		<TELL "You already have the resurrection arrangement: ">
		<PRINT-ITEM ,RESURRECTION-ARRANGEMENTS T>
		<TELL ,EXCLAMATION-CR>
		<COND (<G=? ,MONEY .FEE>
			<CRLF>
			<TELL "Do you wish to cancel this and make a new arrangement?">
			<COND (<YES?>
				<COST-MONEY .FEE ,TEXT-PAID>
				<SETG RESURRECTION-ARRANGEMENTS .RESURRECTION>
				<EMPHASIZE "You have made resurrection arrangements at this temple.">
				<COND (.STORY <PUTP .RESURRECTION ,P?CONTINUE .STORY>)>
			)>
		)(ELSE
			<EMPHASIZE "... and you cannot afford to make a new arrangement at this time.">
		)>
	)(<G=? ,MONEY .FEE>
		<CRLF>
		<TELL "Make resurrection arrangements at this temple for " N .FEE " " D ,CURRENCY "?">
		<COND (<YES?>
			<COST-MONEY .FEE ,TEXT-PAID>
			<SETG RESURRECTION-ARRANGEMENTS .RESURRECTION>
			<EMPHASIZE "You have made resurrection arrangements at this temple.">
		)>
	)(ELSE
		<EMPHASIZE "You cannot afford to make resurrection arrangements at this time.">
	)>>

<ROUTINE RENOUNCE-TYRNAI ("OPT" STORY)
	<COND (<NOT .STORY> <SET STORY ,HERE>)>
	<COND (,GOD
		<COND (<CHECK-GOD ,GOD-TYRNAI>
			<RENOUNCE-WORSHIP 50 ,GOD-TYRNAI>
			<COND (,GOD
				<PREVENT-DOOM .STORY>
			)(ELSE
				<CRLF>
				<TELL ,TEXT-WRATHFUL-BLOW>
				<CRLF>
				<LOSE-STAMINA 1 ,DIED-FROM-INJURIES .STORY>
				<COND (<IS-ALIVE>
					<COND (<EQUAL? ,RESURRECTION-ARRANGEMENTS ,RESURRECTION-TYRNAI>
						<SETG RESURRECTION-ARRANGEMENTS NONE>
						<EMPHASIZE "Your resurrection arrangements are forfeit!">
					)>
				)>
			)>
		)(ELSE
			<PREVENT-DOOM .STORY>
		)>
	)(ELSE
		<PREVENT-DOOM .STORY>
	)>>

<ROUTINE RENOUNCE-WORSHIP (FEE WORSHIP "AUX" RESURRECTION)
	<COND (,GOD
		<COND (<CHECK-GOD .WORSHIP>
			<COND (<G=? ,MONEY .FEE>
				<CRLF>
				<TELL "Renounce the worship of " D .WORSHIP "?">
				<COND (<YES?>
					<COND (<G? .FEE 0> <COST-MONEY .FEE ,TEXT-PAID>)>
					<SETG GOD NONE>
					<SET RESURRECTION <GETP .WORSHIP ,P?RESURRECTION>>
					<COND (.RESURRECTION
						<COND (<EQUAL? .RESURRECTION ,RESURRECTION-ANY>
							<EMPHASIZE "You lose all outstanding resurrection arrangements!">
							<SETG RESURRECTION-ARRANGEMENTS NONE>
						)(<EQUAL? ,RESURRECTION-ARRANGEMENTS .RESURRECTION>
							<EMPHASIZE "You've lost resurrection arrangements made at this temple!">
							<SETG RESURRECTION-ARRANGEMENTS NONE>
						)>
					)>
					<UPDATE-STATUS-LINE>
				)>
			)(ELSE
				<EMPHASIZE "You cannot afford to pay the compensation of the priesthood!">
			)>
		)(ELSE
			<CRLF>
			<HLIGHT ,H-BOLD>
			<TELL "You are not an initiate of " D .WORSHIP ,EXCLAMATION-CR>
			<HLIGHT 0>
		)>
	)(ELSE
		<EMPHASIZE "You are not an initiate of any god!">
	)>>

; "Yellowport market"
; ---------------------------------------------------------------------------------------------

<CONSTANT YELLOWPORT-BUY-MENU <LTABLE "Buy armour" "Buy weapons" "Buy Magical Equipment" "Buy other items" "Return to the market">>

<ROOM YELLOWPORT-BUY
	(DESC "030 Merchant - Selling")
	(CHOICES YELLOWPORT-BUY-MENU)
	(DESTINATIONS <LTABLE YELLOWPORT-BUY-ARMOUR YELLOWPORT-BUY-WEAPONS YELLOWPORT-BUY-MAGIC YELLOWPORT-BUY-OTHER STORY030>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM YELLOWPORT-BUY-ARMOUR
	(DESC "030 Merchant - Selling armours")
	(EVENTS YELLOWPORT-BUYING-ARMOUR)
	(CONTINUE YELLOWPORT-BUY)
	(FLAGS LIGHTBIT)>

<ROOM YELLOWPORT-BUY-WEAPONS
	(DESC "030 Merchant - Selling weapons")
	(EVENTS YELLOWPORT-BUYING-WEAPONS)
	(CONTINUE YELLOWPORT-BUY)
	(FLAGS LIGHTBIT)>

<ROOM YELLOWPORT-BUY-MAGIC
	(DESC "030 Merchant - Selling magic items")
	(EVENTS YELLOWPORT-BUYING-MAGIC)
	(CONTINUE YELLOWPORT-BUY)
	(FLAGS LIGHTBIT)>

<ROOM YELLOWPORT-BUY-OTHER
	(DESC "030 Merchant - Selling other items")
	(EVENTS YELLOWPORT-BUYING-OTHER)
	(CONTINUE YELLOWPORT-BUY)
	(FLAGS LIGHTBIT)>

<ROUTINE YELLOWPORT-BUYING-ARMOUR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR RING-MAIL CHAIN-MAIL> <LTABLE 50 100 200>>>

<ROUTINE YELLOWPORT-BUYING-WEAPONS ()
	<MERCHANT <LTABLE AXE BATTLE-AXE MACE SPEAR STAFF SWORD BATTLE-AXE1 MACE1 SPEAR1 STAFF1 SWORD1> <LTABLE 50 50 50 50 50 50 250 250 250 250 250>>>

<ROUTINE YELLOWPORT-BUYING-MAGIC ()
	<MERCHANT <LTABLE AMBER-WAND> <LTABLE 500>>>

<ROUTINE YELLOWPORT-BUYING-OTHER ()
	<MERCHANT <LTABLE MANDOLIN HOLY-SYMBOL COMPASS ROPE LANTERN CLIMBING-GEAR RAT-POISON> <LTABLE 300 200 500 50 100 100 60>>>

<CONSTANT YELLOWPORT-SELL-MENU <LTABLE "Sell armour" "Sell weapons (no COMBAT bonuses)" "Sell weapons (+1 COMBAT)" "Sell weapons (+2 COMBAT)" "Sell weapons (+3 COMBAT)" "Sell Magical Equipment" "Sell other items" "Return to the market">>

<ROOM YELLOWPORT-SELL
	(DESC "030 Merchant - Buying")
	(CHOICES YELLOWPORT-SELL-MENU)
	(DESTINATIONS <LTABLE YELLOWPORT-SELL-ARMOUR YELLOWPORT-SELL-WEAPONS YELLOWPORT-SELL-WEAPONS1 YELLOWPORT-SELL-WEAPONS2 YELLOWPORT-SELL-WEAPONS3 YELLOWPORT-SELL-MAGIC YELLOWPORT-SELL-OTHER STORY030>)
	(TYPES EIGHT-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM YELLOWPORT-SELL-ARMOUR
	(DESC "030 Merchant - Buying armours")
	(EVENTS YELLOWPORT-SELLING-ARMOUR)
	(CONTINUE YELLOWPORT-SELL)
	(FLAGS LIGHTBIT)>

<ROOM YELLOWPORT-SELL-WEAPONS
	(DESC "030 Merchant - Buying weapons (no COMBAT bonuses)")
	(EVENTS YELLOWPORT-SELLING-WEAPONS)
	(CONTINUE YELLOWPORT-SELL)
	(FLAGS LIGHTBIT)>

<ROOM YELLOWPORT-SELL-WEAPONS1
	(DESC "030 Merchant - Buying weapons (COMBAT +1)")
	(EVENTS YELLOWPORT-SELLING-WEAPONS1)
	(CONTINUE YELLOWPORT-SELL)
	(FLAGS LIGHTBIT)>

<ROOM YELLOWPORT-SELL-WEAPONS2
	(DESC "030 Merchant - Buying weapons (COMBAT +2)")
	(EVENTS YELLOWPORT-SELLING-WEAPONS2)
	(CONTINUE YELLOWPORT-SELL)
	(FLAGS LIGHTBIT)>

<ROOM YELLOWPORT-SELL-WEAPONS3
	(DESC "030 Merchant - Buying weapons (COMBAT +3)")
	(EVENTS YELLOWPORT-SELLING-WEAPONS3)
	(CONTINUE YELLOWPORT-SELL)
	(FLAGS LIGHTBIT)>

<ROOM YELLOWPORT-SELL-MAGIC
	(DESC "030 Merchant - Buying magic items")
	(EVENTS YELLOWPORT-SELLING-MAGIC)
	(CONTINUE YELLOWPORT-SELL)
	(FLAGS LIGHTBIT)>

<ROOM YELLOWPORT-SELL-OTHER
	(DESC "030 Merchant - Buying other items")
	(EVENTS YELLOWPORT-SELLING-OTHER)
	(CONTINUE YELLOWPORT-SELL)
	(FLAGS LIGHTBIT)>

<ROUTINE YELLOWPORT-SELLING-ARMOUR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR RING-MAIL CHAIN-MAIL SPLINT-ARMOUR PLATE-ARMOUR HEAVY-PLATE> <LTABLE 45 90 180 360 720 1440> ,PLAYER T>>

<ROUTINE YELLOWPORT-SELLING-WEAPONS ()
	<MERCHANT <LTABLE AXE BATTLE-AXE MACE SPEAR STAFF SWORD> <LTABLE 40 40 40 40 40 40> ,PLAYER T>>

<ROUTINE YELLOWPORT-SELLING-WEAPONS1 ()
	<MERCHANT <LTABLE AXE1 BATTLE-AXE1 MACE1 SPEAR1 STAFF1 SWORD1> <LTABLE 200 200 200 200 200 200> ,PLAYER T>>

<ROUTINE YELLOWPORT-SELLING-WEAPONS2 ()
	<MERCHANT <LTABLE AXE2 BATTLE-AXE2 MACE2 SPEAR2 STAFF2 SWORD2> <LTABLE 400 400 400 400 400 400> ,PLAYER T>>

<ROUTINE YELLOWPORT-SELLING-WEAPONS3 ()
	<MERCHANT <LTABLE AXE3 BATTLE-AXE3 MACE3 SPEAR3 STAFF3 SWORD3> <LTABLE 800 800 800 800 800 800> ,PLAYER T>>

<ROUTINE YELLOWPORT-SELLING-MAGIC ()
	<MERCHANT <LTABLE AMBER-WAND EBONY-WAND COBALT-WAND> <LTABLE 400 800 600> ,PLAYER T>>

<ROUTINE YELLOWPORT-SELLING-OTHER ()
	<MERCHANT <LTABLE MANDOLIN LOCKPICKS HOLY-SYMBOL COMPASS ROPE LANTERN CLIMBING-GEAR BAG-OF-PEARLS RAT-POISON SILVER-NUGGET TREASURE-MAP SILVER-FLUTE> <LTABLE 270 270 100 450 45 90 90 100 50 200 150 500> ,PLAYER T>>

; "Venefax Market"
; ---------------------------------------------------------------------------------------------

<CONSTANT VENEFAX-BUY-MENU <LTABLE "Buy armour/weapons" "Buy other items" "Back">>
<CONSTANT VENEFAX-SELL-MENU <LTABLE "Sell armour/weapons" "Sell other items" "Back">>

<ROOM VENEFAX-BUY
	(DESC "152 Merchant - Selling")
	(CHOICES VENEFAX-BUY-MENU)
	(DESTINATIONS <LTABLE VENEFAX-BUY-GEAR VENEFAX-BUY-OTHER STORY152>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM VENEFAX-BUY-GEAR
	(DESC "152 Merchant - Selling armour/weapons")
	(EVENTS VENEFAX-BUYING-GEAR)
	(CONTINUE VENEFAX-BUY)
	(FLAGS LIGHTBIT)>

<ROOM VENEFAX-BUY-OTHER
	(DESC "152 Merchant - Selling other items")
	(EVENTS VENEFAX-BUYING-OTHER)
	(CONTINUE VENEFAX-BUY)
	(FLAGS LIGHTBIT)>

<ROOM VENEFAX-SELL
	(DESC "152 Merchant - Buying")
	(CHOICES VENEFAX-SELL-MENU)
	(DESTINATIONS <LTABLE VENEFAX-SELL-GEAR VENEFAX-SELL-OTHER STORY152>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM VENEFAX-SELL-GEAR
	(DESC "152 Merchant - Buying armour/weapons")
	(EVENTS VENEFAX-SELLING-GEAR)
	(CONTINUE VENEFAX-SELL)
	(FLAGS LIGHTBIT)>

<ROOM VENEFAX-SELL-OTHER
	(DESC "152 Merchant - Buying other items")
	(EVENTS VENEFAX-SELLING-OTHER)
	(CONTINUE VENEFAX-SELL)
	(FLAGS LIGHTBIT)>

<ROUTINE VENEFAX-BUYING-GEAR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR BATTLE-AXE MACE SPEAR STAFF SWORD> <LTABLE 50 50 50 50 50 50>>>

<ROUTINE VENEFAX-BUYING-OTHER ()
	<MERCHANT <LTABLE ROPE LANTERN CLIMBING-GEAR SCORPION-ANTIDOTE> <LTABLE 50 100 100 100>>>

<ROUTINE VENEFAX-SELLING-GEAR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR RING-MAIL BATTLE-AXE MACE SPEAR STAFF SWORD BATTLE-AXE1 MACE1 SPEAR1 STAFF1 SWORD1> <LTABLE 45 90 40 40 40 40 40 200 200 200 200 200> ,PLAYER T>>

<ROUTINE VENEFAX-SELLING-OTHER ()
	<MERCHANT <LTABLE ROPE LANTERN CLIMBING-GEAR SCORPION-ANTIDOTE SILVER-FLUTE> <LTABLE 45 90 90 90 500> ,PLAYER T>>

; "Caran Baru Market"
; ---------------------------------------------------------------------------------------------

<CONSTANT CARAN-BUY-MENU <LTABLE "Buy armour" "Buy weapons" "Buy Weapons (+1 COMBAT)" "Buy Weapons (+2 COMBAT)" "Buy other items" "Back">>
<CONSTANT CARAN-SELL-MENU <LTABLE "Sell armour" "Sell weapons" "Sell Weapons (+1 COMBAT)" "Sell Weapons (+2 COMBAT)" "Sell Weapons (+3 COMBAT)" "Sell magic weapons" "Sell other items" "Back">>

<ROOM CARAN-BARU-BUY
	(DESC "215 Merchant - Selling")
	(CHOICES CARAN-BUY-MENU)
	(DESTINATIONS <LTABLE CARAN-BUY-ARMOUR CARAN-BUY-WEAPONS CARAN-BUY-WEAPONS1 CARAN-BUY-WEAPONS2 CARAN-BUY-OTHER STORY215>)
	(TYPES SIX-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-BUY-ARMOUR
	(DESC "215 Merchant - Selling armours")
	(EVENTS CARAN-BUYING-ARMOUR)
	(CONTINUE CARAN-BARU-BUY)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-BUY-WEAPONS
	(DESC "215 Merchant - Selling weapons")
	(EVENTS CARAN-BUYING-WEAPONS)
	(CONTINUE CARAN-BARU-BUY)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-BUY-WEAPONS1
	(DESC "215 Merchant - Selling weapons (+1 COMBAT)")
	(EVENTS CARAN-BUYING-WEAPONS1)
	(CONTINUE CARAN-BARU-BUY)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-BUY-WEAPONS2
	(DESC "215 Merchant - Selling weapons (+2 COMBAT)")
	(EVENTS CARAN-BUYING-WEAPONS2)
	(CONTINUE CARAN-BARU-BUY)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-BUY-OTHER
	(DESC "215 Merchant - Selling other items")
	(EVENTS CARAN-BUYING-OTHER)
	(CONTINUE CARAN-BARU-BUY)
	(FLAGS LIGHTBIT)>

<ROUTINE CARAN-BUYING-ARMOUR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR RING-MAIL CHAIN-MAIL SPLINT-ARMOUR PLATE-ARMOUR> <LTABLE 50 100 200 400 800>>>

<ROUTINE CARAN-BUYING-WEAPONS ()
	<MERCHANT <LTABLE AXE BATTLE-AXE MACE SPEAR STAFF SWORD> <LTABLE 50 50 50 50 50 50>>>

<ROUTINE CARAN-BUYING-WEAPONS1 ()
	<MERCHANT <LTABLE AXE1 BATTLE-AXE1 MACE1 SPEAR1 STAFF1 SWORD1> <LTABLE 250 250 250 250 250 250>>>

<ROUTINE CARAN-BUYING-WEAPONS2 ()
	<MERCHANT <LTABLE AXE2 BATTLE-AXE2 MACE2 SPEAR2 STAFF2 SWORD2> <LTABLE 500 500 500 500 500 500>>>

<ROUTINE CARAN-BUYING-OTHER ()
	<MERCHANT <LTABLE MANDOLIN COMPASS ROPE LANTERN CLIMBING-GEAR RAT-POISON WOLF-PELT> <LTABLE 300 500 50 100 100 60 100>>>

<ROOM CARAN-BARU-SELL
	(DESC "215 Merchant - Buying")
	(CHOICES CARAN-SELL-MENU)
	(DESTINATIONS <LTABLE CARAN-SELL-ARMOUR CARAN-SELL-WEAPONS CARAN-SELL-WEAPONS1 CARAN-SELL-WEAPONS2 CARAN-SELL-WEAPONS3 CARAN-SELL-MAGIC CARAN-SELL-OTHER STORY215>)
	(TYPES EIGHT-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-SELL-ARMOUR
	(DESC "215 Merchant - Buying armours")
	(EVENTS CARAN-SELLING-ARMOUR)
	(CONTINUE CARAN-BARU-SELL)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-SELL-WEAPONS
	(DESC "215 Merchant - Buying weapons")
	(EVENTS CARAN-SELLING-WEAPONS)
	(CONTINUE CARAN-BARU-SELL)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-SELL-WEAPONS1
	(DESC "215 Merchant - Buying weapons (+1 COMBAT)")
	(EVENTS CARAN-SELLING-WEAPONS1)
	(CONTINUE CARAN-BARU-SELL)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-SELL-WEAPONS2
	(DESC "215 Merchant - Buying weapons (+2 COMBAT)")
	(EVENTS CARAN-SELLING-WEAPONS2)
	(CONTINUE CARAN-BARU-SELL)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-SELL-WEAPONS3
	(DESC "215 Merchant - Buying weapons (+3 COMBAT)")
	(EVENTS CARAN-SELLING-WEAPONS3)
	(CONTINUE CARAN-BARU-SELL)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-SELL-MAGIC
	(DESC "215 Merchant - Buying magic weapons")
	(EVENTS CARAN-SELLING-MAGIC)
	(CONTINUE CARAN-BARU-SELL)
	(FLAGS LIGHTBIT)>

<ROOM CARAN-SELL-OTHER
	(DESC "215 Merchant - Buying other items")
	(EVENTS CARAN-SELLING-OTHER)
	(CONTINUE CARAN-BARU-SELL)
	(FLAGS LIGHTBIT)>

<ROUTINE CARAN-SELLING-ARMOUR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR RING-MAIL CHAIN-MAIL SPLINT-ARMOUR PLATE-ARMOUR HEAVY-PLATE> <LTABLE 45 90 180 360 720 1440> ,PLAYER T>>

<ROUTINE CARAN-SELLING-WEAPONS ()
	<MERCHANT <LTABLE AXE BATTLE-AXE MACE SPEAR STAFF SWORD> <LTABLE 40 40 40 40 40 40> ,PLAYER T>>

<ROUTINE CARAN-SELLING-WEAPONS1 ()
	<MERCHANT <LTABLE AXE1 BATTLE-AXE1 MACE1 SPEAR1 STAFF1 SWORD1> <LTABLE 200 200 200 200 200 200> ,PLAYER T>>

<ROUTINE CARAN-SELLING-WEAPONS2 ()
	<MERCHANT <LTABLE AXE2 BATTLE-AXE2 MACE2 SPEAR2 STAFF2 SWORD2> <LTABLE 400 400 400 400 400 400> ,PLAYER T>>

<ROUTINE CARAN-SELLING-WEAPONS3 ()
	<MERCHANT <LTABLE AXE3 BATTLE-AXE3 MACE3 SPEAR3 STAFF3 SWORD3> <LTABLE 800 800 800 800 800 800> ,PLAYER T>>

<ROUTINE CARAN-SELLING-MAGIC ()
	<MERCHANT <LTABLE AMBER-WAND EBONY-WAND COBALT-WAND SELENIUM-WAND> <LTABLE 400 800 1600 	1600> ,PLAYER T>>

<ROUTINE CARAN-SELLING-OTHER ()
	<MERCHANT <LTABLE MANDOLIN LOCKPICKS HOLY-SYMBOL COMPASS ROPE LANTERN CLIMBING-GEAR BAG-OF-PEARLS RAT-POISON SILVER-NUGGET PLATINUM-EARRING WOLF-PELT SILVER-FLUTE> <LTABLE 270 270 100 450 45 90 90 100 50 150 800 90 500> ,PLAYER T>>

; "Local market"
; ---------------------------------------------------------------------------------------------

<ROOM LOCAL-MARKET-BUY
	(DESC "292 Merchant selling items")
	(EVENTS LOCAL-MARKET-BUYING-OTHER)
	(CONTINUE STORY292)
	(FLAGS LIGHTBIT)>

<ROUTINE LOCAL-MARKET-BUYING-OTHER ()
	<MERCHANT <LTABLE SMOLDER-FISH SILVER-NUGGET> <LTABLE 60 160>>>

<ROOM LOCAL-MARKET-SELL
	(DESC "292 Merchant buying items")
	(EVENTS LOCAL-MARKET-SELLING-OTHER)
	(CONTINUE STORY292)
	(FLAGS LIGHTBIT)>

<ROUTINE LOCAL-MARKET-SELLING-OTHER ()
	<MERCHANT <LTABLE SMOLDER-FISH SILVER-NUGGET SILVER-FLUTE> <LTABLE 55 150 500> ,PLAYER T>>

; "City of trees market"
; ---------------------------------------------------------------------------------------------

<CONSTANT TREES-BUY-MENU <LTABLE "Buy armour/weapons" "Buy magic/other items" "Back">>
<CONSTANT TREES-SELL-MENU <LTABLE "Sell armour/weapons" "Sell magic/other items" "Back">>

<ROOM CITY-TREES-BUY
	(DESC "358 Merchant - Selling")
	(CHOICES CARAN-BUY-MENU)
	(DESTINATIONS <LTABLE TREES-BUY-GEAR TREES-BUY-OTHER STORY358>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM TREES-BUY-GEAR
	(DESC "358 Merchant - Selling armours/weapons")
	(EVENTS TREES-BUYING-GEAR)
	(CONTINUE CITY-TREES-BUY)
	(FLAGS LIGHTBIT)>

<ROOM TREES-BUY-OTHER
	(DESC "358 Merchant - Selling magic/other items")
	(EVENTS TREES-BUYING-OTHER)
	(CONTINUE CITY-TREES-BUY)
	(FLAGS LIGHTBIT)>

<ROOM CITY-TREES-SELL
	(DESC "358 Merchant - Buying")
	(CHOICES CARAN-BUY-MENU)
	(DESTINATIONS <LTABLE TREES-SELL-GEAR TREES-SELL-OTHER STORY358>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM TREES-SELL-GEAR
	(DESC "358 Merchant - Buying armours/weapons")
	(EVENTS TREES-SELLING-GEAR)
	(CONTINUE CITY-TREES-SELL)
	(FLAGS LIGHTBIT)>

<ROOM TREES-SELL-OTHER
	(DESC "358 Merchant - Buying magic/other items")
	(EVENTS TREES-SELLING-OTHER)
	(CONTINUE CITY-TREES-SELL)
	(FLAGS LIGHTBIT)>

<ROUTINE TREES-BUYING-GEAR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR AXE BATTLE-AXE MACE SPEAR STAFF SWORD AXE1 BATTLE-AXE1 MACE1 SPEAR1 STAFF1 SWORD1> <LTABLE 50 50 50 50 50 50 50 250 250 250 250 250 250>>>

<ROUTINE TREES-BUYING-OTHER ()
	<MERCHANT <LTABLE AMBER-WAND EBONY-WAND SILVER-HOLY-SYMBOL GOLD-COMPASS ROPE LANTERN> <LTABLE 500 1000 800 900 50 100>>>

<ROUTINE TREES-SELLING-GEAR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR RING-MAIL AXE BATTLE-AXE MACE SPEAR STAFF SWORD AXE1 BATTLE-AXE1 MACE1 SPEAR1 STAFF1 SWORD1> <LTABLE 45 90 40 40 40 40 40 40 200 200 200 200 200 200> ,PLAYER T>>

<ROUTINE TREES-SELLING-OTHER ()
	<MERCHANT <LTABLE AMBER-WAND EBONY-WAND COBALT-WAND MANDOLIN SILVER-HOLY-SYMBOL GOLD-COMPASS ROPE LANTERN SILVER-NUGGET SILVER-FLUTE> <LTABLE 400 800 1600 270 750 800 45 90 150 500> ,PLAYER T>>

; "Marlock city market"
; ---------------------------------------------------------------------------------------------

<CONSTANT MARLOCK-BUY-MENU <LTABLE "Buy armour" "Buy weapons" "Buy magical and other items" "Return to the market">>

<ROOM MARLOCK-CITY-BUY
	(DESC "396 Merchant - Selling")
	(CHOICES MARLOCK-BUY-MENU)
	(DESTINATIONS <LTABLE MARLOCK-BUY-ARMOUR MARLOCK-BUY-WEAPONS MARLOCK-BUY-OTHER STORY396>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM MARLOCK-BUY-ARMOUR
	(DESC "386 Merchant - Selling armours")
	(EVENTS MARLOCK-BUYING-ARMOUR)
	(CONTINUE MARLOCK-CITY-BUY)
	(FLAGS LIGHTBIT)>

<ROOM MARLOCK-BUY-WEAPONS
	(DESC "396 Merchant - Selling weapons")
	(EVENTS MARLOCK-BUYING-WEAPONS)
	(CONTINUE MARLOCK-CITY-BUY)
	(FLAGS LIGHTBIT)>

<ROOM MARLOCK-BUY-OTHER
	(DESC "396 Merchant - Selling magical and other items")
	(EVENTS MARLOCK-BUYING-OTHER)
	(CONTINUE MARLOCK-CITY-BUY)
	(FLAGS LIGHTBIT)>

<ROUTINE MARLOCK-BUYING-ARMOUR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR RING-MAIL CHAIN-MAIL SPLINT-ARMOUR> <LTABLE 70 120 220 420>>>

<ROUTINE MARLOCK-BUYING-WEAPONS ()
	<MERCHANT <LTABLE AXE BATTLE-AXE MACE SPEAR STAFF SWORD AXE1 BATTLE-AXE1 MACE1 SPEAR1 STAFF1 SWORD1> <LTABLE 70 70 70 70 70 70 270 270 270 270 270 270>>>

<ROUTINE MARLOCK-BUYING-OTHER ()
	<MERCHANT <LTABLE AMBER-WAND> <LTABLE 500>>>

<CONSTANT MARLOCK-SELL-MENU <LTABLE "Sell armour" "Sell weapons (COMBAT +0-1)" "Sell weapons (++2-3 COMBAT)" "Sell magical items" "Sell other items" "Return to the market">>

<ROOM MARLOCK-CITY-SELL
	(DESC "396 Merchant - Buying")
	(CHOICES MARLOCK-SELL-MENU)
	(DESTINATIONS <LTABLE MARLOCK-SELL-ARMOUR MARLOCK-SELL-WEAPONS1 MARLOCK-SELL-WEAPONS2 MARLOCK-SELL-MAGIC MARLOCK-SELL-OTHER STORY396>)
	(TYPES SIX-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM MARLOCK-SELL-ARMOUR
	(DESC "396 Merchant - Buying armours")
	(EVENTS MARLOCK-SELLING-ARMOUR)
	(CONTINUE MARLOCK-CITY-SELL)
	(FLAGS LIGHTBIT)>

<ROOM MARLOCK-SELL-WEAPONS1
	(DESC "396 Merchant - Buying weapons (COMBAT +0-1)")
	(EVENTS MARLOCK-SELLING-WEAPONS1)
	(CONTINUE MARLOCK-CITY-SELL)
	(FLAGS LIGHTBIT)>

<ROOM MARLOCK-SELL-WEAPONS2
	(DESC "396 Merchant - Buying weapons (COMBAT +2-3)")
	(EVENTS MARLOCK-SELLING-WEAPONS2)
	(CONTINUE MARLOCK-CITY-SELL)
	(FLAGS LIGHTBIT)>

<ROOM MARLOCK-SELL-MAGIC
	(DESC "396 Merchant - Buying magic items")
	(EVENTS MARLOCK-SELLING-MAGIC)
	(CONTINUE MARLOCK-CITY-SELL)
	(FLAGS LIGHTBIT)>

<ROOM MARLOCK-SELL-OTHER
	(DESC "396 Merchant - Buying other items")
	(EVENTS MARLOCK-SELLING-OTHER)
	(CONTINUE MARLOCK-CITY-SELL)
	(FLAGS LIGHTBIT)>

<ROUTINE MARLOCK-SELLING-ARMOUR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR RING-MAIL CHAIN-MAIL SPLINT-ARMOUR PLATE-ARMOUR HEAVY-PLATE> <LTABLE 25 70 160 340 700 1420> ,PLAYER T>>

<ROUTINE MARLOCK-SELLING-WEAPONS1 ()
	<MERCHANT <LTABLE AXE BATTLE-AXE MACE SPEAR STAFF SWORD AXE1 BATTLE-AXE1 MACE1 SPEAR1 STAFF1 SWORD1> <LTABLE 20 20 20 20 20 20 180 180 180 180 180 180> ,PLAYER T>>

<ROUTINE MARLOCK-SELLING-WEAPONS2 ()
	<MERCHANT <LTABLE AXE2 BATTLE-AXE2 MACE2 SPEAR2 STAFF2 SWORD2 AXE3 BATTLE-AXE3 MACE3 SPEAR3 STAFF3 SWORD3> <LTABLE 380 380 380 380 380 380 780 780 780 780 780 780> ,PLAYER T>>

<ROUTINE MARLOCK-SELLING-MAGIC ()
	<MERCHANT <LTABLE AMBER-WAND EBONY-WAND COBALT-WAND> <LTABLE 380 780 1580> ,PLAYER T>>

<ROUTINE MARLOCK-SELLING-OTHER ()
	<MERCHANT <LTABLE MANDOLIN LOCKPICKS HOLY-SYMBOL COMPASS ROPE LANTERN CLIMBING-GEAR BAG-OF-PEARLS RAT-POISON SILVER-NUGGET SILVER-FLUTE> <LTABLE 250 250 80 430 25 70 70 80 130 190 500> ,PLAYER T>>

; "Trading Post market"
; ---------------------------------------------------------------------------------------------

<CONSTANT TRADING-BUY-MENU <LTABLE "Buy armour/weapons" "Buy other items" "Back">>

<ROOM TRADING-POST-BUY
	(DESC "452 Merchant - Selling")
	(CHOICES TRADING-BUY-MENU)
	(DESTINATIONS <LTABLE TRADING-BUY-GEAR TRADING-BUY-OTHER STORY452>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM TRADING-BUY-GEAR
	(DESC "452 Merchant - Selling armour/weapons")
	(EVENTS TRADING-BUYING-GEAR)
	(CONTINUE TRADING-POST-BUY)
	(FLAGS LIGHTBIT)>

<ROOM TRADING-BUY-OTHER
	(DESC "452 Merchant - Selling other items")
	(EVENTS TRADING-BUYING-OTHER)
	(CONTINUE TRADING-POST-BUY)
	(FLAGS LIGHTBIT)>

<ROUTINE TRADING-BUYING-GEAR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR AXE BATTLE-AXE MACE SPEAR STAFF SWORD> <LTABLE 50 50 50 50 50 50 50>>>

<ROUTINE TRADING-BUYING-OTHER ()
	<MERCHANT <LTABLE MANDOLIN COMPASS ROPE LANTERN SILVER-FLUTE> <LTABLE 300 500 50 100 500>>>

<CONSTANT TRADING-SELL-MENU <LTABLE "Sell armour" "Sell weapons" "Sell magic and other items" "Back">>

<ROOM TRADING-POST-SELL
	(DESC "452 Merchant - Buying")
	(CHOICES TRADING-SELL-MENU)
	(DESTINATIONS <LTABLE TRADING-SELL-ARMOUR TRADING-SELL-WEAPON TRADING-SELL-OTHER STORY452>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM TRADING-SELL-ARMOUR
	(DESC "452 Merchant - Buying armour")
	(EVENTS TRADING-SELLING-ARMOUR)
	(CONTINUE TRADING-POST-SELL)
	(FLAGS LIGHTBIT)>

<ROOM TRADING-SELL-WEAPON
	(DESC "452 Merchant - Buying weapons")
	(EVENTS TRADING-SELLING-WEAPON)
	(CONTINUE TRADING-POST-SELL)
	(FLAGS LIGHTBIT)>

<ROOM TRADING-SELL-OTHER
	(DESC "452 Merchant - Buying magic and other items")
	(EVENTS TRADING-SELLING-OTHER)
	(CONTINUE TRADING-POST-SELL)
	(FLAGS LIGHTBIT)>

<ROUTINE TRADING-SELLING-ARMOUR ()
	<MERCHANT <LTABLE LEATHER-ARMOUR RING-MAIL CHAIN-MAIL> <LTABLE 45 90 180> ,PLAYER T>>

<ROUTINE TRADING-SELLING-WEAPON ()
	<MERCHANT <LTABLE AXE BATTLE-AXE MACE SPEAR STAFF SWORD AXE1 BATTLE-AXE1 MACE1 SPEAR1 STAFF1 SWORD1> <LTABLE 40 40 40 40 40 40 200 200 200 200 200 200> ,PLAYER T>>

<ROUTINE TRADING-SELLING-OTHER ()
	<MERCHANT <LTABLE AMBER-WAND MANDOLIN LOCKPICKS HOLY-SYMBOL COMPASS ROPE LANTERN CLIMBING-GEAR BAG-OF-PEARLS RAT-POISON PICKAXE SILVER-NUGGET SILVER-FLUTE> <LTABLE 400 270 270 100 450 45 90 90 100 50 90 150 500> ,PLAYER T>>

; "Instructions"
; ---------------------------------------------------------------------------------------------

<CONSTANT INSTRUCTIONS-HEADER "|HOW TO USE THIS E-ADVENTURE|">
<CONSTANT INSTRUCTIONS-TEXT "Fabled Lands: War-Torn Kingdom is a digital gamebook -- an interactive game where the choices that you make correspond to numbered sections in the game. In moving through these sections you are creating a unique story for your adventuring persona.||You will begin your adventure by choosing a pre-generated character or a profession (see below)with the ability scores and Stamina that correspond to that profession at 1st Rank.||ABILITIES|---------||You have six abilities. Your initial score in each ability is decided by your choice of profession. Ability scores range from 1 (low ability) to 6 (a high level of ability). Ability scores will change during your adventure but can never be lower than 1 or higher than 12.||CHARISMA the knack of befriending people|COMBAT the skill of fighting|MAGIC the art of casting spells|SANCTITY the gift of divine power and wisdom|SCOUTING the techniques of tracking and wilderness lore|THIEVERY the talent for stealth and lock picking||STAMINA|-------||Stamina is lost when you get hurt. Keep track of your Stamina score throughout your travels and adventures. You must guard against your Stamina score dropping to zero, because if it does you are dead.||Lost Stamina can be recovered by various means, but your Stamina cannot go above its initial score until you advance in Rank.||You start with 9 Stamina points.||RANK|----||You start at 1st Rank. By completing quests and overcoming enemies, you will have the chance to go up in Rank.||You will be told during the course of your adventures when you are entitled to advance in Rank. Characters of higher Rank are tougher, luckier and generally better able to deal with trouble.||POSSESSIONS|-----------||You can carry up to twelve possessions on your person. All characters begin with 16 Shards in cash and the following possessions:||* sword|* leather jerkin (Defence +1)||Remember that you are limited to carrying a total of 12 items, so if you get more than this you'll have to cross something off your inventory or find somewhere to store extra items. There is no limit to how much money you can carry.||DEFENCE|-------||Your Defence score is equal to:||* your COMBAT score|* plus your RANK|* plus the bonus for the armour you're wearing (if any)||Every suit of armour you find will have a Defence bonus listed for it. The higher the bonus, the better the armour. You can carry several suits of armour if you wish -- but because you can wear only one at a time, you only get the Defence bonus of the best armour you are carrying.||To start with, it is just your COMBAT score plus 2 (because you are 1st Rank and have +1 DEFENSE).||It will be updated if you get better armour or increase in Rank or COMBAT ability.||ADDITIONAL HELP|---------------||During action selection and in other parts of the game, pressing 'H' or '?' brings up a list of additional command keys.">
<CONSTANT INSTRUCTIONS-PROFESSIONS "PROFESSIONS||Every adventurer has some strengths and some weaknesses. Your choice of profession determines your initial scores in the six abilities.">

<ROUTINE INSTRUCTIONS ()
	<HLIGHT ,H-BOLD>
	<TELL ,INSTRUCTIONS-HEADER>
	<HLIGHT 0>
	<CRLF>
	<TELL ,INSTRUCTIONS-TEXT>
	<CRLF>>

<CONSTANT HELP-TEXT "C - Display player information (abilities, items, codewords)|I - Display inventory (items)|R - Restore progress from a saved file|S - Save current progress to a file|Q - quit the game">

<ROUTINE DISPLAY-HELP ()
	<CRLF>
	<HLIGHT ,H-BOLD>
	<TELL "Additional Command Keys:">
	<HLIGHT 0>
	<CRLF>
	<TELL CR ,HELP-TEXT>
	<CRLF>>

; "Story"
; ---------------------------------------------------------------------------------------------

; "reset routines"
<ROUTINE RESET-OBJECTS ()
	<FSET ,LEATHER-JERKIN ,WORNBIT>
	<PUTP ,RESURRECTION-NAGIL ,P?CONTINUE ,STORY350>
	<PUTP ,RESURRECTION-TYRNAI ,P?CONTINUE ,STORY640>>

<ROUTINE RESET-STORY ()
	<RESET-ODDS 1 0 ,STORY038>
	<RESET-ODDS 1 0 ,STORY049>
	<RESET-ODDS 2 0 ,STORY051>
	<RESET-ODDS 1 0 ,STORY124>
	<RESET-ODDS 2 0 ,STORY444>
	<SET-DESTINATION ,STORY358 3 ,STORY678>
	<RESET-DIFFICULTY ,STORY237 1 10>
	<PUTP ,STORY014 ,P?DOOM T>
	<PUTP ,STORY034 ,P?DOOM T>
	<PUTP ,STORY036 ,P?DOOM T>
	<PUTP ,STORY042 ,P?DOOM T>
	<PUTP ,STORY043 ,P?DOOM T>
	<PUTP ,STORY045 ,P?DOOM T>
	<PUTP ,STORY049 ,P?DOOM T>
	<PUTP ,STORY051-CRUSHING-DEFEAT ,P?DOOM T>
	<PUTP ,STORY055 ,P?DOOM T>
	<PUTP ,STORY060 ,P?DOOM T>
	<PUTP ,STORY064 ,P?DOOM T>
	<PUTP ,STORY069 ,P?DOOM T>
	<PUTP ,STORY081 ,P?DOOM T>
	<PUTP ,STORY087 ,P?DOOM T>
	<PUTP ,STORY096 ,P?DOOM T>
	<PUTP ,STORY101-SUCCEED ,P?DOOM T>
	<PUTP ,STORY105 ,P?DOOM T>
	<PUTP ,STORY121 ,P?DOOM T>
	<PUTP ,STORY145 ,P?DOOM T>
	<PUTP ,STORY174 ,P?DOOM T>
	<PUTP ,STORY182 ,P?DOOM T>
	<PUTP ,STORY194 ,P?DOOM T>
	<PUTP ,STORY199 ,P?DOOM T>
	<PUTP ,STORY210 ,P?DOOM T>
	<PUTP ,STORY219 ,P?DOOM T>
	<PUTP ,STORY228 ,P?DOOM T>
	<PUTP ,STORY238 ,P?DOOM T>
	<PUTP ,STORY247 ,P?DOOM T>
	<PUTP ,STORY289 ,P?DOOM T>
	<PUTP ,STORY297 ,P?DOOM T>
	<PUTP ,STORY299 ,P?DOOM T>
	<PUTP ,STORY304 ,P?DOOM T>
	<PUTP ,STORY313 ,P?DOOM T>
	<PUTP ,STORY318 ,P?DOOM T>
	<PUTP ,STORY321 ,P?DOOM T>
	<PUTP ,STORY325 ,P?DOOM T>
	<PUTP ,STORY346 ,P?DOOM T>
	<PUTP ,STORY347 ,P?DOOM T>
	<PUTP ,STORY353 ,P?DOOM T>
	<PUTP ,STORY371 ,P?DOOM T>
	<PUTP ,STORY389 ,P?DOOM T>
	<PUTP ,STORY393 ,P?DOOM T>
	<PUTP ,STORY428 ,P?DOOM T>
	<PUTP ,STORY476 ,P?DOOM T>
	<PUTP ,STORY479 ,P?DOOM T>
	<PUTP ,STORY484 ,P?DOOM T>
	<PUTP ,STORY485 ,P?DOOM T>
	<PUTP ,STORY486 ,P?DOOM T>
	<PUTP ,STORY514 ,P?DOOM T>
	<PUTP ,STORY520 ,P?DOOM T>
	<PUTP ,STORY529 ,P?DOOM T>
	<PUTP ,STORY569 ,P?DOOM T>
	<PUTP ,STORY570 ,P?DOOM T>
	<PUTP ,STORY573 ,P?DOOM T>
	<PUTP ,STORY579 ,P?DOOM T>
	<PUTP ,STORY585 ,P?DOOM T>
	<PUTP ,STORY589 ,P?DOOM T>
	<PUTP ,STORY617 ,P?DOOM T>>

; "endings"
<CONSTANT BAD-ENDING "Your adventure ends here.|">
<CONSTANT GOOD-ENDING "Further adventure awaits.|">
<CONSTANT ENDING-BLOOD-DARK-SEA "Further adventures await at Fabled Lands 3: Over the Blood-Dark Sea.|">
<CONSTANT ENDING-CITIES-GOLD-GLORY "Further adventures await at Fabled Lands 2: Cities of Gold and Glory.|">
<CONSTANT ENDING-PLAINS-HOWLING-DARKNESS "Further adventures await at Fabled Lands 4: The Plains of Howling Darkness.|">

<ROUTINE SPECIAL-INTERRUPT-ROUTINE (KEY)
	; "TO-DO: Implement potion-of-healing"
	; "TO-DO: Implement Forest of the Forsaken Map"
	; "TO-DO: Implement Moonstone of Teleportation"
	; "TO-DO: View Ship Manifest (partially implemented in Harbour routines)"
	; "TO-DO: Implement use of antidotes"
	<RFALSE>>

<CONSTANT DIED-IN-COMBAT "You died in combat">
<CONSTANT DIED-OF-HUNGER "You starved to death">
<CONSTANT DIED-GREW-WEAKER "You grew weaker and eventually died">
<CONSTANT DIED-FROM-INJURIES "You died from your injuries">
<CONSTANT DIED-FROM-COLD "You eventually freeze to death">
<CONSTANT NOTHING-HAPPENS "Nothing happens.">

<CONSTANT TEXT-STORM-SEA "Heavy black clouds race towards you across the sky, whipping the waves into a frenzy. The crew mutter among themselves fearfully.">
<CONSTANT CHOICES-STORM-FURY "The storm hits with full fury">

<CONSTANT TEXT-STORM-SUBSIDES "Your ship is thrown about like flotsam and jetsam. When the storm subsides, you take stock. Much has been swept overboard.||Also, the ship has been swept way off course and the mate has no idea where you are. \"We're lost at sea, Cap'n,\" he moans.">
<CONSTANT TEXT-GUILD-INVESTMENTS "You can invest money in multiples of 100 Shards. The guild will buy and sell commodities on your behalf using this money until you return to collect it. \"Don't forget that you can lose money as well,\" mutters a merchant whose investments have not paid off.">
<CONSTANT TEXT-BLESSING-STORM-SAFETY "Your 'Safety from Storms' blessing protected you">

<CONSTANT TEXT-YOU-CAN-GO "You can go:">
<CONSTANT TEXT-YOU-CAN "You can:">

<CONSTANT HAVE-A "You have a">
<CONSTANT HAVE-AN "You have an">
<CONSTANT HAVE-THE "You have the">
<CONSTANT HAVE-CODEWORD "You have the codeword">
<CONSTANT HAVE-NEITHER "You have neither">
<CONSTANT IF-NOT "If not">
<CONSTANT OTHERWISE "Otherwise">
<CONSTANT YOU-ARE-A "You are a">

<CONSTANT TEXT-ROLL-COMBAT "Make a COMBAT roll">
<CONSTANT TEXT-ROLL-CHARISMA "Make a CHARISMA roll">
<CONSTANT TEXT-ROLL-MAGIC "Make a MAGIC roll">
<CONSTANT TEXT-ROLL-SANCTITY "Make a SANCTITY roll">
<CONSTANT TEXT-ROLL-SCOUTING "Make a SCOUTING roll">
<CONSTANT TEXT-ROLL-THIEVERY "Make a THIEVERY roll">

<CONSTANT TEXT-PAID "paid">
<CONSTANT TEXT-STORM "Storm">
<CONSTANT TEXT-UNEVENTFUL "An uneventful voyage">

<CONSTANT TEXT-BECOME-INITIATE "Become an Initiate">
<CONSTANT TEXT-LEAVE-TEMPLE "Leave the temple">
<CONSTANT TEXT-RENOUNCE-WORSHIP "Renounce worship">
<CONSTANT TEXT-RESURRECTION-ARRANGEMENTS "Make Resurrection Arrangements">
<CONSTANT TEXT-SEEK-BLESSING "Seek a blessing">
<CONSTANT CHOICES-STANDARD-TEMPLE <LTABLE TEXT-BECOME-INITIATE TEXT-RENOUNCE-WORSHIP TEXT-SEEK-BLESSING TEXT-LEAVE-TEMPLE>>

<CONSTANT TEXT-INITIATE-ALMIR-VALMIR "Becoming an initiate of Alvir and Valmir gives you the benefit of paying less for blessings and other services the temple can offer. It costs 40 Shards to become an initiate. You cannot do this if you are already an initiate of another temple.">

<CONSTANT TEXT-INITIATE-ELNIR "Becoming an initiate of Elnir gives you the benefit of paying less for blessings and other services the temple can offer. It costs 60 Shards to become an initiate. You cannot become an initiate of Elnir if you are already an initiate of another temple.">

<CONSTANT TEXT-BLESSING-ELNIR "If you are an initiate it costs only 10 Shards to purchase Elnir's blessing. A non-initiate must pay 25 Shards.||The blessing works by allowing you to try again when you make a failed CHARISMA roll. It is good for only one reroll. You can have only one CHARISMA blessing at any one time. Once it is used up, you can return to any branch of the Temple of Elnir to buy a new one.">

<CONSTANT TEXT-BLESSING-LACUNA "If you are an initiate it costs only 10 Shards to purchase Lacuna's blessing. A non-initiate must pay 25 Shards.||The blessing works by allowing you to try again on a failed SCOUTING roll. It is good for only one reroll. You can have only one SCOUTING blessing at any one time. Once it is used up, you can return to any branch of the temple of Lacuna to buy a new one.">

<CONSTANT TEXT-WRATHFUL-BLOW "The High Priest smashes you across the jaw, saying, \"I'm doing you a favour, believe me.\"">

<CONSTANT TEXT-TO-BEACH "Go down to the beach">
<CONSTANT TEXT-TO-TREFOILLE "Take the road to Trefoille">
<CONSTANT TEXT-TO-MARLOCK "Take the road to Marlock City">

<CONSTANT TEXT-SMOLDER-FISH "You caught a smolder fish while fishing.">

<CONSTANT CHOICES-COMBAT <LTABLE TEXT-ROLL-COMBAT>>
<CONSTANT CHOICES-CHARISMA <LTABLE TEXT-ROLL-CHARISMA>>
<CONSTANT CHOICES-MAGIC <LTABLE TEXT-ROLL-MAGIC>>
<CONSTANT CHOICES-SANCTITY <LTABLE TEXT-ROLL-SANCTITY>>
<CONSTANT CHOICES-SCOUTING <LTABLE TEXT-ROLL-SCOUTING>>
<CONSTANT CHOICES-THIEVERY <LTABLE TEXT-ROLL-THIEVERY>>
<CONSTANT CHOICES-RANDOM <LTABLE TEXT-RANDOM-EVENT>>

<CONSTANT ONE-ABILITY <LTABLE R-TEST-ABILITY>>
<CONSTANT ONE-RANDOM <LTABLE R-RANDOM>>
<CONSTANT TYPE-SAIL <LTABLE R-RANK R-TEST-ABILITY R-NONE>>
<CONSTANT STORY-TEST-SAILING <LTABLE 4 <LTABLE ABILITY-CHARISMA 11> NONE>>
<CONSTANT TWO-ABILITY <LTABLE R-TEST-ABILITY R-TEST-ABILITY>>

<CONSTANT CHOICES-NERECH <LTABLE "Demand that the crew follow your orders (The Plains of Howling Darkness)" TEXT-ROLL-CHARISMA "Turn back">>

<CONSTANT TEXT-VIOLET-OCEAN "\"The Violet Ocean's a dangerous place, Cap'n,\" says the first mate. \"The crew won't follow you there if they don't think you're good enough.\"">
<CONSTANT CHOICES-VIOLET-OCEAN <LTABLE "Demand that the crew follow your orders (Over the Blood-Dark Sea)" TEXT-ROLL-CHARISMA "Turn back">>
<CONSTANT STORY-VIOLET-REQUIREMENTS <LTABLE 4 <LTABLE ABILITY-CHARISMA 12> NONE>>

<CONSTANT STORY-STORM-REQUIREMENTS <LTABLE <LTABLE 1 0 <LTABLE 3 5 20> <LTABLE "The ship sinks!" "The mast splits!" "You weather the storm!">>>>

<ROUTINE STORY-GAIN-CARGO (CARGO "OPT" CAPACITY COUNT)
	<COND (,CURRENT-SHIP
		<MOVE .CARGO ,CURRENT-SHIP>
		<SET CAPACITY <GETP ,CURRENT-SHIP ,P?CAPACITY>>
		<SET COUNT <COUNT-CONTAINER ,CARGO>>
		<COND (<G? .COUNT .CAPACITY>
			<DEC .COUNT>
			<STORY-LOSE-CARGO .COUNT>
		)>
	)>>

<ROUTINE STORY-LOSE-BLESSING ("OPT" MAX "AUX" COUNT)
	<COND (<NOT <ASSIGNED? MAX>> <SET MAX 1>)>
	<SET COUNT <COUNT-CONTAINER ,BLESSINGS>>
	<COND (<L=? .COUNT .MAX>
		<RESET-CARGO>
	)(ELSE
		<LOSE-STUFF ,BLESSINGS ,LOST-STUFF "blessing" <- .COUNT .MAX> RESET-BLESSINGS>
	)>>

<ROUTINE STORY-LOSE-CARGO ("OPT" MAX "AUX" COUNT)
	<COND (<NOT <ASSIGNED? MAX>> <SET MAX 1>)>
	<SET COUNT <COUNT-CONTAINER ,CARGO>>
	<COND (<L=? .COUNT .MAX>
		<RESET-CARGO>
	)(ELSE
		<LOSE-STUFF ,CARGO ,LOST-STUFF "cargo" <- .COUNT .MAX> RESET-CARGO>
	)>>

<CONSTANT TEXT-DROWNED "You drowned!">
<CONSTANT TEXT-DRIFTWOOD "You manage to find some driftwood and make it back to shore">
<CONSTANT TEXT-SHIPWRECK "Your ship, crew and cargo are lost to the deep, dark sea. Your only thought now is to save yourself.">

<ROUTINE STORY-SHIPWRECK (STORY "AUX" (RANK 1) ROLL LOSS)
	<SET RANK <GET-RANK ,CURRENT-CHARACTER>>
	<SET ROLL <RANDOM-EVENT 2>>
	<COND (<G? .ROLL .RANK>
		<EMPHASIZE ,TEXT-DROWNED>
	)(ELSE
		<RESET-CONTAINER ,CARGO>
		<REMOVE ,CURRENT-SHIP>
		<SETG CURRENT-SHIP NONE>
		<CRLF>
		<TELL ,TEXT-DRIFTWOOD>
		<TELL ,PERIOD-CR>
		<SET LOSS <RANDOM-EVENT 1 0 T>>
		<LOSE-STAMINA .LOSS ,DIED-GREW-WEAKER .STORY>
	)>>

<ROUTINE STORY-LOSE-EVERYTHING ("OPT" (VERBOSE T))
	<COND (.VERBOSE
		<EMPHASIZE "You've lost all your money and possessions.">
	)>
	<RESET-POSSESSIONS>
	<SETG MONEY 0>
	<UPDATE-STATUS-LINE>>

<ROUTINE STORY-RESET-CREW ("OPT" CONDITION)
	<COND (<NOT .CONDITION> <SET .CONDITION ,CONDITION-GOOD>)>
	<COND (,CURRENT-SHIP <PUTP ,CURRENT-SHIP ,P?CONDITION .CONDITION>)>>

<ROUTINE STORY-ROLL-RANK (STORY "OPT" (MODIFIER -1) "AUX" ROLL (RANK 1))
	<SET ROLL <RANDOM-EVENT 1 .MODIFIER T>>
	<SET RANK <GET-RANK ,CURRENT-CHARACTER>>
	<COND (<L=? .ROLL .RANK> <STORY-JUMP .STORY>)>>

<CONSTANT TEXT001 "The first sound is the gentle murmur of waves some way off. The cry of gulls. Then the sensation of a softly stirring sea breeze and the baking sun on your back.||If that was all, you could imagine yourself in paradise, but as your senses return you start to feel the aches in every muscle. And then you remember the shipwreck.||You force open your eyes, caked shut by a crust of salt. You are lying on a beach, a desolate slab of wet sand that glistens in the merciless glare of the sun. Small crabs break away as you stir, scurrying for cover amid the long strands of seaweed.||\"Not... food for you yet...\" you murmur, wincing at the pain of cracked lips. Your mouth is dry and there is a pounding in your head born of fatigue and thirst. You don't care about the headache or the bruises, just as long as you're alive.||As you lie gathering your strength, you hear somebody coming along the shore.">
<CONSTANT CHOICES001 <LTABLE "Lie still until he's gone" "Speak to him">>

<ROOM STORY001
	(DESC "001")
	(STORY TEXT001)
	(CHOICES CHOICES001)
	(DESTINATIONS <LTABLE STORY736 STORY020>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT002 "You are face to face with a soldier. But is he friend -- or foe?">
<CONSTANT CHOICES002 <LTABLE HAVE-A HAVE-CODEWORD HAVE-NEITHER>>

<ROOM STORY002
	(DESC "002")
	(STORY TEXT002)
	(CHOICES CHOICES002)
	(DESTINATIONS <LTABLE STORY676 STORY098 STORY680>)
	(REQUIREMENTS <LTABLE CODED-MISSIVE CODEWORD-DELIVER NONE>)
	(TYPES <LTABLE R-ITEM R-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT003 "You have come to the foothills of the Spine of Harkun, in the north west of Sokara. The view is impressive: a massive wall of forested mountains, whose rocky, white-flanked peaks soar skywards into the clouds. These parts of the mountains are unscalable but you notice a large cave at the bottom of a mountain.">
<CONSTANT CHOICES003 <LTABLE "Investigate the cave" "Go east to the Citadel of Velis Corin" "South into the wilderness">>

<ROOM STORY003
	(DESC "003")
	(STORY TEXT003)
	(CHOICES CHOICES003)
	(DESTINATIONS <LTABLE STORY665 STORY271 STORY276>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT004 "The priests of Alvir and Valmir are overjoyed that you have returned the golden net. The high priest rewards you with 100 Shards and a rune-engraved magic weapon.">

<ROOM STORY004
	(DESC "004")
	(STORY TEXT004)
	(EVENTS STORY004-EVENTS)
	(CONTINUE STORY220)
	(ITEMS <LTABLE TRIDENT>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY004-EVENTS ()
	<RETURN-ITEM ,GOLDEN-NET T>
	<GAIN-MONEY 100>>

<CONSTANT TEXT005 "It is a tough climb upwards but not impossible.">

<ROOM STORY005
	(DESC "005")
	(STORY TEXT005)
	(EVENTS STORY005-EVENTS)
	(CONTINUE STORY681)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY005-EVENTS ()
	<ITEM-JUMP ,CLIMBING-GEAR ,STORY652>>

<CONSTANT TEXT006 "The chest springs open with a click. Inside you find 60 Shards, a mandolin (CHARISMA +1), and a potion of healing. The potion can be used once at any time (even in combat) to restore 5 Stamina points.||There is also an ancient religious text about the gods of Uttaku, called the scroll of Ebron, which reveals that one of the gods of the Uttakin is called Ebron, and that he has fourteen angles. You double-check but that's what it says. Not angels, angles.">

<ROOM STORY006
	(DESC "006")
	(STORY TEXT006)
	(EVENTS STORY006-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY006-EVENTS ()
	<SELECT-FROM-LIST <LTABLE MANDOLIN POTION-OF-HEALING SCROLL-OF-EBRON> 3 3>>

<CONSTANT TEXT007 "Much to your embarrassment, you get lost in the vast forest. You wander around for days until you finally emerge at the Bronze Hills.">

<ROOM STORY007
	(DESC "007")
	(STORY TEXT007)
	(CONTINUE STORY110)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT008 "You step through the archway. Immediately the symbols on the stone begin to glow with red-hot energy; your hair stands on end and your body tingles. A crackling nimbus of blue-white force engulfs you, the sky darkens and thunder and lightning crash and leap across the heavens. Suddenly, your vision fades, and everything goes black.||When your sight returns, you find yourself at the gates of a large city, set on an ochre-coloured river. A vile stink of brimstone permeates the air. You wrinkle your face up in disgust and gag involuntarily.||\"Welcome to Yellowport,\" says a passing merchant.">

<ROOM STORY008
	(DESC "008")
	(STORY TEXT008)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROOM STORY009
	(DESC "009")
	(BACKGROUND STORY009-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY009-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-ALTITUDE> <RETURN ,STORY272>)>
	<RETURN ,STORY685>>

<CONSTANT TEXT010 "Yellowport is the second largest city in Sokara. It is mainly a trading town, and is known for its exotic goods from distant Ankon-Konu.||The Stinking River brings rich deposits of sulphur from the Lake of the Sea Dragon down to the town, where it is extracted and stored in the large waterfront warehouses run by the merchants' guild. From here, the mineral is exported all over Harkuna. But all that sulphur has its drawbacks. The stink is abominable, and much of the city has a yellowish hue. The river is so full of sulphur that it is virtually useless as drinking water. However, the demand for sulphur, especially from the sorcerous guilds, is great.||Politically much has changed in the past few years. The old and corrupt king of Sokara, Corin VII, has been deposed and executed in a military coup. General Grieve Marlock and the army now control Sokara. The old Council of Yellowport has been indefinitely dissolved and a provost marshal, Marloes Marlock, the general's brother, appointed as military governor of the town.||You can buy a townhouse in Yellowport for 200 Shards. Owning a townhouse gives you a place to rest and to store equipment.||To leave Yellowport by sea, buy or sell ships and cargo, go to the harbourmaster.">

<CONSTANT YELLOWPORT-CHOICES
	<LTABLE
		"Call on Pyletes the Sage"
		"Seek an audience with the provost marshal"
		"Visit the market"
		"Visit the harbourmaster"
		"Go to the merchants' guild"
		"Explore the city by day"
		"Explore the city by night"
		"Visit your townhouse"
		"Visit the Gold Dust Tavern"
		"Visit the temple of Maka"
		"Visit the Temple of Elnir"
		"Visit the temple of Alvir and Valmir"
		"Visit the temple of Tyrnai"
		"Travel north-east toward Venefax"
		"Head north-west to Trefoille"
		"Follow the Stinking River north"
		"Strike out north-west, across country"
		"Visit your secret cache"
		"Go down into the sewers"
	>>

<CONSTANT YELLOWPORT-DESTINATIONS
	<LTABLE
		STORY040
		STORY523
		STORY030
		STORY555
		STORY405
		STORY302
		STORY442
		STORY300
		STORY506
		STORY141
		STORY316
		STORY220
		STORY526
		STORY621
		STORY233
		STORY082
		STORY558
		STORY327
		STORY460
	>>

<CONSTANT YELLOWPORT-REQUIREMENTS
	<LTABLE
		<LTABLE CODEWORD-ARTIFACT BOOK-SEVEN-SAGES>
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		CODEWORD-ABIDE
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		CODEWORD-ACID
		CODEWORD-AJAR
	>>

<CONSTANT YELLOWPORT-TYPES
	<LTABLE
		R-CODEWORD-ITEM
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-CODEWORD
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-CODEWORD
		R-CODEWORD
	>>

<ROOM STORY010
	(DESC "010")
	(VISITS 0)
	(LOCATION LOCATION-YELLOWPORT)
	(BACKGROUND STORY010-BACKGROUND)
	(STORY TEXT010)
	(EVENTS STORY010-EVENTS)
	(CHOICES YELLOWPORT-CHOICES)
	(DESTINATIONS YELLOWPORT-DESTINATIONS)
	(REQUIREMENTS YELLOWPORT-REQUIREMENTS)
	(TYPES YELLOWPORT-TYPES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY010-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-ASSASSIN>
		<RETURN ,STORY050>
	)(<CHECK-VISITS-EQUAL ,STORY010 4>
		<RETURN ,STORY273>
	)>>

<ROUTINE STORY010-EVENTS ()
	<COND (<AND <NOT <CHECK-CODEWORD ,CODEWORD-ABIDE>> <G=? ,MONEY 200>>
		<CRLF>
		<TELL "Would you like to buy a townhouse in Yellowport (200 " D ,CURRENCY ")?">
		<COND (<YES?>
			<COST-MONEY 200>
			<GAIN-CODEWORD ,CODEWORD-ABIDE>
			<GAIN-TOWNHOUSE ,TOWNHOUSE-YELLOWPORT>
		)>
	)>>

<CONSTANT TEXT011 "A narrow path leads up the hill, the top of which is crowned with a circle of large obsidian standing stones, hewn from solid rock. Despite the bitter wind that blows across these hills, the stones are unweathered and seem but newly lain. They form three archways, each carved with mystic symbols and runes of power.">

<ROOM STORY011
	(DESC "011")
	(STORY TEXT011)
	(CONTINUE STORY065)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT012 "You tell them a story of tragic love between a merman and a human princess. The merfolk are moved to shed briny tears, and one of them plants a languorous kiss on your lips.||You find you can indeed breathe underwater now. The merfolk lead you into the depths, where they swim playfully around you.||Suddenly, a hideous form looms out of the murk. It is like a giant squid, but it carries a spear in one of its many tentacles and wears rudimentary armour. Great black eyes shine with an implacable alien intelligence. The merfolk dart away in fright, leaving you alone with the creature.">

<ROOM STORY012
	(DESC "012")
	(STORY TEXT012)
	(EVENTS STORY012-EVENTS)
	(CONTINUE STORY238)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY012-EVENTS ()
	<CODEWORD-JUMP ,CODEWORD-ANCHOR ,STORY116>>

<ROOM STORY013
	(DESC "013")
	(STORY TEXT-VIOLET-OCEAN)
	(CHOICES CHOICES-VIOLET-OCEAN)
	(DESTINATIONS <LTABLE STORY-BLOOD-DARK-SEA <LTABLE STORY-BLOOD-DARK-SEA STORY507> STORY507>)
	(REQUIREMENTS STORY-VIOLET-REQUIREMENTS)
	(TYPES TYPE-SAIL)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT014 "Someone stabs you in the back.">
<CONSTANT TEXT014-CONTINUED "You spin around just as a beefy, disreputable-looking thug comes for you again with a long dagger.||\"Get the snooping swine!\" yells the man with the eye patch">

<ROOM STORY014
	(DESC "014")
	(STORY TEXT014)
	(EVENTS STORY014-EVENTS)
	(CONTINUE STORY476)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY014-EVENTS ()
	<LOSE-STAMINA 5 ,DIED-FROM-INJURIES ,STORY014>
	<COND (<IS-ALIVE>
		<CRLF>
		<TELL ,TEXT014-CONTINUED>
		<TELL ,PERIOD-CR>
		<COMBAT-MONSTER ,MONSTER-THUG 3 6 13>
		<CHECK-COMBAT ,MONSTER-THUG ,STORY014>
	)>>

<CONSTANT TEXT015 "Three drunken army officers accost you on the street.">

<ROOM STORY015
	(DESC "015")
	(STORY TEXT015)
	(EVENTS STORY015-EVENTS)
	(CONTINUE STORY686)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY015-EVENTS ()
	<TITLE-JUMP ,TITLE-PROTECTOR-SOKARA ,STORY542>>

<ROOM STORY016
	(DESC "016")
	(VISITS 0)
	(BACKGROUND STORY016-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY016-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY016 1> <RETURN ,STORY251>)>
	<RETURN ,STORY688>>

<CONSTANT TEXT017 "The horse and you hit the wall. There is a bright flash, and you find that you have passed straight through into the hill. It must be a faerie mound -- and that's not good. The horse you are riding abruptly changes shape in a puff of smoke. You find yourself on the back of a little knobbly-limbed, white-faced goblin, who promptly collapses under your weight.||You are in a cavern lit by mouse-sized faerie folk, who flit about in the air blazing like fireflies. The other horses have also turned into goblins, elves and faeries of all shapes and sizes.||\"What have we here?\" whispers a pale, dark-eyed elfin woman, dressed in silvery cobwebs and wearing a platinum crown.||\"An overweight mortal sitting on poor old Gobrash, your majesty,\" groans the goblin you are sitting on.||You realize you are in great danger here. There's no telling what the faerie folk will do to you. The queen signals to her people and they close in around you ominously.">

<ROOM STORY017
	(DESC "017")
	(STORY TEXT017)
	(CHOICES CHOICES-SANCTITY)
	(DESTINATIONS <LTABLE <LTABLE STORY626 STORY268>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SANCTITY 9>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT018 "You spin them a tale about how your poor brother, a mercenary in Grieve Marlock's personal guard, lost his legs in the fight to overthrow the old king, and that you have spent all your money on looking after him.||Several of the militia are brought to tears by your eloquent speech. They end up having a whip-round among themselves for your brother, and they give you 15 Shards. Chuckling to yourself, you return to the city centre.">

<ROOM STORY018
	(DESC "018")
	(STORY TEXT018)
	(EVENTS STORY018-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY018-EVENTS ()
	<GAIN-MONEY 15>>

<CONSTANT TEXT019 "The Dragon Knights are impressed with your combat skills. Your opponent comes round, ruefully rubbing his neck. Grudgingly, he admits to your superior skill and hands you his weapon and armour. You get an ordinary sword and a suit of heavy plate (Defence +6).">

<ROOM STORY019
	(DESC "019")
	(VISITS 0)
	(STORY TEXT019)
	(EVENTS STORY019-EVENTS)
	(CONTINUE STORY276)
	(ITEMS <LTABLE SWORD HEAVY-PLATE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY019-EVENTS ()
	<COND (<CHECK-VISITS-MORE ,STORY019 2> <GAIN-CODEWORD ,CODEWORD-ANVIL>)>>

<CONSTANT TEXT020 "Wary of danger, you lose no time in getting to your feet, but it is only an old man gathering driftwood.||\"What have we here?\" he asks, edging closer. \"All wet and out of luck, you look. Washed-up, eh?\"||\"Where is this?\" Your eyes take in the empty shore, the cliffs, the forest of the hinterland. None of it is familiar to you.||\"You don't know?\" The old man gives you a keener look, and a more serious look comes into his eyes. \"Can it be? After all my waiting, the prophecy is fulfilled at last?\"||\"Prophecy? What are you talking about?\"||\"It was written in the stars that someone like you would come. A traveller from a far land. Great things are in store for you, my young friend.\"||The old man turns smartly about and begins walking up a path. Looking past him, you can just make out a monolithic stone structure atop the cliffs.||\"You still haven't told me where I am.\"||\"This is the Isle of the Druids.\" He gestures to the west. \"The great continent of Harkuna lies a few leagues that way. But if you want to explore it, you'd better come with me.\"||\"Come with you where?\"||He points. \"That ring of stones up there. It's called the Gates of the World.\"">
<CONSTANT CHOICES020 <LTABLE "Follow him" "Explore the Coast" "Head into the nearby forest">>

<ROOM STORY020
	(DESC "020")
	(STORY TEXT020)
	(CHOICES CHOICES020)
	(DESTINATIONS <LTABLE STORY192 STORY128 STORY257>)
	(TYPES THREE-CHOICES)
	(CODEWORDS <LTABLE CODEWORD-AURIC>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT021 "While making your way through the back streets of the poor quarter you are set upon by a knife-wielding thug who is intent on relieving you of your purse.">
<CONSTANT CHOICES021 <LTABLE "Reason with him" "Fight">>

<ROOM STORY021
	(DESC "021")
	(STORY TEXT021)
	(CHOICES CHOICES021)
	(DESTINATIONS <LTABLE STORY689 STORY690>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT022 "You reach down and deftly pull out the ceramic plug. A gush of foul-smelling emerald green liquid spills on to the floor, and the golem twitches once before collapsing. The other golem is coming to life, however. You'll have to be quick to get it in time.">

<ROOM STORY022
	(DESC "022")
	(STORY TEXT022)
	(CHOICES CHOICES-COMBAT)
	(DESTINATIONS <LTABLE <LTABLE STORY539 STORY647>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-COMBAT 9>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT023 "As you stride forward, they look up with expressions of luminous rage.||\"Get you back, mortal,\" warns one, \"or I'll touch you with my grave-cold hands and then it'll be your dying day.\"">
<CONSTANT CHOICES023 <LTABLE "Attack them" "Call on your god to banish them">>

<ROOM STORY023
	(DESC "023")
	(STORY TEXT023)
	(CHOICES CHOICES023)
	(DESTINATIONS <LTABLE STORY479 STORY520>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT024 "You will need to subdue the king and his henchmen with a spell.">

<ROOM STORY024
	(DESC "024")
	(STORY TEXT024)
	(CHOICES CHOICES-MAGIC)
	(DESTINATIONS <LTABLE <LTABLE STORY644 STORY208>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-MAGIC 12>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT025 "Captain Vorkung is impressed with your claims of loyalty to the rightful king. He decides you might be useful to their cause, and you are led, blindfolded, through a secret pass to a mountain stockade.||King Nergan gives you an audience in a makeshift throne room. He is a young, and handsome man, who seems committed to his country. He leads you aside, into a private chamber.||\"I have need of one such as you,\" he says. \"Yellowport groans under the yoke of Governor Marloes Marlock, the brother of General Grieve Marlock. If you can get into the palace at Yellowport and assassinate Marloes, I will be eternally grateful.\"">

<ROOM STORY025
	(DESC "025")
	(BACKGROUND NONE)
	(STORY TEXT025)
	(EVENTS STORY025-EVENTS)
	(CONTINUE STORY735)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY025-EVENTS ()
	<CODEWORD-JUMP ,CODEWORD-ARTERY ,STORY399>>

<CONSTANT TEXT026 "You set sail for Dweomer. The journey takes a few days but is uneventful. The captain can't believe his luck. \"I half-expected us to end up wrecked on rocks or seized by Uttakin slavers,\" he says with evident relief. You disembark at Dweomer harbour, on the Sorcerers' Isle.">

<ROOM STORY026
	(DESC "026")
	(STORY TEXT026)
	(CONTINUE STORY-BLOOD-DARK-SEA)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT027 "Either you are recklessly brave or very foolish to visit the palace where you assassinated the governor. Provost Marshal Royzer has established new security procedures, and it is impossible for you to see him.">

<ROOM STORY027
	(DESC "027")
	(STORY TEXT027)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT028 "You jump into the air and hit the ground rolling. You come up, bruised but alive, in time to see the horses ride straight into the rocky wall of a low hill. To your amazement, they pass straight through the rock and disappear. Silence falls across the land like a blanket. There is no sign of them, not even tracks. You camp for the night and the next day set off once more.">
<CONSTANT CHOICES028 <LTABLE "North across country" "East to the road" "To Trefoille" "To Marlock City" "West towards the River Grimm">>

<ROOM STORY028
	(DESC "028")
	(STORY TEXT028)
	(CHOICES CHOICES028)
	(DESTINATIONS <LTABLE STORY560 STORY558 STORY250 STORY100 STORY099>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT029 "Your ship is sailing in the coastal waters beside Yellowport. There are a number of other ships, mostly merchantmen, but there are also a few warships of the Sokaran Imperial Navy. \"At least we won't be plagued by pirates with the navy around,\" says the first mate.">
<CONSTANT STORY029-REQUIREMENTS <LTABLE <LTABLE 2 0 <LTABLE 4 9 12> <LTABLE TEXT-STORM TEXT-UNEVENTFUL "Sokaran war galley!">>>>

<ROOM STORY029
	(DESC "029")
	(STORY TEXT029)
	(CHOICES CHOICES-RANDOM)
	(DESTINATIONS <LTABLE <LTABLE STORY613 STORY439 STORY165>>)
	(REQUIREMENTS STORY029-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT030 "The market is large and busy. At the corners of Brimstone Plaza, gigantic braziers burn sweet-smelling incense in an attempt to overpower the rotten-egg smell that permeates the whole city. There are many stalls and goods to choose from.||One trader is offering a treasure map for sale at 200 Shards. He will also buy any old treasure map for 150 Shards.||To buy cargo for a ship, you need to visit the warehouses at the
harbourmaster.">
<CONSTANT CHOICES030 <LTABLE "buy armours/weapons/magical/equipment/other items" "sell armours/weapons/magical/equipment/other items" "buy treasure map" "go back to town">>

<ROOM STORY030
	(DESC "030")
	(LOCATION LOCATION-YELLOWPORT)
	(STORY TEXT030)
	(CHOICES CHOICES030)
	(DESTINATIONS <LTABLE YELLOWPORT-BUY YELLOWPORT-SELL STORY200 STORY010>)
	(REQUIREMENTS <LTABLE NONE NONE 200 NONE>)
	(TYPES <LTABLE R-NONE R-NONE R-MONEY R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT031 "A dark emptiness surrounds you. Then, as if in your sleep, you see a tiny glimmer of light off in the distance. Suddenly you wake up, coughing and spluttering, up to your neck in water. You look around. You are floundering in the holy waters of Blessed Springs.||Standing at the side of the pool is a tall, slim, mustachioed man who says, \"I am Aklar the Bold. I found you as bottled dust in the lair of Vayss the Sea Dragon. By sprinkling your ashes into the holy waters, I have brought you back to life. I think a reward is in order, don't you?\"||\"As you can see, I have literally nothing to give you.\"||Aklar frowns in annoyance. \"Blast, I knew I should have taken one of the other bottles. Well, you'll just have to owe me a favour. A big favour.\"||\"I can hardly refuse.\"||\"Well, I must be about my business. We shall meet again, count on it.\"||With that he leaves.||You stagger out of the pool.">

<ROOM STORY031
	(DESC "031")
	(STORY TEXT031)
	(CONTINUE STORY510)
	(CODEWORDS <LTABLE CODEWORD-AKLAR>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT032 "You head across the hot, dusty and sparsely vegetated land. Vultures circle overhead -- presumably they think you're going to die. You wander on, until you come to a ridge. Down below, in a shallow valley, is a great mound of earth. Scorpion men crawl in and out of the many burrows that riddle the earth.||The number of scorpion men in the valley makes your heart quail; the place is too deadly to enter.">

<ROOM STORY032
	(DESC "032")
	(LOCATION LOCATION-SCORPION)
	(STORY TEXT032)
	(EVENTS STORY032-EVENTS)
	(CONTINUE STORY492)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY032-EVENTS ()
	<CODEWORD-JUMP ,CODEWORD-ARTIFACT ,STORY406>>

<CONSTANT TEXT033 "Resurrection costs 200 Shards if you are an initiate, and 800 Shards if not. It is the last word in insurance. Once you have arranged for resurrection you need not fear death, as you will be magically restored to life here at the temple. To arrange resurrection, pay the fee.||You can have only one resurrection arranged at any one time. If you arrange another resurrection later at a different temple, the original one is cancelled. You do not get a refund.">

<ROOM STORY033
	(DESC "033")
	(STORY TEXT033)
	(EVENTS STORY033-EVENTS)
	(CONTINUE STORY282)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY033-EVENTS ("AUX" (FEE 800))
	<COND (<CHECK-GOD ,GOD-TYRNAI> <SET FEE 200>)>
	<COND (<EQUAL? ,RESURRECTION-ARRANGEMENTS ,RESURRECTION-TYRNAI>
		<EMPHASIZE "You already made resurrection arrangements at this temple!">
	)(<G=? ,MONEY .FEE>
		<CRLF>
		<TELL "Arrange resurrection at this temple?">
		<COND (<YES?>
			<COST-MONEY .FEE ,TEXT-PAID>
			<SETG RESURRECTION-ARRANGEMENTS ,RESURRECTION-TYRNAI>
		)>
	)(ELSE
		<EMPHASIZE "You cannot afford a resurrection arrangement at this time.">
	)>>

<CONSTANT TEXT034 "You make it only fifty feet up the sheer rock face before you lose your
footing and fall to the ground.">
<CONSTANT TEXT034-CONTINUED "You try again.">

<ROOM STORY034
	(DESC "034")
	(STORY TEXT034)
	(EVENTS STORY034-EVENTS)
	(CONTINUE STORY658)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY034-EVENTS ()
	<LOSE-STAMINA 4 ,DIED-FROM-INJURIES ,STORY034>
	<IF-ALIVE ,TEXT034-CONTINUED>>

<CONSTANT TEXT035 "You come to the top of a windswept cliff. An ancient pillar of jumbled rock, pitted and weather-beaten, stands at the cliff's edge, like a broken finger pointing at the sky. Seagulls sing their song of desolation in the air.||Judging by the runes etched into the rock, the tor dates back to the time of the Shadar, a race that ruled Harkuna so long ago, they are lost in myth and legend.">
<CONSTANT CHOICES035 <LTABLE "Examine the runes" TEXT-TO-BEACH TEXT-TO-TREFOILLE TEXT-TO-MARLOCK>>

<ROOM STORY035
	(DESC "035")
	(LOCATION LOCATION-SHADAR)
	(STORY TEXT035)
	(CHOICES CHOICES035)
	(DESTINATIONS <LTABLE STORY515 STORY097 STORY602 STORY166>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT036 "Soon you realize you are completely lost in this strange, magical forest. You wander around for days, barely able to find enough food and water.">
<CONSTANT TEXT036-CONTINUED "You eventually stagger out of the forest to the coast.">

<ROOM STORY036
	(DESC "036")
	(STORY TEXT036)
	(EVENTS STORY036-EVENTS)
	(CONTINUE STORY128)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY036-EVENTS ()
	<LOSE-STAMINA 4 ,DIED-OF-HUNGER ,STORY036>>

<CONSTANT TEXT037 "Your men have been fishing with a net. This time, however, they have caught a large shark. Afterwards, when it has been cut open, you find the remains of some poor sailor. Inside his leather pouch, you find a bag of pearls, which you can take if you wish.">

<ROOM STORY037
	(DESC "037")
	(STORY TEXT037)
	(EVENTS STORY037-EVENTS)
	(CONTINUE STORY507)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY037-EVENTS ()
	<KEEP-ITEM ,BAG-OF-PEARLS>>

<ROOM STORY038
	(DESC "038")
	(STORY TEXT-STORM-SEA)
	(EVENTS STORY038-EVENTS)
	(CHOICES CHOICES-STORM-FURY)
	(DESTINATIONS <LTABLE <LTABLE STORY325 STORY397 STORY209>>)
	(REQUIREMENTS STORY-STORM-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY038-EVENTS ()
	<STORM-AT-SEA ,STORY038 ,STORY209>>

<CONSTANT TEXT039 "You and some of your crew clamber aboard the wreck. You find some dead sailors amid the wreckage. Their bodies are curiously bloated.">

<ROOM STORY039
	(DESC "039")
	(STORY TEXT039)
	(CHOICES CHOICES-SCOUTING)
	(DESTINATIONS <LTABLE <LTABLE STORY194 STORY465>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 9>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT040 "You take the Book of the Seven Sages to Pyletes the Sage at the Gold Dust tavern. He thanks you effusively for bringing it to him. Your reward is secret learning from the temple of Molhern, god of knowledge.">

<ROOM STORY040
	(DESC "040")
	(STORY TEXT040)
	(EVENTS STORY040-EVENTS)
	(CONTINUE STORY010)
	(TITLES <LTABLE TITLE-ILLUMINATE-MOLHERN>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY040-EVENTS ()
	<UPGRADE-ABILITIES 1>
	<DELETE-CODEWORD ,CODEWORD-ARTIFACT>
	<RETURN-ITEM ,BOOK-SEVEN-SAGES T>
	<COMPLETE-MISSION ,MISSION-BOOK-SAGES>>

<CONSTANT TEXT041 "The inside of the dome is lit with an eerie yellowish glow that comes from the sea-moss that carpets the ceiling. At the far end, a grotto in the wall contains an idol made from sea shells and coral, presumably of Oannes, the god of the repulsive ones. At its feet lies the golden net of Alvir and Valmir, the object of your quest. Between you and the idol swim several of the giant squid-creatures, carrying out various undersea chores.">
<CONSTANT CHOICES041 <LTABLE "Swim back to Shadar Tor" "Fight your way to the golden net" "Trust to your magical prowess" "Rack your memory for a solution">>

<ROOM STORY041
	(DESC "041")
	(STORY TEXT041)
	(CHOICES CHOICES041)
	(DESTINATIONS <LTABLE STORY035 STORY121 STORY592 STORY487>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT042 "Two hulking shapes appear out of the shadows as if from nowhere. They are hideous creatures: manlike, standing on two legs, but with the tail and hairy features of a gigantic rat. Their yellowing teeth snap at you as they lunge for you; the ratmen also wield wicked-looking shortswords in their hands. \"Gut the human!\" yells one of them in a bestial voice. You must fight them, both at once, as if they were one opponent.">

<ROOM STORY042
	(DESC "042")
	(STORY TEXT042)
	(EVENTS STORY042-EVENTS)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY042-EVENTS ("AUX" (MODIFIER 0))
	<COND (<CHECK-ITEM ,RAT-POISON>
		<CRLF>
		<TELL "Use the rat poison?">
		<COND (<YES?>
			<SET MODIFIER 3>
			<EMPHASIZE "The rat poison adds +3 to your COMBAT rolls.">
			<REMOVE-ITEM ,RAT-POISON "used" T T>
		)>
	)>
	<COMBAT-MONSTER ,MONSTER-TWO-RATMEN 6 9 9>
	<COND (<CHECK-COMBAT ,MONSTER-TWO-RATMEN ,STORY042 .MODIFIER>
		<STORY-JUMP ,STORY423>
	)(ELSE
		<STORY-JUMP ,STORY308>
	)>>

<CONSTANT TEXT043 "You must fight the Tomb Guardian. Luckily, your magic weapon will be effective.">

<ROOM STORY043
	(DESC "043")
	(STORY TEXT043)
	(EVENTS STORY043-EVENTS)
	(CONTINUE STORY490)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY043-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-TOMB-GUARDIAN 6 8 12>
	<CHECK-COMBAT ,MONSTER-TOMB-GUARDIAN ,STORY043>>

<CONSTANT TEXT044 "You decide that discretion would be the better part of valour in this case, and step aside. The officers laugh contemptuously, and swagger past. Nothing else happens tonight.">

<ROOM STORY044
	(DESC "044")
	(STORY TEXT044)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT045 "The little girl runs off before you can talk to her. You thread your way through the pitted tombstones and brooding crypts of the cemetery, under a pale moon that bathes the graveyard in a sickly, pallid light. Suddenly, a foul stench fills your nostrils, and a figure rises up out of the shadows. Yellow eyes glow with feral blood-lust, and the creature sinks its black teeth into your arm before you can react.">
<CONSTANT TEXT045-CONTINUED "The ghoul, a rotting, walking corpse, lunges for you again">
<CONSTANT CHOICES045 <LTABLE "Fight it" "Invoke the power of the gods" "If you have any">>

<ROOM STORY045
	(DESC "045")
	(STORY TEXT045)
	(EVENTS STORY045-EVENTS)
	(CHOICES CHOICES045)
	(DESTINATIONS <LTABLE STORY617 STORY155 STORY303>)
	(REQUIREMENTS <LTABLE NONE NONE SALT-IRON-FILINGS>)
	(TYPES <LTABLE R-NONE R-NONE R-ITEM>)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY045-EVENTS ()
	<COND (,RUN-ONCE <LOSE-STAMINA 4 ,DIED-GREW-WEAKER ,STORY045>)>
	<COND (<IS-ALIVE>
		<AFFLICTED-WITH ,DISEASE-GHOULBITE>
		<CRLF>
		<TELL ,TEXT045-CONTINUED>
		<TELL ,PERIOD-CR>
	)>>

<ROOM STORY046
	(DESC "046")
	(STORY TEXT-GUILD-INVESTMENTS)
	(EVENTS STORY046-EVENTS)
	(CONTINUE STORY405)
	(INVESTMENTS 0)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY046-EVENTS ()
	<GUILD-ACTIVITY ,STORY046>>

<CONSTANT TEXT047 "The Forest of Larun is a mighty swathe of densely packed trees, a slice of primordial nature in the middle of busy, industrious Sokara.">
<CONSTANT CHOICES047 <LTABLE "Venture deeper into the forest" "Venture deeper into the forest" "North to the Bronze Hills" "West to the River Grimm" "South into the countryside" "East to the road">>

<ROOM STORY047
	(DESC "047")
	(LOCATION LOCATION-LARUN)
	(STORY TEXT047)
	(CHOICES CHOICES047)
	(DESTINATIONS <LTABLE STORY596 STORY110 STORY333 STORY560 STORY387>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT048 "The warden is in charge of security. \"We have had an unfortunate, umm... accident,\" he says worriedly. \"In the crypt below the temple we sometimes experiment with the corpses of the dead -- you know, the occasional zombie, part of the rituals in honour of the particular aspect of Nagil we revere here. It seems a ghoul has escaped from the pits and is terrorizing the city at night. We'd rather someone like you sorted the problem out before the city militia got to hear of it. Destroy it and bring me the ghoul's head.\"||\"Search for it at night,\" says the warden as you leave.">
<CONSTANT CHOICES048 <LTABLE "Take up the mission" IF-NOT>>

<ROOM STORY048
	(DESC "048")
	(STORY TEXT048)
	(CHOICES CHOICES048)
	(DESTINATIONS <LTABLE STORY100 STORY100>)
	(REQUIREMENTS <LTABLE MISSION-GHOUL-HEAD NONE>)
	(TYPES <LTABLE R-TAKE-MISSION R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT049 "Not taking any chances, you charge the soldier, yelling a war cry. He starts back in astonishment. Just then, several archers pop up from behind the rocks above, and let loose a volley of arrows. One takes you in the leg.">
<CONSTANT TEXT049-CONTINUED "You fall to one knee, and the soldier melts away into the rocks. Alone, and wounded in the thigh, you cannot climb upwards. You have to go back down though the descent will be difficult with an injured leg">
<CONSTANT CHOICES049 <LTABLE "Continue descent">>
<CONSTANT STORY049-REQUIREMENTS <LTABLE <LTABLE 1 0 <LTABLE 3 6> <LTABLE "You lose footing and fell!" "You finally managed to descend!">>>>

<ROOM STORY049
	(DESC "049")
	(STORY TEXT049)
	(EVENTS STORY049-EVENTS)
	(CHOICES CHOICES049)
	(DESTINATIONS <LTABLE <LTABLE STORY529 STORY474>>)
	(REQUIREMENTS STORY049-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY049-EVENTS ("AUX" ODDS PARAMETERS)
	<COND (,RUN-ONCE
		<LOSE-STAMINA 3 ,DIED-FROM-INJURIES ,STORY049>
		<COND (<IS-ALIVE>
			<RESET-ODDS 1 0,STORY049>
			<CRLF>
			<TELL ,TEXT049-CONTINUED>
			<TELL ,PERIOD-CR>
			<COND (<CHECK-ITEM ,CLIMBING-GEAR>
				<SET ODDS <GETP ,STORY049 ,P?REQUIREMENTS>>
				<SET PARAMETERS <GET .ODDS 1>>
				<PUT .PARAMETERS 2 1>
			)>
		)>
	)>>

<CONSTANT TEXT050 "The new provost marshal of Yellowport is Royzer. He used to be Marloes Marlock's second in command. Since the assassination of the old provost, Royzer has ruled the city with an iron hand: patrols are frequent and spies are everywhere. You will have to be careful not to get yourself recognized.">

<ROOM STORY050
	(DESC "050")
	(STORY TEXT050)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT051 "The war galley pulls alongside, and grappling hooks fly through the air, fastening your ships together. The captain leaps across and his men swarm on to your ship. A battle ensues.">
<CONSTANT CHOICES051 <LTABLE "Do Battle">>
<CONSTANT STORY051-REQUIREMENTS <LTABLE <LTABLE 2 0 <LTABLE 4 9 13 100> <LTABLE "Calamity!" "Crushing Defeat!" "Draw!" "Outright victory!">>>>

<ROOM STORY051
	(DESC "051")
	(STORY TEXT051)
	(EVENTS STORY051-EVENTS)
	(CHOICES CHOICES051)
	(DESTINATIONS <LTABLE <LTABLE STORY-KILLED STORY051-CRUSHING-DEFEAT STORY242 STORY062>>)
	(REQUIREMENTS STORY051-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY051-EVENTS ("AUX" (MODIFIER 0) PROFESSION ODDS PARAMETERS CONDITION)
	<RESET-ODDS 2 0 ,STORY051>
	<SET MODIFIER <GET-RANK ,CURRENT-CHARACTER>>
	<SET PROFESSION <GETP ,CURRENT-CHARACTER ,P?PROFESSION>>
	<SET ODDS <GETP ,STORY051 ,P?REQUIREMENTS>>
	<SET PARAMETERS <GET .ODDS 1>>
	<COND (<CHECK-PROFESSION ,PROFESSION-WARRIOR>
		<PUT .PARAMETERS 1 3>
	)(ELSE
		<PUT .PARAMETERS 1 2>
	)>
	<COND (,CURRENT-SHIP
		<SET CONDITION <GETP ,CURRENT-SHIP ,P?CONDITION>>
		<COND (.CONDITION
			<COND (<EQUAL? .CONDITION ,CONDITION-GOOD>
				<SET MODIFIER <+ .MODIFIER 2>>
			)(<EQUAL? .CONDITION ,CONDITION-EXCELLENT>
				<SET MODIFIER <+ .MODIFIER 3>>
			)(ELSE
				<SET MODIFIER <- .MODIFIER 2>>
			)>
		)(ELSE
			<SET MODIFIER <- .MODIFIER 2>>
		)>
	)(ELSE
		<SET MODIFIER <- .MODIFIER 2>>
	)>
	<PUT .PARAMETERS 2 .MODIFIER>>

<ROOM STORY051-CRUSHING-DEFEAT
	(DESC "051")
	(EVENTS STORY051-DEFEAT)
	(CONTINUE STORY153)
	(DOOM T)>

<ROUTINE STORY051-DEFEAT ()
	<LOSE-STAMINA <ROLL-DICE 1> ,DIED-IN-COMBAT ,STORY051-CRUSHING-DEFEAT>>

<ROOM STORY052
	(DESC "052")
	(STORY TEXT-BLESSING-LACUNA)
	(EVENTS STORY052-EVENTS)
	(CONTINUE STORY544)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY052-EVENTS ()
	<PURCHASE-BLESSING 25 10 ,GOD-LACUNA ,BLESSING-SCOUTING>>

<CONSTANT TEXT053 "The creature bursts open in death, spilling a black inky cloud into the water. The sac in which this ink is kept falls free from its body. You can take the ink sac if you wish. You also find coral jewellery worth about 15 Shards.||Nothing else occurs during your foray into the depths, so you return to land. You climb back up the path that leads to the clifftop tor without incident.">
<CONSTANT CHOICES053 <LTABLE TEXT-TO-TREFOILLE TEXT-TO-MARLOCK>>

<ROOM STORY053
	(DESC "053")
	(STORY TEXT053)
	(EVENTS STORY053-EVENTS)
	(CHOICES CHOICES053)
	(DESTINATIONS <LTABLE STORY602 STORY166>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY053-EVENTS ()
	<GAIN-MONEY 15>
	<KEEP-ITEM ,INK-SAC>>

<CONSTANT TEXT054 "You drive back the storm demons long enough for you to work free one of the stakes that is holding Sul Veneris down.">

<ROOM STORY054
	(DESC "054")
	(STORY TEXT054)
	(CONTINUE STORY365)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT055 "You remember that this is a trap set up by the cannibal cultists of Badogor. While one pretends to be hurt, two others skulk in the shadows, waiting to ambush the curious. Forewarned you are able to take them by surprise. You cut one down in seconds and the figure who was lying on the ground runs off with a shriek of terror. The remaining cultist, however, turns to fight you.">

<ROOM STORY055
	(DESC "055")
	(STORY TEXT055)
	(EVENTS STORY055-EVENTS)
	(CONTINUE STORY010)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY055-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-CULTIST 3 5 7>
	<CHECK-COMBAT ,MONSTER-CULTIST ,STORY055 0 ,BAG-OF-PEARLS>>

<CONSTANT TEXT056 "A strange-looking craft is bobbing in the water. It is shaped like a cone, floating on its base, and as you draw nearer, you realize it is made entirely of metal. Its sail, a huge piece of cloth, seems to have collapsed and is spread out around it, on the surface of the sea. Great blue and white letters, in some foreign script, are painted on its side. You notice an opening on one side.">
<CONSTANT CHOICES056 <LTABLE "Enter the strange craft" "Leave it and sail on">>

<ROOM STORY056
	(DESC "056")
	(STORY TEXT056)
	(CHOICES CHOICES056)
	(DESTINATIONS <LTABLE STORY496 STORY085>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT057 "You manage to lose them amid the back streets of Yellowport. Once the heat
is off, you return to the city centre.">

<ROOM STORY057
	(DESC "057")
	(STORY TEXT057)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT058 "He doesn't notice you hiding in the shadowy doorway of a nearby derelict house. As he passes, you step out and attack, taking him completely by surprise. He goes down with your first blow. Searching him, you find 25 Shards. Then you flip up his eyepatch. Nestling in the eye socket is a sparkling gem, a flame opal. You pluck it free. Quickly, you haul the body into the shadows and head for the city centre.">

<ROOM STORY058
	(DESC "058")
	(STORY TEXT058)
	(EVENTS STORY058-EVENTS)
	(CONTINUE STORY400)
	(ITEMS FLAME-OPAL-EYE)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY058-EVENTS ()
	<GAIN-MONEY 25>
	<DELETE-CODEWORD ,CODEWORD-BARNACLE>>

<CONSTANT TEXT059 "Your deft fingers find a false spine of carved wood among the titles in the bookcase. Pressing it, you hear a click and the bookcase swings out from the wall. Beyond lies a hidden room where you find a verdigris key.">
<CONSTANT CHOICES059 <LTABLE "Leave at once" "Go upstairs to find Lauria" "Wait for her to return">>

<ROOM STORY059
	(DESC "059")
	(STORY TEXT059)
	(CHOICES CHOICES059)
	(DESTINATIONS <LTABLE STORY010 STORY386 STORY584>)
	(TYPES THREE-CHOICES)
	(ITEMS <LTABLE VERDIGRIS-KEY>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT060 "You are crossing the wild country of north-east Sokara.">
<CONSTANT TEXT060-TRAP "You are caught in an animal trap!">
<CONSTANT TEXT060-ATTACK "You are attacked by a wolf, and must fight.">
<CONSTANT CHOICES060 <LTABLE "North" "South" "West">>

<ROOM STORY060
	(DESC "060")
	(LOCATION LOCATION-SOKARA)
	(STORY TEXT060)
	(EVENTS STORY060-EVENTS)
	(CHOICES CHOICES060)
	(DESTINATIONS <LTABLE STORY518 STORY458 STORY201>)
	(TYPES THREE-CHOICES)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY060-EVENTS ("AUX" ROLL)
	<COND (,RUN-ONCE
		<SET ROLL <RANDOM-EVENT 1>>
		<COND (<L=? .ROLL 2>
			<EMPHASIZE ,TEXT060-TRAP>
			<LOSE-STAMINA 2 ,DIED-FROM-INJURIES ,STORY060>
		)(<L=? .ROLL 4>
			<EMPHASIZE ,NOTHING-HAPPENS>
			<PREVENT-DOOM ,STORY060>
		)(ELSE
			<EMPHASIZE ,TEXT060-ATTACK>
			<COMBAT-MONSTER ,MONSTER-WOLF 3 5 7>
			<CHECK-COMBAT ,MONSTER-WOLF ,STORY060 0 ,WOLF-PELT>
		)>
	)>
	<IF-ALIVE ,TEXT-YOU-CAN-GO>>

<CONSTANT TEXT061 "\"Wait!\" you cry, \"I have seen the light. I wish to join your cult.\" \"What?\" yells the chef. Then his shoulders sag with obvious disappointment. \"We cannot refuse a new member. And we cannot eat our own people.\"||A short ceremony later -- fortunately, the initiation does not involve any cannibalistic rites -- and you are a full member of the Cult of Badogor. You lose 1 point of SANCTITY for joining such a vile cult.|| You take your leave and they wish you well, all smiles and friendship.||\"Remember, never say his name. And don't forget to bring us new recruits,\" says the leader.||\"And bring some people for dinner!\" adds the chef.||Hastily you head for the city centre.">

<ROOM STORY061
	(DESC "061")
	(STORY TEXT061)
	(CONTINUE STORY010)
	(TITLES <LTABLE TITLE-UNSPEAKABLE-CULTIST>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT062 "The Sokarans surrender. Their captain has been killed in the battle and his marines have had the fight knocked out of them. The war galley isn't carrying any cargo, but you find an officer's pass on the body of the captain, and a chest in his cabin, which contains 150 Shards. You have to hand out 50 Shards to your crew, but you keep the other 100 Shards.||You leave the galley to limp back to Yellowport while you sail on.">

<ROOM STORY062
	(DESC "062")
	(STORY TEXT062)
	(EVENTS STORY062-EVENTS)
	(CONTINUE STORY439)
	(ITEMS <LTABLE OFFICERS-PASS>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY062-EVENTS ()
	<GAIN-MONEY 100>>

<ROOM STORY063
	(DESC "063")
	(BACKGROUND STORY063-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY063-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-ATTAR> <RETURN ,STORY578>)>
	<RETURN ,STORY734>>

<CONSTANT TEXT064 "Your amateurish tinkering sets the trap off, and the chest explodes. You take the full force of the blast.">
<CONSTANT TEXT064-CONTINUED "You also find that the contents of the chest have been vaporized, except for a sturdy metal scroll case containing a piece of ancient religious text about the gods of Uttaku.||The scroll relates that one of the gods of the Uttakin is called Ebron and that he has fourteen angles. Which seems strange, but you study the text carefully and it definitely says angles, not angels">

<ROOM STORY064
	(DESC "064")
	(STORY TEXT064)
	(EVENTS STORY064-EVENTS)
	(CONTINUE STORY010)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY064-EVENTS ()
	<LOSE-STAMINA 5 ,DIED-FROM-INJURIES ,STORY064>
	<COND (<IS-ALIVE>
		<CRLF>
		<TELL ,TEXT064-CONTINUED>
		<TELL ,PERIOD-CR>
		<KEEP-ITEM ,SCROLL-OF-EBRON>
	)>>

<CONSTANT TEXT065 "There are three stone gates engraved with ancient runes. Each gate is marked with a name: Yellowport, Marlock City and Wishport. From here, you can see the coast and the whole of the island, which is heavily forested.">
<CONSTANT CHOICES065 <LTABLE "Explore the coastline" "Head into the forest" "Step through the Yellowport arch" "Step through the Marlock City arch" "Step through the Wishport arch">>

<ROOM STORY065
	(DESC "065")
	(STORY TEXT065)
	(CHOICES CHOICES065)
	(DESTINATIONS <LTABLE STORY128 STORY257 STORY008 STORY180 STORY330>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT066 "You stand your ground. The ghostly horses stream past you on either side, neighing wildly at the sky. Nimbly, you leap at one, and manage to wrap your arms around its neck, and swing on to its back. The horse feels quite solid, but appears to be a luminous, pale-green colour. You look up through a cloud of sparks emanating from the horse's mane just in time to see a rocky wall of a low hill looming up out of the evening mist. Your horse is galloping full tilt right into it!">
<CONSTANT CHOICES066 <LTABLE "Hold on" "Leap off">>

<ROOM STORY066
	(DESC "066")
	(STORY TEXT066)
	(CHOICES CHOICES066)
	(DESTINATIONS <LTABLE STORY017 STORY028>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM STORY067
	(DESC "067")
	(STORY TEXT-STORM-SUBSIDES)
	(EVENTS STORY-LOSE-CARGO)
	(CONTINUE STORY090)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT068 "To renounce the worship of Alvir and Valmir, you must pay 30 Shards in compensation to the priesthood.||The priest simply points to a ship limping into harbour -- its shattered masts, torn sails and battered hull mute testimony to its storm-tossed voyage.||\"The captain did not revere the Twin Gods,\" whispers the coral-jewelled priest darkly.">

<ROOM STORY068
	(DESC "068")
	(STORY TEXT068)
	(EVENTS STORY068-EVENTS)
	(CONTINUE STORY154)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY068-EVENTS ()
	<RENOUNCE-WORSHIP 30 ,GOD-ALVIR-VALMIR>>

<CONSTANT TEXT069 "To renounce the worship of Tyrnai, you must pay 50 Shards to the warrior priests, and suffer the Ceremony of the Wrathful Blow. A priest will strike you once, on the doctrinal grounds that it is better to be struck by a priest than by Tyrnai himself.">

<ROOM STORY069
	(DESC "069")
	(STORY TEXT069)
	(EVENTS STORY069-EVENTS)
	(CONTINUE STORY526)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY069-EVENTS ()
	<RENOUNCE-TYRNAI ,STORY069>>

<ROOM STORY070
	(DESC "070")
	(STORY TEXT-STORM-SUBSIDES)
	(EVENTS STORY-LOSE-CARGO)
	(CONTINUE STORY090)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT071 "Nagil is the Lord of the Lands of the Dead, and his temple in Marlock City is covered in friezes and gargoyles of ornate design, depicting the souls of the dead on their journey to the underworld.Inside, it is cool and dark, hung with black velvet drapes.||A poster on the wall reads: \"Wanted: person of unusual resourcefulness. See temple warden.\"">
<CONSTANT CHOICES071 <LTABLE TEXT-BECOME-INITIATE TEXT-RENOUNCE-WORSHIP TEXT-RESURRECTION-ARRANGEMENTS "Visit the warden" TEXT-LEAVE-TEMPLE>>

<ROOM STORY071
	(DESC "071")
	(BACKGROUND STORY071-BACKGROUND)
	(STORY TEXT071)
	(CHOICES CHOICES071)
	(DESTINATIONS <LTABLE STORY409 STORY187 STORY478 STORY048 STORY100>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY071-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-AGUE> <RETURN ,STORY517>)>
	<RETURN ,STORY071>>

<CONSTANT TEXT072 "You manage to shrug off the effects of the gas.">
<CONSTANT CHOICES072 <LTABLE "Attack the beast" "Run off">>

<ROOM STORY072
	(DESC "072")
	(STORY TEXT072)
	(CHOICES CHOICES072)
	(DESTINATIONS <LTABLE STORY371 STORY527>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM STORY073
	(DESC "073")
	(STORY TEXT-BLESSING-ELNIR)
	(EVENTS STORY073-EVENTS)
	(CONTINUE STORY568)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY073-EVENTS ()
	<PURCHASE-BLESSING 25 10 ,GOD-ELNIR ,BLESSING-CHARISMA>>

<CONSTANT TEXT074 "A fisherman will take you all the way to Yellowport for 15 Shards. Amazingly, despite the apparent fragility of the small vessel, you arrive without incident.">

<ROOM STORY074
	(DESC "074")
	(STORY TEXT074)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT075 "The high priest takes you to a private chamber. \"You may be just what the temple needs,\" he says, \"a good, old-fashioned thief. There is a suit of armour made entirely from gold -- ceremonial only, of course. Nevertheless, we would like to, er, have it donated to us.\"||\"I see,\" you reply, \"and where is the armour?\"||\"Well, that's the tricky part -- it's in the Temple of Tyrnai, in Caran Baru. In fact, it's worn by the idol of Tyrnai himself in the temple. Can you bring us the gold chain mail of Tyrnai? In return, we will instruct you in the roguish arts.\"">
<CONSTANT CHOICES075 <LTABLE "Take up the mission for the Temple of Sig" IF-NOT>>

<ROOM STORY075
	(DESC "075")
	(STORY TEXT075)
	(CHOICES CHOICES075)
	(DESTINATIONS <LTABLE STORY235 STORY235>)
	(REQUIREMENTS <LTABLE CODEWORD-ARMOUR NONE>)
	(TYPES <LTABLE R-GAIN-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT076 "You are an accomplished street brawler, and after only a few minutes' furious fighting, the three officers are laid out unconscious in the street. Several people gathered to watch the brawl. Most of them give a cheer at your performance. General Marlock's troops have not endeared themselves to the populace.||You find about 25 Shards on them along with an officer's pass">

<ROOM STORY076
	(DESC "076")
	(STORY TEXT076)
	(EVENTS STORY076-EVENTS)
	(CONTINUE STORY100)
	(ITEMS <LTABLE OFFICERS-PASS>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY076-EVENTS ()
	<GAIN-MONEY 25>>

<CONSTANT TEXT077 "\"It is fortunate that we have a Chosen One of Maka at this temple,\" says the high priestess. \"Only the Chosen Ones have the goddess-given powers to cure the afflicted.\"||It costs 75 Shards (only 30 if you are an initiate of Maka) to be cured of a poison or a disease.">

<ROOM STORY077
	(DESC "077")
	(STORY TEXT077)
	(EVENTS STORY077-EVENTS)
	(CONTINUE STORY141)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY077-EVENTS ()
	<GOD-CURE 75 30 ,GOD-MAKA ,POISONBIT ,DISEASEBIT>>

<ROOM STORY078
	(DESC "078")
	(CHOICES CHOICES-SCOUTING)
	(DESTINATIONS <LTABLE <LTABLE STORY524 STORY415>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT079 "You try to lose them in the tunnels. It is hard because they know the layout better than you do.">

<ROOM STORY079
	(DESC "079")
	(STORY TEXT079)
	(CHOICES CHOICES-SCOUTING)
	(DESTINATIONS <LTABLE <LTABLE STORY224 STORY381>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 14>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT080 "You grab the woman's wrist a split-second before she can cut the strings of your money pouch. You drag her around to face you, but she meets your outraged scowl with a swashbuckling grin.||\"You've got good reflexes,\" she says. \"Most of the street scum around here are too drink-sodden or dimwitted to notice the loss of a few Shards. Want to earn some real money?\"">
<CONSTANT CHOICES080 <LTABLE "Accept her offer" "Refuse and leave">>

<ROOM STORY080
	(DESC "080")
	(STORY TEXT080)
	(CHOICES CHOICES080)
	(DESTINATIONS <LTABLE STORY425 STORY010>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT081 "This could be a tough fight.">

<ROOM STORY081
	(DESC "081")
	(STORY TEXT081)
	(EVENTS STORY081-EVENTS)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY081-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-GOLEM 5 10 10>
	<CHECK-COMBAT ,MONSTER-GOLEM ,STORY081>>

<CONSTANT TEXT082 "You are following the course of the Stinking River -- and it certainly does
stink, laden with sulphur as it is.">
<CONSTANT TEXT082-STUNG "You are stung by a large golden insect.">
<CONSTANT CHOICES082 <LTABLE "Follow the river north" "Follow the river south to Yellowport" "Go west to the road" "Go east into the countryside">>

<ROOM STORY082
	(DESC "082")
	(STORY TEXT082)
	(EVENTS STORY082-EVENTS)
	(CHOICES CHOICES082)
	(DESTINATIONS <LTABLE STORY310 STORY010 STORY558 STORY278>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY082-EVENTS ("AUX" ROLL)
	<SET ROLL <RANDOM-EVENT 1>>
	<COND (<L=? .ROLL 2>
		<EMPHASIZE ,TEXT082-STUNG>
		<POISONED-WITH ,POISON-COMBAT>
	)(<L=? .ROLL 4>
		<EMPHASIZE ,NOTHING-HAPPENS>
	)(ELSE
		<EMPHASIZE ,TEXT-SMOLDER-FISH>
		<TAKE-ITEM ,SMOLDER-FISH>
	)>>

<ROOM STORY083
	(DESC "083")
	(STORY TEXT-STORM-SUBSIDES)
	(EVENTS STORY-LOSE-CARGO)
	(CONTINUE STORY090)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT084 "Your ship awaits you in the harbour. The crew are in good spirits, as ever when a new voyage is about to begin.">
<CONSTANT CHOICES084 <LTABLE "Go ashore" "Set sail">>

<ROOM STORY084
	(DESC "084")
	(STORY TEXT084)
	(EVENTS STORY-RESET-CREW)
	(CHOICES CHOICES084)
	(DESTINATIONS <LTABLE STORY142 STORY222>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT085 "You are sailing around Scorpion Bight.">
<CONSTANT CHOICES085 <LTABLE "Sail north along the coast" "Sail west towards Yellowport" "Sail east into the Sea of Whispers" "Sail south into the Violet Ocean" "Go ashore at Scorpion Bight">>

<ROOM STORY085
	(DESC "085")
	(STORY TEXT085)
	(CHOICES CHOICES085)
	(DESTINATIONS <LTABLE STORY190 STORY029 STORY136 STORY416 STORY176>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT086 "The temple of the Three Fortunes is a squat, square building. A frieze above the door depicts three women weaving a tapestry. \"That's the Tapestry of Fate, wherein our destiny is woven,\" comments a priest.">

<ROOM STORY086
	(DESC "086")
	(STORY TEXT086)
	(CHOICES CHOICES-STANDARD-TEMPLE)
	(DESTINATIONS <LTABLE STORY258 STORY573 STORY603 STORY400>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT087 "You are on the road between Blessed Springs and Venefax. Pilgrims, the sick and the injured travel this route to the holy waters of Blessed Springs to find salvation.">
<CONSTANT TEXT087-ATTACK "You are attacked by a mad pilgrim. You must fight.">
<CONSTANT TEXT087-BLESSED "Blessed by a priest.">
<CONSTANT CHOICES087 <LTABLE "Go to Blessed Springs" "Go to Venefax" "Go north into the countryside">>

<ROOM STORY087
	(DESC "087")
	(LOCATION LOCATION-SOKARA)
	(STORY TEXT087)
	(EVENTS STORY087-EVENTS)
	(CHOICES CHOICES087)
	(DESTINATIONS <LTABLE STORY510 STORY427 STORY548>)
	(TYPES THREE-CHOICES)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY087-EVENTS ("AUX" ROLL)
	<COND (,RUN-ONCE
		<SET ROLL <RANDOM-EVENT 1>>
		<COND (<L=? .ROLL 2>
			<COMBAT-MONSTER ,MONSTER-MAD-PILGRIM 3 5 6>
			<CHECK-COMBAT ,MONSTER-MAD-PILGRIM ,STORY087 0 ,STAFF>
		)(<L=? .ROLL 4>
			<EMPHASIZE ,NOTHING-HAPPENS>
			<PREVENT-DOOM ,STORY087>
		)(ELSE
			<EMPHASIZE ,TEXT087-BLESSED>
			<GAIN-BLESSING ,BLESSING-SAFETY-FROM-STORMS>
			<PREVENT-DOOM ,STORY087>
		)>
	)>
	<IF-ALIVE ,TEXT-YOU-CAN-GO>>

<CONSTANT TEXT088 "You find out how well your investments have done:">

<ROOM STORY088
	(DESC "088")
	(BACKGROUND STORY088-BACKGROUND)
	(STORY TEXT088)
	(EVENTS STORY088-EVENTS)
	(CONTINUE STORY104)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY088-BACKGROUND ("AUX" INVESTMENTS)
	<SET INVESTMENTS <GETP ,STORY104 ,P?INVESTMENTS>>
	<COND (.INVESTMENTS <RETURN ,STORY088>)>
	<RETURN ,STORY104>>

<ROUTINE STORY088-EVENTS ()
	<CHECK-INVESTMENTS ,STORY104>>

<CONSTANT TEXT089 "The undead pirate reaches for you, but it is too slow. Then it speaks, its voice seeming to sound inside your head.||\"Damn you, and your kind, thieving sea centaur. I curse you forever. May you never swim again in the seas you love. You will walk for the rest of your life as a human, doomed to wander the surface world, unable to find the peace of coral caves.\"||Quickly you swim away, unable to believe your luck. What a convenient curse. Already you are changing back to human form. You just make it to your ship, coughing and spluttering, and your crew haul you aboard.||The gems are worth 300 Shards. You sail on, lucky to be still human.">

<ROOM STORY089
	(DESC "089")
	(STORY TEXT089)
	(EVENTS STORY089-EVENTS)
	(CONTINUE STORY507)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY089-EVENTS ()
	<GAIN-MONEY 300>>

<CONSTANT TEXT090 "Your ship is limping through unknown waters. The sun beats down, and the wind drops to a whisper.||\"What direction, Cap'n?\" asks the bo'sun.">

<ROOM STORY090
	(DESC "090")
	(STORY TEXT090)
	(CHOICES CHOICES-SCOUTING)
	(DESTINATIONS <LTABLE <LTABLE STORY633 STORY484>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT091 "He smiles and takes you into the Gambler's Den. It is a smoke-filled casino, full of all kinds of dubious-looking characters, playing cards and dice. If you want to gamble, decide how much you want to bet, to a maximum of 20 Shards.">

<ROOM STORY091
	(DESC "091")
	(VISITS 0)
	(STORY TEXT091)
	(EVENTS STORY091-EVENTS)
	(CONTINUE STORY109)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY091-EVENTS ()
	<GAMBLING-DEN 20>
	<COND (<CHECK-VISITS-MORE ,STORY091 1> <STORY-JUMP ,STORY100>)>>

<CONSTANT TEXT092 "He falls dead at your feet. Searching him, you find 25 Shards. Then you flip up his eyepatch. Nestling in the eye-socket is a sparkling gem, a flame opal. You pluck it free. You hurry off before a patrol arrives.">

<ROOM STORY092
	(DESC "092")
	(STORY TEXT092)
	(EVENTS STORY092-EVENTS)
	(CONTINUE STORY400)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY092-EVENTS ()
	<GAIN-MONEY 25>
	<DELETE-CODEWORD ,CODEWORD-BARNACLE>
	<KEEP-ITEM ,FLAME-OPAL-EYE>>

<ROOM STORY093
	(DESC "093")
	(BACKGROUND STORY093-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY093-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-AZURE> <RETURN ,STORY359>)>
	<RETURN ,STORY733>>

<CONSTANT TEXT094 "At last, the golem is defeated. You manage to get into the temple without being noticed by anyone else. Inside, it is cool and dark, filled with an unearthly stillness. You reach forward to strip the armour off the idol of Tyrnai.">

<ROOM STORY094
	(DESC "094")
	(STORY TEXT094)
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE <LTABLE STORY509 STORY228>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 12>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT095 "You are greeted warmly and politely by the provost marshal who treats you as one of his own. However, there are no more missions, and after thanking you once again, he politely sends you on your way.">

<ROOM STORY095
	(DESC "095")
	(STORY TEXT095)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT096 "One of the militiamen kicks over a table, blocking your escape. You set your back to a corner of the room and grimly prepare to fight for your life.">

<ROOM STORY096
	(DESC "096")
	(STORY TEXT096)
	(EVENTS STORY096-EVENTS)
	(CONTINUE STORY432)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY096-EVENTS ("AUX" MILITIA-STAMINA)
	<SET MILITIA-STAMINA <LTABLE 5 4 5>>
	<DO (I 1 3)
		<PUTP ,STORY096 ,P?DOOM T>
		<COMBAT-MONSTER ,MONSTER-MILITIAMAN 4 7 <GET .MILITIA-STAMINA .I>>
		<CHECK-COMBAT ,MONSTER-MILITIAMAN ,STORY096>
		<COND (<IS-ALIVE>
			<COND (<EQUAL? .I 3> <RETURN>)>
			<CRLF>
			<TELL "Do you wish to surrender?">
			<COND (<YES?>
				<STORY-JUMP ,STORY218>
				<RETURN>
			)>
		)(ELSE
			<RETURN>
		)>
	>>

<CONSTANT TEXT097 "You climb down a narrow track to the beach. The sea pounds the rocky shore, and the spray lashes your face. A mournful, yet utterly captivating singing suddenly fills your ears. You look out to sea, and spot several mermaids and mermen, cavorting in the surf.||A lilting voice calls across the waves that fills you with a yearning desire to plunge into the sea and swim out to them. \"Come, come to us...\"">

<ROOM STORY097
	(DESC "097")
	(STORY TEXT097)
	(CHOICES CHOICES-SANCTITY)
	(DESTINATIONS <LTABLE <LTABLE STORY584 STORY159>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SANCTITY 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT098 "The soldier recognizes you and bows. \"We are a small group now, left here to act as raiders behind enemy lines. Thanks to your heroic actions, the Citadel of Velis Corin is now ours. The king has moved his court there. Go to the citadel if you would speak with the king.\"||There is nothing else of interest in the mountains, so you return to the foothills.">

<ROOM STORY098
	(DESC "098")
	(STORY TEXT098)
	(CONTINUE STORY474)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT099 "You are on the east bank of the River Grimm, a great, powerful river, which rushes past towards the sea. You can travel to Golnir from here.">
<CONSTANT CHOICES099 <LTABLE "Cross the bridge to Conflass (Cities of Gold and Glory)" "Ford the river to the south (Cities of Gold and Glory)" "Follow the river north" "Head for the Curstmoor" "Head towards Devil's Peak" "Go south to the mouth of the river" "Go to Marlock City">>

<ROOM STORY099
	(DESC "099")
	(STORY TEXT099)
	(CHOICES CHOICES099)
	(DESTINATIONS <LTABLE STORY-CITIES-GOLD-GLORY STORY-CITIES-GOLD-GLORY STORY333 STORY175 STORY560 STORY579 STORY100>)
	(TYPES SEVEN-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT100 "Marlock City is a huge sprawling metropolis, enclosed in a fortified wall said to have been built one thousand years ago by the ancient Shadar empire. It is the capital city of Sokara. Marlock City was once known as Sokar, until General Grieve Marlock led the army in bloody revolt against the old king, Corin VII, and had him executed. The general renamed the city after himself. It is now a crime to call it Sokar.||The general lives in the old king's palace, and calls himself the Protector-General of all Sokara. Whereas the old king was corrupt, the general rules with a fist of iron. Some people like the new regime; others are royalists, still loyal to Nergan, the heir to the throne, who has gone into hiding somewhere.||Outside the city gates hang the bodies of many dead people. Labels around their necks read: \"Rebels, executed by the state for the good of the people.\"||\"You'd best behave yourself if you don't want to end up like one of them,\" grates a guardsman, nodding toward the swinging corpses, as you pass through the great eagle-headed gates of Marlock City.||You can buy a townhouse in Marlock City for 200 Shards. Owning a townhouse gives you a place to rest, and to store equipment.||To leave Marlock City by sea, or to buy or sell ships and cargo, go to the
harbourmaster.">

<CONSTANT MARLOCK-CHOICES
	<LTABLE
		"Visit the Three Rings Tavern"
		"Visit the temple of Alvir and Valmir"
		"Visit the Temple of Nagil"
		"Visit the Temple of Sig"
		"Visit the Temple of Elnir"
		"Visit the market"
		"Visit the harbourmaster"
		"Go to the merchants' guild"
		"Explore the city"
		"Visit your town house"
		"Visit the House of Priests"
		"Visit the general's palace"
		"Travel east towards Trefoille"
		"Head south-east towards the Shadar Tor"
		"Follow the River Grimm north"
		"Journey north into the Curstmoor"
		"Head west to the River Grimm delta"
	>>

<CONSTANT MARLOCK-DESTINATIONS
	<LTABLE
		STORY158
		STORY154
		STORY071
		STORY235
		STORY568
		STORY396
		STORY142
		STORY571
		STORY138
		STORY434
		STORY535
		STORY601
		STORY377
		STORY166
		STORY099
		STORY175
		STORY579
	>>

<CONSTANT MARLOCK-REQUIREMENTS
	<LTABLE
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		CODEWORD-AEGIS
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
	>>

<CONSTANT MARLOCK-TYPES
	<LTABLE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-CODEWORD
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
	>>

<ROOM STORY100
	(DESC "100")
	(LOCATION LOCATION-MARLOCK)
	(STORY TEXT100)
	(EVENTS STORY100-EVENTS)
	(CHOICES MARLOCK-CHOICES)
	(DESTINATIONS MARLOCK-DESTINATIONS)
	(REQUIREMENTS MARLOCK-REQUIREMENTS)
	(TYPES MARLOCK-TYPES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY100-EVENTS ()
	<COND (<AND <NOT <CHECK-CODEWORD ,CODEWORD-AEGIS>> <G=? ,MONEY 200>>
		<CRLF>
		<TELL "Would you like to buy a townhouse in Marlock City (200 " D ,CURRENCY ")?">
		<COND (<YES?>
			<COST-MONEY 200>
			<GAIN-CODEWORD ,CODEWORD-AEGIS>
			<GAIN-TOWNHOUSE ,TOWNHOUSE-MARLOCK>
		)>
	)>>

<CONSTANT TEXT101 "You yell the name of their god again and again. The cultists clap their hands over their ears, hopping about in horror.||\"Argh!\" howls the leader. \"Stop your blaspheming, you heathen devil.\"||In their confusion, you make it to your equipment. Now you can fight your way out.">
<CONSTANT TEXT101-CONTINUED "You manage to fight your way to freedom.">

<ROOM STORY101
	(DESC "101")
	(STORY TEXT101)
	(CHOICES CHOICES-COMBAT)
	(DESTINATIONS <LTABLE <LTABLE STORY101-SUCCEED STORY204>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-COMBAT 13>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<ROOM STORY101-SUCCEED
	(DESC "101")
	(EVENTS STORY101-EVENTS)
	(CONTINUE STORY010)
	(DOOM T)>

<ROUTINE STORY101-EVENTS ()
	<LOSE-STAMINA 4 ,DIED-IN-COMBAT ,STORY101-SUCCEED>
	<IF-ALIVE ,TEXT101-CONTINUED>>

<ROOM STORY102
	(DESC "102")
	(BACKGROUND STORY102-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY102-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-DEFEND> <RETURN ,STORY655>)>
	<RETURN ,STORY732>>

<CONSTANT TEXT103 "You set sail for Copper Island. The uneventful journey takes only a few days. The captain cannot believe how smooth the voyage has been. You disembark at the harbour of Copper Island.">

<ROOM STORY103
	(DESC "103")
	(STORY TEXT103)
	(CONTINUE STORY-BLOOD-DARK-SEA)
	(FLAGS LIGHTBIT)>

<ROOM STORY104
	(DESC "104")
	(STORY TEXT-GUILD-INVESTMENTS)
	(EVENTS STORY104-EVENTS)
	(CONTINUE STORY571)
	(INVESTMENTS 0)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY104-EVENTS ()
	<GUILD-ACTIVITY ,STORY104>>

<CONSTANT TEXT105 "You will have to fight it.">

<ROOM STORY105
	(DESC "105")
	(STORY TEXT105)
	(EVENTS STORY105-EVENTS)
	(CONTINUE STORY532)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY105-EVENTS ("AUX" INITIAL-STAMINA)
	<SET INITIAL-STAMINA ,STAMINA>
	<COMBAT-MONSTER ,MONSTER-SCORPION-SHAMAN 5 8 9>
	<CHECK-COMBAT ,MONSTER-SCORPION-SHAMAN ,STORY105>
	<COND (<AND <IS-ALIVE> <L? ,STAMINA .INITIAL-STAMINA>>
		<POISONED-WITH ,POISON-SCORPION>
	)>>

<CONSTANT TEXT106 "The young man smiles ingratiatingly, and hands you the pearls.">

<ROOM STORY106
	(DESC "106")
	(STORY TEXT106)
	(CHOICES CHOICES-MAGIC)
	(DESTINATIONS <LTABLE <LTABLE STORY306 STORY489>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-MAGIC 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT107 "If you are an initiate it costs only 10 Shards to purchase Tyrnai's blessing. A non-initiate must pay 25 Shards.||The blessing works by allowing you to try again on a failed COMBAT roll. It is good for only one reroll. You can only have one COMBAT blessing at any one time. Once it is used up, you can return to any branch of the temple of Tyrnai to buy a new one.">

<ROOM STORY107
	(DESC "107")
	(STORY TEXT107)
	(EVENTS STORY107-EVENTS)
	(CONTINUE STORY282)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY107-EVENTS ()
	<PURCHASE-BLESSING 25 10 ,GOD-TYRNAI ,BLESSING-COMBAT>>

<CONSTANT TEXT108 "That night, your sleep is restless. You dream a most vivid dream. You are attacked by a gigantic sea monster, a mighty octopoid thing that encircles the ship with tree-like tentacles and pulls it under the waves. You sink into the bottle-green depths until you are caught in a glowing golden net.||You wake in an undersea palace of multi-coloured coral with mermaids to attend you. They lead you past trident-armed merman guards into a great hall. Seated upon two giant shells, like thrones, are the king and queen of the deep, with green hair, sea-grey eyes, and crowns of pale gold. Shoals of iridescent angel fish dart about in an intricate flashing dance of colour, dancing for the rulers of the land beneath the waves. In awe, you bow before them.||\"We are bored,\" says the queen. \"Entertain us.\"||A silver flute appears in your hands.">

<ROOM STORY108
	(DESC "108")
	(STORY TEXT108)
	(CHOICES CHOICES-CHARISMA)
	(DESTINATIONS <LTABLE <LTABLE STORY132 STORY457>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-CHARISMA 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT109 "You are about to leave when you see a crowd gathered around a skinny, pasty-faced scholar at a card table.||\"By the Three Fortunes, but I'm hot tonight!\" he cries. It seems he is on a winning streak. You notice a couple of dodgy-looking ruffians watching the scholar carefully.">
<CONSTANT CHOICES109 <LTABLE "Wait and follow the scholar" "Return to the city centre">>

<ROOM STORY109
	(DESC "109")
	(STORY TEXT109)
	(CHOICES CHOICES109)
	(DESTINATIONS <LTABLE STORY540 STORY100>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT110 "You are walking through the Bronze Hills. Virtually the whole area has been given over to mining. Everywhere, quarries and mine shafts abound. It is a horrible expanse of torn-up earth -- hardly any areas of green are left. Great heaps of excavated rock, leeched of their useful minerals, mar the landscape. You find a quarry that is open to the public. That is to say, if you pay 50 Shards, you can dig for an hour in a silver mine.">
<CONSTANT CHOICES110 <LTABLE "Pay 50 Shards and mine for silver" "Go to Caran Baru" "South into the Forest of Larun" "West to the River Grimm" "North west into the Western Wilderness">>

<ROOM STORY110
	(DESC "110")
	(LOCATION LOCATION-BRONZE)
	(STORY TEXT110)
	(CHOICES CHOICES110)
	(DESTINATIONS <LTABLE STORY668 STORY400 STORY047 STORY333 STORY276>)
	(REQUIREMENTS <LTABLE 50 NONE NONE NONE NONE>)
	(TYPES <LTABLE R-MONEY R-NONE R-NONE R-NONE R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT111 "Your knowledge of the arcane arts is too limited to help you here.">
<CONSTANT CHOICES111 <LTABLE "Fight your way to the golden net" "Swim back to Shadar Tor">>

<ROOM STORY111
	(DESC "111")
	(STORY TEXT111)
	(CHOICES CHOICES111)
	(DESTINATIONS <LTABLE STORY111 STORY035>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT112 "The merchants' guild is comparatively small here. Most of its work involves financial services for the army. Here you can bank your money for safe-keeping, but there are no facilities for investment.">
<CONSTANT CHOICES112 <LTABLE "To deposit or withdraw money in Caran Baru" "Return to the town centre">>

<ROOM STORY112
	(DESC "112")
	(STORY TEXT112)
	(CHOICES CHOICES112)
	(DESTINATIONS <LTABLE STORY605 STORY400>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT CHOICES113 <LTABLE HAVE-CODEWORD YOU-ARE-A "Otherwise, the high priest has little to say; your is cut short.">>

<ROOM STORY113
	(DESC "113")
	(CHOICES CHOICES113)
	(DESTINATIONS <LTABLE STORY550 STORY075 STORY235>)
	(REQUIREMENTS <LTABLE CODEWORD-ARMOUR PROFESSION-ROGUE NONE>)
	(TYPES <LTABLE R-CODEWORD R-PROFESSION R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT114 "You are known as the priest who outwitted the storm demons to save Sul Veneris. You are shown in to see the chief administrator, who welcomes you freely. He can heal you of all lost Stamina points, and cure you of a disease or of poison free of charge. He cannot, however, lift a curse. \"Whenever you need help, come to me!\" he says. When you are ready.">

<ROOM STORY114
	(DESC "114")
	(STORY TEXT114)
	(EVENTS STORY114-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY114-EVENTS ()
	<COND (<OR <L? ,STAMINA ,MAX-STAMINA> <G? <COUNT-CONTAINER ,AILMENTS ,DISEASEBIT> 0> <G? <COUNT-CONTAINER ,AILMENTS ,POISONBIT> 0>>
		<SETG STAMINA ,MAX-STAMINA>
		<CURE-AILMENTS 0 ,DISEASEBIT ,POISONBIT>
	)>>

<CONSTANT TEXT115 "You are exploring Marlock City.">

<ROOM STORY115
	(DESC "115")
	(BACKGROUND STORY115-BACKGROUND)
	(STORY TEXT115)
	(EVENTS STORY115-EVENTS)
	(CONTINUE STORY226)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY115-BACKGROUND ()
	<COND (<MISSION-COMPLETED ,MISSION-GHOUL-HEAD> <RETURN ,STORY226>)>
	<RETURN ,STORY115>>

<ROUTINE STORY115-EVENTS ()
	<COND (<AND <CHECK-MISSION ,MISSION-GHOUL-HEAD> <NOT <MISSION-COMPLETED ,MISSION-GHOUL-HEAD>>>
		<CRLF>
		<TELL "Do you want to pursue the quest for the Temple of Nagil and bring it the head of the escaped ghoul?">
		<COND (<YES?> <STORY-JUMP STORY446>)>
	)(<MISSION-COMPLETED ,MISSION-GHOUL-HEAD>
		<CRLF>
		<COND (<CHECK-ITEM ,GHOULS-HEAD>
			<TELL "Perhaps you should go back to the Temple of Nagil to claim your reward">
		)(ELSE
			<TELL "The escaped ghoul has already been dealt with">
		)>
		<TELL ,PERIOD-CR>
	)>>

<CONSTANT TEXT116 "You realize the creature is one of the legendary repulsive ones. It is swimming past you, intent on its own business, so you follow it, in the hope it will lead you to the sunken city of Ziusudra.">

<ROOM STORY116
	(DESC "116")
	(VISITS 0)
	(BACKGROUND STORY116-BACKGROUND)
	(STORY TEXT116)
	(CONTINUE STORY547)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY116-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY116 1> <RETURN ,STORY226>)>
	<RETURN ,STORY116>>

<CONSTANT TEXT117 "There are several people with eyepatches but none with a velvet one. You ask around among the taverns and bars of the rougher areas in Caran Baru.">

<ROOM STORY117
	(DESC "117")
	(STORY TEXT117)
	(CHOICES CHOICES-CHARISMA)
	(DESTINATIONS <LTABLE <LTABLE STORY149 STORY468>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-CHARISMA 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT118 "The overseer of the mines is a fat, cruel-looking man. He welcomes you with a promise, \"In one month, you'll be dead, slave.\"||You spend the next few weeks in chains, working sixteen hours a day, deep underground, digging at a rock face in the tunnels of the mines in the Bronze Hills. You are fed on gruel and black bread. You realize you will not live long down here and that you must escape if you are to survive.">
<CONSTANT CHOICES118 <LTABLE HAVE-CODEWORD OTHERWISE>>

<ROOM STORY118
	(DESC "118")
	(STORY TEXT118)
	(CHOICES CHOICES118)
	(DESTINATIONS <LTABLE STORY351 STORY565>)
	(REQUIREMENTS <LTABLE CODEWORD-ASHEN NONE>)
	(TYPES <LTABLE R-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT119 "You hear shouts from outside, muffled by the swirling sulphurous fog. A stab of icy panic pulses at your heart, and an instant later the door bursts open. Three militiamen armed with maces burst through the doorway. Behind them, a tall cadaverous gentleman wrapped in a cape is stamping in fury.||\"A thief in my house!\" he rages. \"Do your duty, men.\"||You realize the truth: Lauria has used you as a decoy to cover her escape. You'll get even with her later -- if you survive.">

<ROOM STORY119
	(DESC "119")
	(STORY TEXT119)
	(CHOICES CHOICES-COMBAT)
	(DESTINATIONS <LTABLE <LTABLE STORY588 STORY096>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-COMBAT 12>>)
	(TYPES ONE-ABILITY)
	(CODEWORDS <LTABLE CODEWORD-ASHEN>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT120 "Your ship is sailing in the coastal waters off the Shadar Tor. You can just see the tor, a jumbled mass of rocks, sitting on the clifftops as it has done for a thousand years.">
<CONSTANT STORY120-REQUIREMENTS <LTABLE <LTABLE 2 0 <LTABLE 4 9 12> <LTABLE TEXT-STORM TEXT-UNEVENTFUL "A merchant ship">>>>

<ROOM STORY120
	(DESC "120")
	(STORY TEXT120)
	(CHOICES CHOICES-RANDOM)
	(DESTINATIONS <LTABLE <LTABLE STORY324 STORY559 STORY207>>)
	(REQUIREMENTS STORY120-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT121 "You wait outside, hoping to take the repulsive ones singly as they emerge. You will have to fight three of them, but you can do so one at a time. However, you will fight with -1 COMBAT during this battle because you are unused to fighting underwater.">

<ROOM STORY121
	(DESC "121")
	(STORY TEXT121)
	(EVENTS STORY121-EVENTS)
	(CONTINUE STORY213)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY121-EVENTS ("AUX" REPULSIVE-COMBAT REPULSIVE-DEFENSE)
	<SET REPULSIVE-COMBAT <LTABLE 4 3 4>>
	<SET REPULSIVE-DEFENSE <LTABLE 6 5 6>>
	<AFFLICTED-WITH ,DISADVANTAGE-COMBAT1>
	<DO (I 1 3)
		<PUTP ,STORY121 ,P?DOOM T>
		<COMBAT-MONSTER ,MONSTER-REPULSIVE-ONE <GET .REPULSIVE-COMBAT .I> <GET .REPULSIVE-DEFENSE .I> 10>
		<CHECK-COMBAT ,MONSTER-REPULSIVE-ONE ,STORY121>
		<COND (<NOT <IS-ALIVE>>
			<RETURN>
		)>
	>
	<COND (<IS-ALIVE> <REMOVE ,DISADVANTAGE-COMBAT1>)>>

<CONSTANT CHOICES122 <LTABLE HAVE-CODEWORD HAVE-A OTHERWISE>>

<ROOM STORY122
	(DESC "122")
	(CHOICES CHOICES122)
	(DESTINATIONS <LTABLE STORY543 STORY384 STORY731>)
	(REQUIREMENTS <LTABLE CODEWORD-ACID COPPER-AMULET NONE>)
	(TYPES <LTABLE R-CODEWORD R-ITEM R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT123 "This is the east bank of the River Grimm, near its source in the Spine of Harkun, far to the north.||You reach a ford where you can travel to the west bank for 1 Shard. Alternatively you could try swimming across instead, but the current is strong.">
<CONSTANT CHOICES123 <LTABLE "Swim (Cities of Gold and Glory)" "Pay to cross (Cities of Gold and Glory)" "East to the wilderness North to the mountains" "Follow the riverbank south">>

<ROOM STORY123
	(DESC "123")
	(STORY TEXT123)
	(CHOICES CHOICES123)
	(DESTINATIONS <LTABLE <LTABLE STORY-CITIES-GOLD-GLORY STORY-CITIES-GOLD-GLORY> STORY-CITIES-GOLD-GLORY STORY276 STORY003 STORY333>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 10> 1 NONE NONE NONE>)
	(TYPES <LTABLE R-TEST-ABILITY R-MONEY R-NONE R-NONE R-NONE>)
	(FLAGS LIGHTBIT)>

<ROOM STORY124
	(DESC "124")
	(STORY TEXT-STORM-SEA)
	(EVENTS STORY124-EVENTS)
	(CHOICES CHOICES-STORM-FURY)
	(DESTINATIONS <LTABLE <LTABLE STORY346 STORY583 STORY420>>)
	(REQUIREMENTS STORY-STORM-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY124-EVENTS ()
	<STORM-AT-SEA ,STORY124 ,STORY420>>

<CONSTANT TEXT125 "You mumble a prayer to the gods, but you're not sure if you got the ritual right.||The beggar thanks you and babbles, \"Yes, yes, a new doublet for an old beggar. I shall wear it with pride.\"||He wanders off, stopping passersby to show off what he thinks are his new clothes. Poor old fool.||You return to the city centre.">

<ROOM STORY125
	(DESC "125")
	(STORY TEXT125)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT126 "You come across a strange sight. A man lies staked out on the ground asleep. Blue energy crackles up and down his body, and a hefty-looking hammer, glowing red, is still attached to his belt. He is Sul Veneris, the one you have come to free.||As you are about to lift out the stakes, a keening blast of ferocious wind engulfs you. You are surrounded by whirling storm demons -- vaguely man-shaped creatures of thunderous energy which try to sweep you into the air and off the edge of the peak.||You try to recite the rituals of dismissal associated with such demons.">

<ROOM STORY126
	(DESC "126")
	(BACKGROUND STORY126-BACKGROUND)
	(STORY TEXT126)
	(CHOICES CHOICES-SANCTITY)
	(DESTINATIONS <LTABLE <LTABLE STORY421 STORY210>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SANCTITY 12>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY126-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-ALOFT> <RETURN ,STORY199>)>
	<RETURN ,STORY126>>

<ROOM STORY127
	(DESC "127")
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE <LTABLE STORY269 STORY183>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 9>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT128 "You make your way around the coast. The interior of the island appears to be heavily forested. After a while, however, you come to a bay in which a couple of ships are anchored. A small settlement nestles on the beach, and you make your way towards it.">

<ROOM STORY128
	(DESC "128")
	(STORY TEXT128)
	(CONTINUE STORY195)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT129 "\"Pssst, come here, friend,\" someone whispers from the shadows.">
<CONSTANT CHOICES129 <LTABLE "Go over to him" "Ignore him and leave">>

<ROOM STORY129
	(DESC "129")
	(STORY TEXT129)
	(CHOICES CHOICES129)
	(DESTINATIONS <LTABLE STORY641 STORY100>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT130 "You are greeted by several of the knights.||\"We'll not fight you anymore,\" says the Blue Dragon Knight.||\"We keep losing,\" says the Green Dragon Knight.||\"And it's costing us a fortune in armour, not to say a lot of bruises,\" says the Red Dragon Knight.">
<CONSTANT CHOICES130 <LTABLE HAVE-CODEWORD "Otherwise you are turned away">>

<ROOM STORY130
	(DESC "130")
	(STORY TEXT130)
	(CHOICES CHOICES130)
	(DESTINATIONS <LTABLE STORY521 STORY276>)
	(REQUIREMENTS <LTABLE CODEWORD-AXE NONE>)
	(TYPES <LTABLE R-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT131 "On the island is a community of sea gypsies. They hail you, but then they seem to recognize you. Rapid activity takes place, and within seconds a huge sail has been raised, and the island scuds away. It seems they would rather not meet you a second time.">

<ROOM STORY131
	(DESC "131")
	(STORY TEXT131)
	(CONTINUE STORY085)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT132 "You play the flute like never before. The king and queen are entranced by the haunting melodies you are able to coax from the enchanted flute. Unfortunately, you have played too well. The king puts you under a spell, so that you find you cannot stop.">

<ROOM STORY132
	(DESC "132")
	(STORY TEXT132)
	(CHOICES CHOICES-SANCTITY)
	(DESTINATIONS <LTABLE <LTABLE STORY413 STORY307>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SANCTITY 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT133 "You are forced back by the flames. Some townsfolk, covered in wet blankets, manage to get the woman out. They are treated like heroes -- you are forgotten. Such is life.">

<ROOM STORY133
	(DESC "133")
	(STORY TEXT133)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT134 "\"The high priest is out of town,\" a clerk tells you.||\"Yeah, until the heat dies down,\" quips a passing member of the temple. The clerk glares at her angrily.">

<ROOM STORY134
	(DESC "134")
	(STORY TEXT134)
	(CONTINUE STORY235)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT135 "The shores of the Lake of the Sea Dragon are swept by ochre waves, and the air smells foul. A sickly, pale green seaweed is the only vegetation that can survive in the sulphurous waters of the lake. A small fishing village, Cadmium, has grown up on the shores of the lake.">
<CONSTANT CHOICES135 <LTABLE "Talk to a fisherman" "Visit the local market" "Hire a boat and go fishing" "Go north to the Coldbleak Mountains" "North east into the farmlands" "South east into open countryside" "South, following the Stinking River" "West along the road">>

<ROOM STORY135
	(DESC "135")
	(STORY TEXT135)
	(CHOICES CHOICES135)
	(DESTINATIONS <LTABLE STORY382 STORY292 STORY203 STORY474 STORY548 STORY278 STORY576 STORY387>)
	(TYPES EIGHT-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT136 "The Sea of Whispers. Under a grey-blue sky, the sea is uncannily quiet and flat as a pane of glass. At night, however, the waters seem to come alive with an eerie whispering. One of your crew tells you that the sounds you heard at night are the sea centaurs speaking to one another across the waves.">
<CONSTANT STORY136-REQUIREMENTS <LTABLE <LTABLE 2 0 <LTABLE 4 7 10 12> <LTABLE TEXT-STORM TEXT-UNEVENTFUL "An unusual catch" "A strange dream">>>>

<ROOM STORY136
	(DESC "136")
	(STORY TEXT136)
	(CHOICES CHOICES-RANDOM)
	(DESTINATIONS <LTABLE <LTABLE STORY639 STORY507 STORY337 STORY108>>)
	(REQUIREMENTS STORY136-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT137 "The merchantman appears to be from Golnir. It keeps well away from you, no doubt fearing piracy.">

<ROOM STORY137
	(DESC "137")
	(STORY TEXT137)
	(CONTINUE STORY559)
	(FLAGS LIGHTBIT)>

<ROOM STORY138
	(DESC "138")
	(BACKGROUND STORY138-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY138-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-AGUE> <RETURN ,STORY115>)>
	<RETURN ,STORY730>>

<CONSTANT TEXT139 "You are spotted by a spear-armed guard. It gives an ululating cry of alarm, and many others swarm out of the mound.||You have little choice but to run -- with a pack of deadly killers close behind. Desperately, you try to lose them in the night.">

<ROOM STORY139
	(DESC "139")
	(STORY TEXT139)
	(EVENTS STORY139-EVENTS)
	(CONTINUE STORY663)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY139-EVENTS ()
	<STORY-ROLL-RANK ,STORY295>>

<CONSTANT TEXT140 "The ship drops you at Yellowport docks. You make your way to the city centre.">

<ROOM STORY140
	(DESC "140")
	(STORY TEXT140)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT141 "The Temple of Maka, the terrible goddess of disease and famine, is a large underground chamber accessible via an ornate entrance in the middle of the Plaza of the Gods, where all the temples stand in Yellowport.||Down below, the walls are bare earth; the ceiling is covered in the roots of growing plants, for Maka is also the goddess of the harvest who must be kept happy else disease and famine will strike the people, their crops and their livestock, bringing ruin to all.">
<CONSTANT CHOICES141 <LTABLE TEXT-BECOME-INITIATE TEXT-RENOUNCE-WORSHIP TEXT-SEEK-BLESSING "Ask to be cured of disease or poison" TEXT-LEAVE-TEMPLE>>

<ROOM STORY141
	(DESC "141")
	(STORY TEXT141)
	(CHOICES CHOICES141)
	(DESTINATIONS <LTABLE STORY368 STORY261 STORY481 STORY077 STORY010>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT142 "All shipping in and out of Marlock City must come through the offices of the harbourmaster. Here you can buy passage to far lands, or even a ship of your own, to fill with cargo and crew.||You can buy a one-way passage on a ship to the following destinations: Yellowport, Wishport, Sorcerers' Isle, Copper Island.||If you buy a ship, you are the captain, and can take it wherever you wish, exploring or trading. You also get to name it. There are three types of ship, and four quality levels of crew. You can also buy cargo for your ship to sell in other ports.||The quality of the ship's crew is average unless you pay to upgrade it. If you already own a ship, you can sell it to the harbourmaster at half the listed prices.||It costs 50 Shards to upgrade a poor crew to average, 100 Shards to upgrade an average crew to good, and 150 Shards to upgrade a good crew to excellent.||Cargo can be bought at Marlock City and sold at other ports for profit. If you own a ship you may buy as many Cargo Units as it has room for. You may also sell cargo, if you have any. Prices quoted are for entire Cargo Units.">

<ROOM STORY142
	(DESC "142")
	(LOCATION LOCATION-MARLOCK)
	(STORY TEXT142)
	(EVENTS STORY142-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY142-EVENTS ()
	<HARBOUR-MARLOCK>>

<CONSTANT TEXT143 "To renounce the worship of Elnir, you must pay 40 Shards to the priesthood by way of compensation. A passing noble says disdainfully, \"Ha! Only those born to rule have the fibre to worship the Sky Lord. Those who renounce Elnir never reach the top.\"">

<ROOM STORY143
	(DESC "143")
	(STORY TEXT143)
	(EVENTS STORY143-EVENTS)
	(CONTINUE STORY316)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY143-EVENTS ()
	<RENOUNCE-WORSHIP 40 ,GOD-ELNIR>>

<CONSTANT TEXT144 "You call on the divine powers of the gods, to banish this foul, blasphemous travesty of life. The ghoul shrinks back for a moment, snarling.">

<ROOM STORY144
	(DESC "144")
	(STORY TEXT144)
	(CHOICES CHOICES-SANCTITY)
	(DESTINATIONS <LTABLE <LTABLE STORY223 STORY289>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SANCTITY 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT145 "King Skabb gives a cry of anger, and leaps at you in desperation, swinging a spiked mace in his hand. You must fight him,">

<ROOM STORY145
	(DESC "145")
	(STORY TEXT145)
	(EVENTS STORY145-EVENTS)
	(CONTINUE STORY554)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY145-EVENTS ("AUX" (MODIFIER 0))
	<COND (<CHECK-ITEM ,RAT-POISON>
		<CRLF>
		<TELL "Use " T ,RAT-POISON "?">
		<COND (<YES?>
			<SET MODIFIER 3>
			<EMPHASIZE "The rat poison adds +3 to your COMBAT rolls.">
			<REMOVE-ITEM ,RAT-POISON "used" T T>
		)>
	)>
	<COMBAT-MONSTER ,MONSTER-KING-SKABB 5 7 10>
	<CHECK-COMBAT ,MONSTER-KING-SKABB ,STORY145 .MODIFIER>>

<CONSTANT TEXT146 "He seems to see something he approves of because he says, \"Perhaps. But first you must prove yourself. There is a knight, a man of great evil. He is known as the Black Dragon Knight. Defeat him in battle and I will teach you. Bring me his black dragon shield as proof of your valour.\" With that, he turns and walks away.||\"But how will I find him? And then how will I find you?\"||\"Would you have me kill him for you as well?\" he asks over his shoulder. \"As for the second, ask for me in the Blue Griffon Tavern in Caran Baru. My name is Yanryt the Son.\"">

<ROOM STORY146
	(DESC "146")
	(STORY TEXT146)
	(CONTINUE STORY412)
	(CODEWORDS <LTABLE CODEWORD-AXE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT147 "An old troubadour tells an epic tale of adventure and romance involving three heroes, a princess and a dragon. Afterwards, you find yourself talking to him at the bar. He tells you about the time he was captured by the Manbeasts of Nerech, and that by soothing their savage ferocity with music, he was able to escape.">
<CONSTANT CHOICES147 <LTABLE YOU-ARE-A OTHERWISE>>

<ROOM STORY147
	(DESC "147")
	(STORY TEXT147)
	(CHOICES CHOICES147)
	(DESTINATIONS <LTABLE STORY469 STORY100>)
	(REQUIREMENTS <LTABLE PROFESSION-TROUBADOUR NONE>)
	(TYPES <LTABLE R-PROFESSION R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT148 "\"Stop, stop, I surrender!\" yells the tree.||You cease your attack. \"So I can pass?\"||\"In view of recent events, I guess so,\" the tree says grudgingly. It uproots itself with a great tearing sound and shuffles out of the way.||You walk through the thorn bush gate. Beyond, you find several huge oaks trees whose branches are so big that they are able to support the homes of many people.">

<ROOM STORY148
	(DESC "148")
	(STORY TEXT148)
	(CONTINUE STORY358)
	(CODEWORDS <LTABLE CODEWORD-APPLE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT149 "A man accosts you as you are leaving a tavern. He presses his face close to yours. His breath reeks of rotting teeth and his ear has been cut off -- the mark of a man punished for piracy. \"Give me 10 Shards and I will tell you what you want to know.\"">
<CONSTANT CHOICES149 <LTABLE "Pay the money" "Refuse to pay">>

<ROOM STORY149
	(DESC "149")
	(STORY TEXT149)
	(CHOICES CHOICES149)
	(DESTINATIONS <LTABLE STORY533 STORY468>)
	(REQUIREMENTS <LTABLE 10 NONE>)
	(TYPES <LTABLE R-MONEY R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT150 "You get a berth on a merchantmen headed for Marlock City. It is a trouble-free journey.||\"I pay everyone off -- the Sokarans, the pirates,\" says the captain. \"That way I get left alone.\"||You disembark in Marlock City.">

<ROOM STORY150
	(DESC "150")
	(STORY TEXT150)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT151 "Inside the cave you find Damor the Hermit floating cross-legged in the air. \"I told you never to come back,\" he shouts angrily. He waves his hand, and you are teleported back down to the bottom of the mountain before you can say a word.">

<ROOM STORY151
	(DESC "151")
	(STORY TEXT151)
	(CONTINUE STORY244)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT152 "You clamber down a ladder into a long low hall, the Venefax Market. A sign reads, \"Closed on Thursday\". Fortunately, it's not Thursday, and a stocky, barrel-chested man with piggy eyes introduces himself as Fourze, the Master of the Market.||There is not much you can buy or sell in this provincial market.">
<CONSTANT CHOICES152 <LTABLE "Buy armours/weapons/other items" "Sell armours/weapons/other items" "Leave Venefax market">>

<ROOM STORY152
	(DESC "152")
	(LOCATION LOCATION-VENEFAX)
	(BACKGROUND STORY152-BACKGROUND)
	(STORY TEXT152)
	(CHOICES CHOICES152)
	(DESTINATIONS <LTABLE VENEFAX-BUY VENEFAX-SELL STORY427>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY152-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-ATTAR> <RETURN ,STORY623>)>
	<RETURN ,STORY152>>

<CONSTANT TEXT153 "You and your men are forced to surrender. The Sokarans take all your money and cargo, if you have any.||\"Count yourself lucky I haven't decided to call you rebels and sell the lot of you into slavery,\" says the captain.||They depart, leaving you and your crew with the bitter taste of defeat. Disconsolately you sail on.">

<ROOM STORY153
	(DESC "153")
	(STORY TEXT153)
	(CONTINUE STORY439)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT154 "The temple of Alvir and Valmir, Divine Rulers of the House of the Sea, is right on the teeming harbour of Marlock City. Its sea-green marbled porticos are draped in a hundred silver nets. Brother and sister, Alvir and Valmir rule below the waves. Alvir brings the souls of the drowned in his nets before his sister, Valmir, for judgment.||A swaggering ship's captain emerges from the temple, saying to you in passing, \"Never, I mean never go to sea without paying your respects to the twin gods -- unless ye want to sail through a world of storms.\"">

<ROOM STORY154
	(DESC "154")
	(STORY TEXT154)
	(CHOICES CHOICES-STANDARD-TEMPLE)
	(DESTINATIONS <LTABLE STORY343 STORY068 STORY275 STORY100>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT155 "One of the Trading Post sailors rows you out to your ship anchored in the bay. The sky is clear and the smell of the sea fills your heart with wanderlust. \"Welcome aboard, Cap'n,\" says the mate.">
<CONSTANT CHOICES155 <LTABLE "Set sail into the Sea of Whispers" "Return to the Trading Post">>

<ROOM STORY155
	(DESC "155")
	(STORY TEXT155)
	(CHOICES CHOICES155)
	(DESTINATIONS <LTABLE STORY136 STORY195>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT156 "The priest looks you over. \"I'm afraid we have no one skilled enough to cure you. However, I believe the temple of Maka in Yellowport might be able to help. And the holy waters at Blessed Springs are known to be efficacious in this kind of case.\"">

<ROOM STORY156
	(DESC "156")
	(STORY TEXT156)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT157 "You try to prove your loyalty to the new regime, but they don't believe a word of it. They beat you into unconsciousness, and leave you lying in the gutter. They rob you of all the money you had, but leave your possessions untouched. You come round with only 3 Stamina points.">

<ROOM STORY157
	(DESC "157")
	(STORY TEXT157)
	(EVENTS STORY157-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY157-EVENTS ()
	<COND (<G? ,STAMINA 3> <SETG STAMINA 3>)>
	<SETG MONEY 0>
	<UPDATE-STATUS-LINE>>

<CONSTANT TEXT158 "The Three Rings Tavern is a comfortable inn near the city centre. The tavern costs you 1 Shard a day. Each day you spend here, you can recover 1 Stamina point if injured, up to the limit of your normal unwounded Stamina score.">
<CONSTANT CHOICES158 <LTABLE "Pay 3 more Shards and buy some drinks" "Leave the tavern">>

<ROOM STORY158
	(DESC "158")
	(VISITS 0)
	(STORY TEXT158)
	(EVENTS STORY158-EVENTS)
	(CHOICES CHOICES158)
	(DESTINATIONS <LTABLE STORY158-SHARDS STORY100>)
	(REQUIREMENTS <LTABLE 3 NONE>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY158-EVENTS ()
	<COND (,RUN-ONCE <VISIT-INN ,STORY158 1 1>)>>

<ROOM STORY158-SHARDS
	(DESC "158")
	(BACKGROUND STORY158-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY158-BACKGROUND ()
	<GAIN-STAMINA 3>
	<RETURN ,STORY100>>

<CONSTANT TEXT159 "Your mind falls into a waking dream, and you walk lazily into the waters. The merfolk, laughing and singing, take you down to their undersea home of living coral, where they stop you from drowning with their faerie magic. They keep you for several weeks, until you are no longer an amusement to them.||You wake up, as if from a long sleep, with only a shadowy memory of your ordeal, to find yourself washed up in the harbour of Yellowport. You have lost all the possessions you were carrying but you still have your money.">

<ROOM STORY159
	(DESC "159")
	(STORY TEXT159)
	(EVENTS STORY159-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY159-EVENTS ()
	<RESET-POSSESSIONS>>

<CONSTANT TEXT160 "You learned the password 'Rebirth' in the library of Dweomer.||\"My, aren't we the wise one,\" carps the door sarcastically. \"Still, a job's a job, eh?\"||The door lifts straight up, and you step into the shadows of the Tomb of the Wizard King. It is lit by still-burning torches that give off an eerie eldritch glow. In the middle of the large round chamber, a sarcophagus lies, surrounded by a pentacle drawn in blood. You notice the blood still seems fresh.">

<ROOM STORY160
	(DESC "160")
	(VISITS 0)
	(BACKGROUND STORY160-BACKGROUND)
	(STORY TEXT160)
	(CHOICES CHOICES-MAGIC)
	(DESTINATIONS <LTABLE <LTABLE STORY674 STORY309>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-MAGIC 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY160-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY160 1> <RETURN ,STORY461>)>
	<RETURN ,STORY160>>

<CONSTANT TEXT161 "The governor is a seasoned veteran of many battles, a hardy man. He is quick to react, and calls his guards before you can kill him. You are subdued by sheer numbers.||\"Take this dirty rebel assassin to the dungeons,\" sneers Marloes Marlock.||The guards take all your money and possessions.">

<ROOM STORY161
	(DESC "161")
	(STORY TEXT161)
	(EVENTS STORY161-EVENTS)
	(CONTINUE STORY454)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY161-EVENTS ()
	<RESET-POSSESSIONS>
	<SETG MONEY 0>
	<UPDATE-STATUS-LINE>>

<CONSTANT TEXT162 "With the golems out of the way, you can get on with business. You reach forward to strip the armour off the idol of Tyrnai.">

<ROOM STORY162
	(DESC "162")
	(STORY TEXT162)
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE <LTABLE STORY509 STORY228>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 12>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT163 "You hold up the pirate captain's head. The guildmaster looks up expectantly, but his face quickly darkens.||\"This is not Amcha! Everyone knows Amcha has only one eye. This poor fellow is probably some beggar you killed in an alley somewhere. You think you can swindle the guild with this pathetic ruse. Get out -- and don't come back until you bring me the head of Amcha One-eye.\"||The guildmaster has you removed by his guards, and you are dumped into the street.">

<ROOM STORY163
	(DESC "163")
	(STORY TEXT163)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT164 "The dank tunnels, running with rivulets of foul water, take you deeper into the unknown. You mark the twisting passages with chalk so that you can find your way back.||Shortly, you come out into a large, rough-hewn cavern, wreathed in shadows that dance and flicker in the light you have brought.||A sound makes you start in surprise.">
<CONSTANT CHOICES164 <LTABLE TEXT-ROLL-SCOUTING TEXT-ROLL-THIEVERY>>

<ROOM STORY164
	(DESC "164")
	(STORY TEXT164)
	(CHOICES CHOICES164)
	(DESTINATIONS <LTABLE <LTABLE STORY247 STORY042> <LTABLE STORY247 STORY042>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 11> <LTABLE ABILITY-THIEVERY 11>>)
	(TYPES TWO-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT165 "A Sokaran war galley hails you and draws up alongside. \"We're coming aboard for an inspection!\" yells the captain of the galley. His men attempt to grapple your ship.">
<CONSTANT CHOICES165 <LTABLE "Let them board you" "Try to escape">>

<ROOM STORY165
	(DESC "165")
	(STORY TEXT165)
	(CHOICES CHOICES165)
	(DESTINATIONS <LTABLE STORY552 STORY444>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT166 "You are on the road between Marlock City and the Shadar Tor. Along most of the length of the road, a thin sliver of a shanty town has grown up. Tents and lean-tos line the way. You find out that the people living here are refugees from Trefoille. The city was burnt to the ground during the recent civil war, in which the old king was overthrown.">
<CONSTANT TEXT166-PICKPOCKET "A pick-pocket; you lose 10 Shards.">
<CONSTANT TEXT166-LANTERN "You find a lantern by the side of the road.">
<CONSTANT CHOICES166 <LTABLE "Go to Marlock City" "Head for the Shadar Tor">>

<ROOM STORY166
	(DESC "166")
	(STORY TEXT166)
	(EVENTS STORY166-EVENTS)
	(CHOICES CHOICES166)
	(DESTINATIONS <LTABLE STORY100 STORY035>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY166-EVENTS ("AUX" ROLL)
	<COND (,RUN-ONCE
		<SET ROLL <RANDOM-EVENT 1>>
		<COND (<L=? .ROLL 2>
			<EMPHASIZE ,TEXT166-PICKPOCKET>
			<LOSE-MONEY 10>
		)(<L=? .ROLL 4>
			<EMPHASIZE ,NOTHING-HAPPENS>
		)(ELSE
			<EMPHASIZE ,TEXT166-LANTERN>
			<KEEP-ITEM ,LANTERN>
		)>
	)>>

<CONSTANT TEXT167 "You lose your pursuers in the treacherous rocky passes of the mountains. Eventually, you reach the safety of the foothills.">

<ROOM STORY167
	(DESC "167")
	(STORY TEXT167)
	(CONTINUE STORY474)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT168 "As you stretch out your hand, you loose your footing, and plummet to the ground, right between the two golems! They turn their heads with a grating rumble, and open their mouths to speak. The sound that comes out is a bell-like gonging that alerts the temple. You pick yourself up and fall back on the last resort of the rogue -- running for your life! Warrior priests swarm out of the temple in pursuit.">

<ROOM STORY168
	(DESC "168")
	(STORY TEXT168)
	(EVENTS STORY168-EVENTS)
	(CONTINUE STORY551)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY168-EVENTS ()
	<STORY-ROLL-RANK ,STORY395>>

<CONSTANT TEXT169 "You see a couple of Sokaran warships, pursuing two other ships. Your first mate says, \"See the Red Pennants on them thar ships? They be pirates, running from the Sokarans.\"||The warships catch up and a bitter battle ensues. You can intervene if you wish.">
<CONSTANT CHOICES169 <LTABLE "Help the Sokarans" "Help the pirates" "Ignore the battle">>

<ROOM STORY169
	(DESC "169")
	(VISITS 0)
	(BACKGROUND STORY169-BACKGROUND)
	(STORY TEXT169)
	(CHOICES CHOICES169)
	(DESTINATIONS <LTABLE STORY286 STORY394 STORY443>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY169-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY169 1> <RETURN ,STORY443>)>
	<RETURN ,STORY169>>

<CONSTANT TEXT170 "Becoming an initiate of Lacuna gives you the benefit of paying less for blessings and other services the temple can offer. It costs 60 Shards to become an initiate. You cannot do this if you are already an initiate of another temple.">

<ROOM STORY170
	(DESC "170")
	(STORY TEXT170)
	(EVENTS STORY170-EVENTS)
	(CONTINUE STORY615)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY170-EVENTS ()
	<BECOME-INITIATE 60 ,GOD-LACUNA>>

<CONSTANT TEXT171 "You have soon laid the figures out like three logs on the village green. They are badly hurt but still alive. Now that you can get a better look at them, you see that they are dusted all over with flour, giving them a spectral appearance.||You summon the other villagers. At first they are loath to venture out and inspect the three strangers, but the fact that you survived convinces them there are no ghosts to worry about.||\"Why, it's Old Megan!\" cries a man as he claps eyes on one of the three. \"And here's Bradok the miller, and lame Pootmar. Why are they all covered in flour? Where're the ghosts?\"||You shake your head and sigh at the stupidity of yokels. \"There weren't any ghosts. It was these three all along.\"">

<ROOM STORY171
	(DESC "171")
	(STORY TEXT171)
	(CONTINUE STORY671)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT172 "\"Thank you,\" says the scholar. He gives you a vial of yellow dust as a reward. \"I found this at an ancient archaeological site I have been studying. I believe it needs to be thrown into the holy waters at the village of Blessed Springs -- although quite what happens then, I have no idea.\"||He thanks you again and takes his leave.">

<ROOM STORY172
	(DESC "172")
	(STORY TEXT172)
	(CONTINUE STORY100)
	(ITEMS <LTABLE VIAL-YELLOW-DUST>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT173 "You find yourself washed up on a rocky shore, battered and cold, but lucky to be alive. You haul yourself up the beach on to land. Fortunately for you, you find the village of Blessed Springs.">

<ROOM STORY173
	(DESC "173")
	(STORY TEXT173)
	(CONTINUE STORY510)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT174 "You advance, weapon at the ready. As you draw closer, something rushes out of the cave with a shrieking cry. It is the gorlock, a beast with legs like a bird, a body like a reptile, with two short forelimbs and a beaked, lizard-like head. Its two legs do indeed have backward-pointing feet. You'll have to fight.">
<CONSTANT TEXT174-DEAD "Your bones will join the others at the entrance of the cave.">

<ROOM STORY174
	(DESC "174")
	(STORY TEXT174)
	(EVENTS STORY174-EVENTS)
	(CONTINUE STORY315)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY174-EVENTS()
	<COMBAT-MONSTER ,MONSTER-GORLOCK 4 6 7>
	<CHECK-COMBAT ,MONSTER-GORLOCK ,STORY174>
	<COND (<NOT <IS-ALIVE>> <EMPHASIZE ,TEXT174-DEAD>)>>

<CONSTANT TEXT175 "You are trekking across the aptly named Curstmoor. A great rolling expanse of blasted heath stretches before you. Grey clouds hang over a mournful plain studded with rocky outcrops and low hills. A raven flutters to the ground nearby, eyeing you curiously. His brothers caw loudly into the echoing sky.||Dusk falls, and in the dim twilight, a herd of horses comes streaking out of the night straight at you. As they near, it seems to you that their hooves are not touching the ground, and from their manes trail wispy clouds of sparks like tiny stars.">
<CONSTANT CHOICES175 <LTABLE "Get out of their way" "Mount one of them">>

<ROOM STORY175
	(DESC "175")
	(VISITS 0)
	(LOCATION LOCATION-CURSTMOOR)
	(BACKGROUND STORY175-BACKGROUND)
	(STORY TEXT175)
	(CHOICES CHOICES175)
	(DESTINATIONS <LTABLE STORY390 STORY066>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY175-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY175 1> <RETURN ,STORY673>)>
	<RETURN ,STORY175>>

<CONSTANT TEXT176 "The crew are very nervous about your orders. They drop anchor in a bay, and will row you to shore, but they absolutely refuse to come with you. In fact, they won't even wait for you to come back.||If you insist on going ashore, your crew will sail for Yellowport and meet you there. \"If you ever make it back,\" adds the first mate ominously.">
<CONSTANT CHOICES176 <LTABLE "Go ashore" OTHERWISE>>

<ROOM STORY176
	(DESC "176")
	(STORY TEXT176)
	(CHOICES CHOICES176)
	(DESTINATIONS <LTABLE STORY032 STORY085>)
	(REQUIREMENTS <LTABLE DOCK-YELLOWPORT NONE>)
	(TYPES <LTABLE R-DOCK R-NONE>)
	(FLAGS LIGHTBIT)>

<ROOM STORY177
	(DESC "177")
	(STORY TEXT-TOWNHOUSE)
	(EVENTS STORY177-EVENTS)
	(CONTINUE STORY400)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY177-EVENTS ()
	<VISIT-TOWNHOUSE ,STORY177 ,TOWNHOUSE-CARAN-BARU>>

<CONSTANT TEXT178 "A pale woman in black leather brushes past you in the street, casting you an enigmatic look.">

<ROOM STORY178
	(DESC "178")
	(STORY TEXT178)
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE STORY635 STORY198>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT179 "You claim that you have come to swear allegiance to Nergan, the rightful king of Sokara. Captain Vorkung is not convinced. He narrows his eyes suspiciously.||\"You'd better leave -- now, before I decide you are a spy and have you shot.\"||One of the archer looses a shaft, and an arrow thuds into the ground at your feet, quivering menacingly.||Realizing it is time to leave, you climb down the mountain.">

<ROOM STORY179
	(DESC "179")
	(STORY TEXT179)
	(CONTINUE STORY474)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT180 "You step through the archway. Immediately the symbols on the stone begin to glow with red-hot energy; your hair stands on end and your body tingles. A crackling nimbus of blue-white force engulfs you, the sky darkens and rumbles, thunder and lightning crash and leap across the heavens.||Suddenly, your vision fades, and, momentarily, everything goes black.||When your sight returns, you find yourself outside the gates of a huge, fortified city. A guard starts in surprise at the sight of you. Then he shakes his head as if to clear it, sure he must have imagined what he just saw.||The gates open, and a troop of heavy cavalry canter past. \"Make way for the Marlock City militia,\" says the guard.||When they have passed, you walk into the city.">

<ROOM STORY180
	(DESC "180")
	(STORY TEXT180)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT181 "The Green Man Inn costs you 1 Shard a day. Each day you spend here, you can recover 1 Stamina point if injured, up to the limit of your normal unwounded Stamina score.">

<ROOM STORY181
	(DESC "181")
	(VISITS 0)
	(STORY TEXT181)
	(EVENTS STORY181-EVENTS)
	(CONTINUE STORY195)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY181-EVENTS ()
	<VISIT-INN ,STORY181 1 1>>

<ROOM STORY182
	(DESC "182")
	(STORY TEXT-SHIPWRECK)
	(EVENTS STORY182-EVENTS)
	(CONTINUE STORY591)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY182-EVENTS ()
	<STORY-SHIPWRECK ,STORY182>>

<CONSTANT TEXT183 "You find a shadowy natural alcove in the rocky wall of a tunnel. Desperately, you squeeze yourself into it, using all your skill to hide in the darkness. Several ratmen run past, but others sniff you out with their highly developed sense of smell. You are overwhelmed by sheer numbers.">

<ROOM STORY183
	(DESC "183")
	(STORY TEXT183)
	(CONTINUE STORY308)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT184 "The Blue Griffon Tavern is frequented by soldiers and mercenaries. The tavern costs you 1 Shard a day. Each day you spend here, you can recover 1 Stamina point if injured, up to the limit of your normal unwounded Stamina score.">
<CONSTANT CHOICES184 <LTABLE "Find Yanryt the Son" HAVE-A "Buy drinks all round at the bar, and listen for rumours" "Return to the town centre">>

<ROOM STORY184
	(DESC "184")
	(VISITS 0)
	(STORY TEXT184)
	(EVENTS STORY184-EVENTS)
	(CHOICES CHOICES184)
	(DESTINATIONS <LTABLE STORY451 STORY451 STORY341 STORY400>)
	(REQUIREMENTS <LTABLE CODEWORD-AXE BLACK-DRAGON-SHIELD 3 NONE>)
	(TYPES <LTABLE R-CODEWORD R-ITEM R-MONEY R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY184-EVENTS ()
	<VISIT-INN ,STORY184 1 1>>

<CONSTANT TEXT185 "You tell him who you are, and that General Grieve Marlock's brother, the Governor of Yellowport, is your personal friend. His eyes widen as recognition dawns on his fat, greedy face.||\"Ah, er... I was merely jesting!\" he cries. \"Umm... I mean to say, perhaps you need an escort?\"||\"What I require is a levy in order to carry out the important mission the governor has entrusted to me. Sixty Shards ought to do it.\"||The Sokaran captain hands over the 60 Shards and leads his men off your ship. You sail on">

<ROOM STORY185
	(DESC "185")
	(STORY TEXT185)
	(EVENTS STORY185-EVENTS)
	(CONTINUE STORY439)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY185-EVENTS ()
	<GAIN-MONEY 60>>

<CONSTANT TEXT186 "You pass the leash over to the man in the palanquin, who leans out and hands you 75 Shards. You leave the slave market.">

<ROOM STORY186
	(DESC "186")
	(STORY TEXT186)
	(EVENTS STORY186-EVENTS)
	(CONTINUE STORY400)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY186-EVENTS ()
	<GAIN-MONEY 75>>

<CONSTANT TEXT187 "You tell the high priest that you wish to renounce the worship of Nagil. He brings out a small wax dummy, and carves your name into it. Then he sets fire to it. The wax melts into a puddle on the floor and the priest steps into it, leaving the imprint of his foot.||\"Such is the fate of those who would deny Nagil, the Lord of Death,\" he says.||\"Do I have to pay compensation to the temple?\"||He shakes his head. \"It is you who lose, not we.\"||Do you want to reconsider?">

<ROOM STORY187
	(DESC "187")
	(STORY TEXT187)
	(EVENTS STORY187-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY187-EVENTS ()
	<RENOUNCE-WORSHIP 0 ,GOD-NAGIL>>

<CONSTANT TEXT188 "You are thrown into a stinking prison cell.||\"We meet again, my dear friend,\" says a half-dead man with white hair.||You recognize the poor old man whom you met the last time you were thrown into the dungeons. He launches into the same old story about the gorlock, the creature with the backward-pointing feet. By the end of it, you are looking forward to being sold into slavery and sent to work in the tin mines of Caran Baru.">

<ROOM STORY188
	(DESC "188")
	(STORY TEXT188)
	(CONTINUE STORY118)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT189 "There is nothing in your limited knowledge of undersea wildlife to help you.">
<CONSTANT CHOICES189 <LTABLE "Swim back to the Shadar Tor" "Fight your way to the golden net" "Try magic">>

<ROOM STORY189
	(DESC "189")
	(STORY TEXT189)
	(CHOICES CHOICES189)
	(DESTINATIONS <LTABLE STORY035 STORY121 STORY592>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT190 "You are sailing along the coast off Blessed Springs and Fort Brilon. Gulls cluster around the ship, looking for food. Their cries echo across the vasty seas.">
<CONSTANT STORY190-REQUIREMENTS <LTABLE <LTABLE 2 0 <LTABLE 4 9 12> <LTABLE TEXT-STORM TEXT-UNEVENTFUL "A shipwreck">>>>

<ROOM STORY190
	(DESC "190")
	(STORY TEXT190)
	(CHOICES CHOICES-RANDOM)
	(DESTINATIONS <LTABLE <LTABLE STORY038 STORY209 STORY504>>)
	(REQUIREMENTS STORY190-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT191 "The provost marshal is a rich and powerful man, cunning and capable.||\"I have need of someone like you,\" he says. \"A group of rebels, loyal to the old king, are hiding out in the Coldbleak Mountains. Their leader, Nergan Corin, is dangerous to us, as he is the heir to the old throne and a rallying point for the rebels. Penetrate their stronghold and slay Nergan Corin, and you will be richly rewarded. I can promise you 500 Shards and a title if you succeed.\"">
<CONSTANT CHOICES191 <LTABLE HAVE-CODEWORD "Otherwise, the provost dismisses you">>

<ROOM STORY191
	(DESC "191")
	(STORY TEXT191)
	(EVENTS STORY191-EVENTS)
	(CHOICES CHOICES191)
	(DESTINATIONS <LTABLE STORY375 STORY010>)
	(REQUIREMENTS <LTABLE CODEWORD-AMBUSCADE NONE>)
	(TYPES <LTABLE R-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY191-EVENTS ()
	<COND (<AND <NOT <CHECK-MISSION ,MISSION-NEGRAN-CORIN>> <NOT <MISSION-COMPLETED ,MISSION-NEGRAN-CORIN>>>
		<CRLF>
		<TELL "Take up the mission " D ,MISSION-NEGRAN-CORIN "?">
		<COND (<YES?> <TAKE-MISSION ,MISSION-NEGRAN-CORIN>)>
	)>>

<CONSTANT TEXT192 "You reach a hill crowned with a circle of large obsidian standing stones. Despite the bitter wind that blows across these hills, the stones are unweathered and seem almost newly cut. The stones are laid in such a way that they form three archways, each carven with mystic symbols and runes of power.||\"The Gates of the World.\" says the old man. \"Each gate will take you to a part of the world of Harkuna, though I know not to where.\"||Abruptly he turns around and sets off down the hill, leaving you alone with the brooding stones and the howling wind.">

<ROOM STORY192
	(DESC "192")
	(STORY TEXT192)
	(CONTINUE STORY065)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT193 "You find yourself washed up on a rocky shore, battered and cold, but lucky to be alive. You head inland until you come to a road.">

<ROOM STORY193
	(DESC "193")
	(STORY TEXT193)
	(CONTINUE STORY621)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT194 "You know what the strange swellings on the dead bodies mean. They have been injected with the eggs of the ker'ilk, hideous lobster-like beings of the deep. Soon the eggs will hatch, and the young will feed on the bodies of the sailors. You also know that the adults never stray far from their eggs, and warn your men that the ker'ilk are nearby.||Your warning is timely -- several horrific-looking creatures, like giant lobsters, all spines and pincers, surge out of the waters. Your men, however, are ready. A battle ensues -- you must fight one of the creatures.">
<CONSTANT TEXT194-END "You end up as food for ker'ilk young.">

<ROOM STORY194
	(DESC "194")
	(STORY TEXT194)
	(EVENTS STORY194-EVENTS)
	(CONTINUE STORY519)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY194-EVENTS()
	<COMBAT-MONSTER ,MONSTER-KER-ILK 4 9 8>
	<CHECK-COMBAT ,MONSTER-GORLOCK ,STORY194>
	<COND (<NOT <IS-ALIVE>> <EMPHASIZE ,TEXT194-END>)>>

<CONSTANT TEXT195 "The Trading Post is a small village, set up here by enterprising settlers from the mainland. Its main export appears to be furs from the forest.||The mayor, a fat genial fellow, who greets you personally, insists that one day the Trading Post will be a thriving town. There is not a lot here yet, however: a small market, a quay, the settlers' houses, and a shrine to Lacuna the Huntress, goddess of nature.">
<CONSTANT CHOICES195 <LTABLE "Visit the shrine to Lacuna" "Visit the market" "Visit the quayside" "Visit the Green Man Inn" "Climb the hill that overlooks the town" "Go inland, into the forest">>

<ROOM STORY195
	(DESC "195")
	(LOCATION LOCATION-TRADING)
	(STORY TEXT195)
	(CHOICES CHOICES195)
	(DESTINATIONS <LTABLE STORY544 STORY452 STORY332 STORY181 STORY011 STORY257>)
	(TYPES SIX-CHOICES)
	(CODEWORDS <LTABLE CODEWORD-ASPEN>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY195-EVENTS ()
	<COND (,CURRENT-SHIP <PUTP ,CURRENT-SHIP ,P?DOCKED ,DOCK-TRADING>)>>
<CONSTANT TEXT196 "You hack off the hideous head and leave.">

<ROOM STORY196
	(DESC "196")
	(STORY TEXT196)
	(EVENTS STORY196-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY196-EVENTS ()
	<COMPLETE-MISSION ,MISSION-GHOUL-HEAD>
	<TAKE-ITEM ,GHOULS-HEAD>>

<CONSTANT TEXT197 "The blessing of Sig costs 10 Shards if you are an initiate, 30 Shards otherwise.||The blessing works by allowing you to reroll any failed THIEVERY attempt once. You can have only one blessing for each ability at any one time. Once your THIEVERY blessing is used up, you can return to any branch of the temple of Sig to buy a new one.">

<ROOM STORY197
	(DESC "197")
	(STORY TEXT197)
	(EVENTS STORY197-EVENTS)
	(CONTINUE STORY235)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY197-EVENTS ()
	<PURCHASE-BLESSING 30 10 ,GOD-SIG ,BLESSING-THIEVERY>>

<CONSTANT TEXT198 "Musing to yourself about the strange woman, you pause at the end of an alleyway to buy roast chestnuts as you watch her striding off into the evening smog enveloping the city.||\"That'll be a Shard,\" grunts the chestnut vendor.||You reach for your money pouch. Then your hands fumble in panic. The pouch has gone! After a moment the truth dawns on you. You stare grimly in the direction that the black-garbed woman went, but there is no sign of her now.||\"I'll have them chestnuts back, then,\" growls the vendor when he sees you can't pay.">

<ROOM STORY198
	(DESC "198")
	(STORY TEXT198)
	(EVENTS STORY198-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY198-EVENTS ()
	<SETG MONEY 0>
	<UPDATE-STATUS-LINE>>

<CONSTANT TEXT199 "A strange, vaguely humanoid shape, flickering with energy, soars down to attack you. You must fight.">
<CONSTANT TEXT199-FADE "The demon fades away leaving a clear blue jewel worth 200 Shards. There's nothing else up here, so you climb down again.">

<ROOM STORY199
	(DESC "199")
	(BACKGROUND STORY199-BACKGROUND)
	(STORY TEXT199)
	(EVENTS STORY199-EVENTS)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY199-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY199 1> <RETURN ,STORY634>)>
	<RETURN ,STORY199>>

<ROUTINE STORY199-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-STORM-DEMON 3 6 8>
	<CHECK-COMBAT ,MONSTER-STORM-DEMON ,STORY199>
	<COND (<IS-ALIVE>
		<IF-ALIVE ,TEXT199-FADE>
		<GAIN-MONEY 200>
	)>>

<CONSTANT TEXT200 "You have acquired an old map of the Forest of the Forsaken in Golnir, the land to the west of Sokara that is described in Fabled Lands book 2: Cities of Gold and Glory. The map shows a safe path that leads to the Tower of Despair, but it seems to conflict with the location of the Tower of Despair on the regular map of Golnir. Which is correct?||As long as you have the Forest of the Forsaken map you can choose the option to look at it at any time.">
<CONSTANT TEXT200-MAP "-- TO-DO: Map Display --">

<ROOM STORY200
	(DESC "200")
	(VISITS 0)
	(STORY TEXT200)
	(EVENTS STORY200-EVENTS)
	(CONTINUE STORY030)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY200-EVENTS ()
	<COND (<CHECK-VISITS-MORE ,STORY200 1>
		<STORY-JUMP ,PREVIOUS-STORY>
	)(ELSE
		<TAKE-ITEM ,FOREST-FORSAKEN-MAP>
	)>>

<CONSTANT TEXT201 "The road between the Citadel and Caran Baru is chock-a-block with troops and carts. It looks like there is a war in the north.">
<CONSTANT CHOICES201 <LTABLE "Head for the citadel" "Go south to Caran Baru" "Head west" "Head east">>

<ROOM STORY201
	(DESC "201")
	(LOCATION LOCATION-SOKARA)
	(STORY TEXT201)
	(CHOICES CHOICES201)
	(DESTINATIONS <LTABLE STORY271 STORY400 STORY276 STORY060>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT202 "Gingerly, you open the door. It leads to a curtained alcove, through which you observe the room beyond. It is a long, low hall -- clearly an ancient Uttakin temple, from a time when the Masked Lords of Uttaku ruled all of Harkuna, but now part of the sewers of Yellowport.||A cheap wooden chair has been placed on the altar to act as a throne. On it sits a large and extremely ugly ratman. He has a tawdry amulet around his neck, and a rusty iron hoop for a crown. Several ratmen are kneeling before him, engaged in conversation.||\"But, Skabb...\" one of the rat men is saying.||\"That's Great King Skabb to you, dung-breath!!\" bellows the rat on the throne.">
<CONSTANT CHOICES202 <LTABLE "Charge in to the attack" "Sneak in to assassinate the king" "Use sorcery to get close to Skabb" "Bluff your way in">>

<ROOM STORY202
	(DESC "202")
	(STORY TEXT202)
	(CHOICES CHOICES202)
	(DESTINATIONS <LTABLE STORY428 STORY595 STORY024 STORY336>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT203 "You can hire a fishing boat for 15 Shards a day. It comes with a fishing net.">
<CONSTANT CHOICES203 <LTABLE "Go fishing" "Don't go fishing">>

<ROOM STORY203
	(DESC "203")
	(STORY TEXT203)
	(CHOICES CHOICES203)
	(DESTINATIONS <LTABLE STORY267 STORY135>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT204 "There are simply too many of them, and you are beaten into submission. Your end is grisly indeed -- killed, boiled with herbs and garlic, and eaten by the cannibal cultists of Badogor the Unspoken.">

<ROOM STORY204
	(DESC "204")
	(STORY TEXT204)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT205 "The runes are written in Old Shadar, an ancient language from thousands of years ago. You realize that the runes form a spell that will give you the power to breathe underwater for a few hours.">
<CONSTANT CHOICES205 <LTABLE "Use the spell and swim out to sea" TEXT-TO-BEACH TEXT-TO-TREFOILLE TEXT-TO-MARLOCK>>

<ROOM STORY205
	(DESC "205")
	(STORY TEXT205)
	(CHOICES CHOICES205)
	(DESTINATIONS <LTABLE STORY493 STORY097 STORY602 STORY166>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT206 "The crew absolutely refuses to sail into the Unbounded Ocean. \"There's no land out there, and the seas are infested with Demons of the Deep. If we go too far, we'll fall off the edge of the world!\" says the first mate.||You have no choice but to reconsider your destination.">

<ROOM STORY206
	(DESC "206")
	(STORY TEXT206)
	(CONTINUE STORY507)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT207 "The look-out cries, \"Ship on the starboard bow!\"||You spot a crippled merchant ship, limping towards Marlock City. It looks like a trading vessel from the Feathered Lands.">
<CONSTANT CHOICES207 <LTABLE "Assist" "Attack">>

<ROOM STORY207
	(DESC "207")
	(VISITS 0)
	(BACKGROUND STORY207-BACKGROUND)
	(STORY TEXT207)
	(CHOICES CHOICES207)
	(DESTINATIONS <LTABLE STORY293 STORY464>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY207-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY207 4> <RETURN ,STORY137>)>
	<RETURN ,STORY207>>

<CONSTANT TEXT208 "Using your sorcerous powers you breathe a cloud of greenish vapour over the ratmen. Coughing and gasping, they sink into an enchanted slumber -- all but King Skabb. Standing on the altar, he is able to keep his head above the vapours.">

<ROOM STORY208
	(DESC "208")
	(STORY TEXT208)
	(CONTINUE STORY145)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT209 "You are sailing in the coastal waters off Fort Brilon and Blessed Springs.">
<CONSTANT CHOICES209 <LTABLE "Sail north along the coast of Nerech" "Sail south to Scorpion Bight" "Sail east into the Sea of Whispers">>

<ROOM STORY209
	(DESC "209")
	(STORY TEXT209)
	(CHOICES CHOICES209)
	(DESTINATIONS <LTABLE STORY249 STORY430 STORY136>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT210 "They fall back for a moment, but your invocation fails to take hold, and they close in. You must fight them one at a time.">
<CONSTANT TEXT210-END "You are tossed off the top of the peak, and end up as a messy
paste on the ground below.">

<ROOM STORY210
	(DESC "210")
	(STORY TEXT210)
	(EVENTS STORY210-EVENTS)
	(CONTINUE STORY054)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY210-EVENTS ()
	<DO (I 1 3)
		<PUTP ,STORY210 ,P?DOOM T>
		<COMBAT-MONSTER ,MONSTER-STORM-DEMON 4 7 8>
		<CHECK-COMBAT ,MONSTER-STORM-DEMON ,STORY210>
		<COND (<NOT <IS-ALIVE>>
			<EMPHASIZE ,TEXT210-END>
			<RETURN>
		)>
	>>

<CONSTANT TEXT211 "When he emerges, you are waiting for him.">

<ROOM STORY211
	(DESC "211")
	(STORY TEXT211)
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE <LTABLE STORY058 STORY304>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT212 "You are dissolved in the acid until all that is left of you is a pile of yellow dust. Vayss scoops you up and puts you into a bottle on his shelf.">

<ROOM STORY212
	(DESC "212")
	(STORY TEXT212)
	(EVENTS STORY-LOSE-EVERYTHING)
	(CONTINUE STORY031)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT213 "Each creature bursts open in death, spilling a black inky cloud into the water. The sac in which this ink is kept falls free from its body. You also find coral jewellery worth about 45 Shards. You swim down and take the golden net and strike out for the Shadar Tor as fast as you can.">
<CONSTANT CHOICES213 <LTABLE TEXT-TO-TREFOILLE TEXT-TO-MARLOCK>>

<ROOM STORY213
	(DESC "213")
	(STORY TEXT213)
	(EVENTS STORY213-EVENTS)
	(CHOICES CHOICES213)
	(DESTINATIONS <LTABLE STORY602 STORY166>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY213-EVENTS ()
	<COND (,RUN-ONCE
		<GAIN-MONEY 45>
		<TAKE-QUANTITIES ,INK-SAC "ink sacs" "How many of the ink sacs will you take" 3>
	)>>

<CONSTANT TEXT214 "You try to stop the panic but your men are too far gone. They are already diving over the side, trying to swim back to your ship. Unfortunately, they are even more vulnerable in the sea, and the ker'ilk take them at will. Soon you are all overwhelmed. You are taken alive to be injected with eggs -- a most horrible end.">

<ROOM STORY214
	(DESC "214")
	(STORY TEXT214)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT215 "Caran Baru market consists of several covered arcades -- much of its stock is for miners and soldiers, and it is run with business-like efficiency by the Sokaran military. Items with no purchase price listed are not available locally.">
<CONSTANT CHOICES215 <LTABLE "Buy armours/weapons/other items" "Sell armours/weapons/magic/other items" "Leave Caran Baru market">>

<ROOM STORY215
	(DESC "215")
	(STORY TEXT215)
	(CHOICES CHOICES215)
	(DESTINATIONS <LTABLE CARAN-BARU-BUY CARAN-BARU-SELL STORY400>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT216 "The cry goes up throughout the palace, \"Murder! Assassin!\" and the hunt is on -- for you. You will need all your skill to get out of the palace alive.">

<ROOM STORY216
	(DESC "216")
	(STORY TEXT216)
	(EVENTS STORY216-EVENTS)
	(CONTINUE STORY566)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY216-EVENTS ("AUX" (MODIFIER 0))
	<COND (
		<OR
			<CHECK-PROFESSION ,PROFESSION-ROGUE>
			<CHECK-PROFESSION ,PROFESSION-TROUBADOUR>
			<CHECK-PROFESSION ,PROFESSION-WAYFARER>
		>
		<SET MODIFIER -1>
	)>
	<STORY-ROLL-RANK ,STORY407 .MODIFIER>>

<CONSTANT TEXT217 "You come across a forest glade. Birds twitter in the trees, and woodland animals frolic playfully about. In the middle of the glade stands a mighty willow, ancient beyond reckoning. The trunk is hollow, and a wooden door has been set in the entrance. You step into the glade.">

<ROOM STORY217
	(DESC "217")
	(STORY TEXT217)
	(CHOICES CHOICES-SANCTITY)
	(DESTINATIONS <LTABLE <LTABLE STORY356 STORY646>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SANCTITY 9>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT218 "The militia take you alive. You lose all your money and possessions. Then you are thrown into the dungeons of Yellowport.">

<ROOM STORY218
	(DESC "218")
	(STORY TEXT218)
	(EVENTS STORY-LOSE-EVERYTHING)
	(CONTINUE STORY454)
	(FLAGS LIGHTBIT)>

<ROOM STORY219
	(DESC "219")
	(STORY TEXT-SHIPWRECK)
	(EVENTS STORY219-EVENTS)
	(CONTINUE STORY436)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY219-EVENTS ()
	<STORY-SHIPWRECK ,STORY219>>

<CONSTANT TEXT220 "The temple of Alvir and Valmir is built like an upside-down galleon. Alvir and Valmir are brother and sister, King and Queen of the Land beneath the Waves, masters of the sea. Their servants and soldiers are the souls of the drowned, and when seas are rough and storm-tossed, sailors say that Alvir and Valmir are arguing again.">
<CONSTANT CHOICES220 <LTABLE HAVE-CODEWORD IF-NOT>>

<ROOM STORY220
	(DESC "220")
	(STORY TEXT220)
	(CHOICES CHOICES220)
	(DESTINATIONS <LTABLE STORY531 STORY729>)
	(REQUIREMENTS <LTABLE CODEWORD-ANCHOR NONE>)
	(TYPES <LTABLE R-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT221 "One of the militiamen recognizes you and shouts, \"That's the one who assassinated Marloes Marlock!\" You turn tail and flee with more than a dozen militiamen on your heels.">

<ROOM STORY221
	(DESC "221")
	(STORY TEXT221)
	(EVENTS STORY221-EVENTS)
	(CONTINUE STORY252)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY221-EVENTS ()
	<STORY-ROLL-RANK ,STORY057 0>>

<CONSTANT TEXT222 "Your ship is sailing in the coastal waters near Marlock City.">
<CONSTANT STORY222-REQUIREMENTS <LTABLE <LTABLE 2 0 <LTABLE 4 9 12> <LTABLE TEXT-STORM TEXT-UNEVENTFUL "Sea battle">>>>

<ROOM STORY222
	(DESC "222")
	(STORY TEXT222)
	(CHOICES CHOICES-RANDOM)
	(DESTINATIONS <LTABLE <LTABLE STORY124 STORY420 STORY169>>)
	(REQUIREMENTS STORY222-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT223 "The ghoul staggers back, howling at the night sky, and gnashing its teeth. Suddenly, brownish ichor spills from its eyes and the flesh begins to shrivel on its bones. It collapses in on itself, leaving only a mound of putrescent matter, atop of which rests its head, now lifeless, empty eye-sockets staring at the moon. You grab the head, and set off.">

<ROOM STORY223
	(DESC "223")
	(STORY TEXT223)
	(CONTINUE STORY100)
	(ITEMS <LTABLE GHOULS-HEAD>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT224 "Using your wilderness-honed sense of direction you dart through the maze of tunnels. Soon the sounds of pursuit fade, until they are but a dim echo. Heaving a sigh of relief, you press on.">

<ROOM STORY224
	(DESC "224")
	(STORY TEXT224)
	(CONTINUE STORY580)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT225 "You find a cave, with piles of human bones outside it. However, it is quite empty without signs of habitation. The beast that lived here is dead or departed. You make your way back down to Blessed Springs.">

<ROOM STORY225
	(DESC "225")
	(STORY TEXT225)
	(CONTINUE STORY510)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT226 "You take a stroll through the streets. Marlock City has a busy night life.">
<CONSTANT CHOICES226 <LTABLE "Explore the barracks area" "Go to the Street of Entertainers" "Search the residential quarter">>

<ROOM STORY226
	(DESC "226")
	(STORY TEXT226)
	(CHOICES CHOICES226)
	(DESTINATIONS <LTABLE STORY015 STORY129 STORY619>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT227 "The mad beggar takes the money and swallows the lot in one gulp. \"A gourmet meal!\" he babbles.">
<CONSTANT CHOICES227 <LTABLE "Bless him" "If not, he wanders off ranting and you head back to the city centre">>

<ROOM STORY227
	(DESC "227")
	(STORY TEXT227)
	(EVENTS STORY227-EVENTS)
	(CHOICES CHOICES227)
	(DESTINATIONS <LTABLE STORY632 STORY010>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY227-EVENTS ()
	<COST-MONEY 5 "gave">>

<CONSTANT TEXT228 "A stone slab at the base of the idol shifts ominously as you put your foot on it. A wickedly barbed spear springs out of the ground, straight into your leg.">
<CONSTANT TEXT228-CONTINUED "You remove the chain mail and sling it over your shoulder. Because it is made of gold, it is useless if worn as armour.||As you glance at the jaguar-headed idol, its eyes seem to turn to look at you">

<ROOM STORY228
	(DESC "228")
	(STORY TEXT228)
	(EVENTS STORY228-EVENTS)
	(CHOICES CHOICES-SANCTITY)
	(DESTINATIONS <LTABLE <LTABLE STORY625 STORY279>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SANCTITY 8>>)
	(TYPES ONE-ABILITY)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY228-EVENTS ()
	<COND (,RUN-ONCE
		<LOSE-STAMINA 5 ,DIED-FROM-INJURIES ,STORY228>
		<COND (<IS-ALIVE>
			<CRLF>
			<TELL ,TEXT228-CONTINUED>
			<TELL ,PERIOD-CR>
			<TAKE-ITEM ,GOLD-CHAIN-MAIL>
		)>
	)>>

<CONSTANT TEXT229 "The guildmaster welcomes you warmly. He has no further missions for you, though he treats you with respect because you brought Amcha to justice.">

<ROOM STORY229
	(DESC "229")
	(STORY TEXT229)
	(EVENTS STORY229-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

; "TO-DO: Check if player has money invested in guilds (banks), townhouses"
<ROUTINE STORY229-EVENTS ()
	<COND (<L=? ,MONEY 0> <GAIN-MONEY 200>)>>

<CONSTANT TEXT230 "You are caught in a narrow defile, and seized by many men. You are hauled before Captain Vorkung, who sentences you to be hanged. Sentence is carried out immediately.">

<ROOM STORY230
	(DESC "230")
	(STORY TEXT230)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT231 "You notice that the figures have left footprints on the damp grass and cannot, therefore, be ghosts.">
<CONSTANT CHOICES231 <LTABLE "Step out and confront the figures" "Stay hidden and follow when they leave">>

<ROOM STORY231
	(DESC "231")
	(STORY TEXT231)
	(CHOICES CHOICES231)
	(DESTINATIONS <LTABLE STORY023 STORY541>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT232 "The interior of the cave is cool and refreshing, a paradise compared with the savage heat of your gruelling climb. You find a man, floating cross-legged in the middle of the air! He is dressed only in a loincloth, and is painfully thin. His face is shrouded in a great luxuriant growth of glossy black hair, a beard like no other you have ever seen.||At the sight of you, he gives an exasperated sigh. \"I am Damor the Hermit. You know what a hermit is? That means I like to live alone. So go away!\"||\"I nearly died getting here, old man.\"||\"I guess you would have to be pretty tough to get through the curse I put on the path,\" he says apologetically.">
<CONSTANT CHOICES232 <LTABLE HAVE-CODEWORD OTHERWISE>>

<ROOM STORY232
	(DESC "232")
	(VISITS 0)
	(BACKGROUND STORY232-BACKGROUND)
	(STORY TEXT232)
	(CHOICES CHOICES232)
	(DESTINATIONS <LTABLE STORY285 STORY480>)
	(REQUIREMENTS <LTABLE CODEWORD-ANTHEM NONE>)
	(TYPES <LTABLE R-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY232-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY232 1> <RETURN ,STORY151>)>
	<RETURN ,STORY232>>

<CONSTANT TEXT233 "You are on the cobbled road between Yellowport and Trefoille. It is well-kept by the Sokaran military.||You spot a man up ahead, striding towards you. Suddenly, five or six bandits appear from the wayside to assault him. The lone figure executes a series of movements, almost faster than the eye can follow, and you see his sword flashing in the sun. Moments later the bandits are lying dead or dying around him.||You stop to compliment him on his swordsmanship.||The man, a grizzled veteran of many campaigns, regards you with steely grey eyes and says, \"I have learned much of the arts of war in my time, it is true.\"||Impressed by his skill and demeanour, you venture to ask him to teach you some of these arts. He looks you up and down critically.">
<CONSTANT CHOICES233 <LTABLE YOU-ARE-A OTHERWISE>>

<ROOM STORY233
	(DESC "233")
	(VISITS 0)
	(LOCATION LOCATION-SOKARA)
	(BACKGROUND STORY233-BACKGROUND)
	(STORY TEXT233)
	(CHOICES CHOICES233)
	(DESTINATIONS <LTABLE STORY146 STORY567>)
	(REQUIREMENTS <LTABLE PROFESSION-WARRIOR NONE>)
	(TYPES <LTABLE R-PROFESSION R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY233-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY233 1> <RETURN ,STORY412>)>
	<RETURN ,STORY233>>

<CONSTANT TEXT234 "The ship's captain says, \"I'll take you to Dweomer, on the Sorcerers' Isle but it's a dangerous place. You'd better be sure you can handle it -- if you're not at least a master of your profession, I'd advise against. Still, be it on your own head.\"">
<CONSTANT CHOICES234 <LTABLE "If you want to go" "Otherwise, if you are in Marlock City" "Or if you are in Yellowport">>

<ROOM STORY234
	(DESC "234")
	(STORY TEXT234)
	(CHOICES CHOICES234)
	(DESTINATIONS <LTABLE STORY026 STORY142 STORY555>)
	(REQUIREMENTS <LTABLE 30 LOCATION-MARLOCK LOCATION-YELLOWPORT>)
	(TYPES <LTABLE R-MONEY R-LOCATION R-LOCATION>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT235 "The temple of Sig the Cunning, patron of vagabonds, troubadours, lovers, thieves and rogues, is a ramshackle warehouse in the poor quarter. Inside, however, there is so much wealth, it makes you gasp -- the idol of Sig, a saturnine two-faced young human of indistinct sex, is covered in gems. \"As you can see, we have been made rich by generous, er, donations!\" says a black-robed priest.">
<CONSTANT CHOICES235 <LTABLE "Seek an audience with the high priest" TEXT-BECOME-INITIATE TEXT-RENOUNCE-WORSHIP TEXT-SEEK-BLESSING TEXT-LEAVE-TEMPLE>>

<ROOM STORY235
	(DESC "235")
	(STORY TEXT235)
	(CHOICES CHOICES235)
	(DESTINATIONS <LTABLE STORY113 STORY437 STORY563 STORY197 STORY100>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT236 "You find Fourze inside, desperately trying to get out of his suit and run off. At the sight of a hardened adventurer rather than a timid villager, he surrenders and confesses all. He terrified people with the monster disguise to keep them away from the farm. He and his men were kidnapping villagers, chaining them in the cellar below and selling them to a slaver from Caran Baru, for work in the slave mines. You find Haylie and several other villagers down below in the cellar.||\"Don't hurt me,\" begs Fourze, \"I'm only trying to make a few Shards.\"||\"By selling your own people into slavery,\" says one of the villagers, giving him a good kick.||You lead them back to Venefax.">

<ROOM STORY236
	(DESC "236")
	(STORY TEXT236)
	(CONTINUE STORY414)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT237 "You explain what a tree-lover you are, and that your heart has always been at home in forests. You portray yourself as the greenest adventurer ever.">

<ROOM STORY237
	(DESC "237")
	(STORY TEXT237)
	(EVENTS STORY237-EVENTS)
	(CHOICES CHOICES-CHARISMA)
	(DESTINATIONS <LTABLE <LTABLE STORY391 STORY410>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-CHARISMA 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY237-EVENTS ("AUX" (DIFFICULTY 0))
	<RESET-DIFFICULTY ,STORY237 1 10>
	<SET DIFFICULTY <GET-DIFFICULTY ,STORY237 1>>
	<COND (<CHECK-PROFESSION ,PROFESSION-WAYFARER> <SET DIFFICULTY <- .DIFFICULTY 3>>)>
	<COND (<CHECK-GOD ,GOD-LACUNA> <DEC .DIFFICULTY>)>
	<RESET-DIFFICULTY ,STORY237 1 .DIFFICULTY>>

<CONSTANT TEXT238 "The vile-looking creature shoots toward you with a terrifying predatory speed. You have no choice but to fight it. You will fight at -2 COMBAT score for this fight, as you are unused to fighting underwater.">

<ROOM STORY238
	(DESC "238")
	(STORY TEXT238)
	(EVENTS STORY238-EVENTS)
	(CONTINUE STORY053)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY238-EVENTS ()
	<AFFLICTED-WITH ,DISADVANTAGE-COMBAT2>
	<COMBAT-MONSTER ,MONSTER-REPULSIVE-ONE 5 10 10>
	<CHECK-COMBAT ,MONSTER-REPULSIVE-ONE ,STORY238>
	<COND (<IS-ALIVE> <REMOVE ,DISADVANTAGE-COMBAT2>)>>

<CONSTANT TEXT239 "The climb is long and hard, but at last you heave yourself up on to the top of Devil's Peak -- a flat expanse of weathered black rock.">
<CONSTANT CHOICES239 <LTABLE HAVE-CODEWORD OTHERWISE>>

<ROOM STORY239
	(DESC "239")
	(STORY TEXT239)
	(CHOICES CHOICES239)
	(DESTINATIONS <LTABLE STORY126 STORY199>)
	(REQUIREMENTS <LTABLE CODEWORD-ALTITUDE NONE>)
	(TYPES <LTABLE R-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT240 "You sail into the teeming harbour of Marlock City. Sokaran warships escort you in.||\"Troubled times,\" comments a sailor.">

<ROOM STORY240
	(DESC "240")
	(STORY TEXT240)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT241 "To renounce the worship of Elnir, you must pay 40 Shards to the priesthood by way of compensation. The high priest says nothing -- he merely regards you with a mild contempt, as if he expected you to fail in the worship of Elnir. Do you want to change your mind?">

<ROOM STORY241
	(DESC "241")
	(STORY TEXT241)
	(EVENTS STORY241-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY241-EVENTS ()
	<RENOUNCE-WORSHIP 40 ,GOD-ELNIR>>

<CONSTANT TEXT242 "You fight the Sokarans to a standstill. The Sokaran captain orders the retreat; he and his marines pull back to their galley. You and your crew are too tired to pursue, and the Sokarans pull away.||\"I'll get you next time!\" yells the captain.||You sail on.">

<ROOM STORY242
	(DESC "242")
	(STORY TEXT242)
	(CONTINUE STORY439)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT243 "You cannot find any hidden panels -- but after all, Lauria did say that the real treasure was upstairs. You call to her, but she doesn't reply.">
<CONSTANT CHOICES243 <LTABLE "Go upstairs" "Wait downstairs">>

<ROOM STORY243
	(DESC "243")
	(STORY TEXT243)
	(CHOICES CHOICES243)
	(DESTINATIONS <LTABLE STORY386 STORY534>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT244 "You have come to the foothills of the Spine of Harkun. The great mountains rise up majestically before you, their snowcapped peaks wreathed in clouds. You find a clear, cold stream, where you drink your fill and replenish your water supply.">
<CONSTANT CHOICES244 <LTABLE "Climb upwards" "Head south" "Head east to Disaster Bay" "West to the citadel">>

<ROOM STORY244
	(DESC "244")
	(STORY TEXT244)
	(CHOICES CHOICES244)
	(DESTINATIONS <LTABLE STORY536 STORY518 STORY495 STORY271>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT245 "The footprints cross a stream, and there you lose them. After an hour's fruitless searching by moonlight, you are forced to give up and go back to the village. There you are admonished for being reckless.||\"What if the ghosts had taken you with them back to their graves?\" says one man grimly.||The next day you are ready to resume your journey.">
<CONSTANT CHOICES245 <LTABLE "Follow the river north" "Follow the river south" "East into the countryside" "West to the main road">>

<ROOM STORY245
	(DESC "245")
	(STORY TEXT245)
	(CHOICES CHOICES245)
	(DESTINATIONS <LTABLE STORY576 STORY082 STORY278 STORY558>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT246 "Have you already successfully stolen the gold chain mail of Tyrnai for the Temple of Sig?">
<CONSTANT CHOICES246 <LTABLE "Yes" "Not yet">>

<ROOM STORY246
	(DESC "246")
	(STORY TEXT246)
	(CHOICES CHOICES246)
	(DESTINATIONS <LTABLE STORY467 STORY728>)
	(REQUIREMENTS <LTABLE GOLD-CHAIN-MAIL NONE>)
	(TYPES <LTABLE R-ITEM R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT247 "The sound was the click of a secret door sliding open in the wall of the cavern. With a swift motion, you step up beside it, back to the wall. A figure emerges but you are able to ambush the ambusher. A sharp blow to the back of the head sends the dark figure crashing to the ground.||Another steps forth, however, shouting in a guttural voice. You realize the figures are ratmen -- manlike creatures that stand on two legs, but which have the tail and hairy features of a gigantic rat.">

<ROOM STORY247
	(DESC "247")
	(STORY TEXT247)
	(EVENTS STORY247-EVENTS)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY247-EVENTS ("AUX" (MODIFIER 0))
	<COND (<CHECK-ITEM ,RAT-POISON>
		<CRLF>
		<TELL "Use the rat poison?">
		<COND (<YES?>
			<SET MODIFIER 3>
			<EMPHASIZE "The rat poison adds +3 to your COMBAT rolls.">
			<REMOVE-ITEM ,RAT-POISON "used" T T>
		)>
	)>
	<COMBAT-MONSTER ,MONSTER-TWO-RATMEN 3 6 6>
	<COND (<CHECK-COMBAT ,MONSTER-RATMAN ,STORY247 .MODIFIER>
		<STORY-JUMP ,STORY423>
	)(ELSE
		<STORY-JUMP ,STORY308>
	)>>

<ROOM STORY248
	(DESC "248")
	(BACKGROUND STORY248-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY248-BACKGROUND ()
	<COND (<CHECK-ITEM ,WILLOW-STAFF> <RETURN ,STORY319>)>
	<RETURN ,STORY727>>

<CONSTANT TEXT249 "The first mate advises against steering a course to Nerech. \"That land is ringed with reefs that would smash our hull like an egg, Cap'n, and once ashore we'd have to contend with the savage manbeasts. I'm not sure if the crew will stand for it.\"">

<ROOM STORY249
	(DESC "249")
	(STORY TEXT249)
	(CHOICES CHOICES-NERECH)
	(DESTINATIONS <LTABLE STORY-PLAINS-HOWLING-DARKNESS <LTABLE STORY-PLAINS-HOWLING-DARKNESS STORY209> STORY209>)
	(REQUIREMENTS STORY-TEST-SAILING)
	(TYPES TYPE-SAIL)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT250 "The city of Trefoille is a terrifying vision of apocalyptic destruction. It had once been a thriving crossroads town, but now it is a burnt-out hulk. It was almost razed to the ground when it declared for the king, and tried to hold out against the army of Grieve Marlock during the recent civil war. It was sacked by the general's mercenaries. General Marlock is now trying to rebuild it. Craftsmen are hard at work everywhere.||There is nothing here but ashes and rubble.">
<CONSTANT CHOICES250 <LTABLE "Visit Oliphard the Wizardly" "Take the road to the Shadar Tor" TEXT-TO-MARLOCK "Head into the Curstmoor" "Take the road north" "Take the road to Yellowport">>

<ROOM STORY250
	(DESC "250")
	(LOCATION LOCATION-TREFOILLE)
	(STORY TEXT250)
	(CHOICES CHOICES250)
	(DESTINATIONS <LTABLE STORY656 STORY602 STORY377 STORY175 STORY558 STORY233>)
	(REQUIREMENTS <LTABLE CODEWORD-AMENDS NONE NONE NONE NONE NONE>)
	(TYPES <LTABLE R-CODEWORD R-NONE R-NONE R-NONE R-NONE R-NONE>)
	(FLAGS LIGHTBIT)>

<ROOM STORY251
	(DESC "251")
	(BACKGROUND STORY251-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY251-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-AVENGE> <RETURN ,STORY622>)>
	<RETURN ,STORY726>>

<CONSTANT TEXT251 "You lead them a merry chase through the backstreets of Yellowport but unfortunately for you, you run smack dab into another patrol. You are captured and thrown into the dungeons to await your fate but not before the militiamen take all your money and possessions.">

<ROOM STORY252
	(DESC "252")
	(STORY TEXT251)
	(EVENTS STORY-LOSE-EVERYTHING)
	(CONTINUE STORY454)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT253 "To renounce the worship of Lacuna, you must pass an ordeal of judgment. This entails the high priestess throwing several silver daggers at you, while you remain motionless.||\"If Lacuna sees it in her heart to forgive you, the daggers will all miss,\" she claims.">
<CONSTANT CHOICES253 <LTABLE "Submit to the ordeal" "Remain an initiate after all">>

<ROOM STORY253
	(DESC "253")
	(STORY TEXT253)
	(CHOICES CHOICES253)
	(DESTINATIONS <LTABLE STORY313 STORY615>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT254 "You ask for a kiss. \"A kiss is not so easily won,\" says one of the merfolk. \"Tell us a tale to stir our hearts, then we may reward you.\"">

<ROOM STORY254
	(DESC "254")
	(STORY TEXT254)
	(CHOICES CHOICES-CHARISMA)
	(DESTINATIONS <LTABLE <LTABLE STORY012 STORY281>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-CHARISMA 9>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT255 "The provost marshal takes you to an empty side chamber, away from prying ears. Over a glass of fine wine you tell him of your adventures in the Coldbleak Mountains. When you give him the Royal Ring of the House of Corin, he knows that Nergan is dead.||Marloes Marlock is pleased indeed. He pays you 500 Shards, and awards you the title Protector of Sokara.||Also, after completing such a difficult test, you find the experience has taught you much.">

<ROOM STORY255
	(DESC "255")
	(STORY TEXT255)
	(EVENTS STORY255-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY255-EVENTS ()
	<RETURN-ITEM ,ROYAL-RING T>
	<GAIN-MONEY 500>
	<GAIN-TITLE ,TITLE-PROTECTOR-SOKARA>
	<GAIN-RANK 1>
	<UPGRADE-STAMINA <ROLL-DICE 1>>>

<CONSTANT TEXT256 "The king is overjoyed with the news. \"Excellent! At this rate, I will soon be able to take my rightful place in the throne room of Old Sokar.\"||He rewards you with the title King's Champion. The title comes with a cash gift of 500 Shards as well.||The king has another mission for you. He explains that an army of steppe nomads, trau, mannekyn people, and Sokaran troops still loyal to Nergan, have gathered on the steppes and are moving to besiege the Citadel of Velis Corin, which guards the Pass of Eagles through the Spine of Harkun. Nergan tells you that an alliance of northern nations has declared war on the new Sokaran regime. A certain General Beladai leads the Northern Alliance, and King Nergan has joined forces with him. He asks you to travel to the Steppes and talk to General Beladai.||\"An adventurer like yourself might be able to steal into the citadel, and bring about its downfall from within, or some such. If the citadel falls, we will have Sokara at our mercy.\"">
<CONSTANT CHOICES256 <LTABLE "Take up the mission" "Go back down to the foothills of the mountains">>

<ROOM STORY256
	(DESC "256")
	(STORY TEXT256)
	(EVENTS STORY256-EVENTS)
	(CHOICES CHOICES256)
	(DESTINATIONS <LTABLE STORY474 STORY474>)
	(REQUIREMENTS <LTABLE MISSION-CITADEL-VELIS NONE>)
	(TYPES <LTABLE R-TAKE-MISSION R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY256-EVENTS ()
	<COND (,RUN-ONCE
		<GAIN-MONEY 500>
		<GAIN-TITLE ,TITLE-KINGS-CHAMPION>
		<GAIN-RANK 1>
		<UPGRADE-STAMINA <ROLL-DICE 1>>
	)>>

<CONSTANT TEXT257 "The trees are closely packed, leaning together as if in conference, whispering quietly among themselves. Birds twitter in the distance, and slivers of sunlight lance down through the musty gloom.||As you proceed along a forest track, you think you hear a rustling in the bushes. Later, you spot a shadowy figure darting through the trees -- or was it your imagination? An animal snuffling sound right behind you makes you spin around, but there is nothing there.">

<ROOM STORY257
	(DESC "257")
	(STORY TEXT257)
	(CHOICES CHOICES-SCOUTING)
	(DESTINATIONS <LTABLE <LTABLE STORY630 STORY036>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT258 "Becoming an initiate of the Three Fortunes gives you the benefit of paying less for blessings and other services the temple can offer. It costs 75 Shards. You cannot already be an initiate of another temple.">

<ROOM STORY258
	(DESC "258")
	(STORY TEXT258)
	(EVENTS STORY258-EVENTS)
	(CONTINUE STORY086)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY258-EVENTS ()
	<BECOME-INITIATE 75 ,GOD-THREE-FORTUNES>>

<CONSTANT TEXT259 "Fort Brilon, named after a Sokaran king of the first dynasty, is the southernmost castle on the fortified wall that keeps out the rabid manbeasts.||What the soldiers fear most is what they call 'Death Duty' -- going out on patrols beyond the wall, into Nerech itself.">
<CONSTANT CHOICES259 <LTABLE "East into Nerech (The Plains of Howling Darkness)" "North west to Fort Estgard" "West into the farmlands" "South to Blessed Springs">>
<CONSTANT TEXT259-THIEF "The thief steals one item from you.">

<ROOM STORY259
	(DESC "259")
	(LOCATION LOCATION-BRILON)
	(STORY TEXT259)
	(EVENTS STORY259-EVENTS)
	(CHOICES CHOICES259)
	(DESTINATIONS <LTABLE STORY-PLAINS-HOWLING-DARKNESS STORY472 STORY548 STORY466>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY259-EVENTS ("AUX" ROLL COUNT)
	<COND (,RUN-ONCE
		<SET ROLL <RANDOM-EVENT 1>>
		<COND (<L=? .ROLL 2>
			<EMPHASIZE ,TEXT259-THIEF>
			<SET COUNT <COUNT-POSSESSIONS>>
			<COND (<L=? .COUNT 1>
				<LOSE-ITEM <GET-ITEM 1 ,PLAYER>>
			)(ELSE
				<DEC .COUNT>
				<LOSE-STUFF ,PLAYER ,LOST-STUFF "item" .COUNT ,RESET-POSSESSIONS>
			)>
		)(<L=? .ROLL 4>
			<EMPHASIZE ,NOTHING-HAPPENS>
		)(ELSE
			<TAKE-ITEM ,MANBEASTS-HELMET>
		)>
	)>>

<CONSTANT TEXT260 "You are shocked to find that you cannot damage the tomb guardian at all. You have no choice but to run for the door.">
<CONSTANT TEXT260-CONTINUED "You make it back out into the Forest.">
<CONSTANT TEXT260-END "The whirlwind guardian catches you, and buffets you against the stone walls until you are dead.">

<ROOM STORY260
	(DESC "260")
	(STORY TEXT260)
	(EVENTS STORY260-EVENTS)
	(CONTINUE STORY047)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY260-EVENTS ("AUX" ROLL (RANK 1))
	<SET ROLL <RANDOM-EVENT 1 0 T>>
	<SET RANK <GET-RANK ,CURRENT-CHARACTER>>
	<COND (<L=? .ROLL .RANK>
		<PREVENT-DOOM ,STORY260>
		<EMPHASIZE ,TEXT260-CONTINUED>
	)(ELSE
		<EMPHASIZE ,TEXT260-END>
	)>>

<CONSTANT TEXT261 "To renounce the worship of Maka, you must pay 15 Shards to the priesthood by way of compensation.||A man lying on a pallet groans, \"I renounced the goddess, and look at me now...\"||He is ravaged by disease. Do you want to change your mind?">

<ROOM STORY261
	(DESC "261")
	(STORY TEXT261)
	(EVENTS STORY261-EVENTS)
	(CONTINUE STORY141)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY261-EVENTS ()
	<RENOUNCE-WORSHIP 15 ,GOD-MAKA>>

<CONSTANT TEXT262 "You charge into the burning building in search of the child's mother. You see her lying unconscious at the bottom of the stairs. Desperately, you try to get to her but a burning beam has fallen across your way and the smoke is making you choke.">

<ROOM STORY262
	(DESC "262")
	(STORY TEXT262)
	(EVENTS STORY262-EVENTS)
	(CONTINUE STORY133)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY262-EVENTS ()
	<STORY-ROLL-RANK ,STORY546>>

<CONSTANT TEXT263 "You are passing through a wooded glade when you hear a horrendous trumpeting noise. Suddenly, a massive bear-like form about the size of a large bull appears in front of you. It looks rather like a huge hairy toad, with a gaping, toothy mouth.||The creature breathes a billowing cloud of noxious, sulphurous gas at you.||You feel your head swim as you start to fall asleep.">

<ROOM STORY263
	(DESC "263")
	(STORY TEXT263)
	(EVENTS STORY263-EVENTS)
	(CONTINUE STORY072)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY263-EVENTS ()
	<STORY-ROLL-RANK ,STORY491>>

<CONSTANT TEXT264 "A large island made of reeds and plants, which grow out of a massive floating bed of kelp, drifts aimlessly across the waters. As you draw near, you see that a number of people have made their home there. The inhabitants hail you and invite you ashore.">

<ROOM STORY264
	(DESC "264")
	(VISITS 0)
	(BACKGROUND STORY264-BACKGROUND)
	(STORY TEXT264)
	(CONTINUE STORY537)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY264-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY264 1> <RETURN ,STORY131>)>
	<RETURN ,STORY264>>

<ROOM STORY265
	(DESC "265")
	(BACKGROUND STORY265-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY265-BACKGROUND ()
	<COND (<CHECK-TITLE ,TITLE-UNSPEAKABLE-CULTIST> <RETURN ,STORY404>)>
	<RETURN ,STORY725>>

<CONSTANT TEXT266 "\"You rebel swine,\" slurs one of them.||\"Not showing proper respect to the army,\" says another. \"That can't go unpunished.\"||They wade into you, intent on beating you into submission.">

<ROOM STORY266
	(DESC "266")
	(STORY TEXT266)
	(CHOICES CHOICES-COMBAT)
	(DESTINATIONS <LTABLE <LTABLE STORY076 STORY498>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-COMBAT 12>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT267 "You row out on to the lake, spread the net, and wait to see what happens.||After an hour or so, a great bubbling and frothing of the waves disturbs your solitude. A massive scaly head, the size of your boat, erupts out of the ochre-coloured water on the end of a long, sinuous neck. Great luminous green eyes look down at you. The creature is covered in brown scales, with a bright red crest running from the head down its thick, ropy neck.||\"I am Vayss the Sea Dragon,\" it says in a rich, creamy voice tinged with evil greed. \"To fish in my lake, you have to pay tribute -- to wit, one silver nugget. Pay now, or face my wrath.\"">
<CONSTANT CHOICES267 <LTABLE "Hand over a silver nugget" "Unable or refuse to pay">>

<ROOM STORY267
	(DESC "267")
	(STORY TEXT267)
	(CHOICES CHOICES267)
	(DESTINATIONS <LTABLE STORY505 STORY582>)
	(REQUIREMENTS <LTABLE SILVER-NUGGET NONE>)
	(TYPES <LTABLE R-LOSE-ITEM R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT268 "The goblin-folk swarm over you. You try to put up a fight, but there are too many of them. Everything goes black...||You wake up, spluttering, face down on a beach. A wave has just soaked you.||\"Going for a swim, are we?\" asks an old woman who is gathering shells on the beach. You learn from her that a month has passed since your adventure in the faerie mound. You can remember none of it.||You realize you have lost all the money and items you were carrying. Instead, you have a wolf pelt that you are wearing, some rat poison and a silver nugget. The old lady tells you that you are on the delta of the River Grimm.">

<ROOM STORY268
	(DESC "268")
	(LOCATION LOCATION-GRIMM)
	(STORY TEXT268)
	(EVENTS STORY268-EVENTS)
	(CONTINUE STORY579)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY268-EVENTS ()
	<SETG STAMINA ,MAX-STAMINA>
	<STORY-LOSE-EVERYTHING>
	<TAKE-ITEM ,WOLF-PELT>
	<TAKE-ITEM ,RAT-POISON>
	<TAKE-ITEM ,SILVER-NUGGET>
	<UPDATE-STATUS-LINE>>

<CONSTANT TEXT269 "You find a natural alcove in the wall of a tunnel. Desperately, you squeeze yourself into it, and fade into the shadows. The ratmen come bundling past, whooping and yelling. None of them spot you, and once they have gone you step out, smiling to yourself.">

<ROOM STORY269
	(DESC "269")
	(STORY TEXT269)
	(CONTINUE STORY580)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT270 "You make a swift inspection of the casements, walls and furnishings, searching for secret panels where treasure might be concealed.">

<ROOM STORY270
	(DESC "270")
	(STORY TEXT270)
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE <LTABLE STORY059 STORY243>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 12>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT271 "You arrive at the Pass of Eagles, a thin chasm sliced right through the Spine of Harkun, as if Tyrnai himself had split the mountains with his sword.||A vast citadel has been built right across the southern end of the pass, bottling it up, so that none can travel into Sokara without passing through the castle. Its white walls and flag-topped towers shine brightly in the sunlight.">
<CONSTANT CHOICES271 <LTABLE "Enter the citadel (The Plains of Howling Darkness)" "Go to the western foothills" "The eastern foothills" "South on the road to Caran Baru" "Take the road to Fort Mereth">>

<ROOM STORY271
	(DESC "271")
	(LOCATION LOCATION-EAGLES)
	(STORY TEXT271)
	(CHOICES CHOICES271)
	(DESTINATIONS <LTABLE STORY-PLAINS-HOWLING-DARKNESS STORY003 STORY244 STORY201 STORY518>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM STORY272
	(DESC "272")
	(BACKGROUND STORY272-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY272-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-ALOFT> <RETURN ,STORY649>)>
	<RETURN ,STORY724>>

<CONSTANT TEXT273 "You find the city is in turmoil. A rebel group, loyal to the old king, led an uprising against the army. Vicious fighting ensued and the streets ran with blood before the rebellion was brutally put down. Unfortunately, much damage was done during the battle.">
<CONSTANT CHOICES273 <LTABLE HAVE-THE IF-NOT>>

<ROOM STORY273
	(DESC "273")
	(STORY TEXT273)
	(EVENTS STORY273-EVENTS)
	(CHOICES CHOICES273)
	(DESTINATIONS <LTABLE STORY040 STORY010>)
	(REQUIREMENTS <LTABLE <LTABLE CODEWORD-ARTIFACT BOOK-SEVEN-SAGES> NONE>)
	(TYPES <LTABLE R-CODEWORD-ITEM R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY273-EVENTS ()
	<COND (<CHECK-CODEWORD ,CODEWORD-ABIDE>
		<EMPHASIZE "Your townhouse has been looted; any possessions you may have cached there have gone.">
		<RESET-CONTAINER ,TOWNHOUSE-YELLOWPORT>
	)>>

<CONSTANT TEXT274 "Desperately, you try to sneak behind a pile of coins but the dragon spots you. \"A sneaky little thief, eh? Can't have that, oh no,\" hisses the dragon, and it breathes a cloud of billowing acidic gas all over you. You watch in horror as the coins in front of you begin to melt, and then the cloud engulfs you.">
<CONSTANT CHOICES274 <LTABLE HAVE-AN IF-NOT>>

<ROOM STORY274
	(DESC "274")
	(STORY TEXT274)
	(CHOICES CHOICES274)
	(DESTINATIONS <LTABLE STORY298 STORY212>)
	(REQUIREMENTS <LTABLE AMULET-OF-PROTECTION NONE>)
	(TYPES <LTABLE R-ITEM R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT275 "If you are an initiate it costs only 5 Shards to propitiate the twin gods of the sea. A non-initiate must pay 20 Shards. The blessing works by allowing you to ignore any one storm at sea. You can only have one Safety from Storms blessing at any one time. Once it is used up, you can return to any branch of the temple of Alvir and Valmir to buy a new one.">

<ROOM STORY275
	(DESC "275")
	(STORY TEXT275)
	(EVENTS STORY275-EVENTS)
	(CONTINUE STORY154)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY275-EVENTS ()
	<PURCHASE-BLESSING 20 5 ,GOD-ALVIR-VALMIR ,BLESSING-SAFETY-FROM-STORMS>>

<CONSTANT TEXT276 "You are wandering across the wilderness of north-western Sokara. There is a magnificent castle nearby, with many different pennants flying from its towers.">
<CONSTANT CHOICES276 <LTABLE "Visit the castle" "Head west to the River Grimm" "Travel north to the mountains" "Head north-east" "Head east into the Bronze Hills" "Go south into the Forest of Larun">>

<ROOM STORY276
	(DESC "276")
	(LOCATION LOCATION-SOKARA)
	(STORY TEXT276)
	(CHOICES CHOICES276)
	(DESTINATIONS <LTABLE STORY611 STORY123 STORY003 STORY201 STORY110 STORY047>)
	(TYPES SIX-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT277 "A patrol of militiamen -- mercenaries in the pay of the dictator, General Grieve Marlock -- stop you in the street.">
<CONSTANT CHOICES277 <LTABLE HAVE-CODEWORD YOU-ARE-A OTHERWISE>>

<ROOM STORY277
	(DESC "277")
	(STORY TEXT277)
	(CHOICES CHOICES277)
	(DESTINATIONS <LTABLE STORY221 STORY722 STORY723>)
	(REQUIREMENTS <LTABLE CODEWORD-ASSASSIN TITLE-PROTECTOR-SOKARA NONE>)
	(TYPES <LTABLE R-CODEWORD R-TITLE R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT278 "You are crossing an open expanse of flinty ground. A few herds of sheep roam the low hills.">
<CONSTANT CHOICES278 <LTABLE "To Venefax" "West to the Stinking River" "North to the lake" "East">>

<ROOM STORY278
	(DESC "278")
	(STORY TEXT278)
	(EVENTS STORY278-EVENTS)
	(CHOICES CHOICES278)
	(DESTINATIONS <LTABLE STORY427 STORY310 STORY135 STORY087>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY278-EVENTS ("AUX" ROLL)
	<COND (,RUN-ONCE
		<SET ROLL <RANDOM-EVENT 1 0 T>>
		<COND (<L=? .ROLL 2>
			<EMPHASIZE "You got lost">
			<STORY-JUMP ,STORY082>
			<RETURN>
		)(<L=? .ROLL 4>
			<EMPHASIZE ,NOTHING-HAPPENS>
		)(ELSE
			<EMPHASIZE "A shepherd gives you a wolf pelt.">
			<TAKE-ITEM ,WOLF-PELT>
		)>
	)>
	<CRLF>
	<TELL ,TEXT-YOU-CAN-GO>
	<CRLF>>

<CONSTANT TEXT279 "What you have just done is probably sacrilege, desecrating the Temple of Tyrnai, but you don't care. You sneak out of the temple unseen, and head back to town with your prize. Who else could have stolen a holy relic from right under the noses of the warrior priests of Tyrnai?">

<ROOM STORY279
	(DESC "279")
	(STORY TEXT279)
	(CONTINUE STORY400)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT280 "There are too many wolves to contend with. You withdraw before they get angry.">

<ROOM STORY280
	(DESC "280")
	(STORY TEXT280)
	(CONTINUE STORY003)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT281 "Your tale of valour and derring-do falls on an unappreciative audience. The merfolk slip beneath the waves with snorts of derision, leaving you alone on the desolate beach. There is nothing for you to do but return to the clifftop tor.">
<CONSTANT CHOICES281 <LTABLE TEXT-TO-TREFOILLE TEXT-TO-MARLOCK>>

<ROOM STORY281
	(DESC "281")
	(STORY TEXT281)
	(CHOICES CHOICES281)
	(DESTINATIONS <LTABLE STORY602 STORY166>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT282 "The Temple of Tyrnai, the God of Battle, Chaos and Strife, is built like a small fortress in one corner of the city, near the barracks. Its heavy wooden gates are flanked by iron statues of bull-headed men wielding clubs. The workmanship is uncannily lifelike. Inside the temple, the god is represented by a stone idol of a jaguar-headed warrior. A beautiful suit of gold chain mail adorns the idol.">
<CONSTANT CHOICES282 <LTABLE TEXT-BECOME-INITIATE TEXT-RENOUNCE-WORSHIP TEXT-SEEK-BLESSING TEXT-RESURRECTION-ARRANGEMENTS TEXT-LEAVE-TEMPLE>>

<ROOM STORY282
	(DESC "282")
	(BACKGROUND STORY282-BACKGROUND)
	(STORY TEXT282)
	(CHOICES CHOICES282)
	(DESTINATIONS <LTABLE STORY636 STORY514 STORY107 STORY033 STORY400>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY282-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-ARMOUR> <RETURN ,STORY246>)>
	<RETURN ,STORY282>>

<CONSTANT TEXT283 "\"What goes on here?\" you ask. \"Why do you behave so oddly?||The villagers seem quite frightened of you, but one old fellow has nerve enough to reply. \"This banquet is for the ghosts of three travellers who lost their way in a storm, fell into our millpond and were drowned.\"||\"When was this?\" you ask.||\"Seven years since. They come every year on this night, and if we didn't placate them with victuals and treasure there'd be a mess of trouble.\"||\"How do you know that?\"||\"Old Megan told us,\" he says. \"She knows about such things.\"">
<CONSTANT CHOICES283 <LTABLE "Stay out at night and watch for the ghosts" "Follow the river north" "Follow the river south" "Head east into the countryside" "Go west to the main road">>

<ROOM STORY283
	(DESC "283")
	(STORY TEXT283)
	(CHOICES CHOICES283)
	(DESTINATIONS <LTABLE STORY590 STORY576 STORY082 STORY278 STORY558>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT284 "You find an open window and squeeze through into a long hall. Your foot, however, snags on a thin wire stretched across the floor. The wire triggers a loud bell-like gonging that alerts the temple. You have little choice but to run for your life as warrior priests swarm out of the temple and the iron statues at its gates come to life to join in the chase.">

<ROOM STORY284
	(DESC "284")
	(STORY TEXT284)
	(EVENTS STORY284-EVENTS)
	(CONTINUE STORY551)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY284-EVENTS ()
	<STORY-ROLL-RANK ,STORY395>>

<CONSTANT TEXT285 "You mention how a bard in a tavern told you about Damor the Hermit, and that he knew the secret of the Greatest Story Ever Told.||\"Ah,\" says Damor. \"I have waited for one  such as you.\" He tells you the secret of the Greatest Story. \"Well, young adventurer, destiny beckons, for it is fated that your life will be the Greatest Story Ever Told.\"||As you consider this, you feel a sense of momentary enlightenment.||\"Right, that's that,\" says Damor. \"Now, go away and don't come back.\"||For a few hours, he lifts the curse that soured your water so you can make it down again safely.">

<ROOM STORY285
	(DESC "285")
	(STORY TEXT285)
	(EVENTS STORY285-EVENTS)
	(CONTINUE STORY244)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY285-EVENTS ()
	<UPGRADE-STAMINA <ROLL-DICE 1>>>

<CONSTANT TEXT286 "When you and your crew join the fray, the battle is short lived. The pirates are overpowered, though they fight to the last man, preferring death to enslavement or execution. The Sokaran leader, an admiral in the navy, thanks you gravely for your help. He rewards you with a share of the pirate's booty. You get 400 Shards and 1 Cargo Unit of spices, if you have room for it in your ship's hold.">
<CONSTANT TEXT286-CONTINUED "You sail on">

<ROOM STORY286
	(DESC "286")
	(STORY TEXT286)
	(EVENTS STORY286-EVENTS)
	(CONTINUE STORY420)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY286-EVENTS ()
	<GAIN-MONEY 400>
	<STORY-GAIN-CARGO ,CARGO-SPICES>>

<CONSTANT TEXT287 "You wait for an hour. At dusk, something emerges. It is the gorlock, a beast with legs like a bird, a body like a reptile, with two short forelimbs and a beaked, lizard-like head. You see that its two legs do have backward-pointing feet. The beast heads off into the hills, and you creep forward.">

<ROOM STORY287
	(DESC "287")
	(STORY TEXT287)
	(CONTINUE STORY315)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT288 "You end up dead in an alleyway with your throat cut.">

<ROOM STORY288
	(DESC "288")
	(STORY TEXT288)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT289 "There is a pause, as if you are both waiting for something to happen. You realize the gods have not heard your prayer. You adversary realizes it too. It snarls triumphantly and slashes you across the chest.">

<ROOM STORY289
	(DESC "289")
	(STORY TEXT289)
	(EVENTS STORY289-EVENTS)
	(CONTINUE STORY617)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY289-EVENTS ()
	<LOSE-STAMINA 2 ,DIED-FROM-INJURIES ,STORY289>>

<CONSTANT CHOICES290 <LTABLE HAVE-CODEWORD HAVE-CODEWORD OTHERWISE>>

<ROOM STORY290
	(DESC "290")
	(CHOICES CHOICES290)
	(DESTINATIONS <LTABLE STORY403 STORY512 STORY721>)
	(REQUIREMENTS <LTABLE CODEWORD-CUTLASS CODEWORD-AMCHA NONE>)
	(TYPES <LTABLE R-CODEWORD R-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<ROOM STORY291
	(DESC "291")
	(STORY TEXT-INITIATE-ELNIR)
	(EVENTS STORY291-EVENTS)
	(CONTINUE STORY316)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY291-EVENTS ()
	<BECOME-INITIATE 60 ,GOD-ELNIR>>

<CONSTANT TEXT292 "The local market is very small -- only two commodities are available for trade.">
<CONSTANT CHOICES292 <LTABLE "Buy items" "Sell items" "Leave the market">>

<ROOM STORY292
	(DESC "292")
	(STORY TEXT292)
	(CHOICES CHOICES292)
	(DESTINATIONS <LTABLE LOCAL-MARKET-BUY LOCAL-MARKET-SELL STORY135>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT293 "The merchantman has suffered a lot of damage, and the remaining crewmen are half dead with thirst. You give them water and help to repair the ship. The captain, a woman dressed in multi-coloured feather robes and an ornate headdress, is most grateful. She tells you her name is Moon of Evening and that she comes from Smogmaw, the city at the Misty Estuary, in far off Ankon-konu. She tells you to visit her, if you are ever in Smogmaw, so that she can repay the debt.||You sail on.">

<ROOM STORY293
	(DESC "293")
	(STORY TEXT293)
	(CONTINUE STORY559)
	(CODEWORDS <LTABLE CODEWORD-AID>)
	(FLAGS LIGHTBIT)>

<ROOM STORY294
	(DESC "294")
	(STORY TEXT-INITIATE-ALMIR-VALMIR)
	(EVENTS STORY294-EVENTS)
	(CONTINUE STORY220)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY294-EVENTS ()
	<BECOME-INITIATE 40 ,GOD-ALVIR-VALMIR>>

<CONSTANT TEXT295 "The scorpion men cannot keep up with you, and you leg it all the way back to the road. Maybe you can come back and try again later.">

<ROOM STORY295
	(DESC "295")
	(STORY TEXT295)
	(CONTINUE STORY492)
	(FLAGS LIGHTBIT)>

<ROOM STORY296
	(DESC "296")
	(CHOICES CHOICES-MAGIC)
	(DESTINATIONS <LTABLE <LTABLE STORY494 STORY352>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-MAGIC 9>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<ROOM STORY297
	(DESC "297")
	(EVENTS STORY297-EVENTS)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY297-EVENTS ("AUX" ROLL (MONSTER NONE))
	<SET ROLL <RANDOM-EVENT 1 0 T>>
	<COND (<L=? .ROLL 2>
		<SET MONSTER ,MONSTER-BLUE-DRAGON>
		<COMBAT-MONSTER .MONSTER 3 8 6>
	)(<L=? .ROLL 4>
		<SET MONSTER ,MONSTER-GREEN-DRAGON>
		<COMBAT-MONSTER .MONSTER 4 8 8>
	)(ELSE
		<SET MONSTER ,MONSTER-RED-DRAGON>
		<COMBAT-MONSTER .MONSTER 5 8 10>
	)>
	<COND (<CHECK-COMBAT .MONSTER ,STORY297>
		<STORY-JUMP ,STORY019>
	)(ELSE
		<EMPHASIZE "You pass out.">
		<STORY-JUMP ,STORY370>
	)>>

<CONSTANT TEXT298 "The amulet of protection dissolves in a flash of smoke.||Even so it does protect you, and you are obscured by the smoke long enough to get into hiding. The amulet leaves a residue of yellow powder, which the dragon thinks is all that is left of you. He scoops it up and puts it into a bottle, beside the others on his rocky shelf.">

<ROOM STORY298
	(DESC "298")
	(STORY TEXT298)
	(EVENTS STORY298-EVENTS)
	(CONTINUE STORY016)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY298-EVENTS ()
	<LOSE-ITEM ,AMULET-OF-PROTECTION T>>

<CONSTANT TEXT299 "Fort Mereth, named after an ancient hero, is the northernmost of the forts that guard Sokara from the ravening manbeasts of Nerech. A fortified wall stretches right across the peninsula.">
<CONSTANT CHOICES299 <LTABLE "East into Nerech (The Plains of Howling Darkness)" "South east to Fort Estgard" "South into the farmlands" "West on the road to Caran Baru" "West on the road to the citadel">>

<ROOM STORY299
	(DESC "299")
	(LOCATION LOCATION-MERETH)
	(STORY TEXT299)
	(EVENTS STORY299-EVENTS)
	(CHOICES CHOICES299)
	(DESTINATIONS <LTABLE STORY-PLAINS-HOWLING-DARKNESS STORY472 STORY548 STORY458 STORY518>)
	(TYPES FIVE-CHOICES)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY299-EVENTS ("AUX" ROLL)
	<COND (,RUN-ONCE
		<SET ROLL <RANDOM-EVENT 1 0 T>>
		<COND (<L=? .ROLL 2>
			<COMBAT-MONSTER ,MONSTER-DRUNKEN-SOLDIER 4 6 7>
			<CHECK-COMBAT ,MONSTER-DRUNKEN-SOLDIER ,STORY297 0 ,AXE>
		)(<L=? .ROLL 4>
			<EMPHASIZE ,NOTHING-HAPPENS>
			<PREVENT-DOOM ,STORY299>
		)(ELSE
			<EMPHASIZE "You happen upon a merchant selling a mandolin.">
			<MERCHANT <LTABLE MANDOLIN> <LTABLE 100>>
			<PREVENT-DOOM ,STORY299>
		)>
	)>
	<COND (<IS-ALIVE>
		<CRLF>
		<TELL ,TEXT-YOU-CAN-GO>
		<CRLF>
	)>>

<ROOM STORY300
	(DESC "300")
	(STORY TEXT-TOWNHOUSE)
	(EVENTS STORY300-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY300-EVENTS ()
	<VISIT-TOWNHOUSE ,STORY300 ,TOWNHOUSE-YELLOWPORT>>

<CONSTANT TEXT301 "A barque is heading for the Isle of Druids to buy furs and its captain is prepared to take you. The journey, across the Sea of Whispers, is uneventful, and you dock at the trading post on the island a week or so later.">

<ROOM STORY301
	(DESC "301")
	(STORY TEXT301)
	(CONTINUE STORY195)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT302 "You can explore:">
<CONSTANT CHOICES302 <LTABLE "The poor quarter" "The harbour district" "The area around the palace">>

<ROOM STORY302
	(DESC "302")
	(STORY TEXT302)
	(CHOICES CHOICES302)
	(DESTINATIONS <LTABLE STORY093 STORY587 STORY277>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT303 "As fast as you can, you lay out a line of the powder in front of you. The ghoul gives a moaning wail and shrinks back, unable to cross the line of salt and iron filings. Quickly you run around the ghoul, encircling it with the powder. The creature lunges for you but it cannot cross the line -- you keep it at bay at every turn. Soon it is completely trapped. Casually, you sit on a tombstone, and wait for sunrise. With the first rays of dawn the ghoul is burnt to a crisp. You take the charred head and make your way back to town.">

<ROOM STORY303
	(DESC "303")
	(STORY TEXT303)
	(EVENTS STORY303-EVENTS)
	(CONTINUE STORY100)
	(ITEMS <LTABLE GHOULS-HEAD>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY303-EVENTS ()
	<REMOVE-ITEM ,SALT-IRON-FILINGS "used" T T>
	<COMPLETE-MISSION ,MISSION-GHOUL-HEAD>>

<CONSTANT TEXT304 "He spots you before you can get the jump on him. \"Stinking assassin!\" he yells, drawing his sword. You must fight him.">

<ROOM STORY304
	(DESC "304")
	(STORY TEXT304)
	(EVENTS STORY304-EVENTS)
	(CONTINUE STORY092)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY304-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-MAN-EYEPATCH 5 8 12>
	<CHECK-COMBAT ,MONSTER-MAN-EYEPATCH ,STORY304>>

<ROOM STORY305
	(DESC "305")
	(VISITS 0)
	(BACKGROUND STORY305-BACKGROUND)
	(CHOICES CHOICES-MAGIC)
	(DESTINATIONS <LTABLE <LTABLE STORY609 STORY528>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-MAGIC 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY305-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY305 1> <RETURN ,STORY367>)>
	<RETURN ,STORY305>>

<CONSTANT TEXT306 "Something doesn't feel right about the pearls. You realize a minor enchantment has been put on them. They are in fact tiny pebbles made to look like pearls. You squeeze them in the palm of your hand and they revert to their natural state. \"By the twin gods!\" exclaims the young man. \"Look at that, they were pebbles all along.\" You stare at him for a long while, fingering your weapon. The sea gypsy shifts uneasily from foot to foot, coughing nervously and hands you another bag of pearls. This time you are sure they are real.||You take your leave, and resume your journey.">

<ROOM STORY306
	(DESC "306")
	(STORY TEXT306)
	(CONTINUE STORY085)
	(ITEMS <LTABLE BAG-OF-PEARLS>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT307 "It feels like you are playing the flute for an eternity. But at last they tire of your music...||You wake up with a scream. You realize you are not aboard your ship! You find out that you are in the temple of Alvir and Valmir in Yellowport. A priest tells you that your crew brought you here three months ago because they could not wake you from your sleep.||Your ship and crew are long gone now. The priests, however, have been looking after all your possessions. Among them is a silver flute (+2 CHARISMA). While you have the flute, it adds 2 to your CHARISMA. Note that it is worth 500 Shards, and that you can sell it at any market if you like.||You leave the temple.">

<ROOM STORY307
	(DESC "307")
	(LOCATION LOCATION-YELLOWPORT)
	(STORY TEXT307)
	(EVENTS STORY307-EVENTS)
	(CONTINUE STORY010)
	(ITEMS <LTABLE SILVER-FLUTE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY307-EVENTS ()
	<RESET-CONTAINER ,CARGO>
	<COND (,CURRENT-SHIP
		<REMOVE ,CURRENT-SHIP>
		<SETG CURRENT-SHIP NONE>
	)>>

<CONSTANT TEXT308 "The ratmen beat you into unconsciousness, and then toss you down an underground sewer outlet. You are washed up on the beaches outside Yellowport, where you come to. You have 1 Stamina point left, and the ratmen have taken all the items and money that you were carrying.||Groggily, you make your way back into the city.">

<ROOM STORY308
	(DESC "308")
	(LOCATION LOCATION-YELLOWPORT)
	(STORY TEXT308)
	(EVENTS STORY308-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY308-EVENTS ()
	<STORY-LOSE-EVERYTHING F>
	<SETG STAMINA 1>
	<UPDATE-STATUS-LINE>>

<CONSTANT TEXT309 "As you move closer to the sarcophagus, your foot crosses the edge of the pentacle by a few inches. It is enough. The lid of the sarcophagus explodes into the air with a deafening crash, and a pillar of black smoke erupts from the stone coffin. The smoke hurtles towards you, like a miniature tornado. You must fight the tomb guardian.">

<ROOM STORY309
	(DESC "309")
	(STORY TEXT309)
	(EVENTS STORY309-EVENTS)
	(CONTINUE STORY260)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY309-EVENTS ("AUX" WEAPON)
	<SET WEAPON <FIND-BEST ,P?COMBAT ,WEAPONBIT ,PLAYER>>
	<COND (<G? .WEAPON 0> <STORY-JUMP ,STORY043>)>>

<CONSTANT TEXT310 "The Stinking River has cut its way through the high ground here. On the edge of the chasm that overlooks the river lies the village of High Therys. The locals are behaving very oddly. You watch the villagers lay out a fine feast on the village green. A pig is set roasting on a spit, loaves of freshly baked bread are piled beside bowls overflowing with fruits, butter and cheese. Then the innkeeper comes with huge bottles of wine and beer. Lastly, the richest merchants of the village bring coffers full of silver which they set beside the table.||To your amazement, instead of sitting down to dine, the villagers then scurry home and start closing the shutters on their windows.">

<ROOM STORY310
	(DESC "310")
	(VISITS 0)
	(BACKGROUND STORY310-BACKGROUND)
	(STORY TEXT310)
	(CONTINUE STORY283)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY310-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY310 1> <RETURN ,STORY614>)>
	<RETURN ,STORY310>>

<CONSTANT TEXT311 "He narrows his eyes angrily at your refusal.">

<ROOM STORY311
	(DESC "311")
	(STORY TEXT311)
	(EVENTS STORY311-EVENTS)
	(CONTINUE STORY720)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY311-EVENTS ()
	<COND (<AND <CHECK-SHIP ,SHIP-GALLEON> <CHECK-CREW ,CONDITION-GOOD>>
		<STORY-JUMP ,STORY335>
	)>>

<CONSTANT TEXT312 "\"Nerech is a dangerous place, Cap'n,\" says the first mate. \"Even its coastal waters are brimming with hazards. Rocks and monsters and the like. Then once ashore -- well, Land of the Manbeasts, they call it. The crew won't follow you there if they don't think you're good enough to lead them.\"">

<ROOM STORY312
	(DESC "312")
	(STORY TEXT312)
	(CHOICES CHOICES-NERECH)
	(DESTINATIONS <LTABLE STORY-PLAINS-HOWLING-DARKNESS <LTABLE STORY-PLAINS-HOWLING-DARKNESS STORY507> STORY507>)
	(REQUIREMENTS STORY-TEST-SAILING)
	(TYPES TYPE-SAIL)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT313 "You stand against the wall as the high priestess draws back her arm, and hurls a stream of daggers at you.">

<ROOM STORY313
	(DESC "313")
	(STORY TEXT313)
	(EVENTS STORY313-EVENTS)
	(CONTINUE STORY400)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY313-EVENTS ("AUX" ROLL)
	<SET ROLL <RANDOM-EVENT 2 0 T>>
	<COND (<L=? .ROLL <CALCULATE-DEFENSE ,CURRENT-CHARACTER>>
		<EMPHASIZE "The daggers all miss.">
		<PREVENT-DOOM ,STORY313>
	)(ELSE
		<LOSE-STAMINA <ROLL-DICE 1> ,DIED-FROM-INJURIES ,STORY313>
	)>
	<COND (<IS-ALIVE> <SETG GOD NONE>)>>

<CONSTANT TEXT314 "The runes mean nothing to you.">
<CONSTANT CHOICES314 <LTABLE TEXT-TO-BEACH TEXT-TO-TREFOILLE TEXT-TO-MARLOCK>>

<ROOM STORY314
	(DESC "314")
	(STORY TEXT314)
	(CHOICES CHOICES314)
	(DESTINATIONS <LTABLE STORY097 STORY602 STORY166>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT315 "With the gorlock out of the way, you are free to investigate its lair. Inside the cave, you find 500 Shards, a mace and a silver nugget.">

<ROOM STORY315
	(DESC "315")
	(STORY TEXT315)
	(EVENTS STORY315-EVENTS)
	(CONTINUE STORY510)
	(ITEMS <LTABLE MACE SILVER-NUGGET>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY315-EVENTS ()
	<GAIN-MONEY 500>>

<CONSTANT TEXT316 "The temple of Elnir is an imposing edifice of grey stone, inlaid with yellow marbling. Elnir is the god of the sky and of kingship. He is the ruler of the gods.||\"His dreams are the clouds before a storm,\" says a passing priest.">

<ROOM STORY316
	(DESC "316")
	(STORY TEXT316)
	(CHOICES CHOICES-STANDARD-TEMPLE)
	(DESTINATIONS <LTABLE STORY291 STORY143 STORY388 STORY010>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT317 "It is the same craft you got the magic spear from, with the silver-skinned demon inside -- still dead, you presume. You examine it again, but there is nothing else of interest on board. The figure still lies there unmoving. You sail on">

<ROOM STORY317
	(DESC "317")
	(STORY TEXT317)
	(CONTINUE STORY085)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT318 "A scorpion man scuttles out of the brush to confront you. It resembles a huge scorpion, but with a human head and torso. It holds a sword and shield in its human arms. The creature\"s eyes blaze with an unearthly yellow light, and it scrabbles toward you with frightening speed, whipping its sting up and around at you. You must fight it.">

<ROOM STORY318
	(DESC "318")
	(LOCATION LOCATION-SCORPION)
	(STORY TEXT318)
	(EVENTS STORY318-EVENTS)
	(CONTINUE STORY657)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY318-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-SCORPION-MAN 3 6 8>
	<CHECK-COMBAT ,MONSTER-SCORPION-MAN ,STORY318>>

<CONSTANT TEXT319 "You give the willow staff to the Oak Druid of the City of Trees.||\"A willow staff, is it? I see,\" the druid intones. \"Thank you.\"||As a reward, the druid lets you train with the City of Trees' best hunters and trackers.">

<ROOM STORY319
	(DESC "319")
	(STORY TEXT319)
	(EVENTS STORY319-EVENTS)
	(CONTINUE STORY195)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY319-EVENTS ()
	<RETURN-ITEM ,WILLOW-STAFF T>
	<GAIN-RANK 1>
	<UPGRADE-STAMINA <ROLL-DICE 1>>>

<CONSTANT TEXT320 "You learn from their conversation that they are from the jungles of distant Ankon-Konu, the Feathered Lands, and that they have come here to find new sacrifices for their god, and new members for their cult. The chef pronounces the cauldron is ready, and they remove the net that holds you.">
<CONSTANT CHOICES320 <LTABLE "Fight them" "Shout 'Badogor!' repeatedly" "Join their cult">>

<ROOM STORY320
	(DESC "320")
	(STORY TEXT320)
	(CHOICES CHOICES320)
	(DESTINATIONS <LTABLE STORY204 STORY101 STORY061>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT321 "The Black Dragon Knight comes out to meet you. His armour is of black steel, and you think you can see glowing red eyes through the slits in his full-face helm. You must fight him.">

<ROOM STORY321
	(DESC "321")
	(STORY TEXT321)
	(EVENTS STORY321-EVENTS)
	(CONTINUE STORY417)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY321-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-BLACK-DRAGON 5 9 11>
	<CHECK-COMBAT ,MONSTER-BLACK-DRAGON ,STORY321>>

<CONSTANT TEXT322 "The repulsive one recognizes you from your last undersea trip!">

<ROOM STORY322
	(DESC "322")
	(STORY TEXT322)
	(CONTINUE STORY238)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT323 "A few locals are discussing recent events. It seems some hideous beast has made its lair in a cave on the hill that overlooks the village.||\"It's a gorlock,\" says a farmer. \"And it's amassed quite a bit of treasure by all accounts, lifted from its victims. A brave adventurer like yourself could get rich if you killed it. You'd be doing us a favour as well.\"||\"What does it look like?\" you ask.||\"Nobody's come back to tell the tale,\" says the innkeeper.||You leave the tavern.">

<ROOM STORY323
	(DESC "323")
	(STORY TEXT323)
	(CONTINUE STORY510)
	(FLAGS LIGHTBIT)>

<ROOM STORY324
	(DESC "324")
	(STORY TEXT-STORM-SEA)
	(EVENTS STORY324-EVENTS)
	(CHOICES CHOICES-STORM-FURY)
	(DESTINATIONS <LTABLE <LTABLE STORY607 STORY083 STORY559>>)
	(REQUIREMENTS STORY-STORM-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY324-EVENTS ()
	<STORM-AT-SEA ,STORY324 ,STORY559>>

<ROOM STORY325
	(DESC "325")
	(STORY TEXT-SHIPWRECK)
	(EVENTS STORY325-EVENTS)
	(CONTINUE STORY173)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY325-EVENTS ()
	<STORY-SHIPWRECK ,STORY325>>

<CONSTANT TEXT326 "You follow the footprints to the mill, where you see an old lady and two men brushing flour off their clothes.||\"Another successful year's haunting,\" laughs the woman.||Quietly you creep back and tell the villagers what you have discovered. Brimming with outrage, they go straight to the mill and seize the three miscreants.||\"Old Megan!\" cries one of the villagers when he sees who is the ringleader of the three. \"So, you've been masquerading as a ghost these seven years, eh? Well, tomorrow we'll take you to the gallows and then you can play the part for real.\"">

<ROOM STORY326
	(DESC "326")
	(STORY TEXT326)
	(CONTINUE STORY671)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT327 "You have already cleaned the ratmen out of the tunnels below the city but the old well makes a good cache for equipment and money that you don't want to carry with you. It has an advantage over a townhouse as there is no risk of burglary or fire. You can also rest here as long as you like, restoring any lost Stamina points.">

<ROOM STORY327
	(DESC "327")
	(STORY TEXT327)
	(EVENTS STORY327-EVENTS)
	(CONTINUE STORY010)
	(CODEWORDS <LTABLE CODEWORD-ACID>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY327-EVENTS ()
	<GAIN-CACHE ,CACHE-YELLOWPORT>
	<VISIT-TOWNHOUSE ,STORY327 ,CACHE-YELLOWPORT>>

<CONSTANT TEXT328 "You are not sure where to start looking for the ghoul, so you wander around, looking for stories, strange murders -- anything that might put you on its trail.">

<ROOM STORY328
	(DESC "328")
	(STORY TEXT328)
	(CHOICES CHOICES-SCOUTING)
	(DESTINATIONS <LTABLE <LTABLE STORY419 STORY360>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 12>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT329 "\"Still haven't found him? Did you try the Castle of the Dragon Knights to the west of the Bronze Hills?\" As he turns to leave, he adds, \"When you have better tidings, I will return here.\"||You follow him, but he is nowhere to be seen.">

<ROOM STORY329
	(DESC "329")
	(STORY TEXT329)
	(CONTINUE STORY400)
	(FLAGS LIGHTBIT)>

<CONSTANT CHOICES330 <LTABLE "Travel to Wishport" "Choose a different gate">>

<ROOM STORY330
	(DESC "330")
	(CHOICES CHOICES330)
	(DESTINATIONS <LTABLE STORY719 STORY065>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT331 "You fall into conversation with Pyletes, a kindly old scholar priest of Molhern, the God of Knowledge.||\"Many years ago, the Book of the Seven Sages was stolen from us,\" he says. \"News suggests that the scorpion men are in possession of it. I need a young adventurer like yourself to travel to Scorpion Bight and return the book to me. In return I can show you how to improve the skill of your choice.\"">
<CONSTANT CHOICES331 <LTABLE "Take up the quest" IF-NOT>>

<ROOM STORY331
	(DESC "331")
	(VISITS 0)
	(BACKGROUND STORY331-BACKGROUND)
	(STORY TEXT331)
	(CHOICES CHOICES331)
	(DESTINATIONS <LTABLE STORY010 STORY010>)
	(REQUIREMENTS <LTABLE MISSION-BOOK-SAGES NONE>)
	(TYPES <LTABLE R-TAKE-MISSION R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY331-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY331 1> <RETURN ,STORY627>)>
	<RETURN ,STORY331>>

<CONSTANT TEXT332 "The quayside at the Trading Post is a simple affair, without the harbour facilities or the shipwrights of large ports. There are no ships available to buy here, but if you already own a ship, you can buy and sell cargo.">

<ROOM STORY332
	(DESC "332")
	(LOCATION LOCATION-TRADING)
	(STORY TEXT332)
	(EVENTS STORY332-EVENTS)
	(CONTINUE STORY195)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY332-EVENTS ()
	<HARBOUR-TRADING-POST>>

<CONSTANT TEXT333 "You are on the east bank of the River Grimm.">
<CONSTANT CHOICES333 <LTABLE "Cross to the west bank (Cities of Gold and Glory)" "Head east into the Forest of Larun" "Follow the river north" "Follow the river south">>

<ROOM STORY333
	(DESC "333")
	(LOCATION LOCATION-GRIMM)
	(STORY TEXT333)
	(EVENTS STORY333-EVENTS)
	(CHOICES CHOICES333)
	(DESTINATIONS <LTABLE STORY-CITIES-GOLD-GLORY STORY047 STORY123 STORY099>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY333-EVENTS ("AUX" ROLL COUNT)
	<COND (,RUN-ONCE
		<SET ROLL <RANDOM-EVENT 1 0 T>>
		<COND (<L=? .ROLL 2>
			<COND (<G? <COUNT-CONTAINER ,BLESSINGS> 0>
				<EMPHASIZE "A water sprite curses you -- you lose a blessing">
				<SET COUNT <COUNT-CONTAINER ,BLESSINGS>>
				<DEC .COUNT>
				<STORY-LOSE-BLESSING .COUNT>
			)(ELSE
				<EMPHASIZE ,NOTHING-HAPPENS>
			)>
		)(<L=? .ROLL 2>
			<EMPHASIZE ,NOTHING-HAPPENS>
		)(ELSE
			<EMPHASIZE ,TEXT-SMOLDER-FISH>
			<TAKE-ITEM ,SMOLDER-FISH>
		)>
	)>
	<CRLF>
	<TELL ,TEXT-YOU-CAN-GO>
	<CRLF>>

<CONSTANT TEXT334 "To renounce the worship of Lacuna, you must pay 40 Shards in compensation to the shrine. \"If you forsake the love of the goddess, you will never survive the rigours of the wilderness,\" warns the priestess.">

<ROOM STORY334
	(DESC "334")
	(STORY TEXT334)
	(EVENTS STORY334-EVENTS)
	(CONTINUE STORY195)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY334-EVENTS ()
	<RENOUNCE-WORSHIP 40 ,GOD-LACUNA>>

<CONSTANT TEXT335 "The captain eyes your crew, and your marines. They are a tough-looking lot, seasoned sailors and veterans of quite a few battles at sea. \"Bah!\" he exclaims, \"It's not worth the trouble. I'll let it pass this time.\" With that, he returns to his ship, and departs.">

<ROOM STORY335
	(DESC "335")
	(STORY TEXT335)
	(CONTINUE STORY439)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT336 "You step in, saying, \"I have a message for King Skabb...\"||The ratmen stare at you in amazement.||\"A human! Get it!\" screams Skabb.||The four ratmen charge toward you with a roar, wielding swords before you can say anything more. Soon they have been joined by many others and you have little choice but to turn and flee for your life! Desperately, you race down the sewer tunnels with an army of ratmen in hot pursuit.">
<CONSTANT CHOICES336 <LTABLE "Lose them in the tunnels" "Try some magic" "Hide">>

<ROOM STORY336
	(DESC "336")
	(STORY TEXT336)
	(CHOICES CHOICES336)
	(DESTINATIONS <LTABLE STORY079 STORY296 STORY127>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT337 "The crew have been using a net to catch fish. This time they have caught a sea centaur, a strange-looking creature with a top half like a man and a bottom half like a sea horse. It struggles feebly, clutching at the net with webbed fingers, trying to saw it apart with a long, serrated dagger made of sea shell.||The first mate looks at you with his hand on his cutlass. \"We'll have to put it to the sword, Cap'n. They're terrible bad luck to have on board.\"">
<CONSTANT CHOICES337 <LTABLE "Give the order to kill it" "Spare its life">>

<ROOM STORY337
	(DESC "337")
	(VISITS 0)
	(BACKGROUND STORY337-BACKGROUND)
	(STORY TEXT337)
	(CHOICES CHOICES337)
	(DESTINATIONS <LTABLE STORY522 STORY604>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY337-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY337 1> <RETURN ,STORY037>)>
	<RETURN ,STORY337>>

<CONSTANT TEXT338 "You climb down the ladder into a house with herbs and plants hanging on the walls, and shelves lined with pots, pans and bottles of all sorts. The healer, an old woman, can cure you of poison but is unable to cure disease, lift curses or heal wounds. It will cost you 25 Shards to get cured, if you are poisoned. If you pay, you can restore your abilities to normal.">

<ROOM STORY338
	(DESC "338")
	(STORY TEXT338)
	(EVENTS STORY338-EVENTS)
	(CONTINUE STORY427)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY338-EVENTS ()
	<CURE-AILMENTS 25 ,POISONBIT>>

<CONSTANT TEXT339 "You find a burned-out house in the poor quarter where a trader has set up a stall, selling ash and debris. The merchant, a weaselly-looking old woman, is screeching, \"Ashes, ashes from the house of a sorceress. Fifteen Shards a packet.\"">

<ROOM STORY339
	(DESC "339")
	(STORY TEXT339)
	(EVENTS STORY339-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY339-EVENTS ()
	<BUY-ITEM ,ASHES 15>>

<CONSTANT CHOICES340 <LTABLE TEXT-ROLL-SCOUTING TEXT-ROLL-THIEVERY>>

<ROOM STORY340
	(DESC "340")
	(CHOICES CHOICES340)
	(DESTINATIONS <LTABLE <LTABLE STORY239 STORY034> <LTABLE STORY239 STORY034>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 10> <LTABLE ABILITY-THIEVERY 10>>)
	(TYPES TWO-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT341 "You hear an interesting story about one of Baroness Ravayne's knights in Golnir. Apparently he is plotting against her.||\"Intrigue and treachery in the court of the baroness...\" mutters a man before his voice fades into a whisper.||You leave the tavern.">

<ROOM STORY341
	(DESC "341")
	(STORY TEXT341)
	(CONTINUE STORY400)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT342 "The alchemist's shop is lined with potions, jars of exotic substances, herbs, and so on. Alembics and beakers bubble and boil, full of strangely-coloured liquids. The alchemist, a tall, gangly fellow with a beak of a nose, sells potions. You can buy as many as you can afford -- each one costs 50 Shards.||A potion can be used just before an ability roll or a fight to add 1 to the relevant ability for that one roll or fight only. Each potion can be used only once.||The alchemist can make you a special potion for 250 Shards, but he needs an ink sac. If you pay the money, and have an ink sac he will make you a potion of restoration. It can be used only once to heal all lost Stamina points, cure poison and disease.">

<ROOM STORY342
	(DESC "342")
	(STORY TEXT342)
	(EVENTS STORY342-EVENTS)
	(CONTINUE STORY510)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY342-EVENTS ()
	<MERCHANT <LTABLE POTION-OF-STRENGTH POTION-OF-COMELINESS POTION-OF-INTELLECT POTION-OF-GODLINESS POTION-OF-STEALTH POTION-OF-NATURE> <LTABLE 50 50 50 50 50 50>>
	<COND (<AND <G=? ,MONEY 250> <CHECK-ITEM ,INK-SAC> <NOT <CHECK-ITEM ,POTION-OF-RESTORATION>>>
		<CRLF>
		<TELL "Ask the alchemist to make you a ">
		<PRINT-ITEM ,POTION-OF-RESTORATION T>
		<TELL "?">
		<COND (<YES?>
			<REMOVE-ITEM ,INK-SAC "gave" T T>
			<COST-MONEY 250 ,TEXT-PAID>
			<TAKE-ITEM ,POTION-OF-RESTORATION>
		)>
	)>>

<ROOM STORY343
	(DESC "343")
	(STORY TEXT-INITIATE-ALMIR-VALMIR)
	(EVENTS STORY343-EVENTS)
	(CONTINUE STORY154)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY343-EVENTS ()
	<BECOME-INITIATE 40 ,GOD-ALVIR-VALMIR>>

<CONSTANT CHOICES344 <LTABLE TEXT-ROLL-COMBAT TEXT-ROLL-MAGIC>>

<ROOM STORY344
	(DESC "344")
	(STORY TEXT-YOU-CAN)
	(CHOICES CHOICES344)
	(DESTINATIONS <LTABLE <LTABLE STORY161 STORY718> <LTABLE STORY161 STORY718>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-COMBAT 14> <LTABLE ABILITY-MAGIC 14>>)
	(TYPES TWO-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT345 "A ship, impaled on some rocks, is breaking up. Nothing remains except for rotten timbers. A little bottle is bobbing in the waves nearby. Inside, a message reads, \"Never sail at night through rocky waters.\" You sail on.">

<ROOM STORY345
	(DESC "345")
	(STORY TEXT345)
	(CONTINUE STORY209)
	(FLAGS LIGHTBIT)>

<ROOM STORY346
	(DESC "346")
	(STORY TEXT-SHIPWRECK)
	(EVENTS STORY346-EVENTS)
	(CONTINUE STORY453)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY346-EVENTS ()
	<STORY-SHIPWRECK ,STORY346>>

<CONSTANT TEXT347 "The road is nearly blocked by wagons and supply convoys. A troop of soldiers forces its way through the throng -- the men bang heads indiscriminately to clear people out of the way">
<CONSTANT CHOICES347 <LTABLE "North to Caran Baru" "East into the Coldbleak Mountains" "South along the road" "West into the Forest of Larun">>

<ROOM STORY347
	(DESC "347")
	(STORY TEXT347)
	(EVENTS STORY347-EVENTS)
	(CHOICES CHOICES347)
	(DESTINATIONS <LTABLE STORY400 STORY474 STORY387 STORY047>)
	(TYPES FOUR-CHOICES)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY347-EVENTS ("AUX" ROLL)
	<COND (,RUN-ONCE
		<SET ROLL <RANDOM-EVENT 1 0 T>>
		<COND (<L=? .ROLL 2>
			<EMPHASIZE "You were banged on the head!">
			<LOSE-STAMINA 1 ,DIED-FROM-INJURIES ,STORY347>
		)(<L=? .ROLL 2>
			<EMPHASIZE ,NOTHING-HAPPENS>
			<PREVENT-DOOM ,STORY347>
		)(ELSE
			<EMPHASIZE "You were mistaken for a beggar by a passing priest!">
			<GAIN-MONEY 10>
			<PREVENT-DOOM ,STORY347>
		)>
	)>
	<IF-ALIVE ,TEXT-YOU-CAN-GO>>

<CONSTANT TEXT348 "You remember what the fishermen say: the root of a certain seaweed, when crushed, gives off a cloud of toxic fluid. This sap is harmless to humans but is known to paralyse marine creatures for a short while. Fortunately, the seaweed grows in abundance here. You swim down with a handful of the roots, squeezing its sap into the waters. The hideous creatures shoot towards you, but are paralysed the instant they enter the cloud of reddish fluid that billows around you.||You take the golden net and swim back to the Shadar Tor as fast as you can.">
<CONSTANT CHOICES348 <LTABLE TEXT-TO-TREFOILLE TEXT-TO-MARLOCK>>

<ROOM STORY348
	(DESC "348")
	(STORY TEXT348)
	(CHOICES CHOICES348)
	(DESTINATIONS <LTABLE STORY602 STORY166>)
	(TYPES TWO-CHOICES)
	(ITEMS <LTABLE GOLDEN-NET>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT349 "You are too fast to get caught, and run off into the shadowy backstreets of Caran Baru. Cursing your luck, you consider your next move.">

<ROOM STORY349
	(DESC "349")
	(STORY TEXT349)
	(CONTINUE STORY400)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT350 "You are restored to life at the Temple of Nagil in Marlock City. Your Stamina is back to its normal score. The possessions and cash you were carrying at the time of your death are lost. \"Nagil has taken you from the barge of souls that sails to the lands of the dead, and returned you to us,\" declares the high priest.||You leave the temple.">

<ROOM STORY350
	(DESC "350")
	(STORY TEXT350)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT351 "One day, a new slave is brought in to work beside you. Much to your astonishment, it is Lauria, the thief who left you in the lurch when you burgled a wizard's house in Yellowport.||\"Sorry about the last time,\" she says, \"Business, you know. Now's my chance to make it up to you.\"||She explains that she has discovered an escape route. This time, she promises to set up a diversion while you make for a tunnel where a cave-in has left an opening to the outside. Lauria says she will meet you there later.">
<CONSTANT CHOICES351 <LTABLE "Go along with her plan" "Escape on your own">>

<ROOM STORY351
	(DESC "351")
	(STORY TEXT351)
	(CHOICES CHOICES351)
	(DESTINATIONS <LTABLE STORY662 STORY565>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT352 "You mutter an enchantment that is intended to give you the appearance of a ratman but you get some of the intricate syllables wrong, and take on the appearance of a particularly wealthy merchant! At the sight of you, the ratmen redouble their efforts, and you are overwhelmed by sheer numbers.">

<ROOM STORY352
	(DESC "352")
	(STORY TEXT352)
	(CONTINUE STORY308)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT353 "The guard recognizes you, and shouts at the top of his lungs, \"It's the stinking traitor who murdered Nergan. Shoot to kill!\"||Several archers pop up from behind the rocks overhead, and start shooting at you. An arrow embeds itself in your shoulder.">
<CONSTANT TEXT353-CONTINUED "You realize you made a bad mistake in coming back here, and you run for your life. As you climb down, you are shot at again.">
<CONSTANT TEXT353-END "You make it back to the foothills of the mountains.">

<ROOM STORY353
	(DESC "353")
	(STORY TEXT353)
	(EVENTS STORY353-EVENTS)
	(CONTINUE STORY474)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY353-EVENTS ("AUX" ROLL)
	<LOSE-STAMINA 3 ,DIED-FROM-INJURIES ,STORY353>
	<COND (<IS-ALIVE>
		<IF-ALIVE ,TEXT353-CONTINUED>
		<SET ROLL <RANDOM-EVENT 1 0 T>>
		<COND (<L=? .ROLL 2>
			<EMPHASIZE "You are hit twice.">
			<LOSE-STAMINA 6 ,DIED-FROM-INJURIES ,STORY353>
		)(<L=? .ROLL 4>
			<EMPHASIZE "You are hit once.">
			<LOSE-STAMINA 3 ,DIED-FROM-INJURIES ,STORY353>
		)(ELSE
			<EMPHASIZE "The arrows missed completely.">
			<PREVENT-DOOM ,STORY353>
		)>
	)>
	<IF-ALIVE ,TEXT353-END>>

<CONSTANT TEXT354 "You throw, muttering a prayer for forgiveness to the gods.||The weapon soars through the air. It turns, and catches the sunlight, sparkling like a flashing star, before sinking beneath the water with barely a splash. No ripples appear. Your heart feels uplifted, and the curse is no more!">

<ROOM STORY354
	(DESC "354")
	(STORY TEXT354)
	(EVENTS STORY354-EVENTS)
	(CONTINUE STORY378)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY354-EVENTS ()
	<DELETE-CODEWORD ,CODEWORD-APPEASE>
	<DELETE-CURSE ,CURSE-TYRNAI>>

<ROOM STORY355
	(DESC "355")
	(STORY TEXT-GUILD-INVESTMENTS)
	(EVENTS STORY355-EVENTS)
	(CONTINUE STORY046)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY355-EVENTS ()
	<CHECK-INVESTMENTS ,STORY046>>

<CONSTANT TEXT356 "You are pious enough to be allowed to enter the sacred grove. You step in and knock on the door. A kindly old druid opens the door and greets you. You hand him the oak staff.||\"Thank you,\" he says, \"An oak staff, eh. That's an interesting message, to be sure.\"||He hands you 50 Shards as payment and a willow staff, saying, \"Please take this staff to the Oak Druid in the City of Trees, on the Isle of Druids. I'm sure he'll reward you, too. Good day and thanks again.\"||With that he shuts the door. You head back into the forest.">

<ROOM STORY356
	(DESC "356")
	(STORY TEXT356)
	(EVENTS STORY356-EVENTS)
	(CONTINUE STORY047)
	(ITEMS <LTABLE WILLOW-STAFF>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY356-EVENTS ()
	<GIVE-ITEM ,OAK-STAFF T>
	<GAIN-MONEY 50>>

<CONSTANT TEXT357 "The moon begins to rise, making the ghosts seem to glow. They sit hunched over their feast like vultures, occasionally stirring their hands in the pile of silver coins and tittering eerily.">
<CONSTANT CHOICES357 <LTABLE "Confront them" "Stay hidden and follow when they leave">>

<ROOM STORY357
	(DESC "357")
	(STORY TEXT357)
	(CHOICES CHOICES357)
	(DESTINATIONS <LTABLE STORY023 STORY541>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT358 "\"Welcome to the City of Trees,\" says a passing woman dressed in the garb of a druid.||The city has been built amid the branches of several mighty oaks. Ladders run up and down the trees to houses that perch like nests in the branches. You are not allowed into any houses, but the druids allow you to barter at the market.">
<CONSTANT CHOICES358 <LTABLE "Buy weapons/armours/magic/other items" "Sell weapons/armours/magic/other items" "Leave the City of Trees">>

<ROOM STORY358
	(DESC "358")
	(LOCATION LOCATION-TREES)
	(STORY TEXT358)
	(EVENTS STORY358-EVENTS)
	(DESTINATIONS <LTABLE CITY-TREES-BUY CITY-TREES-SELL STORY678>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY358-EVENTS ()
	<COND (<CHECK-PROFESSION ,PROFESSION-WAYFARER>
		<SET-DESTINATION ,STORY358 3 ,STORY645>
	)(ELSE
		<SET-DESTINATION ,STORY358 3 ,STORY678>
	)>>

<CONSTANT TEXT359 "A wandering tinker accosts you, selling lanterns for 50 Shards each. You can buy no more than three.">

<ROOM STORY359
	(DESC "359")
	(STORY TEXT359)
	(EVENTS STORY359-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY359-EVENTS ()
	<BUY-ITEMS ,LANTERN 50 3>>

<CONSTANT TEXT360 "You have no luck in tracking down the ghoul. The next day, you hear a rumour doing the rounds in the taverns. A ghoul was found and destroyed by an adventuring priestess of Tyrnai. Apparently the temple of Nagil rewarded her handsomely. Looks like you were pipped at the post.">

<ROOM STORY360
	(DESC "360")
	(STORY TEXT360)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT361 "You find a huddled, moaning figure on the ground. As you approach, a net is thrown over you from behind. You glimpse a face painted with white bone dust and big red circles around the eyes just before a terrific blow on the back of your head slams you into unconsciousness.">

<ROOM STORY361
	(DESC "361")
	(VISITS 0)
	(BACKGROUND STORY361-BACKGROUND)
	(STORY TEXT361)
	(CONTINUE STORY508)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY361-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY361 1> <RETURN ,STORY055>)>
	<RETURN ,STORY361>>

<CONSTANT TEXT362 "The sea dragon dives deep to the bottom of the lake. You are pulled along at a terrific rate through the murky waters. You think your lungs are about to burst when at last the creature surges upwards, breaking the surface.||You find yourself in a cave inside a small rocky island, somewhere on the surface of the lake. A hole in the roof lets in a shaft of bright sunlight, that reflects off the water, casting dappled yellow light all over the walls.||Part of the cave is dry ground, heaped with the dragon's treasure hoard -- sparkling coins, swords, armour and the like. You notice a rocky ledge, lined with a number of bottles, full of yellow dust.||The dragon pulls itself on top of its hoard. You have a few seconds to try to hide.">

<ROOM STORY362
	(DESC "362")
	(STORY TEXT362)
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE <LTABLE STORY016 STORY274>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT363 "You collapse a rotting beam, just inside the cabin. The roof falls in, and a cloud of debris fills the water, obscuring you completely. You grab the gems, but it is not long before the magic of the sea centaurs takes you over. You live on for a hundred years as a sea centaur.">

<ROOM STORY363
	(DESC "363")
	(STORY TEXT363)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROOM STORY364
	(DESC "364")
	(STORY TEXT-VIOLET-OCEAN)
	(CHOICES CHOICES-VIOLET-OCEAN)
	(DESTINATIONS <LTABLE STORY-BLOOD-DARK-SEA <LTABLE STORY-BLOOD-DARK-SEA STORY085> STORY085>)
	(REQUIREMENTS STORY-TEST-SAILING)
	(TYPES TYPE-SAIL)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT365 "Sul Veneris wakes up the moment you remove the stake. He rips the other stakes out of the ground, and soars into the air, with a shout like a clap of thunder. He swings his hammer around his head, and bolts of lightning leap forth to strike the storm demons.||As he rises into the clouds in pursuit of the demons, a bolt of lightning streaks from his hand and strikes you full force! You are thrown backwards, but to your amazement you are unhurt. In fact, you feel empowered by the blast.||You have freed Sul Veneris, the Lord of Thunder.||Then, you climb down to the bottom.">

<ROOM STORY365
	(DESC "365")
	(STORY TEXT365)
	(EVENTS STORY365-EVENTS)
	(CONTINUE STORY658)
	(CODEWORDS <LTABLE CODEWORD-ALOFT>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY365-EVENTS ()
	<UPGRADE-STAMINA 3>>

<ROOM STORY366
	(DESC "366")
	(STORY TEXT-VIOLET-OCEAN)
	(CHOICES CHOICES-VIOLET-OCEAN)
	(DESTINATIONS <LTABLE STORY-BLOOD-DARK-SEA <LTABLE STORY-BLOOD-DARK-SEA STORY439> STORY439>)
	(REQUIREMENTS STORY-TEST-SAILING)
	(TYPES TYPE-SAIL)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT367 "You have attempted to steal the chain mail before. This time, security has been doubled with warrior priests of Tyrnai in abundance. Inside the temple, there are two more of the bullheaded iron golem guards, and you realize there is no way you can succeed.||You head back to the city centre.">

<ROOM STORY367
	(DESC "367")
	(STORY TEXT367)
	(CONTINUE STORY400)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT368 "Becoming an initiate of Maka gives you the benefit of paying less for blessings and other services the temple can offer. It costs 50 Shards to become an initiate. You cannot become an initiate of Maka if you are already an initiate of another temple.">

<ROOM STORY368
	(DESC "368")
	(STORY TEXT368)
	(EVENTS STORY368-EVENTS)
	(CONTINUE STORY141)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY368-EVENTS ()
	<BECOME-INITIATE 50 ,GOD-MAKA>>

<CONSTANT TEXT369 "The priestess, dressed in ceremonial leather armour, and carrying a silver bow, recognizes you, and welcomes you. She offers you the usual services.">

<ROOM STORY369
	(DESC "369")
	(BACKGROUND STORY369-BACKGROUND)
	(STORY TEXT369)
	(CHOICES CHOICES-STANDARD-TEMPLE)
	(DESTINATIONS <LTABLE STORY618 STORY334 STORY052 STORY195>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY369-BACKGROUND ()
	<COND (<CHECK-ITEM ,BOARS-TUSK> <RETURN ,STORY612>)>
	<RETURN ,STORY369>>

<CONSTANT TEXT370 "You come round, back to your Stamina score before the fight started. You lose the weapon and armour you were using. The Dragon Knights compliment you on your bravery. \"Until the next time,\" says your recent opponent.||You take your leave, somewhat bruised.">

<ROOM STORY370
	(DESC "370")
	(STORY TEXT370)
	(EVENTS STORY370-EVENTS)
	(CONTINUE STORY276)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY370-EVENTS ()
	<SETG STAMINA ,PREVIOUS-STAMINA>
	<COND (,BEST-WEAPON <REMOVE ,BEST-WEAPON>)>
	<COND (,BEST-ARMOUR <REMOVE ,BEST-ARMOUR>)>
	<FIND-BEST-GEAR>
	<UPDATE-STATUS-LINE>>

<CONSTANT TEXT371 "With a war cry, you leap to the attack. Your first blow rips away a great chunk of its body. A frightened voice pipes up from inside the Gob-gobbler. \"Help, help, lads, this one's a real fighter!\"||You realize the Gob-gobbler is a man disguised as a monster. But then two bandits run out of the woods to attack you. You must fight them one at a time.">

<ROOM STORY371
	(DESC "371")
	(STORY TEXT371)
	(EVENTS STORY371-EVENTS)
	(CONTINUE STORY422)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY371-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-BANDIT 3 4 6>
	<CHECK-COMBAT ,MONSTER-BANDIT ,STORY371>
	<COND (<IS-ALIVE>
		<COMBAT-MONSTER ,MONSTER-BANDIT 2 3 7>
		<CHECK-COMBAT ,MONSTER-BANDIT ,STORY371>
	)>>

<CONSTANT TEXT372 "A sleek yacht takes you on a trouble-free journey to Yellowport.">

<ROOM STORY372
	(DESC "372")
	(STORY TEXT372)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT373 "If you are an initiate it costs only 10 Shards to purchase Tyrnai's blessing. A non-initiate must pay 25 Shards. The blessing works by allowing you to try again when you make a failed COMBAT roll. It is good for only one reroll. You can have only one COMBAT blessing at any one time. Once it is used up, you can return to any branch of the temple of Tyrnai to buy a new one.">

<ROOM STORY373
	(DESC "373")
	(STORY TEXT373)
	(EVENTS STORY373-EVENTS)
	(CONTINUE STORY526)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY373-EVENTS ()
	<PURCHASE-BLESSING 25 10 ,GOD-TYRNAI ,BLESSING-COMBAT>>

<CONSTANT TEXT374 "You sense that sorcery is afoot. You make a few magical divinations which tell you that the path is cursed: it will sour the water supply of anyone that travels upon it. However, you can tell that the curse affects only the path. There is just enough room to squeeze your way up beside it, hugging the rock face. You find your water returns to a state that is drinkable.||Eventually, the path leads to a bubbling well of spring water in the rocks, just at the opening of a cave. You refill your canteen, then explore the cave.">

<ROOM STORY374
	(DESC "374")
	(STORY TEXT374)
	(CONTINUE STORY232)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT375 "You tell the provost you have important news, best heard by him alone. He takes you to a side chamber without his guards.">
<CONSTANT CHOICES375 <LTABLE "If you want to attempt to slay the provost marshal" "Otherwise, you tell him some old news and he throws you out">>

<ROOM STORY375
	(DESC "375")
	(STORY TEXT375)
	(CHOICES CHOICES375)
	(DESTINATIONS <LTABLE STORY344 STORY010>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT376 "You manage to slip out of your chains, and sneak off into the tunnels. You make it to the outside, but a troop of guards and a pack of dogs finally track you down. The fate of all escaped slaves is death.">

<ROOM STORY376
	(DESC "376")
	(STORY TEXT376)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT377 "The road between Marlock and Trefoille is well maintained with regular guard posts. The Sokarans are nothing if not efficient.">
<CONSTANT CHOICES377 <LTABLE TEXT-TO-TREFOILLE TEXT-TO-MARLOCK "North into Curstmoor">>

<ROOM STORY377
	(DESC "377")
	(STORY TEXT377)
	(LOCATION LOCATION-SOKARA)
	(EVENTS STORY377-EVENTS)
	(CHOICES CHOICES377)
	(DESTINATIONS <LTABLE STORY250 STORY100 STORY175>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY377-EVENTS ("AUX" ROLL COUNT)
	<COND (,RUN-ONCE
		<SET ROLL <RANDOM-EVENT 1 0 T>>
		<COND (<L=? .ROLL 2>
			<COND (<G? <COUNT-CONTAINER ,BLESSINGS> 0>
				<EMPHASIZE "A bad omen -- you lose a blessing">
				<SET COUNT <COUNT-CONTAINER ,BLESSINGS>>
				<DEC .COUNT>
				<STORY-LOSE-BLESSING .COUNT>
			)(ELSE
				<EMPHASIZE ,NOTHING-HAPPENS>
			)>
		)(<L=? .ROLL 2>
			<EMPHASIZE ,NOTHING-HAPPENS>
		)(ELSE
			<EMPHASIZE "You found an ordinary sword.">
			<TAKE-ITEM ,SWORD>
		)>
	)>
	<CRLF>
	<TELL ,TEXT-YOU-CAN-GO>
	<CRLF>>

<CONSTANT TEXT378 "You find a wide pool of bubbling, electric blue water. It gives off a strong invigorating scent, like crushed pine leaves.">
<CONSTANT CHOICES378 <LTABLE HAVE-CODEWORD HAVE-A OTHERWISE>>

<ROOM STORY378
	(DESC "378")
	(STORY TEXT378)
	(CHOICES CHOICES378)
	(DESTINATIONS <LTABLE STORY593 STORY556 STORY717>)
	(REQUIREMENTS <LTABLE CODEWORD-APPEASE VIAL-YELLOW-DUST NONE>)
	(TYPES <LTABLE R-CODEWORD R-ITEM R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT379 "The scholar is in no condition to resist now that your work has been done for you by the ruffians. You take his purse. Inside you find 100 Shards. Content with a good bit of banditry, you decide to call it a night.">

<ROOM STORY379
	(DESC "379")
	(STORY TEXT379)
	(EVENTS STORY379-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY379-EVENTS ()
	<GAIN-MONEY 100>>

<CONSTANT TEXT380 "\"By the Larcenous One!\" exclaims the high priest joyfully. \"You are indeed an accomplished rogue.\"||The high priest teaches you secret knowledge of Sig, the God of Deception. You get a 300 Shard reward and you go up 1 Rank.">

<ROOM STORY380
	(DESC "380")
	(STORY TEXT380)
	(EVENTS STORY380-EVENTS)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY380-EVENTS ()
	<RETURN-ITEM ,GOLD-CHAIN-MAIL T>
	<GAIN-MONEY 300>
	<GAIN-RANK 1>
	<UPGRADE-STAMINA <ROLL-DICE 1>>
	<COND (<CHECK-AILMENT ,CURSE-TYRNAI> <STORY-JUMP ,STORY564>)>>

<CONSTANT TEXT381 "You dart down a side tunnel but are horrified to meet several ratmen coming to meet you while your pursuers close in behind. You are caught in a vice and, though you fight with desperate bravery, you are overcome.">

<ROOM STORY381
	(DESC "381")
	(STORY TEXT381)
	(CONTINUE STORY308)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT382 "\"Fishing?\" you ask. \"Surely nothing can live in these poisonous waters.\"||The fisherman shows you a bright yellow fish with grey stripes. \"Only the smolder fish has adapted to the sulphur. It feeds on the local seaweed. Mind you, the smolder fish is totally inedible.\"||\"Why hunt it, then?\"||\"Each fish is worth quite a bit to sorcerers and the like. We have a standing quota to fill each month for the magical colleges at Dweomer. The sulphur-laden organs burn in a particular way -- a very useful ingredient in certain magics, I am told.\"||\"And where does all this sulphur come from?\"||\"Scholars say there is an underground volcanic vent. Others believe it is the breath of the sea dragon. Personally, I always drop a silver nugget into the waters once a month to appease the dragon.\"||\"Silver? Not gold?\",||\"The dragon prefers the taste of silver.\"">

<ROOM STORY382
	(DESC "382")
	(STORY TEXT382)
	(CONTINUE STORY135)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT383 "After a while Fourze circles around, heading across country.">

<ROOM STORY383
	(DESC "383")
	(STORY TEXT383)
	(CHOICES CHOICES-SCOUTING)
	(DESTINATIONS <LTABLE <LTABLE STORY585 STORY263>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT384 "Guildmaster Vernon is pleased to see you. You hand him the copper amulet and he exclaims joyfully, \"The amulet of King Skabb! Well done, indeed.\"||You are given 450 Shards as a reward.">

<ROOM STORY384
	(DESC "384")
	(STORY TEXT384)
	(EVENTS STORY384-EVENTS)
	(CONTINUE STORY010)
	(CODEWORDS <LTABLE CODEWORD-ACID>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY384-EVENTS ()
	<RETURN-ITEM ,COPPER-AMULET T>
	<GAIN-MONEY 450>>

<CONSTANT TEXT385 "The king is taken totally by surprise, and you cut him down. He falls dead at your feet.||\"Long live General Marlock,\" you mutter under your breath.||You take the king's royal ring as proof of your act.||Although you manage to talk your way out of the stockade, the body is discovered as you are heading down the mountain path. Vengeful soldiers set off in pursuit.">
<CONSTANT CHOICES385 <LTABLE TEXT-ROLL-SCOUTING TEXT-ROLL-THIEVERY>>

<ROOM STORY385
	(DESC "385")
	(STORY TEXT385)
	(CHOICES CHOICES385)
	(DESTINATIONS <LTABLE <LTABLE STORY167 STORY230> <LTABLE STORY167 STORY230>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 9> <LTABLE ABILITY-THIEVERY 9>>)
	(TYPES TWO-ABILITY)
	(ITEMS <LTABLE ROYAL-RING>)
	(CODEWORDS <LTABLE CODEWORD-ARK>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT386 "There is no sign of Lauria, but you do find an open trunk and a window with a knotted rope dangling from it. So she found the treasure and then made her escape, leaving you behind to face the music. You allow yourself a tight-lipped smile as you hear her voice echoing leadenly from far off in the fog: \"There's a thief at Master Talanexor's house. Quick!\"||You'll settle the score with Lauria at a future date. For now, you just have time to escape before a patrol arrives.">

<ROOM STORY386
	(DESC "386")
	(STORY TEXT386)
	(CONTINUE STORY010)
	(CODEWORDS <LTABLE CODEWORD-ASHEN>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT387 "You are on a road between Caran Baru and Trefoille. You come to the Weary Pilgrim Tavern, a way station between the cities. The tavern costs you 1 Shard a day. Each day you spend here, you can recover 1 Stamina point if injured, up to the limit of your normal unwounded Stamina score.">
<CONSTANT CHOICES387 <LTABLE "If you want to spend 3 Shards buying drinks all round so you can glean rumours" "To leave, you can go: South" "North" "West into the Forest of Larun" "East to the lake">>

<ROOM STORY387
	(DESC "387")
	(VISITS 0)
	(STORY TEXT387)
	(EVENTS STORY387-EVENTS)
	(CHOICES CHOICES387)
	(DESTINATIONS <LTABLE STORY666 STORY558 STORY347 STORY047 STORY135>)
	(REQUIREMENTS <LTABLE 3 NONE NONE NONE NONE>)
	(TYPES <LTABLE R-MONEY R-NONE R-NONE R-NONE R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY387-EVENTS ()
	<VISIT-INN ,STORY387 1 1>>

<ROOM STORY388
	(DESC "388")
	(STORY TEXT-BLESSING-ELNIR)
	(EVENTS STORY388-EVENTS)
	(CONTINUE STORY316)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY388-EVENTS ()
	<PURCHASE-BLESSING 25 10 ,GOD-ELNIR ,BLESSING-CHARISMA>>

<CONSTANT TEXT389 "Driving one of the creatures back with your sword, you leap on to the forecastle shouting, \"To me, men!\" They rally around you, organizing themselves into a fighting unit and a battle ensues. You must fight one ker'ilk.">

<ROOM STORY389
	(DESC "389")
	(STORY TEXT389)
	(EVENTS STORY389-EVENTS)
	(CONTINUE STORY519)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY389-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-KER-ILK 4 9 8>
	<CHECK-COMBAT ,MONSTER-KER-ILK ,STORY389>>

<CONSTANT TEXT390 "The horses rush past you. They seem to gallop through the air, whinnying and neighing, bellowing at the twilight sky. Soon they disappear from your sight. You make camp, and the next day continue your journey.">
<CONSTANT CHOICES390 <LTABLE "Go north across country" "Head east to the road" "Go to Trefoille" TEXT-TO-MARLOCK "Head west towards the River Grimm">>

<ROOM STORY390
	(DESC "390")
	(STORY TEXT390)
	(CHOICES CHOICES390)
	(DESTINATIONS <LTABLE STORY560 STORY558 STORY250 STORY100>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT391 "\"Umm, well, I suppose I could let one such as you through,\" says the tree thoughtfully. Then it uproots itself with a great tearing sound, and shuffles out of the way. \"There you go. You may pass.\"||You walk through the thorn bush gate. Beyond, you find several huge oak trees whose branches are so big that they are able to support the homes of many people.">

<ROOM STORY391
	(DESC "391")
	(STORY TEXT391)
	(CONTINUE STORY358)
	(CODEWORDS <LTABLE CODEWORD-APPLE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT392 "You pass your hands over the mad beggar, mumbling a prayer to the gods.||The beggar cries out, \"A cloud has been lifted from my mind. The curse is dispelled. I remember all!\"||His name, he tells you, is Akradai, the Azure Prince of the Horde of the Thundering Skies, nomads of the steppes. \"I was cursed with madness by Shazir of the Ruby Citadel but now you have cured me,\" he says. \"I am forever in your debt. Seek me on the steppes and I shall reward you.\"">

<ROOM STORY392
	(DESC "392")
	(STORY TEXT392)
	(CONTINUE STORY010)
	(CODEWORDS <LTABLE CODEWORD-AZURE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT393 "You hear a sound behind you. You spin around just as a another man, a beefy, disreputable-looking thug, comes for you with a long dagger. \"Get the interfering busybody!\" yells the man with the eyepatch. You must fight.">

<ROOM STORY393
	(DESC "393")
	(STORY TEXT393)
	(EVENTS STORY393-EVENTS)
	(CONTINUE STORY476)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY393-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-THUG 3 6 13>
	<CHECK-COMBAT ,MONSTER-THUG ,STORY393>>

<CONSTANT TEXT394 "When you and your crew join the fray, the battle is short-lived. The Sokarans are overpowered, and taken as slaves by the pirates.||The pirate captain, Verin Crookback, is a short, bull-chested man. He walks like a hunchback, because of a crippling wound he took to the shoulder blade, many years ago. He thanks you for your help and rewards you with a share of the booty from the Sokaran warships -- only 50 Shards. He also hands you a silver medallion.||\"If you ever go to the Kingdom of the Reavers,\" he says, \"flash this about. One of the lads'll recognize it. Villains, the lot of them, but they'll honour one who carries the medallion. Someone will bring you to me. I'll help you, if you need it.\"||The pirates take their leave and you sail on.">

<ROOM STORY394
	(DESC "394")
	(STORY TEXT394)
	(EVENTS STORY394-EVENTS)
	(CONTINUE STORY420)
	(ITEMS <LTABLE SILVER-MEDALLION>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY394-EVENTS ()
	<GAIN-MONEY 50>>

<CONSTANT TEXT395 "You make it out of the temple with your pursuers close behind. However, you manage to lose them amid the alleys of Caran Baru, hiding inside a barrel of rotting food -- garbage from the army barracks. You emerge stinking, but safe.">

<ROOM STORY395
	(DESC "395")
	(STORY TEXT395)
	(CONTINUE STORY400)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT396 "The market square in Marlock City is huge. Armed guards stand around the edge to enforce General Marlock's will. Merchants and traders from all over Harkuna hawk their goods in a dozen languages.||Items that are not available locally are not listed. The general has imposed a sales tax on all trade; the tax has been included in all the prices listed.">
<CONSTANT CHOICES396 <LTABLE "Buy armours/weapons/magic/other items" "Sell armours/weapons/magic/other items" "Return to city centre">>

<ROOM STORY396
	(DESC "396")
	(LOCATION LOCATION-MARLOCK)
	(STORY TEXT396)
	(CHOICES CHOICES396)
	(DESTINATIONS <LTABLE MARLOCK-CITY-BUY MARLOCK-CITY-SELL STORY100>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM STORY397
	(DESC "397")
	(STORY TEXT-STORM-SUBSIDES)
	(EVENTS STORY-LOSE-CARGO)
	(CONTINUE STORY090)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT398 "You make your way up the hill. After a while, you spot a cave set into the hillside, a little further up. Judging by the human bones, dumped near the entrance, this is the lair of a dangerous beast. Fresh tracks, of some large, two-legged, three-toed creature, lead from the cave into some nearby trees. It seems it is not at home, at the moment.">
<CONSTANT CHOICES398 <LTABLE HAVE-CODEWORD IF-NOT>>

<ROOM STORY398
	(DESC "398")
	(VISITS 0)
	(BACKGROUND STORY398-BACKGROUND)
	(STORY TEXT398)
	(CHOICES CHOICES398)
	(DESTINATIONS <LTABLE STORY463 STORY710>)
	(REQUIREMENTS <LTABLE CODEWORD-APACHE NONE>)
	(TYPES <LTABLE R-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY398-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY398 1> <RETURN ,STORY225>)>
	<RETURN ,STORY398>>

<CONSTANT TEXT399 "You were asked by the Governor of Yellowport to assassinate Nergan Corin. It is a good time to make the attempt if you want to.">
<CONSTANT CHOICES399 <LTABLE "Try to assassinate Nergan Corin" "Join the rebels and try to kill the governor instead">>

<ROOM STORY399
	(DESC "399")
	(STORY TEXT399)
	(CHOICES CHOICES399)
	(DESTINATIONS <LTABLE STORY715 STORY716>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT400 "Caran Baru is a medium-sized town, that acts as a way-station between the citadel to the north, and the rich towns of the south. It is a garrison town; many supplies, arms and soldiers move through Caran Baru on the north-south trail. Shops, traders, temples and the like have sprung up here to serve the needs of the military. There is also a sizeable mining community, for the mines of Sokara lie in the Bronze Hills just outside town, and a slave market where poor unfortunates, sold into slavery, are bought for work in the mines.||You can buy a townhouse in Caran Baru for 200 Shards. Owning a townhouse gives you a place to rest and store equipment.">

<CONSTANT CARAN-BARU-CHOICES
	<LTABLE
		"Visit the marketplace"
		"Visit the merchants' guild"
		"Visit the slave market"
		"Visit the temple of Tyrnai"
		"Visit the temple of Lacuna"
		"Visit the temple of the Three Fortunes"
		"Visit your townhouse"
		"Visit the Blue Griffon Tavern"
		"Visit the Blue Griffon Tavern"
		"Follow the road north to the citadel"
		"Go west into the Bronze Hills"
		"Travel north east into the country"
		"Take the east road to Fort Mereth"
		"Head south east into the mountains"
		"Take the south road"
	>>

<CONSTANT CARAN-BARU-DESTINATIONS
	<LTABLE
		STORY215
		STORY112
		STORY473
		STORY282
		STORY615
		STORY086
		STORY177
		STORY184
		STORY201
		STORY110
		STORY060
		STORY458
		STORY474
		STORY347
	>>

<CONSTANT CARAN-BARU-REQUIREMENTS
	<LTABLE
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		CODEWORD-AQUA
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
		NONE
	>>

<CONSTANT CARAN-BARU-TYPES
	<LTABLE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-CODEWORD
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
		R-NONE
	>>

<ROOM STORY400
	(DESC "400")
	(LOCATION LOCATION-CARAN)
	(STORY TEXT400)
	(EVENTS STORY400-EVENTS)
	(CHOICES CARAN-BARU-CHOICES)
	(DESTINATIONS CARAN-BARU-DESTINATIONS)
	(REQUIREMENTS CARAN-BARU-REQUIREMENTS)
	(TYPES CARAN-BARU-TYPES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY400-EVENTS ()
	<COND (<CHECK-CODEWORD ,CODEWORD-BARNACLE>
		<STORY-JUMP ,STORY418>
	)(<AND <NOT <CHECK-CODEWORD ,CODEWORD-AQUA>> <G=? ,MONEY 200>>
		<CRLF>
		<TELL "Would you like to buy a townhouse in Caran Baru (200 " D ,CURRENCY ")?">
		<COND (<YES?>
			<COST-MONEY 200>
			<GAIN-CODEWORD ,CODEWORD-AQUA>
			<GAIN-TOWNHOUSE ,TOWNHOUSE-CARAN-BARU>
		)>
	)>>

<CONSTANT TEXT401 "The captain gives you a satisfied smile.||\"Harbour duties all paid up. You may proceed,\" he says mockingly. He and his men leave the ship. Several of your crew curse or spit in disgust.||You sail on.">

<ROOM STORY401
	(DESC "401")
	(STORY TEXT401)
	(CONTINUE STORY439)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT402 "Your ship draws away, leaving the Sokarans behind. Your crew jeer at them, and you spot the captain shaking his fist at you in rage, before they disappear from sight.">

<ROOM STORY402
	(DESC "402")
	(STORY TEXT402)
	(CONTINUE STORY439)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT403 "You dump the head of Amcha One-eye on the guildmaster\"s desk. He stares at in horror for a moment and then a look of joy crosses his features.||\"At last we are rid of that scourge of commerce. Well done indeed.\"||The guildmaster pays for you to have special training. You can choose which area you would like to improve -- you gain one point on one ability of your choice (for example, +1 COMBAT).">
<CONSTANT TEXT403-CONTINUED "You return to the city. \"Come back any time,\" yells the guildmaster as you go.">

<ROOM STORY403
	(DESC "403")
	(VISITS 0)
	(BACKGROUND STORY403-BACKGROUND)
	(STORY TEXT403)
	(EVENTS STORY403-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY403-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY403 1> <RETURN ,STORY229>)>
	<RETURN ,STORY403>>

<ROUTINE STORY403-EVENTS ()
	<RETURN-ITEM ,AMCHAS-HEAD T>
	<UPGRADE-ABILITIES 1>
	<IF-ALIVE ,TEXT403-CONTINUED>>

<CONSTANT TEXT404 "One of the cultists of Badogor the Unspoken is feigning distress in the hope of luring a sacrificial victim for dinner. He sits up when he recognizes you as a member of the cult and says, rather disconsolately, \"Ah, hallo, friend. We were hoping for a big banquet tonight.\"||Two more cultists step from the shadows, holding a net. \"Oh well, perhaps another will come along,\" one of them says optimistically.||They treat you as one of their own, even giving you a share of the cult's recent income.||\"May you never speak his name,\" they intone in parting.||You return to the city centre.">

<ROOM STORY404
	(DESC "404")
	(STORY TEXT404)
	(EVENTS STORY404-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY404-EVENTS ()
	<GAIN-MONEY 20>>

<CONSTANT TEXT405 "The merchants' guild of Yellowport is a large building of granite, plushly decorated inside to show off its wealth. Here you can bank your money for safe-keeping -- or invest it in guild enterprises in the hope of making a profit. You hear that the guildmaster is looking for adventurers.">
<CONSTANT CHOICES405 <LTABLE "Visit the guildmaster" "Make an investment" "Check on investments" "Deposit or withdraw money" "Return to the town centre">>

<ROOM STORY405
	(DESC "405")
	(LOCATION LOCATION-YELLOWPORT)
	(STORY TEXT405)
	(CHOICES CHOICES405)
	(DESTINATIONS <LTABLE STORY122 STORY046 STORY355 STORY605 STORY010>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT406 "You know that the Book of the Seven Sages that Pyletes wants lies within the mound.">
<CONSTANT CHOICES406 <LTABLE "Try and get it" "Leave it for another time">>

<ROOM STORY406
	(DESC "406")
	(LOCATION LOCATION-SCORPION)
	(STORY TEXT406)
	(CHOICES CHOICES406)
	(DESTINATIONS <LTABLE STORY714 STORY492>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT407 "You hide in the kitchen pantry, and then, disguised as a kitchen scullion, sneak out unnoticed. The skill and daring of your exploit will be forever remembered! Long live the rightful king!">

<ROOM STORY407
	(DESC "407")
	(STORY TEXT407)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT408 "You decline. They look at you inscrutably, and then sink beneath the waves with the body of their companion.">

<ROOM STORY408
	(DESC "408")
	(STORY TEXT408)
	(CONTINUE STORY507)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT409 "Becoming an initiate of Nagil gives you the benefit of paying less for services the temple can offer. You cannot do this if you are already an initiate of another temple. To become an initiate you have to pass a priestly exam.">

<ROOM STORY409
	(DESC "409")
	(VISITS 1)
	(STORY TEXT409)
	(EVENTS STORY409-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY409-EVENTS ("AUX" (DIFFICULTY 10))
	<COND (<CHECK-VISITS-MORE ,STORY409 1> <SET DIFFICULTY 15>)>
	<COND (<NOT ,GOD>
		<CRLF>
		<TELL "Face the trial to become an Initiate of Nagil?">
		<COND (<YES?>
			<CRLF>
			<COND (<TEST-ABILITY ,CURRENT-CHARACTER ,ABILITY-SANCTITY .DIFFICULTY>
				<SETG GOD ,GOD-NAGIL>
				<EMPHASIZE "You have become an Initiate of the God Nagil!">
				<STORY-JUMP ,STORY071>
			)>
		)>
	)(<CHECK-GOD ,GOD-NAGIL>
		<EMPHASIZE "You are already and Initiate of the God Nagil!">
	)(ELSE
		<EMPHASIZE "You are already and Initiate of another God!">
	)>>

<CONSTANT TEXT410 "\"Oh, what a load of rotten leaves!\" exclaims the tree, \"Anyone can see you're as bad as the next human. In fact, I'd say you're probably a... a lumberjack! Now, get lost.\"">
<CONSTANT CHOICES410 <LTABLE "Leave the forest" "Attack the tree">>

<ROOM STORY410
	(DESC "410")
	(STORY TEXT410)
	(CHOICES CHOICES410)
	(DESTINATIONS <LTABLE STORY678 STORY570>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT411 "The high priest tells you that the golden net of the twin gods has been stolen. The repulsive ones have taken it to their palace beneath the sea in the Sunken City of Ziusudra. The repulsive ones worship the fish-god Oannes, who struggles with Alvir and Valmir for control of the sea.||\"We must have that golden net, or the repulsive ones will use it against us. If you return it to us, we will reward you,\" says the high priest. \"The Sunken City lies under the coastal waters off the Shadar Tor.\"">
<CONSTANT CHOICES411 <LTABLE "Take up the mission" IF-NOT>>

<ROOM STORY411
	(DESC "411")
	(STORY TEXT411)
	(CHOICES CHOICES411)
	(DESTINATIONS <LTABLE STORY220 STORY220>)
	(REQUIREMENTS <LTABLE MISSION-GOLDEN-NET NONE>)
	(TYPES <LTABLE R-TAKE-MISSION R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT412 "You are on the cobbled road between Yellowport and Trefoille. You meet a few merchants and pilgrims, but all in all it is an uneventful journey.">
<CONSTANT CHOICES412 <LTABLE "Head for Yellowport" "Head for Trefoille">>

<ROOM STORY412
	(DESC "412")
	(STORY TEXT412)
	(LOCATION LOCATION-SOKARA)
	(CHOICES CHOICES412)
	(DESTINATIONS <LTABLE STORY010 STORY250>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT413 "You are so devout that the king's spell cannot affect you for more than a few seconds. The queen, recognizing your faith in the gods, thanks you for entertaining them.||You wake up in the cabin aboard your ship. You are musing about the strange nature of your dream when you realize you have something in your hand. It is a silver flute. It is worth 500 Shards, and you can sell it at any market if you like.">

<ROOM STORY413
	(DESC "413")
	(STORY TEXT413)
	(CONTINUE STORY507)
	(ITEMS <LTABLE SILVER-FLUTE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT414 "Haylie runs into her mother's arms for a tearful reunion. Lynn, the mother, gives you a suit of chain mail and a sword.||\"These have been in the family for generations. It's all I have to give,\" she says.||Fourze is hauled off to the local magistrate for judgment. He will probably be sold into slavery.">

<ROOM STORY414
	(DESC "414")
	(STORY TEXT414)
	(CONTINUE STORY427)
	(ITEMS <LTABLE SWORD CHAIN-MAIL>)
	(CODEWORDS <LTABLE CODEWORD-ATTAR>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT415 "You cannot continue. You sink to your knees, gasping for water and pass out. Death is not long in coming. It is all over.">

<ROOM STORY415
	(DESC "415")
	(STORY TEXT415)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<CONSTANT CHOICES416 <LTABLE "Order the crew to sail south west (Over the Blood-Dark Sea)" "Sail south (Over the Blood-Dark Sea)" "Order the crew to sail south east (Over the Blood-Dark Sea)" "Sail south east (Over the Blood-Dark Sea)" "Turn back">>

<ROOM STORY416
	(DESC "416")
	(STORY TEXT-VIOLET-OCEAN)
	(CHOICES CHOICES416)
	(DESTINATIONS <LTABLE STORY-BLOOD-DARK-SEA <LTABLE STORY-BLOOD-DARK-SEA STORY559> STORY-BLOOD-DARK-SEA <LTABLE STORY-BLOOD-DARK-SEA STORY559> STORY559>)
	(REQUIREMENTS <LTABLE 4 <LTABLE ABILITY-CHARISMA 12> 4 <LTABLE ABILITY-CHARISMA 12> NONE>)
	(TYPES <LTABLE R-RANK R-TEST-ABILITY R-RANK R-TEST-ABILITY R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT417 "The other knights are amazed by your skill, and they seem quite pleased that the Black Dragon Knight is dead.||\"He was an evil man,\" says the Green Dragon Knight.||You take the black dragon shield. As you watch, the rest of your opponent's body dissolves into a foul-smelling smoke, armour and all.||You leave the castle.">

<ROOM STORY417
	(DESC "417")
	(STORY TEXT417)
	(EVENTS STORY417-EVENTS)
	(CONTINUE STORY276)
	(ITEMS <LTABLE BLACK-DRAGON-SHIELD>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY417-EVENTS ()
	<DELETE-CODEWORD ,CODEWORD-AXE>>

<CONSTANT TEXT418 "You have heard that the man with the velvet eyepatch should be in Caran Baru.">
<CONSTANT CHOICES418 <LTABLE "If you want to search for him now" IF-NOT>>

<ROOM STORY418
	(DESC "418")
	(STORY TEXT418)
	(CHOICES CHOICES418)
	(DESTINATIONS <LTABLE STORY117 STORY400>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT419 "The trail of gruesome murders, and tales of terror leads you to an old cemetery in a near-deserted part of the old quarter. It is early morning, a few hours from daylight, so you haven't much time before it goes into hiding.||At the gates of the cemetery, you find a small girl, hunched over, sobbing. When she sees you, she backs away, terrified.">

<ROOM STORY419
	(DESC "419")
	(STORY TEXT419)
	(CHOICES CHOICES-CHARISMA)
	(DESTINATIONS <LTABLE <LTABLE STORY553 STORY045>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-CHARISMA 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT420 "Your ship is sailing in the coastal waters beside Marlock City. You notice an unusual number of Sokaran warships patrolling the area.||\"The pirates are getting bolder and bolder -- that's why the navy's out in force,\" says the first mate.">
<CONSTANT CHOICES420 <LTABLE "Sail west (Cities of Gold and Glory)" "Sail into Marlock City" "Sail east along the coast" "Sail south into the Violet Ocean">>

<ROOM STORY420
	(DESC "420")
	(STORY TEXT420)
	(CHOICES CHOICES420)
	(DESTINATIONS <LTABLE STORY-CITIES-GOLD-GLORY STORY142 STORY120 STORY502>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT421 "The storm demons shrink back with a wailing, mournful cry, like wind in the trees. The power of your faith is enough to repel them. You work free one of the stakes holding down Sul Veneris.">

<ROOM STORY421
	(DESC "421")
	(STORY TEXT421)
	(CONTINUE STORY365)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT422 "The bandits are dead. The man inside the suit surrenders. It is Fourze, the master of the market. He terrified people with the monster disguise, and used a large pair of bellows full of gas to put his victims to sleep. Then he sold them to a slaver from Caran Baru, for work in the slave mines. You find Haylie, and several other villagers in the cellar of an old farm nearby.||\"Don't hurt me,\" begs Fourze, \"I'm only trying to make a few Shards.\"||\"What, by selling your own people into slavery?\" says one of the villagers, giving him a good kick.||You lead them back to Venefax.">

<ROOM STORY422
	(DESC "422")
	(STORY TEXT422)
	(CONTINUE STORY414)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT423 "The ratmen lie defeated at your feet. You find 15 Shards on the bodies, and a note which says: 'Parti! Kitchuns. Tonite. Rank and file rats only. No offsirs and no king allowed!'||The rest of the cavern is bare, so you press on down the tunnels ahead.||After a while you come to a cleaner area of the sewers, a part of the old city now buried under Yellowport. It dates from the period when all of Harkuna was ruled by the Masked Ones of Uttaku, before the people overthrew them.||You come to two rotten wooden doors. Names have been scratched on to them by some half-literate ratman. One says 'Thrown Rum'; the other says 'Kitchuns'. You can hear gravelly rat voices from behind both doors.">
<CONSTANT CHOICES423 <LTABLE "Enter the 'kitchuns'" "Enter the 'thrown rum'">>

<ROOM STORY423
	(DESC "423")
	(STORY TEXT423)
	(EVENTS STORY423-EVENTS)
	(CHOICES CHOICES423)
	(DESTINATIONS <LTABLE STORY572 STORY202>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY423-EVENTS ()
	<GAIN-MONEY 15>>

<CONSTANT TEXT424 "The ship's captain says, \"I'll take you but you should be warned, it's a dangerous place we're travelling to. You'd better be sure you can handle it. If you're not at least a master of your profession, I'd advise against. But it's up to you.\"">
<CONSTANT CHOICES424 <LTABLE "If you still want to go (Over the Blood-Dark Sea)" "If you decide not to go to Copper Island">>

<ROOM STORY424
	(DESC "424")
	(STORY TEXT424)
	(CHOICES CHOICES424)
	(DESTINATIONS <LTABLE STORY-BLOOD-DARK-SEA STORY712>)
	(REQUIREMENTS <LTABLE 30 NONE>)
	(TYPES <LTABLE R-MONEY R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT425 "The woman tells you her name is Lauria. She leads you stealthily through winding cobblestoned streets to a town house standing at the back of a small tree-lined square.||A yellowish fog is descending with the coming of night. Lauria waits until it is thick enough to shroud your activities from any stray passersby, then jemmies a downstairs window. Within seconds the two of you are inside.||\"The stuff we're after is upstairs.\" she says. \"You've got the easy job. Stay down here and keep watch.\"||She bounds silently up to the next floor.">
<CONSTANT CHOICES425 <LTABLE "Stay on watch" "Search the ground floor">>

<ROOM STORY425
	(DESC "425")
	(STORY TEXT425)
	(CHOICES CHOICES425)
	(DESTINATIONS <LTABLE STORY534 STORY270>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT426 "\"I see that you are a student of the arcane arts,\" says Oliphard the Wizardly. \"There is something I need. If you can get it for me I will teach you how to advance as a mage. It was Vayss the Sea Dragon who turned me into powder. He stole my magic chest in which I store all my magical equipment. Without it, I am virtually powerless. Meet me in Trefoille when you have it.\"||\"Where is Vayss?\" you ask.||\"In the Lake of the Sea Dragon, of course.\"||As he leaves, Oliphard gives you an amulet of protection.">

<ROOM STORY426
	(DESC "426")
	(STORY TEXT426)
	(CONTINUE STORY378)
	(ITEMS <LTABLE AMULET-OF-PROTECTION>)
	(CODEWORDS <LTABLE CODEWORD-AVENGE>)
	(FLAGS LIGHTBIT)>

<ROOM STORY427
	(DESC "427")
	(LOCATION LOCATION-VENEFAX)
	(BACKGROUND STORY427-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY427-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-ATTAR> <RETURN ,STORY578>)>
	<RETURN ,STORY711>>

<CONSTANT TEXT428 "With a martial cry you draw your weapon and charge. You manage to cut down two of the ratmen before they can react. The remaining two officers draw their swords while King Skabb ducks down behind his throne.">

<ROOM STORY428
	(DESC "428")
	(STORY TEXT428)
	(EVENTS STORY428-EVENTS)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY428-EVENTS ("AUX" (MODIFIER 0))
	<COND (<CHECK-ITEM ,RAT-POISON>
		<CRLF>
		<TELL "Use the rat poison?">
		<COND (<YES?>
			<SET MODIFIER 3>
			<EMPHASIZE "The rat poison adds +3 to your COMBAT rolls.">
			<REMOVE-ITEM ,RAT-POISON "used" T T>
		)>
	)>
	<COMBAT-MONSTER ,MONSTER-TWO-RATMEN 8 11 12>
	<COND (<CHECK-COMBAT ,MONSTER-TWO-RATMEN ,STORY042 .MODIFIER>
		<STORY-JUMP ,STORY145>
	)(ELSE
		<STORY-JUMP ,STORY308>
	)>>

<CONSTANT TEXT429 "The gloomy wreck is filled with coral-encrusted skeletons of its drowned crew. You find the captain\"s cabin. Inside, a figure still sits in a chair, a chest of gems at its feet. With a thrill of horror, you realize it is a ghost, an undead remnant of a pirate captain, steeped in evil, its nacreous, fish-gnawed flesh still pulsing with a kind of half-life.">
<CONSTANT CHOICES429 <LTABLE "Swim straight in and grab the chest" "Try to steal it without being seen">>

<ROOM STORY429
	(DESC "429")
	(STORY TEXT429)
	(CHOICES CHOICES429)
	(DESTINATIONS <LTABLE STORY089 STORY363>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT430 "You are sailing in the waters around Scorpion Bight.||\"I wouldn't want to put into land in these parts,\" says your navigator. \"The scorpion men'll take all we've got, and our lives too, given half a chance.\"">
<CONSTANT STORY430-REQUIREMENTS <LTABLE <LTABLE 2 0 <LTABLE 4 7 9 12> <LTABLE TEXT-STORM TEXT-UNEVENTFUL "A ship of bizarre design" "A floating island">>>>

<ROOM STORY430
	(DESC "430")
	(STORY TEXT430)
	(CHOICES CHOICES-RANDOM)
	(DESTINATIONS <LTABLE <LTABLE STORY586 STORY085 STORY056 STORY264>>)
	(REQUIREMENTS STORY430-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT431 "You notice that Oliphard has erected his pavilion over a verdigris trapdoor set into the floor.||\"I see you have the key,\" says Oliphard. \"Please, be my guest -- use the door.\"||You open it up and climb some short stairs into a square chamber with three doors.|| \"They are doors of teleportation -- step through and you will be taken to whatever land is displayed!\" says Oliphard.||The first door leads to a teeming city of merchants -- Metriciens in Golnir.||The second door leads to a cloud-fringed peak: Sky Mountain in the Great Steppes, far to the north.||The third door leads to Dweomer, the City of Sorcerers, on Sorcerers' Isle.">
<CONSTANT CHOICES431 <LTABLE "Enter the first door (Cities of Gold and Glory)" "Enter the second door (The Plains of Howling Darkness)" "Enter the third door (Over the Blood-Dark Sea)" "If you don't want to step through any of the doors">>

<ROOM STORY431
	(DESC "431")
	(STORY TEXT431)
	(CHOICES CHOICES431)
	(DESTINATIONS <LTABLE STORY-CITIES-GOLD-GLORY STORY-PLAINS-HOWLING-DARKNESS STORY-BLOOD-DARK-SEA STORY656>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT432 "The militiamen are down. The tall gentleman watches you like a snake with its eyes on a mongoose. You have no time to bother with him now.||\"We'll meet again, perhaps,\" he says in a voice like slithering murder.||\"Remember my name: Talanexor the Fireweaver.\"||\"Remember my name,\" you call back as you lope off, \"Lauria the Housebreaker.\"||Let the conniving vixen get into trouble. She nearly played you for her patsy, after all.">

<ROOM STORY432
	(DESC "432")
	(STORY TEXT432)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT433 "You rush in, taking the ruffians by surprise. A couple of good buffets around the head, and they run off. The scholar lies groaning on the ground.">
<CONSTANT CHOICES433 <LTABLE "Help him up" "Rob him">>

<ROOM STORY433
	(DESC "433")
	(STORY TEXT433)
	(CHOICES CHOICES433)
	(DESTINATIONS <LTABLE STORY172 STORY379>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM STORY434
	(DESC "434")
	(STORY TEXT-TOWNHOUSE)
	(EVENTS STORY434-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY434-EVENTS ()
	<VISIT-TOWNHOUSE ,STORY434 ,TOWNHOUSE-MARLOCK T ,CODEWORD-AEGIS>>

<CONSTANT TEXT435 "Becoming an initiate of Tyrnai gives you the benefit of paying less for blessings and other services the temple can offer. To qualify as an initiate you must have a COMBAT score of at least 6. You cannot become an initiate of Tyrnai if you are already an initiate of another temple.">

<ROOM STORY435
	(DESC "435")
	(STORY TEXT435)
	(EVENTS STORY435-EVENTS)
	(CONTINUE STORY526)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY435-EVENTS ("AUX" COMBAT)
	<SET COMBAT <CALCULATE-ABILITY ,CURRENT-CHARACTER ,ABILITY-COMBAT ,PLAYER>>
	<COND (<NOT ,GOD>
		<COND (<G=? .COMBAT 6>
			<CRLF>
			<TELL "Become an Initiate of ">
			<HLIGHT ,H-BOLD>
			<TELL D ,GOD-TYRNAI>
			<HLIGHT 0>
			<TELL " (COMBAT: ">
			<HLIGHT ,H-BOLD>
			<TELL N .COMBAT>
			<HLIGHT 0>
			<TELL ")?">
			<COND (<YES?>
				<SETG GOD ,GOD-TYRNAI>
				<CRLF>
				<HLIGHT ,H-BOLD>
				<TELL "You have become an Initiate of " D ,GOD ,PERIOD-CR>
				<HLIGHT 0>
			)>
		)(ELSE
			<CRLF>
			<TELL "You cannot become an Initiate of ">
			<HLIGHT ,H-BOLD>
			<TELL D ,GOD-TYRNAI>
			<HLIGHT 0>
			<TELL " at this time. Your combat is score is ">
			<HLIGHT ,H-BOLD>
			<TELL N .COMBAT>
			<HLIGHT 0>
			<TELL ", lower than the required.">
		)>
	)(ELSE
		<CRLF>
		<HLIGHT ,H-BOLD>
		<TELL "You are already an Initiate of " D ,GOD ,EXCLAMATION-CR>
		<HLIGHT 0>
	)>>

<CONSTANT TEXT436 "You find yourself washed up on a rocky shore, battered and cold but lucky to be alive. You haul yourself up the beach. You are near the Trading Post on the Isle of Druids.">

<ROOM STORY436
	(DESC "436")
	(STORY TEXT436)
	(CONTINUE STORY195)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT437 "Becoming an initiate of Sig gives you the benefit of paying less for blessings and other services. Also, you can add 1 to your THIEVERY score, as Sig will watch over your pilfering activities and keep you safe from the law. It costs 50 Shards to become an initiate. You cannot become an initiate of Sig if you are an initiate of any other temple.">

<ROOM STORY437
	(DESC "437")
	(STORY TEXT437)
	(EVENTS STORY437-EVENTS)
	(CONTINUE STORY235)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY437-EVENTS ()
	<BECOME-INITIATE 50 ,GOD-SIG>>

<CONSTANT TEXT438 "The climb is too arduous for you. The air becomes too thin to breathe, and you cannot find the footholds you need to pull yourself up. You are forced to abandon the attempt and climb back down.">

<ROOM STORY438
	(DESC "438")
	(STORY TEXT438)
	(CONTINUE STORY244)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT439 "Your ship is sailing in the coastal waters beside Yellowport.">
<CONSTANT CHOICES439 <LTABLE "Sail into Yellowport Harbour" "Sail north east towards Scorpion Bight" "Sail south west along the coast" "Sail south into the Violet Ocean">>

<ROOM STORY439
	(DESC "439")
	(STORY TEXT439)
	(CHOICES CHOICES439)
	(DESTINATIONS <LTABLE STORY555 STORY430 STORY120 STORY366>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM STORY440
	(DESC "440")
	(STORY TEXT-INITIATE-ELNIR)
	(EVENTS STORY440-EVENTS)
	(CONTINUE STORY568)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY440-EVENTS ()
	<BECOME-INITIATE 60 ,GOD-ELNIR>>

<CONSTANT TEXT441 "You clamber up on to the battlements of the Temple of Tyrnai with relative ease and manoeuvre yourself into a position overlooking the golem guards at the gate. Now you have to reach down without being noticed.">

<ROOM STORY441
	(DESC "441")
	(STORY TEXT441)
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE <LTABLE STORY022 STORY168>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT442 "You set out to explore the city of Yellowport at night, unwholesome though it is with its reeking air and dusty ochre streets.">
<CONSTANT CHOICES442 <LTABLE "Head for the rough part of town" "Go to the wealthy area" "Explore the merchants' storehouses">>

<ROOM STORY442
	(DESC "442")
	(LOCATION LOCATION-YELLOWPORT)
	(STORY TEXT442)
	(CHOICES CHOICES442)
	(DESTINATIONS <LTABLE STORY021 STORY178 STORY265>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT443 "You are witness to a major sea battle involving at least forty warships between the Sokaran navy and a pirate fleet. Arrows fill the air and smoking fireballs are launched from catapults mounted on some of the ships. The shrieks of the dying carry across the waves. You decide it would be better not to get involved in such a conflict.">

<ROOM STORY443
	(DESC "443")
	(STORY TEXT443)
	(CONTINUE STORY420)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT444 "You try to make a run for it.">
<CONSTANT STORY444-REQUIREMENTS <LTABLE <LTABLE 2 0 <LTABLE 7 100> <LTABLE "The galley overtakes you" "You outrun them">>>>

<ROOM STORY444
	(DESC "444")
	(STORY TEXT444)
	(EVENTS STORY444-EVENTS)
	(CHOICES CHOICES-RANDOM)
	(DESTINATIONS <LTABLE <LTABLE STORY051 STORY402>>)
	(REQUIREMENTS STORY444-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY444-EVENTS ("AUX" ODDS PARAMETERS (MODIFIER 0) (CONDITION NONE))
	<RESET-ODDS 2 0 ,STORY444>
	<SET MODIFIER 0>
	<SET ODDS <GETP ,STORY444 ,P?REQUIREMENTS>>
	<SET PARAMETERS <GET .ODDS 1>>
	<SET MODIFIER <+ .MODIFIER <GET-RANK ,CURRENT-CHARACTER>>>
	<COND (,CURRENT-SHIP
		<SET CONDITION <GETP ,CURRENT-SHIP ,P?CONDITION>>
		<COND (.CONDITION
			<COND (<EQUAL? .CONDITION ,CONDITION-EXCELLENT>
				<SET MODIFIER <+ .MODIFIER 2>>
			)(<EQUAL? .CONDITION ,CONDITION-GOOD>
				<INC .MODIFIER>
			)(<EQUAL? .CONDITION ,CONDITION-POOR>
				<DEC .MODIFIER>
			)>
		)(ELSE
			<DEC .MODIFIER>
		)>
	)(ELSE
		<DEC .MODIFIER>
	)>
	<PUT .PARAMETERS 2 .MODIFIER>>

<CONSTANT TEXT445 "You climb up, and squeeze through an open window into a long hall. Thin wires are stretched across the room, but you are an able enough rogue to crawl though without touching any of them and setting off possible traps or alarms.||Inside the temple, it is cool and dark, filled with an unearthly stillness. Suddenly, the temple doors are flung open, and two figures lumber into the room. You realize with a thrill of horror that the bull-headed iron statues outside the gates have come to life. They are golems, set here to guard the temple.">
<CONSTANT CHOICES445 <LTABLE "Run for your life" "Fight them">>

<ROOM STORY445
	(DESC "445")
	(STORY TEXT445)
	(CHOICES CHOICES445)
	(DESTINATIONS <LTABLE STORY349 STORY569>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT446 "You set out that night on your quest.">

<ROOM STORY446
	(DESC "446")
	(VISITS 0)
	(BACKGROUND STORY446-BACKGROUND)
	(STORY TEXT446)
	(CHOICES CHOICES-MAGIC)
	(DESTINATIONS <LTABLE <LTABLE STORY511 STORY328>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-MAGIC 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY446-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY446 1> <RETURN ,STORY226>)>
	<RETURN ,STORY446>>

<CONSTANT TEXT447 "You find yourself washed up on a rocky shore, beneath towering cliffs. You are battered and cold, but lucky to be alive. Eventually, you find a path up the cliff. You climb up to find yourself at the Shadar Tor.">

<ROOM STORY447
	(DESC "447")
	(LOCATION LOCATION-SHADAR)
	(STORY TEXT447)
	(CONTINUE STORY035)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT448 "If you are an initiate it costs only 5 Shards to propitiate the twin gods of the sea. A non-initiate must pay 20 Shards.||The blessing works by allowing you to ignore any one storm at sea. You can only have one 'Safety from Storms' blessing at any one time. Once it is used up, you can return to any branch of the temple of Alvir and Valmir to buy a new one.">

<ROOM STORY448
	(DESC "448")
	(STORY TEXT448)
	(EVENTS STORY448-EVENTS)
	(CONTINUE STORY220)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY448-EVENTS ()
	<PURCHASE-BLESSING 20 5 ,GOD-ALVIR-VALMIR ,BLESSING-SAFETY-FROM-STORMS>>

<CONSTANT TEXT449 "You creep past a scorpion man guard, which is dozing at the entrance to one of the burrows. The stench inside the mound is foul -- a kind of acrid, rotting vegetable smell. You head for the centre of the mound, past tunnels, rooms and egg chambers, avoiding the inhabitants by skulking in the shadows.||Finally, you come to a room which is more like the laboratory of a sorcerer than a scorpion den: jars, alembics and scrolls lie all over the place. A scorpion man is at work at a desk. Unlike others of his kind, he wears rudimentary clothing.||Suddenly a stuffed animal's head mounted on the wall says, \"There is an intruder, master.\"||The scorpion man wheels round and charges straight at you.">

<ROOM STORY449
	(DESC "449")
	(STORY TEXT449)
	(CHOICES CHOICES-MAGIC)
	(DESTINATIONS <LTABLE <LTABLE STORY503 STORY105>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-MAGIC 9>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT450 "A wooden stockade encloses the springs. At the gate, two militiamen stand on guard, and a priest, dressed in blue robes, sits behind a desk.||\"Thirty-five Shards to enjoy the divine spa,\" says the priest.">
<CONSTANT CHOICES450 <LTABLE "Pay and enter" "Cannot or will not pay">>

<ROOM STORY450
	(DESC "450")
	(STORY TEXT450)
	(CHOICES CHOICES450)
	(DESTINATIONS <LTABLE STORY378 STORY510>)
	(REQUIREMENTS <LTABLE 30 NONE>)
	(TYPES <LTABLE R-MONEY R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT451 "You ask the innkeeper about Yanryt the Son. He looks at you oddly, clearly unsettled by your question.||\"Some say he is the son of a mortal woman, and the god Tyrnai. But he has not been here for some time...\" Suddenly he stops, staring in amazement at the corner of the tavern.||You turn to look and there, hunched over a stoop of ale, is Yanryt the Son.">
<CONSTANT CHOICES451 <LTABLE HAVE-A IF-NOT>>

<ROOM STORY451
	(DESC "451")
	(STORY TEXT451)
	(CHOICES CHOICES451)
	(DESTINATIONS <LTABLE STORY575 STORY329>)
	(REQUIREMENTS <LTABLE BLACK-DRAGON-SHIELD NONE>)
	(TYPES <LTABLE R-ITEM R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT452 "The Trading Post has a small market place in the village square, where half a dozen stalls sell a few goods. Items with no purchase price listed are not available locally.">
<CONSTANT CHOICES452 <LTABLE "Buy armour/weapons/other items" "Sell armour/weapons/magic/other items" "Go back to the village">>

<ROOM STORY452
	(DESC "452")
	(LOCATION LOCATION-TRADING)
	(STORY TEXT452)
	(CHOICES CHOICES452)
	(DESTINATIONS <LTABLE TRADING-POST-BUY TRADING-POST-SELL STORY195>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT453 "You find yourself washed up on a long, sandy beach, battered and cold, but lucky to be alive. You head inland until you realize you have arrived at the river-mouth delta of the River Grimm.">

<ROOM STORY453
	(DESC "453")
	(LOCATION LOCATION-GRIMM)
	(STORY TEXT453)
	(CONTINUE STORY579)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT454 "You are thrown into a stinking prison cell. Your cellmate, a half-dead old man with long white hair tells you his tale: \"The lair of the gorlock! A hideous beast that has backward-pointing feet -- Krine and I, fleeing with our stolen treasure sought refuge in its cave near Blessed Springs. The tracks led us to believe it had just left its cave, but we didn't know about its feet -- in fact it was at home. It took Krine but I managed to escape with my life, only to be taken by the militia. I will never live to see the treasure but you, forewarned, may defeat the gorlock and take the riches it guards...\"||A few days later, you learn your own fate. You are to be sold into slavery, and taken to Caran Baru to work in the tin mines.">

<ROOM STORY454
	(DESC "454")
	(VISITS 0)
	(BACKGROUND STORY454-BACKGROUND)
	(STORY TEXT454)
	(CONTINUE STORY118)
	(CODEWORDS <LTABLE CODEWORD-APACHE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY454-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY454 1> <RETURN ,STORY188>)>
	<RETURN ,STORY454>>

<CONSTANT TEXT455 "A merchant ship, sailing for Wishport, will take you for 15 Shards.">
<CONSTANT CHOICES455 <LTABLE "If you do not want to make the trip" "If you pay for the journey to Wishport">>

<ROOM STORY455
	(DESC "455")
	(STORY TEXT455)
	(CHOICES CHOICES455)
	(DESTINATIONS <LTABLE STORY142 STORY709>)
	(REQUIREMENTS <LTABLE NONE 15>)
	(TYPES <LTABLE R-NONE R-MONEY>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT456 "\"Welcome,\" says Marloes Marlock.">
<CONSTANT CHOICES456 <LTABLE HAVE-CODEWORD HAVE-THE OTHERWISE>>

<ROOM STORY456
	(DESC "456")
	(STORY TEXT456)
	(CHOICES CHOICES456)
	(DESTINATIONS <LTABLE STORY375 STORY255 STORY708>)
	(REQUIREMENTS <LTABLE CODEWORD-AMBUSCADE <LTABLE CODEWORD-ARK ROYAL-RING> NONE>)
	(TYPES <LTABLE R-CODEWORD R-CODEWORD-ITEM R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT457 "They are unimpressed with your musical ability. The king waves his hand irritably. Suddenly, you wake up in your cabin, puzzled by your peculiar dream.">

<ROOM STORY457
	(DESC "457")
	(STORY TEXT457)
	(EVENTS STORY457-EVENTS)
	(CONTINUE STORY507)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY457-EVENTS ()
	<DELETE-BLESSING ,BLESSING-SAFETY-FROM-STORMS>>

<CONSTANT TEXT458 "The road between Caran Baru and Fort Mereth is another military highway for transporting troops and supplies.">
<CONSTANT CHOICES458 <LTABLE "North into the country" "South to the farmlands" "South west to Caran Baru" "North east to Fort Mereth">>

<ROOM STORY458
	(DESC "458")
	(STORY TEXT458)
	(LOCATION LOCATION-SOKARA)
	(CHOICES CHOICES458)
	(DESTINATIONS <LTABLE STORY060 STORY548 STORY400 STORY299>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT459 "The little mannekyn creature is handed over to you on a leash. Its wings have been tied together to stop it flying away.||\"Who are you, then?\" it pipes in a squeaky voice.||Just then, a palanquin carried by four bearers arrives. A man leans out. \"You there! I've come to buy that flying monkey but I see I am too late. I will give you 75 Shards for it.\"||\"Don't sell me to that popinjay. Free me instead,\" chitters the mannekyn.">
<CONSTANT CHOICES459 <LTABLE "Free it" "Sell it">>

<ROOM STORY459
	(DESC "459")
	(STORY TEXT459)
	(CHOICES CHOICES459)
	(DESTINATIONS <LTABLE STORY659 STORY186>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT460 "You climb down an old disused well in the poor quarter of Yellowport.">
<CONSTANT CHOICES460 <LTABLE HAVE-CODEWORD HAVE-A "If you have neither">>

<ROOM STORY460
	(DESC "460")
	(STORY TEXT460)
	(CHOICES CHOICES460)
	(DESTINATIONS <LTABLE STORY327 STORY327 STORY707>)
	(REQUIREMENTS <LTABLE CODEWORD-ACID COPPER-AMULET NONE>)
	(TYPES <LTABLE R-CODEWORD R-ITEM R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT461 "You call out the password 'Rebirth' to the door.||\"The password changes once it has been used.\" says the door smugly. \"I can't open for you even if I wanted to.\"||There is nothing else to do here, so you leave.">
<CONSTANT CHOICES461 <LTABLE "North to the Bronze Hills" "West to the river Grimm" "South to the country" "East to the road">>

<ROOM STORY461
	(DESC "461")
	(STORY TEXT461)
	(CHOICES CHOICES461)
	(DESTINATIONS <LTABLE STORY110 STORY333 STORY560 STORY387>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT462 "What service do you seek at the temple of the Twin Gods of the Sea?">

<ROOM STORY462
	(DESC "462")
	(STORY TEXT462)
	(CHOICES CHOICES-STANDARD-TEMPLE)
	(DESTINATIONS <LTABLE STORY294 STORY624 STORY448 STORY010>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT463 "You remember the words of the old man you shared a prison cell with. This must be the lair of the gorlock that is said to have backward-pointing feet, so that the tracks it leaves will always show the opposite direction of travel. You realize that this means the gorlock must be inside the cave.">
<CONSTANT CHOICES463 <LTABLE "Challenge the beast to combat" "Wait for it to leave the cave and sneak in">>

<ROOM STORY463
	(DESC "463")
	(STORY TEXT463)
	(CHOICES CHOICES463)
	(DESTINATIONS <LTABLE STORY174 STORY287>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT464 "The ship, already crippled by a storm, and with only half its crew, is easy meat for your hardy men. The strangely dressed foreigners surrender without much of a fight. You get 100 Shards as booty, and 1 Cargo Unit of spices, if you have room to take it.">

<ROOM STORY464
	(DESC "464")
	(STORY TEXT464)
	(EVENTS STORY464-EVENTS)
	(CONTINUE STORY559)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY464-EVENTS ()
	<GAIN-MONEY 100>
	<STORY-GAIN-CARGO ,CARGO-SPICES>>

<CONSTANT TEXT465 "Several hideous creatures, which resemble giant lobsters, surge out of the water to attack you! You and your crew are taken by surprise, and things look bleak. Some of your men are quickly killed, their bodies torn in two by powerful mandibles. The others begin to panic.">

<ROOM STORY465
	(DESC "465")
	(STORY TEXT465)
	(CHOICES CHOICES-CHARISMA)
	(DESTINATIONS <LTABLE <LTABLE STORY389 STORY214>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-CHARISMA 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT466 "The road between Blessed Springs and Fort Brilon is patrolled by troopers of the Sokaran army. The fort is well-supplied from Blessed Springs, and traffic abounds.">
<CONSTANT CHOICES466 <LTABLE "Visit Fort Brilon" "Head for Blessed Springs" "Set off north into the farmlands">>

<ROOM STORY466
	(DESC "466")
	(STORY TEXT466)
	(CHOICES CHOICES466)
	(DESTINATIONS <LTABLE STORY259 STORY510 STORY548>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT467 "The heavy wooden gates of the temple of Tyrnai are guarded by a couple of veteran warriors -- the old iron bullmen are gone. Inside, the god is represented by a stone idol of a jaguar-headed warrior. He appears to be naked.||Suddenly, a priest shouts, \"It's the thief! The blasphemous devil had the nerve to return here.\"||A score of warrior priests of Tyrnai boil out of the back rooms of the temple. You had better run for your life.">

<ROOM STORY467
	(DESC "467")
	(STORY TEXT467)
	(EVENTS STORY467-EVENTS)
	(CONTINUE STORY551)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY467-EVENTS ()
	<STORY-ROLL-RANK ,STORY395>>

<CONSTANT TEXT468 "You are walking down a side alley when a figure steps out of a doorway to block your path; it is a man with a velvet eyepatch.||His one good eye glitters with evil humour from a face ravaged with the scars of many a fight. \"I hear you are looking for me.\"">

<ROOM STORY468
	(DESC "468")
	(STORY TEXT468)
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE <LTABLE STORY393 STORY014>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT469 "He tells you of his life-long quest to find the 'Greatest Story Ever Told'. It is said that the god, Sig, in his aspect as the Divine Bard, passed this knowledge to a mystic called Damor the Hermit. He lives alone in a lost cave, awaiting the day when he can pass on the story to the one who finds him.||\"I am too old now to pursue the quest, so I pass it on to you. I believe Damor can be found in the foothills of the Spine of Harkun, the mountains to the north. If you find him, you will become a great troubadour.\"">

<ROOM STORY469
	(DESC "469")
	(STORY TEXT469)
	(CONTINUE STORY100)
	(CODEWORDS <LTABLE CODEWORD-ANTHEM>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT470 "You grab the woman's wrist and give it a painful twist. You are not being cruel for the sake of it. She was about to steal your money.||\"Let me go,\" she pleads, showing you the little infant son she's carrying in her other arm. \"I need the money for my starving children and my poor crippled husband.\"||Yellowport is full of wretches like this. With a snarl, you push her away, tossing a coin after her for good measure.||Later, strolling down by the canal, you find a small bundle lying on the slick cobblestones. It is a doll wrapped in swaddling clothes to make it look like a baby.">

<ROOM STORY470
	(DESC "470")
	(STORY TEXT470)
	(EVENTS STORY470-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY470-EVENTS ()
	<COST-MONEY 1 "tossed away">>

<CONSTANT TEXT471 "The priestess, dressed in silken robes, and wearing a wreath of oak leaves, says, \"I have need of an adventurer like yourself. For arcane reasons involving the secret mysteries of Lacuna, I need the tusk of a boar. A were-boar, in fact. I believe they can be found in the Forest of the Forsaken, in northern Golnir. Hunt down a were-boar, and bring me a boar's tusk. In return, I will teach you how to be a better scout.\"">
<CONSTANT CHOICES471 <LTABLE "Accept the mission" IF-NOT>>

<ROOM STORY471
	(DESC "471")
	(BACKGROUND STORY471-BACKGROUND)
	(STORY TEXT471)
	(CHOICES CHOICES471)
	(DESTINATIONS <LTABLE STORY544 STORY544>)
	(REQUIREMENTS <LTABLE CODEWORD-ANIMAL NONE>)
	(TYPES <LTABLE R-GAIN-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY471-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-ANIMAL> <RETURN ,STORY369>)>
	<RETURN ,STORY471>>

<CONSTANT TEXT472 "Fort Estgard is one of three forts along the wall that runs right along the border. Their purpose is to defend Sokara against the ravening manbeasts of Nerech, which are constantly trying to break through to raid the interior. The commander of the fort desperately wants to see you.||\"My daughter, Alissia, has been kidnapped by the man-beasts!\" he says. \"They are asking that I let one of their raiding parties through, to attack the farmlands. I'm delaying my response as long as possible, but if I don't do something soon, they will kill her! Please, I need a brave adventurer to rescue her!\"">
<CONSTANT CHOICES472 <LTABLE "Take up the quest" "Head east into Nerech (The Plains of Howling Darkness)" "North west to Fort Mereth" "South east to Fort Brilon" "West into the farmlands">>

<ROOM STORY472
	(DESC "472")
	(BACKGROUND STORY472-BACKGROUND)
	(STORY TEXT472)
	(CHOICES CHOICES472)
	(DESTINATIONS <LTABLE STORY472 STORY-PLAINS-HOWLING-DARKNESS STORY299 STORY259 STORY548>)
	(REQUIREMENTS <LTABLE CODEWORD-ALISSIA NONE NONE NONE NONE>)
	(TYPES <LTABLE R-GAIN-CODEWORD R-NONE R-NONE R-NONE R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY472-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-DOTAGE> <RETURN ,STORY667>)>
	<RETURN ,STORY472>>

<CONSTANT TEXT473 "The slave market is a large, canvas-covered square. The poor unfortunate slaves, people from all over Harkuna -- from the Feathered Lands, Golnir, criminals of Sokara, nomads from the steppes, are paraded in chains on a dais. Merchants and nobles bid for the slaves they want.||An unusual sale has come up: a little, furry, bat-winged humanoid. It is one of the mannekyn people from Sky Mountain in the north and it is going for 50 Shards.">
<CONSTANT CHOICES473 <LTABLE "Buy it" "If not, you head back into town.">>

<ROOM STORY473
	(DESC "473")
	(VISITS 0)
	(BACKGROUND STORY473-BACKGROUND)
	(STORY TEXT473)
	(CHOICES CHOICES473)
	(DESTINATIONS <LTABLE STORY459 STORY400>)
	(REQUIREMENTS <LTABLE 50 NONE>)
	(TYPES <LTABLE R-MONEY R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY473-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY473 1> <RETURN ,STORY610>)>
	<RETURN ,STORY473>>

<CONSTANT TEXT474 "The Coldbleak Mountains look as inhospitable and forbidding as their name implies, their frozen flanks climbing high into the icy clouds.">
<CONSTANT CHOICES474 <LTABLE "Climb into the mountains" "Enter Caran Baru" "Go west to the road" "Head into the farmlands" "Go south to the Lake of the Sea Dragon">>

<ROOM STORY474
	(DESC "474")
	(STORY TEXT474)
	(CHOICES CHOICES474)
	(DESTINATIONS <LTABLE STORY005 STORY400 STORY347 STORY548 STORY135>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT475 "You slip on the rotting scraps of King Skabb's last meal and fall over with a crash. The ratmen turn to stare at you.||\"A human! Get it!\" screams Skabb.||The ratmen charge toward you with a roar. Soon they have been joined by others and you have no choice but to flee for your life! You race down the sewer tunnels, with an army of ratmen in hot pursuit.">
<CONSTANT CHOICES475 <LTABLE "Lose them in the tunnels" "Try some magic" "Hide">>

<ROOM STORY475
	(DESC "475")
	(STORY TEXT475)
	(CHOICES CHOICES475)
	(DESTINATIONS <LTABLE STORY079 STORY096 STORY127>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT476 "\"Not bad,\" says the man with the eyepatch. \"But now I'll finish you.\" He draws his sword, and you must fight.">

<ROOM STORY476
	(DESC "476")
	(STORY TEXT476)
	(EVENTS STORY476-EVENTS)
	(CONTINUE STORY092)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY476-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-MAN-EYEPATCH 4 6 12>
	<CHECK-COMBAT ,MONSTER-MAN-EYEPATCH ,STORY476>>

<CONSTANT TEXT477 "You cannot get away fast enough. With one gulp Vayss the Sea Dragon gobbles you up.">

<ROOM STORY477
	(DESC "477")
	(STORY TEXT477)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT478 "Resurrection costs 200 Shards if you are an initiate, 600 Shards if not. It is the last word in insurance. Once you have arranged for resurrection you need not fear death, as you will be magically restored to life here at the temple.||You can have only one resurrection arranged at any one time.">

<ROOM STORY478
	(DESC "478")
	(STORY TEXT478)
	(EVENTS STORY478-EVENTS)
	(CONTINUE STORY071)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY478-EVENTS ()
	<PURCHASE-RESURRECTION 600 200 ,GOD-NAGIL ,RESURRECTION-NAGIL ,STORY350>>

<CONSTANT TEXT479 "They seem quite alarmed to see you charge forward undaunted. As your first blow lands solidly and you hear a satisfying grunt of pain, you know for a fact that these are no ghosts that you are facing, but people of flesh and blood. Fight them one at a time.">

<ROOM STORY479
	(DESC "479")
	(STORY TEXT479)
	(EVENTS STORY479-EVENTS)
	(CONTINUE STORY171)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY479-EVENTS ("AUX" TRICKSTER-STAMINA)
	<SET TRICKSTER-STAMINA <LTABLE 3 2 2>>
	<DO (I 1 3)
		<PUTP ,STORY479,P?DOOM T>
		<COMBAT-MONSTER ,MONSTER-TRICKSTER 2 3 <GET .TRICKSTER-STAMINA .I>>
		<COND (<NOT <CHECK-COMBAT ,MONSTER-TRICKSTER ,STORY479>> <RETURN>)>
	>>

<CONSTANT TEXT480 "\"Tell you what -- I'll teach you a few tricks, and then you can go away. What do you say?\"||You've got nothing to lose so you accept. Damor was once a Troubadour, and he instructs you in its arts. Gain 1 CHARISMA point permanently. Afterwards, for a few hours, he lifts the curse that soured your water so you can make it down the mountain path safely.">

<ROOM STORY480
	(DESC "480")
	(STORY TEXT480)
	(EVENTS STORY480-EVENTS)
	(CONTINUE STORY244)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY480-EVENTS ()
	<UPGRADE-ABILITY ,ABILITY-CHARISMA 1>>

<CONSTANT TEXT481 "If you are an initiate it costs only 10 Shards to purchase Maka's blessing. A non-initiate must pay 20 Shards.||The blessing works by allowing you to ignore any one occasion when you would normally suffer from disease or poison -- for instance, the venomous bite of a snake.||You can have only one 'Immunity to Disease and Poison' blessing at any one time. Once it is used up, you can return to any branch of the temple of Maka to buy a new one.">

<ROOM STORY481
	(DESC "481")
	(STORY TEXT481)
	(EVENTS STORY481-EVENTS)
	(CONTINUE STORY141)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY481-EVENTS ()
	<PURCHASE-BLESSING 20 10 ,GOD-MAKA ,BLESSING-IMMUNITY-POISON-DISEASE>>

<ROOM STORY482
	(DESC "482")
	(STORY TEXT-BLESSING-LACUNA)
	(EVENTS STORY482-EVENTS)
	(CONTINUE STORY615)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY482-EVENTS ()
	<PURCHASE-BLESSING 25 10 ,GOD-LACUNA ,BLESSING-SCOUTING>>

<CONSTANT TEXT483 "The tavern costs you 1 Shard a day. Each day you spend here, you can recover 1 Stamina point if injured, up to the limit of your normal unwounded Stamina score.">
<CONSTANT CHOICES483 <LTABLE "Spend 3 Shards buying drinks all round at the bar and listening for rumours" OTHERWISE>>

<ROOM STORY483
	(DESC "483")
	(VISITS 0)
	(STORY TEXT483)
	(EVENTS STORY483-EVENTS)
	(CHOICES CHOICES483)
	(DESTINATIONS <LTABLE STORY323 STORY510>)
	(REQUIREMENTS <LTABLE 3 NONE>)
	(TYPES <LTABLE R-MONEY R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY483-EVENTS ()
	<VISIT-INN ,STORY483 1 1>>

<CONSTANT TEXT484 "You sail for days without sight of land. Soon you have run out of water, and the crew start dying of thirst. Eventually, you find a familiar stretch of coast.">

<ROOM STORY484
	(DESC "484")
	(STORY TEXT484)
	(EVENTS STORY484-EVENTS)
	(CONTINUE STORY136)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY484-EVENTS ("AUX" ROLL)
	<LOSE-STAMINA <ROLL-DICE 1> ,DIED-OF-HUNGER ,STORY484>
	<COND (<IS-ALIVE>
		<STORY-RESET-CREW ,CONDITION-POOR>
		<SET ROLL <RANDOM-EVENT 1 0 T>>
		<COND (<L=? .ROLL 2>
			<STORY-JUMP ,STORY120>
		)(<L=? .ROLL 4>
			<STORY-JUMP ,STORY430>
		)>
	)>>

<ROOM STORY485
	(DESC "485")
	(STORY TEXT-SHIPWRECK)
	(EVENTS STORY485-EVENTS)
	(CONTINUE STORY193)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY485-EVENTS ()
	<STORY-SHIPWRECK ,STORY485>>

<CONSTANT TEXT486 "Everything indicates the cave is empty so you approach carefully, on the look out for attack from behind. Suddenly, something rushes out of the cave, taking you by surprise! It is a gorlock, a beast with legs like a bird, a body like a reptile, with two short forelimbs and a beaked, lizard-like head. You see that its two legs end in backward-pointing feet -- the tracks it leaves will always show the wrong direction of travel!||It bites at you savagely!">

<ROOM STORY486
	(DESC "486")
	(STORY TEXT486)
	(EVENTS STORY486-EVENTS)
	(CONTINUE STORY315)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY486-EVENTS ()
	<LOSE-STAMINA 4 ,DIED-FROM-INJURIES ,STORY486>
	<COND (<IS-ALIVE>
		<IF-ALIVE "You will have to fight it.">
		<COMBAT-MONSTER ,MONSTER-GORLOCK 4 6 7>
		<CHECK-COMBAT ,MONSTER-GORLOCK ,STORY486>
	)>>

<ROOM STORY487
	(DESC "487")
	(CHOICES CHOICES-SCOUTING)
	(DESTINATIONS <LTABLE <LTABLE STORY348 STORY189>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT488 "You collapse, close to death. A priest of Tyrnai heals you so that you come round. It is not out of kindness that he has done this. The priests take all your money and possessions and sell you into slavery.">

<ROOM STORY488
	(DESC "488")
	(STORY TEXT488)
	(EVENTS STORY488-EVENTS)
	(CONTINUE STORY118)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY488-EVENTS ()
	<SETG STAMINA 1>
	<RESET-POSSESSIONS>
	<UPDATE-STATUS-LINE>>

<CONSTANT TEXT489 "Later, in your cabin, you examine the pearls more closely. To your horror, they lose their pearly sheen and return to their natural state -- tiny pebbles. Some enchantment had been laid upon them to make them look like pearls. Cursing the young sea gypsy, you vow to be more careful next time.">

<ROOM STORY489
	(DESC "489")
	(STORY TEXT489)
	(CONTINUE STORY085)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT490 "When you hit the guardian, you tear away great wispy chunks of its smoky essence. Eventually, it dissolves into nothingness.||Inside the sarcophagus you find the moldering bones of a long-dead wizard. In his skeletal hands you find the Book of Excellence. As you scan the pages, you learn all sorts of new tricks.">
<CONSTANT TEXT490-CONTINUED "Once you have read it, the book disappears with a flash. You thread your way out of the Tomb of the Wizard King, back into the Forest of Larun.">

<ROOM STORY490
	(DESC "490")
	(STORY TEXT490)
	(EVENTS STORY490-EVENTS)
	(CONTINUE STORY047)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY490-EVENTS ()
	<UPGRADE-ABILITIES 1>
	<IF-ALIVE ,TEXT490-CONTINUED>>

<CONSTANT TEXT491 "You succumb to the insidious breath of the beast. Death has claimed you.">

<ROOM STORY491
	(DESC "491")
	(STORY TEXT490)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT492 "You are on a rough track that runs between Venefax and the territories of the scorpion men, slogging your way through hot, dry scrubland. A hawk circles overhead, cawing harshly.">
<CONSTANT CHOICES492 <LTABLE "Go north to Venefax" "Go south into Scorpion Bight">>

<ROOM STORY492
	(DESC "492")
	(STORY TEXT492)
	(CHOICES CHOICES492)
	(DESTINATIONS <LTABLE STORY427 STORY318>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT493 "Gills grow out of your cheeks as soon as you have read the runes aloud! You make your way down a track to the beach, and swim out to sea. The gills work perfectly, and you find yourself swimming in the eerie silence of a submarine world.||Suddenly, a hideous form looms out of the murk. It is rather like a giant squid, but it carries a spear in one of its many tentacles and wears rudimentary armour. Great black eyes shine with an implacable alien intelligence.">
<CONSTANT CHOICES493 <LTABLE HAVE-CODEWORD OTHERWISE>>

<ROOM STORY493
	(DESC "493")
	(STORY TEXT493)
	(CHOICES CHOICES493)
	(DESTINATIONS <LTABLE STORY116 STORY238>)
	(REQUIREMENTS <LTABLE CODEWORD-ANCHOR NONE>)
	(TYPES <LTABLE R-CODEWORD R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT494 "You dodge down a side tunnel, and mutter an enchantment intended to give you the appearance of a ratman. Your pursuers come bundling around the corner. One of them stops to shout at you, \"Where'd the human go?\"||Nonchalantly, you point down the tunnel, and the ratmen go haring off down it, whooping and yelling. You turn and walk the other way, a smile on your face.">

<ROOM STORY494
	(DESC "494")
	(STORY TEXT494)
	(CONTINUE STORY580)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT495 "You arrive at Disaster Bay, where you find a community of fishermen. Judging by their wealth, they also make a living by other means -- you suspect by looting the ships that get wrecked in the stormy waters of the bay.||A man offers to take you by boat, safely through the bay, and north to the port of Yarimura, on the Great Steppes; it will cost you 50 Shards.">
<CONSTANT CHOICES495 <LTABLE "Pay to go to Yarimura (The Plains of Howling Darkness)" "Head north to the mountains" "Head for Fort Mereth">>

<ROOM STORY495
	(DESC "495")
	(LOCATION LOCATION-DISASTER)
	(STORY TEXT495)
	(CHOICES CHOICES495)
	(DESTINATIONS <LTABLE STORY-PLAINS-HOWLING-DARKNESS STORY244 STORY518 STORY299>)
	(REQUIREMENTS <LTABLE 50 NONE NONE NONE>)
	(TYPES <LTABLE R-MONEY R-NONE R-NONE R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT496 "You manoeuvre your ship as close as possible, and then take a rowboat over to the craft. Climbing inside, you find yourself in a small cabin which is lit by winking red and green lights set into the walls. A figure lies sprawled beside an ornate couch. The figure, although manlike, appears to have silver skin, and a great big round head, with one black, glittering eye that seems to fill its whole face. Whatever it is appears to be dead.||Quickly you search the craft, and find a kind of spear that fires steel balls from one end. It counts as a magic spear. Worried that you may be meddling with a ship of demons, you head back quickly, and sail on.">

<ROOM STORY496
	(DESC "496")
	(VISITS 0)
	(BACKGROUND STORY496-BACKGROUND)
	(STORY TEXT496)
	(CONTINUE STORY085)
	(ITEMS <LTABLE MAGIC-SPEAR>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY496-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY496 1> <RETURN ,STORY317>)>
	<RETURN ,STORY496>>

<CONSTANT TEXT497 "The tavern costs you 1 Shard a day. Each day you spend here, you can recover 1 Stamina point if injured, up to the limit of your normal unwounded Stamina score.">
<CONSTANT CHOICES497 <LTABLE "Spend Shards buying drinks for the locals, and ask them about the scorpion men" OTHERWISE>>

<ROOM STORY497
	(DESC "497")
	(VISITS 0)
	(STORY TEXT497)
	(EVENTS STORY497-EVENTS)
	(CHOICES CHOICES497)
	(DESTINATIONS <LTABLE STORY525 STORY427>)
	(REQUIREMENTS <LTABLE 3 NONE>)
	(TYPES <LTABLE R-MONEY R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY497-EVENTS ()
	<VISIT-INN ,STORY497 1 1>>

<CONSTANT TEXT498 "There are too many of them, and they give you a good hiding. \"Maybe that'll teach you some respect,\" one of them says, as they swagger off, leaving you groaning in the gutter. You are reduced to only 1 Stamina point. You decide to call it a night.">

<ROOM STORY498
	(DESC "498")
	(STORY TEXT498)
	(EVENTS STORY498-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY498-EVENTS ()
	<SETG STAMINA 1>
	<UPDATE-STATUS-LINE>>

<CONSTANT TEXT499 "You board your ship, which is docked in the harbour. The crew gives a drunken cheer as you come on board.||\"Where are we bound, Cap'n?\" says the first mate.">
<CONSTANT CHOICES499 <LTABLE "Return to shore" "Set sail">>

<ROOM STORY499
	(DESC "499")
	(STORY TEXT499)
	(CHOICES CHOICES499)
	(DESTINATIONS <LTABLE STORY555 STORY029>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT500 "You are restored to life at the war-god's temple in Yellowport. Your Stamina is back to its normal score. The possessions and cash you were carrying at the time of your death are lost.||The high priest, pale and wan after the effort of interceding with the god to bring you back to life says, \"You have returned from beyond the dark mirror of death. Tyrnai has granted you another chance. Strive to seek battle in his name.\"">

<ROOM STORY500
	(DESC "500")
	(STORY TEXT500)
	(CONTINUE STORY526)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT501 "Your captors take the money and run. You are released into Yellowport">

<ROOM STORY501
	(DESC "501")
	(BACKGROUND STORY501-BACKGROUND)
	(STORY TEXT501)
	(EVENTS STORY501-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

; "TO-DO: Ensure that ransom is priority (in STORY605)"
<ROUTINE STORY501-BACKGROUND ()
	<COND (<L? ,MONEY ,RANSOM> <RETURN ,STORY288>)>
	<RETURN ,STORY501>>

<ROUTINE STORY501-EVENTS ()
	<COST-MONEY ,RANSOM "paid">
	<SETG RANSOM 0>
	<UPDATE-STATUS-LINE>>

<ROOM STORY502
	(DESC "502")
	(STORY TEXT-VIOLET-OCEAN)
	(CHOICES CHOICES-VIOLET-OCEAN)
	(DESTINATIONS <LTABLE STORY-BLOOD-DARK-SEA <LTABLE STORY-BLOOD-DARK-SEA STORY420> STORY420>)
	(REQUIREMENTS STORY-VIOLET-REQUIREMENTS)
	(TYPES TYPE-SAIL)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT503 "Your magical awareness tells you something is wrong. You realize that the scorpion man is an illusion -- a magically created disguise. The illusion falls away under your keen magical sight, and a rather fat little fellow is standing before you, dressed in a dirty, food-stained tunic.||\"Oh,\" he says, realizing his subterfuge has been uncovered. He drops to his knees, pleading, \"Please don't kill me.\"||You manage to calm him down enough to find out his story. His name is Kaimren the Portly, a minor sorcerer. He came here in the guise of a scorpion man, and swiftly rose to power using his magical skills. He had planned to use the scorpion men as an army.||Fearfully, he hands you the Book of the Seven Sages, which he stole to further his campaign of conquest.||Then Kaimren leads you through a secret tunnel, out of the mound, and back to the village of Venefax, where you hand him over to the Venefax authorities for trial.">

<ROOM STORY503
	(DESC "503")
	(STORY TEXT503)
	(CONTINUE STORY427)
	(ITEMS <LTABLE BOOK-SEVEN-SAGES>)
	(CODEWORDS <LTABLE CODEWORD-AFRAID>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT504 "The lookout spots a ship, its back broken on some rocks near the shore. The vessel will not last long before it is washed away.">
<CONSTANT CHOICES504 <LTABLE "Ignore it" "Explore the wreck">>

<ROOM STORY504
	(DESC "504")
	(VISITS 0)
	(BACKGROUND STORY504-BACKGROUND)
	(STORY TEXT504)
	(CHOICES CHOICES504)
	(DESTINATIONS <LTABLE STORY209 STORY039>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY504-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY504 1> <RETURN ,STORY345>)>
	<RETURN ,STORY504>>

<CONSTANT TEXT505 "\"Excellent,\" says the dragon, catching the nugget in one of its clawed forelimbs.||With that, it rolls over, and dives down into the lake. At the last second, its tail whips up out of the water, inches from your face. You could reach out and grab it if you want to.">
<CONSTANT CHOICES505 <LTABLE "Catch the tail" "Leave it well alone">>

<ROOM STORY505
	(DESC "505")
	(STORY TEXT505)
	(EVENTS STORY505-EVENTS)
	(CHOICES CHOICES505)
	(DESTINATIONS <LTABLE STORY362 STORY561>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY505-EVENTS ()
	<REMOVE-ITEM ,SILVER-NUGGET "threw" T T>>

<CONSTANT TEXT506 "The Gold Dust Tavern is a plush inn beside the city gates. The tavern costs you 1 Shard a day. Each day you spend here, you can recover 1 Stamina point if injured, up to the limit of your normal unwounded Stamina score.">
<CONSTANT CHOICES506 <LTABLE "Spend further Shards buying drinks all round at the bar, and listen for rumours" IF-NOT>>

<ROOM STORY506
	(DESC "506")
	(VISITS 0)
	(STORY TEXT506)
	(EVENTS STORY506-VISITS)
	(CHOICES CHOICES506)
	(DESTINATIONS <LTABLE STORY331 STORY010>)
	(REQUIREMENTS <LTABLE 3 NONE>)
	(TYPES <LTABLE R-MONEY R-NONE>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY506-VISITS ()
	<VISIT-INN ,STORY506 1 1>>

<CONSTANT TEXT507 "You are sailing across the Sea of Whispers with a clear, blue sky and a salty wind to help you on your way.">
<CONSTANT CHOICES507 <LTABLE "Dock at the Isle of Druids" "Sail west towards Scorpion Bight" "Sail north west into coastal waters" "Sail north into coastal waters" "Sail south into the Violet Ocean" "Sail east into the Unbounded Ocean">>

<ROOM STORY507
	(DESC "507")
	(STORY TEXT507)
	(CHOICES CHOICES507)
	(DESTINATIONS <LTABLE STORY195 STORY430 STORY190 STORY312 STORY013 STORY206>)
	(REQUIREMENTS <LTABLE DOCK-TRADING NONE NONE NONE NONE NONE>)
	(TYPES <LTABLE R-DOCK R-NONE R-NONE R-NONE R-NONE R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT508 "You come round inside a disused warehouse, enmeshed in the net. You have been stripped of all your possessions -- they are in a tidy pile nearby. Several men surround you. They are dressed in furs and robes that are adorned with hundreds of multi-coloured feathers. Each man wears a necklace of animal skulls and has his teeth sharpened to needle-like points.||\"Hallo,\" the leader says reasonably. \"We are the Unspeakable Ones. It is our way to eat people in sacrifice to our god\".||He points to a squat wooden idol of a grossly fat half-man, half-ape with ivory needles for teeth. You notice the name \"Badogor the Unspoken\" inscribed on a plaque at the base of the idol.||\"Badogor the Unspoken? Who's he?\" you ask. \"Do not speak his name,\" shouts the cannibal, \"or you will be forever cursed!\"||You notice a large cauldron of boiling water into which another cultist is tossing herbs and garlic. He stares at you and licks his lips.">

<ROOM STORY508
	(DESC "508")
	(STORY TEXT508)
	(CONTINUE STORY320)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT509 "You spot a pressure pad at the base of the idol just in time -- who knows what unpleasant trap that would have set off. Hastily you remove the chain mail and sling it over your shoulder. As it is pure gold, it is useless as armour.||The eyes of the jaguar-headed idol seem to turn to look at you.">

<ROOM STORY509
	(DESC "509")
	(STORY TEXT509)
	(CHOICES CHOICES-SANCTITY)
	(DESTINATIONS <LTABLE <LTABLE STORY625 STORY279>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SANCTITY 10>>)
	(TYPES ONE-ABILITY)
	(ITEMS <LTABLE GOLD-CHAIN-MAIL>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT510 "The village of Blessed Springs, nestling at the foot of a tall hill, has grown up around the holy waters, a special spring said to have healing powers. It has been fenced off by the villagers, and a priesthood appointed to supervise the supplicants who come to bathe, or drink of the spring's waters. There is no market, but an alchemist has set up shop here.">
<CONSTANT CHOICES510 <LTABLE "Visit the Holy Waters" "Visit the alchemist's shop" "Visit the Blessed Ale Tavern" "Explore the hill" "Head north towards Fort Brilon" "South towards Venefax" "West into the countryside" "West into the countryside">>

<ROOM STORY510
	(DESC "510")
	(LOCATION LOCATION-BLESSED)
	(STORY TEXT510)
	(CHOICES CHOICES510)
	(DESTINATIONS <LTABLE STORY450 STORY342 STORY483 STORY398 STORY466 STORY087 STORY278 STORY548>)
	(TYPES EIGHT-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT511 "Your arcane knowledge tells you much about the undead. Ghouls are known to eat the flesh of the dead as well as the living. They like to make their homes in crypts and graveyards and they never venture out during the day, as sunlight burns their pallid, undead flesh. Also, they cannot abide a powder of salt and iron filings mixed together.||You can purchase these ingredients for 15 Shards at many a market stall.">

<ROOM STORY511
	(DESC "511")
	(LOCATION LOCATION-MARLOCK)
	(STORY TEXT511)
	(EVENTS STORY511-EVENTS)
	(CHOICES CHOICES-SCOUTING)
	(DESTINATIONS <LTABLE <LTABLE STORY419 STORY360>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 9>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY511-EVENTS ()
	<COND (,RUN-ONCE
		<COND (<AND <G=? ,MONEY 15> <NOT <CHECK-ITEM ,SALT-IRON-FILINGS>>>
			<CRLF>
			<TELL "Purchase ">
			<PRINT-ITEM ,SALT-IRON-FILINGS T>
			<TELL "?">
			<COND (<YES?>
				<COST-MONEY 15 "paid">
				<TAKE-ITEM ,SALT-IRON-FILINGS T>
			)>
		)>
	)>>

<CONSTANT CHOICES512 <LTABLE "You have it and want to give it to the guildmaster" IF-NOT>>

<ROOM STORY512
	(DESC "512")
	(CHOICES CHOICES512)
	(DESTINATIONS <LTABLE STORY163 STORY706>)
	(REQUIREMENTS <LTABLE PIRATE-CAPTAINS-HEAD NONE>)
	(TYPES <LTABLE R-ITEM R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT513 "One of them gives you a conch shell full of a greenish liquid. You drink it, and dive into the sea. Miraculously, you can breathe underwater. You follow the sea centaurs down into the depths until you arrive at a sunken ship, which is encrusted in barnacles and seaweed.||Suddenly, the sea centaurs swim away, leaving you alone. You notice that you are giving off a glow like the sea centaurs. Looking down, you see that the lower half of your body has turned into that of a sea centaur! You have been taken and transformed to replace their lost companion.">
<CONSTANT CHOICES513 <LTABLE "Explore the sunken wreck" "Swim back up to your ship">>

<ROOM STORY513
	(DESC "513")
	(STORY TEXT513)
	(CHOICES CHOICES513)
	(DESTINATIONS <LTABLE STORY429 STORY616>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT514 "To renounce the worship of Tyrnai, you must pay 50 Shards to the warrior priests, and suffer the 'Wrathful Blow'.">

<ROOM STORY514
	(DESC "514")
	(STORY TEXT514)
	(EVENTS STORY514-EVENTS)
	(CONTINUE STORY282)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY514-EVENTS ()
	<RENOUNCE-TYRNAI ,STORY514>>

<ROOM STORY515
	(DESC "515")
	(CHOICES CHOICES-MAGIC)
	(DESTINATIONS <LTABLE <LTABLE STORY205 STORY314>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-MAGIC 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT516 "You pull the wolf pelt over you, and drop to all fours. Gingerly, you crawl in.||In the dark, you now look and smell like a wolf. At the back of the cave, you find a hole in the roof. An iron ladder leads up to it.">
<CONSTANT CHOICES516 <LTABLE "Climb the ladder (The Plains of Howling Darkness)" "Leave the cave">>

<ROOM STORY516
	(DESC "516")
	(STORY TEXT516)
	(CHOICES CHOICES516)
	(DESTINATIONS <LTABLE STORY-PLAINS-HOWLING-DARKNESS STORY003>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT517 "A priest asks which service you require.">
<CONSTANT CHOICES517 <LTABLE TEXT-BECOME-INITIATE TEXT-RENOUNCE-WORSHIP TEXT-RESURRECTION-ARRANGEMENTS TEXT-LEAVE-TEMPLE>>

<ROOM STORY517
	(DESC "517")
	(BACKGROUND STORY517-BACKGROUND)
	(STORY TEXT517)
	(CHOICES CHOICES517)
	(DESTINATIONS <LTABLE STORY409 STORY187 STORY478 STORY100>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY517-BACKGROUND ()
	<COND (<CHECK-ITEM ,GHOULS-HEAD> <RETURN ,STORY597>)>
	<RETURN ,STORY517>>

<CONSTANT TEXT518 "You are on the road between the Citadel of Velis Corin and Fort Mereth. This is quite rarely travelled -- the military guard posts are few and far between.">
<CONSTANT CHOICES518 <LTABLE "Go to Disaster Bay" "Head for the Citadel of Velis Corin" "Travel to Fort Mereth" "Go south west into wild country">>

<ROOM STORY518
	(DESC "518")
	(STORY TEXT518)
	(EVENTS STORY518-EVENTS)
	(CHOICES CHOICES518)
	(DESTINATIONS <LTABLE STORY495 STORY271 STORY299 STORY060>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY518-EVENTS ("AUX" ROLL)
	<COND (,RUN-ONCE
		<SET ROLL <RANDOM-EVENT 1 0 T>>
		<COND (<L=? .ROLL 2>
			<COND (<G=? ,MONEY 10>
				<EMPHASIZE "You lose 10 shards gambling">
				<COST-MONEY 10 "lost">
			)(ELSE
				<EMPHASIZE ,NOTHING-HAPPENS>
			)>
		)(<L=? .ROLL 4>
			<EMPHASIZE ,NOTHING-HAPPENS>
		)(ELSE
			<COND (<L? ,STAMINA ,MAX-STAMINA>
				<EMPHASIZE "A sweet spring heals you.">
				<GAIN-STAMINA 3>
			)(ELSE
				<EMPHASIZE ,NOTHING-HAPPENS>
			)>
		)>
	)>
	<IF-ALIVE ,TEXT-YOU-CAN>>

<CONSTANT TEXT519 "Your crew have driven off the other ker'ilk, which dive into the sea. The ship was carrying 1 Cargo Unit of furs, which you can take if your ship has room. You clean up the dead sailors, and give them a proper burial at sea. There is nothing else of interest, so you sail on.">

<ROOM STORY519
	(DESC "519")
	(STORY TEXT519)
	(EVENTS STORY519-EVENTS)
	(CONTINUE STORY209)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY519-EVENTS ()
	<STORY-GAIN-CARGO ,CARGO-FURS>>

<CONSTANT TEXT520 "You hold up your arms and utter the mightiest prayer that you know. It has no effect.||The three white figures pelt you with a barrage of plates and knives. Something heavy hits you on the side of the head and you fall with a groan. The ghosts take advantage of this to snatch up the casket of silver and run off.">
<CONSTANT TEXT520-CONTINUED "You recover your wits to find that the three figures have vanished. But you are sure now that they were not ghosts">
<CONSTANT CHOICES520 <LTABLE "Try to track them down" "Follow the river north" "Follow the river south" "Head east into the countryside" "West to the main road">>

<ROOM STORY520
	(DESC "520")
	(STORY TEXT520)
	(EVENTS STORY520-EVENTS)
	(CHOICES CHOICES520)
	(DESTINATIONS <LTABLE STORY541 STORY576 STORY082 STORY278 STORY558>)
	(TYPES FIVE-CHOICES)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY520-EVENTS ()
	<COND (,RUN-ONCE
		<LOSE-STAMINA 2 ,DIED-FROM-INJURIES ,STORY520>
	)>
	<COND (<IS-ALIVE>
		<CRLF>
		<TELL ,TEXT520-CONTINUED>
		<TELL ,PERIOD-CR>
	)>>

<CONSTANT TEXT521 "You are looking for the Black Dragon Knight on a quest that was set for you by Yanryt the Son. You ask the knights if he is here.||\"The Black Dragon Knight? Yes, he is,\" replies one of them. \"But he fights only to the death. For him there is no wager save the greatest of all. That is to say, life itself.\"">
<CONSTANT CHOICES521 <LTABLE "Fight the Black Dragon Knight" "Don't fight and leave instead">>

<ROOM STORY521
	(DESC "521")
	(STORY TEXT521)
	(CHOICES CHOICES521)
	(DESTINATIONS <LTABLE STORY321 STORY276>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT522 "That night several sea centaurs emerge from the waters, their spiny skins glittering with phosphorescent flashes of light.||One of them speaks in a burbling voice. \"Where is our brother, whom you caught in your cruel nets, this day?\"||\"He is dead, I'm afraid\", you reply, readying yourself for a fight.||The sea centaurs remain silent for a few moments, then the leader says, \"His destiny was always bleak. We would be grateful if you were to return his body to us.\"||You cannot think of a reason not to, so you pass the body down to them.||\"We thank you,\" burbles the sea centaur. \"If you wish, we will give you the power to breathe the waters, so that you may swim down to the wreck that lies below, and take its treasures, those things that the surface-dwellers hold dear.\"">
<CONSTANT CHOICES522 <LTABLE "Accept the offer" "Refuse the offer">>

<ROOM STORY522
	(DESC "522")
	(STORY TEXT522)
	(CHOICES CHOICES522)
	(DESTINATIONS <LTABLE STORY513 STORY408>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM STORY523
	(DESC "523")
	(BACKGROUND STORY523-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY523-BACKGROUND ()
	<COND (<CHECK-CODEWORD ,CODEWORD-ASSASSIN>
		<RETURN ,STORY027>
	)(<CHECK-TITLE ,TITLE-PROTECTOR-SOKARA>
		<RETURN ,STORY095>
	)>
	<RETURN ,STORY705>>

<CONSTANT TEXT524 "You struggle on. Only your iron will and hardiness keep you alive. Eventually, the path leads to a bubbling well of spring water in the rocks, just at the opening of a cave. You drink your fill, and soon you feel much better.">

<ROOM STORY524
	(DESC "524")
	(STORY TEXT524)
	(CONTINUE STORY232)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT525 "\"They're vicious, evil devils,\" says an old peasant. \"Like huge scorpions they are, save they have the head and shoulders of a man. Intelligent too, forever seeking to pillage our town, but they can't climb up the ladders.\"||A soldier in the local militia speaks up, \"They hate fire. All we have to do is sit atop the town and pepper them with flaming arrows. They can't stand that for long. Mind you, things are getting bad. They've got a sorcerer now.\"||A young man, blind in one eye and paralysed down one side, says, \"They got a terrible sting as well -- their venom did this to me.\"||There's not much else to hear, so you leave.">

<ROOM STORY525
	(DESC "525")
	(STORY TEXT525)
	(CONTINUE STORY427)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT526 "The temple of Tyrnai, the God of War, is built in the shape of a spear with a long, pillared nave, and an altar at the far end. Two massive stone warriors guard its gates.||Tyrnai is depicted here as the insensate spirit of war: a blood-drenched warrior with the head of a maddened jaguar.">
<CONSTANT CHOICES526 <LTABLE TEXT-BECOME-INITIATE TEXT-RENOUNCE-WORSHIP TEXT-SEEK-BLESSING TEXT-RESURRECTION-ARRANGEMENTS TEXT-LEAVE-TEMPLE>>

<ROOM STORY526
	(DESC "526")
	(STORY TEXT526)
	(CHOICES CHOICES526)
	(DESTINATIONS <LTABLE STORY435 STORY069 STORY373 STORY599 STORY010>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT527 "You run off, leaving the terrible Gob-gobbler behind. The villagers of Venefax greet you with snorts of derision and contempt, and the young boy, Mikail, looks away, disappointed. It would be prudent to leave Venefax for a while.">
<CONSTANT CHOICES527 <LTABLE "South into Scorpion Bight" "North east towards Blessed Springs" "South west on the road to Yellowport" "North into open countryside">>

<ROOM STORY527
	(DESC "527")
	(STORY TEXT527)
	(CHOICES CHOICES527)
	(DESTINATIONS <LTABLE STORY492 STORY087 STORY621 STORY278>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<ROOM STORY528
	(DESC "528")
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE <LTABLE STORY445 STORY284>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT529 "You lose your footing, and fall. Fortunately, some bushes break your fall.">

<ROOM STORY529
	(DESC "529")
	(STORY TEXT529)
	(EVENTS STORY529-EVENTS)
	(CONTINUE STORY474)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY529-EVENTS ()
	<LOSE-STAMINA 4 ,DIED-FROM-INJURIES ,STORY529>>

<ROOM STORY530
	(DESC "530")
	(STORY TEXT-STORM-SUBSIDES)
	(EVENTS STORY-LOSE-CARGO)
	(CONTINUE STORY090)
	(FLAGS LIGHTBIT)>

<ROOM STORY531
	(DESC "531")
	(BACKGROUND STORY531-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY531-BACKGROUND ()
	<COND (<CHECK-ITEM ,GOLDEN-NET> <RETURN ,STORY004>)>
	<RETURN ,STORY462>>

<CONSTANT TEXT532 "The scorpion men's shaman falls dead with an uncannily human cry.">
<CONSTANT TEXT532-POISONED "You have been poisoned by the scorpion man's venom and are severely weakened. If you have some scorpion antidote, it will cure the poison immediately.">
<CONSTANT TEXT532-CONTINUED "A quick search reveals what you were looking for: the Book of the Seven Sages. You steal out of the mound unnoticed and make it safely back to the village of Venefax, to the north.">

<ROOM STORY532
	(DESC "532")
	(STORY TEXT532)
	(EVENTS STORY532-EVENTS)
	(CONTINUE STORY427)
	(ITEMS <LTABLE BOOK-SEVEN-SAGES>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY532-EVENTS ()
	<COND (<CHECK-AILMENT ,POISON-SCORPION> <IF-ALIVE ,TEXT532-POISONED>)>
	<IF-ALIVE ,TEXT532-CONTINUED>>

<CONSTANT TEXT533 "The man takes the money, bites a coin and spits. Satisfied, he says, \"The Witches' Cauldron, that's where you'll find him.\"||Later, you find the Witches' Cauldron tavern in a maze of backstreets. Looking through a window, you spot a man with a velvet eyepatch sitting at a table eating a meal.">
<CONSTANT CHOICES533 <LTABLE "Walk in and challenge him" "Ambush him when he leaves">>

<ROOM STORY533
	(DESC "533")
	(STORY TEXT533)
	(CHOICES CHOICES533)
	(DESTINATIONS <LTABLE STORY589 STORY211>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT534 "A long time passes. After a while, you risk calling up to Lauria in a whisper.||Your voice sounds thick, rasping, choked with growing fear. Lauria does not reply.||Each second you remain in the house increases the risk of discovery.">
<CONSTANT CHOICES534 <LTABLE "Wait a little longer" "Go upstairs to find Lauria" "Leave at once">>

<ROOM STORY534
	(DESC "534")
	(STORY TEXT534)
	(CHOICES CHOICES534)
	(DESTINATIONS <LTABLE STORY119 STORY386 STORY010>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT535 "The house of priests is an impressive building, a roundhouse of multi-coloured bricks. The myriad colours give it a bizarre and garish look, calculated to unsettle the visitor. Inside, a hundred offices teem with the administrators of the polytheistic religion of Sokara and Golnir.">
<CONSTANT CHOICES535 <LTABLE YOU-ARE-A "If not, there is little for you here">>

<ROOM STORY535
	(DESC "535")
	(STORY TEXT535)
	(CHOICES CHOICES535)
	(DESTINATIONS <LTABLE STORY009 STORY100>)
	(REQUIREMENTS <LTABLE PROFESSION-PRIEST NONE>)
	(TYPES <LTABLE R-PROFESSION R-NONE>)
	(FLAGS LIGHTBIT)>

<ROOM STORY536
	(DESC "536")
	(BACKGROUND STORY536-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY536-BACKGROUND ()
	<COND (<CHECK-ITEM ,CLIMBING-GEAR> <RETURN ,STORY628>)>
	<RETURN ,STORY700>>

<CONSTANT TEXT537 "You find out that they call themselves the gypsies of the sea, wandering nomads of the waves, who find their islands naturally occurring in the Sea of Weeds. They make their homes upon them, and live a life of aimless drifting.||A tanned young man, full of wit and charm, explains that he makes his living from pearl diving, and selling what he finds to people like yourself. He offers you a bag of pearls for 25 Shards.">
<CONSTANT CHOICES537 <LTABLE "Buy the pearls" "Leave and resume your journey">>

<ROOM STORY537
	(DESC "537")
	(STORY TEXT537)
	(CHOICES CHOICES537)
	(DESTINATIONS <LTABLE STORY106 STORY085>)
	(REQUIREMENTS <LTABLE 25 NONE>)
	(TYPES <LTABLE R-MONEY R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT538 "\"Refusing to pay your taxes, eh?\" says their leader. \"That's a crime for sure.\"||They close in around you. You'll have to think fast.">

<ROOM STORY538
	(DESC "538")
	(STORY TEXT538)
	(CHOICES CHOICES-CHARISMA)
	(DESTINATIONS <LTABLE <LTABLE STORY018 STORY157>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-CHARISMA 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT539 "You roll across the eaves of the gate, and reach down to pull the plug on the other golem in one deft movement. It ceases to function before it can give the alarm. It is an easy matter to get into the temple by way of the roof.||Inside, it is cool and dark, filled with an unearthly stillness. You reach forward to strip the armour off the idol of Tyrnai.">

<ROOM STORY539
	(DESC "539")
	(STORY TEXT539)
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE <LTABLE STORY509 STORY228>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 12>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT540 "Sure enough, when the scholar leaves, purse bulging with Shards, the two ruffians go too. You follow at a slight distance. As you suspected, the ruffians wait for a suitable moment and then set about the scholar.||\"Help! Thieves!\" cries the scholar in a thin, reedy voice.">
<CONSTANT CHOICES540 <LTABLE "Return to the city centre" "Chase the muggers off">>

<ROOM STORY540
	(DESC "540")
	(STORY TEXT540)
	(CHOICES CHOICES540)
	(DESTINATIONS <LTABLE STORY100 STORY433>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT541 "Burdened by the heavy chest full of coins, the three figures have left deep footprints in the grass.">

<ROOM STORY541
	(DESC "541")
	(STORY TEXT541)
	(CHOICES CHOICES-SCOUTING)
	(DESTINATIONS <LTABLE <LTABLE STORY326 STORY245>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT542 "\"By Tyrnai, it's the one who killed that pretender to the throne, Nergan Corin,\" says one of them. They line up and give you a drunken salute, and then fall to slapping you on the back and offering to buy you beers all night.||They also give you a present: a potion of strength (COMBAT +1). When used it will add 1 to your COMBAT rating for the duration of one fight only, after which it will wear off.">

<ROOM STORY542
	(DESC "542")
	(VISITS 0)
	(BACKGROUND STORY542-BACKGROUND)
	(STORY TEXT542)
	(CONTINUE STORY100)
	(ITEMS <LTABLE POTION-OF-STRENGTH>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY542-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY542 1> <RETURN ,STORY520>)>
	<RETURN ,STORY542>>

<CONSTANT TEXT543 "Guildmaster Vernon is too busy to see you. It seems he doesn't want to know you, now that he doesn't need you anymore. Such is life.">

<ROOM STORY543
	(DESC "543")
	(STORY TEXT543)
	(CONTINUE STORY405)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT544 "The shrine is set in a wooded grove. Birds twitter in the trees, and a deer darts away into the forest at your approach. A priestess is tending a low altar, where food and drink has been laid out in honour of Lacuna, the Goddess of the Wilderness. She is the patron of hunters, trappers, woodsman, and all those who seek oneness with nature.">
<CONSTANT CHOICES544 <LTABLE TEXT-BECOME-INITIATE TEXT-RENOUNCE-WORSHIP TEXT-SEEK-BLESSING "Talk to the priestess" TEXT-LEAVE-TEMPLE>>

<ROOM STORY544
	(DESC "544")
	(STORY TEXT544)
	(CHOICES CHOICES544)
	(DESTINATIONS <LTABLE STORY618 STORY334 STORY052 STORY471 STORY195>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT545 "You are given the cage. The trau speaks to you so quickly that you can barely distinguish the syllables.||\"Let me out of here, and I'll reward you,\" it says.">
<CONSTANT CHOICES545 <LTABLE "Free it" "Sell it to the mines in the Bronze Hills">>

<ROOM STORY545
	(DESC "545")
	(STORY TEXT545)
	(CHOICES CHOICES545)
	(DESTINATIONS <LTABLE STORY642 STORY651>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT546 "With an heroic effort, you manage to get to the woman. Gathering her up, you run for the door, and stagger out into the cool night air, smoke and flames licking at your heels. The townsfolk give you a rousing cheer and the girl thanks you effusively for saving her mother.||Later, it transpires that the woman is actually a powerful sorceress whose experiments in fire magic went slightly wrong. Her name is Elissia the Traveller and she gives you a gift: a pale moonstone.||Elissia tells that you can use the moonstone by rubbing it, and you will be instantly teleported to the vicinity of the sunstone -- which she carries on a necklace. \"I will be here in Marlock City. Whenever you are desperate, at the end of your tether, or just want to get here fast, use the moonstone and you will appear beside me. I will do everything in my power to aid you, and then my debt to you will be repaid.\"">

<ROOM STORY546
	(DESC "546")
	(STORY TEXT546)
	(CONTINUE STORY100)
	(ITEMS <LTABLE MOONSTONE-OF-TELEPORTATION>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT547 "Your instinct was correct. The sea bed suddenly drops away, to reveal the ruins of the Sunken City of Ziusudra. Crumbling towers climb out of the hazy green depths, and shoals of flashing silverfish dart through the abandoned windows and doors of coral-encrusted buildings.||The creature you are following arrows down towards a large dome-like structure covered in waving tendrils of seaweed. It disappears through a hole in the roof of the dome.||Carefully, you swim down to the hole and look through, into the palace of the repulsive ones.">

<ROOM STORY547
	(DESC "547")
	(STORY TEXT547)
	(CONTINUE STORY041)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT548 "You are crossing an area of fertile farmland, where much of the food is grown to feed the army. Little farmsteads dot the landscape, and the ploughed fields have the appearance of a patchwork quilt.">
<CONSTANT CHOICES548 <LTABLE "East to Fort Estgard" "North to the road" "South to Blessed Springs" "To the Coldbleak Mountains" "To the Lake of the Sea Dragon">>

<ROOM STORY548
	(DESC "548")
	(LOCATION LOCATION-SOKARA)
	(STORY TEXT548)
	(EVENTS STORY548-EVENTS)
	(CHOICES CHOICES548)
	(DESTINATIONS <LTABLE STORY472 STORY458 STORY510 STORY474 STORY135>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY548-EVENTS ("AUX" ROLL)
	<COND (,RUN-ONCE
		<SET ROLL <RANDOM-EVENT 1 0 T>>
		<COND (<L=? .ROLL 2>
			<EMPHASIZE "You were mistaken for a murderer! You flee into the mountains!">
			<STORY-JUMP ,STORY474>
			<RETURN>
		)(<L=? .ROLL 4>
			<EMPHASIZE ,NOTHING-HAPPENS>
		)(ELSE
			<EMPHASIZE "You find some leather armour (DEFENSE + 1)">
			<TAKE-ITEM ,LEATHER-ARMOUR>
		)>
	)>
	<IF-ALIVE ,TEXT-YOU-CAN-GO>>

<CONSTANT TEXT549 "The priestess, dressed in a cloak made entirely of the leaves of trees, with her face smeared with moss, greets you. \"A tusk!\" she exclaims. \"But I have no need of another.\"||You ask if she might need it for the next time. \"Next time? Hmm, maybe you have a point.\"||She offers you 15 Shards.">

<ROOM STORY549
	(DESC "549")
	(STORY TEXT549)
	(EVENTS STORY549-EVENTS)
	(CONTINUE STORY195)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY549-EVENTS ()
	<CRLF>
	<TELL "Accept her offer (15 Shards for the boar's tusk)?">
	<COND (<YES?>
		<REMOVE-ITEM ,BOARS-TUSK "sold" T T>
		<GAIN-MONEY 15>
	)>>

<ROOM STORY550
	(DESC "550")
	(BACKGROUND STORY550-BACKGROUND)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY550-BACKGROUND ()
	<COND (<CHECK-ITEM ,GOLD-CHAIN-MAIL> <RETURN ,STORY380>)>
	<RETURN ,STORY134>>

<CONSTANT TEXT551 "You cannot escape. There are too many of them and all of them are seasoned warriors of Tyrnai. You are overpowered and given a savage beating. They take all your money and possessions.||The priests do not have you sacrificed to Tyrnai -- instead you are sold into slavery and set to work in the tin mines outside the city.">

<ROOM STORY551
	(DESC "551")
	(STORY TEXT551)
	(EVENTS STORY551-EVENTS)
	(CONTINUE STORY118)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY551-EVENTS ()
	<SETG STAMINA 1>
	<STORY-LOSE-EVERYTHING F>
	<UPDATE-STATUS-LINE>>

<CONSTANT TEXT552 "A swaggering Sokaran captain marches on board with a complement of marines.||\"I don't think you've paid your harbour duties,\" he says.||\"Harbour duties? We're in the middle of the sea.\"||He smiles smugly at you. \"You'd better cough up fifty Shards, or I'll impound your ship and its cargo.\"||\"That's no better than common piracy,\" says your first mate, outraged.||\"The duty will be sixty Shards now, for calling a captain in the Sokaran Imperial Navy a pirate.\"||Several of his men burst into laughter.">
<CONSTANT CHOICES552 <LTABLE YOU-ARE-A "Hand over the money" "Refuse outright">>

<ROOM STORY552
	(DESC "552")
	(STORY TEXT552)
	(CHOICES CHOICES552)
	(DESTINATIONS <LTABLE STORY185 STORY401 STORY311>)
	(REQUIREMENTS <LTABLE TITLE-PROTECTOR-SOKARA 60 NONE>)
	(TYPES <LTABLE R-TITLE R-MONEY R-NONE>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT553 "You convince her that you mean no harm. The little girl tells you that she was placing flowers at the grave of her father, when a horrible monster came for her.Fortunately, she was able to run away. She points to a large tomb behind which the thing was hiding.||You tell the girl to go home and then you set out warily for the tomb. Suddenly, a foul stench fills your nostrils, and a figure rises up out of the shadows! Yellow eyes glow with feral blood-lust, and the creature's talons, encrusted with dried blood, reach for you hungrily. You've found the ghoul!">
<CONSTANT CHOICES553 <LTABLE "Fight it" "Invoke the power of the gods" "Use some">>

<ROOM STORY553
	(DESC "553")
	(STORY TEXT553)
	(CHOICES CHOICES553)
	(DESTINATIONS <LTABLE STORY617 STORY144 STORY303>)
	(REQUIREMENTS <LTABLE NONE NONE SALT-IRON-FILINGS>)
	(TYPES <LTABLE R-NONE R-NONE R-ITEM>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT554 "King Skabb's rusty iron crown shattered when he fell, so you take the copper amulet from around his neck. You also find a chest in the corner of the room but it is clearly booby-trapped. You can open it using either magic or your skills as a thief.">
<CONSTANT CHOICES554 <LTABLE TEXT-ROLL-MAGIC TEXT-ROLL-THIEVERY "Leave the chest and return to the surface">>

<ROOM STORY554
	(DESC "554")
	(STORY TEXT554)
	(CHOICES CHOICES554)
	(DESTINATIONS <LTABLE <LTABLE STORY006 STORY064> <LTABLE STORY006 STORY064> STORY010>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-MAGIC 9> <LTABLE ABILITY-THIEVERY 9> NONE>)
	(TYPES <LTABLE R-TEST-ABILITY R-TEST-ABILITY R-NONE>)
	(ITEMS <LTABLE COPPER-AMULET>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT555 "All shipping in and out of Yellowport must come through the offices of the harbourmaster. Here you can buy passage to far lands, or even a ship of your own, to fill with cargo and crew. ||Alternatively, if you buy a ship, you are the captain and can take it where you wish, exploring or trading.||The quality of the ship's crew is poor, unless you upgrade it. If you already own a ship, you can sell it back to the harbourmaster. It costs 50 Shards to upgrade a poor crew to average, and 100 Shards to upgrade an average crew to good. Excellent quality is not available in Yellowport.||If you own a ship, you can buy as many Cargo Units as it has room for. You may also sell cargo, if you have any. Prices are for single Cargo Units.">

<ROOM STORY555
	(DESC "555")
	(STORY TEXT555)
	(EVENTS STORY555-EVENTS)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY555-EVENTS ()
	<HARBOUR-YELLOWPORT>>

<CONSTANT TEXT556 "You scatter the powder on the surface of the waters.||There is a flash, and a cloud of yellow smoke billows up out of the pond. When it clears, you find yourself face to face with a white-bearded bespectacled old man, floating a few feet off the water. He is dressed in long, flowing ornate robes.||He blinks at you for a moment before saying, \"Oh, that worthless apprentice of mine. Can you imagine -- I told him to throw the dust into the holy waters but the idiot couldn't even be trusted to do that.\"||The old man's name is Oliphard the Wizardly. As a reward for restoring his physical form, he casts a spell that enhances your skill.">
<CONSTANT CHOICES556 <LTABLE YOU-ARE-A IF-NOT>>

<ROOM STORY556
	(DESC "556")
	(STORY TEXT556)
	(EVENTS STORY556-EVENTS)
	(CHOICES CHOICES556)
	(DESTINATIONS <LTABLE STORY426 STORY699>)
	(REQUIREMENTS <LTABLE PROFESSION-MAGE NONE>)
	(TYPES <LTABLE R-PROFESSION R-NONE>)
	(CODEWORDS <LTABLE CODEWORD-AMENDS>)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY556-EVENTS ()
	<COND (,RUN-ONCE
		<REMOVE-ITEM ,VIAL-YELLOW-DUST "scattered" T T>
		<UPGRADE-ABILITIES 1>
	)>>

<CONSTANT TEXT557 "\"Who is rightful ruler of Sokara -- General Grieve Marlock, or the son of the old king, Nergan Corin?\" asks the soldier.">
<CONSTANT CHOICES557 <LTABLE "Grieve Marlock" "Nergan Corin">>

<ROOM STORY557
	(DESC "557")
	(STORY TEXT557)
	(CHOICES CHOICES557)
	(DESTINATIONS <LTABLE STORY631 STORY664>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT558 "You join the much-travelled road that connects Trefoille and Caran Baru. The traffic mostly consists of convoys of troops and supplies.">
<CONSTANT CHOICES558 <LTABLE "Go to Trefoille" "Follow the road north" "Go north into the Curstmoor" "Go east to the river">>

<ROOM STORY558
	(DESC "558")
	(STORY TEXT558)
	(CHOICES CHOICES558)
	(DESTINATIONS <LTABLE STORY250 STORY387 STORY175 STORY310>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT559 "Your ship is sailing in the coastal waters off the Shadar Tor.">
<CONSTANT CHOICES559 <LTABLE "Sail north west towards Marlock City" "Sail north east towards Yellowport" "Sail south into the Violet Ocean">>

<ROOM STORY559
	(DESC "559")
	(STORY TEXT559)
	(CHOICES CHOICES559)
	(DESTINATIONS <LTABLE STORY222 STORY029 STORY416>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT560 "You are crossing the western wilderness, an expanse of wild, sparsely-populated countryside. A few trappers and woodsman make a living from the natural resources of the area.||A tall spire of rock, a towering anomaly of geology, rises up into the clouds, dominating the horizon. A local hunter tells you it is known as Devil's Peak and that the summit is infested with demons.">
<CONSTANT CHOICES560 <LTABLE "Climb the peak" "Head west to the river" "Head north into the Forest of Larun" "Go south to the Curstmoor" "Travel east to the road">>

<ROOM STORY560
	(DESC "560")
	(STORY TEXT560)
	(CHOICES CHOICES560)
	(DESTINATIONS <LTABLE STORY658 STORY099 STORY047 STORY175 STORY558>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT561 "You are left alone, free to trawl for smolder fish.">

<ROOM STORY561
	(DESC "561")
	(STORY TEXT561)
	(EVENTS STORY561-EVENTS)
	(CONTINUE STORY135)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY561-EVENTS ("AUX" ROLL)
	<SET ROLL <RANDOM-EVENT 1 0 T>>
	<DO (I 1 .ROLL)
		<TAKE-ITEM ,SMOLDER-FISH>
	>>

<CONSTANT TEXT562 "After a gruelling climb of some hours, you are halfway up the side of a mountain when you discover a thin, precarious path, leading up. You take a swig of water from your canteen and proceed up the path.||After a while you have to stop to take more water. To your horror, your water supply has turned sour and undrinkable.">

<ROOM STORY562
	(DESC "562")
	(STORY TEXT562)
	(CHOICES CHOICES-MAGIC)
	(DESTINATIONS <LTABLE <LTABLE STORY374 STORY643>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-MAGIC 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT563 "To renounce the worship of Sig, you must pay 50 Shards in compensation to the priesthood.||\"Sig will no longer watch over you!\" says a priest.">
<CONSTANT TEXT563-CONTINUED "\"The dungeons are full of would-be rogues who renounced the faith!\" yells a priest as you leave.">

<ROOM STORY563
	(DESC "563")
	(STORY TEXT563)
	(EVENTS STORY563-EVENTS)
	(CONTINUE STORY100)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY563-EVENTS ()
	<COND (<CHECK-GOD ,GOD-SIG>
		<RENOUNCE-WORSHIP 50 ,GOD-SIG>
		<COND (<NOT ,GOD>
			<IF-ALIVE ,TEXT563-CONTINUED>
		)>
	)>>

<CONSTANT TEXT564 "You tell the priest about the curse of Tyrnai.||\"Ah, I see. Well, you have to appease the god. You need a weapon (COMBAT +1), which you can buy in most markets, or acquire by some other means. Throw the weapon into the holy waters at the village of Blessed Springs, and ask for his forgiveness.\"">

<ROOM STORY564
	(DESC "564")
	(STORY TEXT564)
	(CONTINUE STORY100)
	(CODEWORDS <LTABLE CODEWORD-APPEASE>)
	(FLAGS LIGHTBIT)>

<ROOM STORY565
	(DESC "565")
	(CHOICES CHOICES-THIEVERY)
	(DESTINATIONS <LTABLE <LTABLE STORY654 STORY376>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-THIEVERY 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT566 "You are discovered hiding in the kitchen pantry. You are hauled off and thrown into the dungeons to await judgment.">

<ROOM STORY566
	(DESC "566")
	(STORY TEXT566)
	(EVENTS STORY-LOSE-EVERYTHING)
	(CONTINUE STORY454)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT567 "\"You are not worthy,\" he says gruffly, and walks on without a backward glance. You sense it would not be wise to press him further.">

<ROOM STORY567
	(DESC "567")
	(STORY TEXT567)
	(CONTINUE STORY412)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT568 "The temple of Elnir is a single spire reaching skyward. Eagles roost in its lofty belfry -- they are sacred to the priests of the Skylord. Elnir is the Divine Ruler of the Heavens, patron of statesman and kings, and his sons are the storm lords.||\"Thunder is the sound of the Sons of Elnir smiting the cloud demons,\" says a passing peasant.">

<ROOM STORY568
	(DESC "568")
	(STORY TEXT568)
	(CHOICES CHOICES-STANDARD-TEMPLE)
	(DESTINATIONS <LTABLE STORY440 STORY241 STORY073 STORY100>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT569 "You will have to fight them one at a time. They are tough opponents because their skin is made of iron.">

<ROOM STORY569
	(DESC "569")
	(STORY TEXT569)
	(EVENTS STORY569-EVENTS)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY569-EVENTS ()
	<DO (I 1 2)
		<PUTP ,STORY569 ,P?DOOM T>
		<COMBAT-MONSTER ,MONSTER-GOLEM 5 11 10>
		<COND (<NOT <CHECK-COMBAT ,MONSTER-GOLEM ,STORY569>>
			<STORY-JUMP ,STORY488>
			<RETURN>
		)>
	>
	<COND (<IS-ALIVE>
		<STORY-JUMP ,STORY162>
	)(ELSE
		<STORY-JUMP ,STORY488>
	)>>

<CONSTANT TEXT570 "\"Aargh, you sapling of soft and treacherous flesh!\" roars the tree, flailing its branches at you. You must fight.">
<CONSTANT TEXT570-LOSE "You are battered into unconsciousness and wake up in the trading post and all your money gone">

<ROOM STORY570
	(DESC "570")
	(STORY TEXT570)
	(EVENTS STORY570-EVENTS)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY570-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-TREE-GUARD 3 7 10>
	<COND (<CHECK-COMBAT ,MONSTER-TREE-GUARD ,STORY570 0 NONE 5>
		<STORY-JUMP ,STORY148>
	)(ELSE
		<SETG MONEY 0>
		<EMPHASIZE TEXT570-LOSE>
		<STORY-JUMP ,STORY195>
	)>>

<CONSTANT TEXT571 "The merchants' guild of Marlock City is a large, many-storeyed building of marble. Inside, many clerks and scribes are at work. Here you can bank your money for safekeeping, or invest it in guild enterprises in the hope of making a profit. A sign on the guildmaster's door reads 'Help wanted'.">
<CONSTANT CHOICES571 <LTABLE "Visit the guildmaster" "Make an investment" "Check on investments" "Deposit or withdraw money" "Return to the town centre">>

<ROOM STORY571
	(DESC "571")
	(STORY TEXT571)
	(CHOICES CHOICES571)
	(DESTINATIONS <LTABLE STORY290 STORY104 STORY088 STORY605 STORY100>)
	(TYPES FIVE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT572 "You open the door on to a large dining hall and kitchen. About thirty ratmen are standing around, eating and drinking. Everything goes quiet as they turn to stare at you with their black beady eyes.||\"Er, I do have an invitation,\" you stutter, holding up the note.||\"And we'd love to have you for dinner,\" one of them snarls.||Yelling noisily, they charge toward you. You have little choice but to turn and flee for your life! You race down the sewer tunnels, with the ratmen in hot pursuit.">
<CONSTANT CHOICES572 <LTABLE "Lose them in the tunnels" "Try some magic" "Hide">>

<ROOM STORY572
	(DESC "572")
	(STORY TEXT572)
	(CHOICES CHOICES572)
	(DESTINATIONS <LTABLE STORY079 STORY296 STORY127>)
	(TYPES THREE-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT573 "To renounce the worship of the Three Fortunes, you will have to undergo a ritual.||\"We must determine what the Three Fortunes have to say about the matter,\" says the high priest.||Do you want to reconsider?">

<ROOM STORY573
	(DESC "573")
	(STORY TEXT573)
	(EVENTS STORY573-EVENTS)
	(CONTINUE STORY086)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY573-EVENTS ("AUX" ROLL)
	<PUTP ,STORY573 ,P?DOOM T>
	<COND (<CHECK-GOD ,GOD-THREE-FORTUNES>
		<SET ROLL <RANDOM-EVENT 1 0 T>>
		<COND (<L=? .ROLL 2>
			<PREVENT-DOOM ,STORY573>
			<EMPHASIZE "You renounced the worship of the Three Fortunes and are free to go.">
			<SETG GOD NONE>
		)(<L=? .ROLL 4>
			<PREVENT-DOOM ,STORY573>
			<COND (<G=? ,MONEY 25>
				<CRLF>
				<TELL "Renounce the worship of ">
				<PRINT-ITEM ,GOD-THREE-FORTUNES T>
				<TELL "?">
				<COND (<YES?>
					<COST-MONEY 25 "paid">
					<SETG GOD NONE>
				)>
			)(ELSE
				<EMPHASIZE "You cannot afford to renounce the worship of Three Fortunes at this time!">
			)>
		)(ELSE
			<EMPHASIZE "They demand a sacrifice of some of your blood">
			<LOSE-STAMINA 1 ,DIED-GREW-WEAKER ,STORY573>
		)>
	)(ELSE
		<EMPHASIZE "You are not an initiate of Three Fortunes!">
		<PREVENT-DOOM ,STORY573>
	)>>

<CONSTANT TEXT574 "\"Ah, the saviour of the citadel. What can I do for you?\" asks the general.||He can arrange for you to be healed of all your wounds, cured of poison, disease, and madness (but his court sorcerer cannot lift a curse).||\"Any time you're in real need, just come to me,\" he adds.">
<CONSTANT CHOICES574 <LTABLE HAVE-A OTHERWISE>>

<ROOM STORY574
	(DESC "574")
	(STORY TEXT574)
	(EVENTS STORY574-EVENTS)
	(CHOICES CHOICES574)
	(DESTINATIONS <LTABLE STORY677 STORY100>)
	(REQUIREMENTS <LTABLE CODED-MISSIVE NONE>)
	(TYPES <LTABLE R-ITEM R-NONE>)
	(FLAGS LIGHTBIT)>

; "TO-DO: search for money in townhouses, caches, banks, and investment houses"
; "TO-DO: search for weapons and armours in townhouses, caches"
<ROUTINE STORY574-EVENTS ()
	<COND (,RUN-ONCE
		<COND (<L? ,STAMINA ,MAX-STAMINA> <SETG STAMINA ,MAX-STAMINA>)>
		<COND (<OR <G? <COUNT-CONTAINER ,AILMENTS ,DISEASEBIT> 0> <G? <COUNT-CONTAINER ,AILMENTS ,POISONBIT> 0>> <CURE-AILMENTS 0 ,DISEASEBIT ,POISONBIT>)>
		<FIND-BEST-GEAR>
		<COND (<NOT ,BEST-WEAPON> <TAKE-ITEM ,SWORD>)>
		<COND (<NOT ,BEST-ARMOUR> <TAKE-ITEM ,CHAIN-MAIL>)>
		<COND (<L=? ,MONEY 0> <GAIN-MONEY 200>)>
	)>>

<CONSTANT TEXT575 "\"You are indeed worthy,\" he says.||\"And will you teach me your fighting arts?\" you ask.||\"You have already learned all I can teach you,\" he says.||You realize that what he says is true. Your defeat of the Black Dragon Knight has taught you much.||You look up, but Yanryt the Son has gone.">

<ROOM STORY575
	(DESC "575")
	(STORY TEXT575)
	(EVENTS STORY575-EVENTS)
	(CONTINUE STORY400)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY575-EVENTS ()
	<RETURN-ITEM ,BLACK-DRAGON-SHIELD T>
	<DELETE-CODEWORD ,CODEWORD-AXE>
	<GAIN-RANK 1>
	<UPGRADE-STAMINA <ROLL-DICE 1>>>

<CONSTANT TEXT576 "You are up the Stinking River near its source: the Lake of the Sea Dragon. From here, the yellow waters rush down to the sea. The smell of the bubbling, sulphur-laden water is abominable.">
<CONSTANT CHOICES576 <LTABLE "Go to the Lake of the Sea Dragon" "Follow the river south" "Go west to the road" "East into the countryside">>

<ROOM STORY576
	(DESC "576")
	(LOCATION LOCATION-STINKING)
	(STORY TEXT576)
	(CHOICES CHOICES576)
	(DESTINATIONS <LTABLE STORY135 STORY310 STORY558 STORY278>)
	(TYPES FOUR-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT577 "You recognize the tracks as those of the legendary gorlock. You remember that it is said to have backward-pointing feet, so that the tracks it leaves will always show the opposite direction of travel! This means that the gorlock is currently inside the cave.">
<CONSTANT CHOICES577 <LTABLE "Challenge the beast to combat" "Wait for it to leave the cave">>

<ROOM STORY577
	(DESC "577")
	(STORY TEXT577)
	(CHOICES CHOICES577)
	(DESTINATIONS <LTABLE STORY174 STORY287>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT578 "The villagers welcome you as the one who brought Fourze to justice, and saved their people from slavery.">

<ROOM STORY578
	(DESC "578")
	(STORY TEXT578)
	(CONTINUE STORY527)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT579 "You are travelling across flatlands. The River Grimm splits into a delta here, spilling its waters into the sea. Long, sandy beaches stretch out to sea.">
<CONSTANT CHOICES579 <LTABLE "Go to Marlock City" "Follow the river north" "Travel west into Golnir (Cities of Gold and Glory)">>

<ROOM STORY579
	(DESC "579")
	(LOCATION LOCATION-GRIMM)
	(STORY TEXT579)
	(EVENTS STORY579-EVENTS)
	(CHOICES CHOICES579)
	(DESTINATIONS <LTABLE STORY100 STORY099 STORY-CITIES-GOLD-GLORY>)
	(TYPES THREE-CHOICES)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY579-EVENTS ("AUX" ROLL)
	<COND (,RUN-ONCE
		<PUTP ,STORY579 ,P?DOOM T>
		<SET ROLL <RANDOM-EVENT 1 0 T>>
		<COND (<L=? .ROLL 2>
			<EMPHASIZE "You were bitten by a crab.">
			<LOSE-STAMINA 1 ,DIED-FROM-INJURIES ,STORY579>
		)(<L=? .ROLL 4>
			<EMPHASIZE ,NOTHING-HAPPENS>
			<PREVENT-DOOM ,STORY579>
		)(ELSE
			<EMPHASIZE "You find an ink sac washed up on the shore.">
			<KEEP-ITEM ,INK-SAC>
			<PREVENT-DOOM ,STORY579>
		)>
	)>
	<IF-ALIVE ,TEXT-YOU-CAN>>

<CONSTANT TEXT580 "You wait for things to die down, and make your way back to the door marked 'Thrown Rum'. Ignoring the kitchens, you go through.">

<ROOM STORY580
	(DESC "580")
	(STORY TEXT580)
	(CONTINUE STORY202)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT581 "You try to cut the king down, but at the last moment, he catches your wrist. His face is a mask of hate and rage. \"Traitorous viper!\" he hisses, before shouting for the guards. You are forced to flee for your life.||Although you make it out of the stockade, you are caught in a narrow defile and seized by many men. You are hauled before Captain Vorkung, who looks sick and ashen-faced. He let you in to see the king in the first place.||You are sentenced to be hanged; the sentence is carried out immediately.">

<ROOM STORY581
	(DESC "581")
	(STORY TEXT581)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT582 "Before you have time to react, the dragon's massive tail smashes into the keel of your boat, lifting it out of the water, and breaking it in two. You are pitched into the sulphurous lake, with a rabid sea dragon closing in, intent on swallowing you whole!">

<ROOM STORY582
	(DESC "582")
	(STORY TEXT582)
	(EVENTS STORY582-EVENTS)
	(CONTINUE STORY477)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY582-EVENTS ("AUX" ROLL (RANK 1))
	<SET ROLL <RANDOM-EVENT 1 0 T>>
	<SET RANK <GET-RANK ,CURRENT-CHARACTER>>
	<COND (<L=? .ROLL .RANK> <STORY-JUMP ,STORY637>)>>

<ROOM STORY583
	(DESC "583")
	(STORY TEXT-STORM-SUBSIDES)
	(EVENTS STORY-LOSE-CARGO)
	(CONTINUE STORY090)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT584 "\"How can I come out to you? I would drown in the sea! Is that what you plan?\" you ask angrily.||\"Don't you know?\" sighs one of them, \"the kiss of the merfolk gives the power to breathe the waters to one of your kind for a short time!\"||The others laugh mischievously.">
<CONSTANT CHOICES584 <LTABLE "Be kissed by the merfolk" "Return to the clifftop tor">>

<ROOM STORY584
	(DESC "584")
	(STORY TEXT584)
	(CHOICES CHOICES584)
	(DESTINATIONS <LTABLE STORY254 STORY035>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT585 "You trail Fourze to the old farm. He goes inside, and you creep to see what he is doing.||Two rough-looking thugs are helping Fourze get into what is obviously a monster suit! It's a bit like a giant hairy toad, made of the hide of some animal stretched over a wooden framework. So much for the dreaded Gob-gobbler!||You wait by the door. As the thugs emerge, you club one to the ground, but you will have to fight the other one.">

<ROOM STORY585
	(DESC "585")
	(STORY TEXT585)
	(EVENTS STORY585-EVENTS)
	(CONTINUE STORY236)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY585-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-BANDIT 4 6 6>
	<CHECK-COMBAT ,MONSTER-BANDIT ,STORY585>>

<ROOM STORY586
	(DESC "586")
	(STORY TEXT-STORM-SEA)
	(EVENTS STORY586-EVENTS)
	(CHOICES CHOICES-STORM-FURY)
	(DESTINATIONS <LTABLE <LTABLE STORY182 STORY530 STORY085>>)
	(REQUIREMENTS STORY-STORM-REQUIREMENTS)
	(TYPES ONE-RANDOM)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY586-EVENTS ()
	<STORM-AT-SEA ,STORY586 ,STORY085>>

<CONSTANT TEXT587 "While taking a stroll through the busy harbour area, you overhear a conversation between two merchants and learn the most profitable trading routes between Sokara and Golnir.">

<ROOM STORY587
	(DESC "587")
	(STORY TEXT587)
	(CONTINUE STORY010)
	(CODEWORDS <LTABLE CODEWORD-ALMANAC>)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT588 "You break past the militia, leap over a table and rush out of the door. From behind you can hear muffled curses and then a fiery blast which sizzles wetly in the damp yellow fog, but you don't look back and you don't stop running until you are well clear of the house.">

<ROOM STORY588
	(DESC "588")
	(STORY TEXT588)
	(CONTINUE STORY010)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT589 "Striding purposefully into the tavern, you walk straight up to him and say, \"I want what you've got under that eyepatch.\"||His one good eye widens in surprise, and he jumps back, drawing his sword. \"We'll see about that, by Sig!\"||The other people in the tavern draw back to give you room and start taking bets on the outcome of the fight.">

<ROOM STORY589
	(DESC "589")
	(STORY TEXT589)
	(EVENTS STORY589-EVENTS)
	(CONTINUE STORY092)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY589-EVENTS ()
	<COMBAT-MONSTER ,MONSTER-MAN-EYEPATCH 5 8 12>
	<CHECK-COMBAT ,MONSTER-MAN-EYEPATCH ,STORY589>>

<CONSTANT TEXT590 "From the cover of a hedge you wait until dusk. By now all the villagers are safely indoors with their shutters tightly barred.||As the sky is turning from velvet indigo to the starlit blackness of night, you see three pale figures come loping across the green from the direction of the millpond. They must be the ghosts.||Seeing the banquet, they utter gleeful cries and start to devour what has been set out for them.">

<ROOM STORY590
	(DESC "590")
	(STORY TEXT590)
	(CHOICES CHOICES-MAGIC)
	(DESTINATIONS <LTABLE <LTABLE STORY231 STORY357>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-MAGIC 11>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<ROOM STORY591
	(DESC "591")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY592
	(DESC "592")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY593
	(DESC "593")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY594
	(DESC "594")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY595
	(DESC "595")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY596
	(DESC "596")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY597
	(DESC "597")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY598
	(DESC "598")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY599
	(DESC "599")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY600
	(DESC "600")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY601
	(DESC "601")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY602
	(DESC "602")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY603
	(DESC "603")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY604
	(DESC "604")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY605
	(DESC "605")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY606
	(DESC "606")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY607
	(DESC "607")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY608
	(DESC "608")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY609
	(DESC "609")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY610
	(DESC "610")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY611
	(DESC "611")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY612
	(DESC "612")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY613
	(DESC "613")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY614
	(DESC "614")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY615
	(DESC "615")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY616
	(DESC "616")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT617 "A desperate battle ensues.">

<ROOM STORY617
	(DESC "617")
	(STORY TEXT617)
	(EVENTS STORY617-EVENTS)
	(CONTINUE STORY196)
	(DOOM T)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY617-EVENTS ("AUX" INITIAL-STAMINA)
	<SET INITIAL-STAMINA ,STAMINA>
	<COMBAT-MONSTER ,MONSTER-GHOUL 3 7 15>
	<CHECK-COMBAT ,MONSTER-GHOUL ,STORY617>
	<COND (<IS-ALIVE>
		<COND (<L? ,STAMINA .INITIAL-STAMINA>)>
		<AFFLICTED-WITH ,DISEASE-GHOULBITE>
	)>>

<ROOM STORY618
	(DESC "618")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT619 "You come across a blazing house in the poorer area of town. A crowd has gathered, watching the flames impassively. A young girl runs up to you, in tears. \"My mother is inside! Please help her,\" she begs.||The fire is raging hard, and you are not sure whether anyone could be left alive inside.">
<CONSTANT CHOICES619 <LTABLE "Attempt a rescue" "Walk on">>

<ROOM STORY619
	(DESC "619")
	(VISITS 0)
	(BACKGROUND STORY619-BACKGROUND)
	(STORY TEXT619)
	(CHOICES CHOICES619)
	(DESTINATIONS <LTABLE STORY262 STORY100>)
	(TYPES TWO-CHOICES)
	(FLAGS LIGHTBIT)>

<ROUTINE STORY619-BACKGROUND ()
	<COND (<CHECK-VISITS-MORE ,STORY619 1> <RETURN ,STORY339>)>
	<RETURN ,STORY619>>

<ROOM STORY620
	(DESC "620")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY621
	(DESC "621")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY622
	(DESC "622")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY623
	(DESC "623")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY624
	(DESC "624")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY625
	(DESC "625")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY626
	(DESC "626")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY627
	(DESC "627")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY628
	(DESC "628")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY629
	(DESC "629")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY630
	(DESC "630")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY631
	(DESC "631")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY632
	(DESC "632")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY633
	(DESC "633")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY634
	(DESC "634")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY635
	(DESC "635")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY636
	(DESC "636")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY637
	(DESC "637")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY638
	(DESC "638")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY639
	(DESC "639")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY640
	(DESC "640")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY641
	(DESC "641")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY642
	(DESC "642")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY643
	(DESC "643")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY644
	(DESC "644")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY645
	(DESC "645")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY646
	(DESC "646")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY647
	(DESC "647")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY648
	(DESC "648")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY649
	(DESC "649")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY650
	(DESC "650")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY651
	(DESC "651")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY652
	(DESC "652")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY653
	(DESC "653")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY654
	(DESC "654")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY655
	(DESC "655")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY656
	(DESC "656")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY657
	(DESC "657")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY658
	(DESC "658")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY659
	(DESC "659")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY660
	(DESC "660")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY661
	(DESC "661")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY662
	(DESC "662")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY663
	(DESC "663")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY664
	(DESC "664")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY665
	(DESC "665")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY666
	(DESC "666")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY667
	(DESC "667")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY668
	(DESC "668")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY669
	(DESC "669")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY670
	(DESC "670")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY671
	(DESC "671")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY672
	(DESC "672")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY673
	(DESC "673")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY674
	(DESC "674")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY675
	(DESC "675")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY676
	(DESC "676")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY677
	(DESC "677")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY678
	(DESC "678")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY679
	(DESC "679")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY680
	(DESC "680")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY681
	(DESC "681")
	(CHOICES CHOICES-SCOUTING)
	(DESTINATIONS <LTABLE <LTABLE STORY652 STORY529>>)
	(REQUIREMENTS <LTABLE <LTABLE ABILITY-SCOUTING 10>>)
	(TYPES ONE-ABILITY)
	(FLAGS LIGHTBIT)>

<ROOM STORY682
	(DESC "682")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY683
	(DESC "683")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY684
	(DESC "684")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY685
	(DESC "685")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY686
	(DESC "686")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY687
	(DESC "687")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY688
	(DESC "688")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY689
	(DESC "689")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY690
	(DESC "690")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY691
	(DESC "691")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY692
	(DESC "692")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY693
	(DESC "693")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY694
	(DESC "694")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY695
	(DESC "695")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY696
	(DESC "696")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY697
	(DESC "697")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY698
	(DESC "698")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY699
	(DESC "699")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY700
	(DESC "700")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY701
	(DESC "701")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY702
	(DESC "702")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY703
	(DESC "703")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY704
	(DESC "704")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY705
	(DESC "705")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY706
	(DESC "706")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY707
	(DESC "707")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY708
	(DESC "708")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY709
	(DESC "709")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY710
	(DESC "710")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY711
	(DESC "711")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY712
	(DESC "712")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY713
	(DESC "713")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY714
	(DESC "714")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY715
	(DESC "715")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY716
	(DESC "716")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY717
	(DESC "717")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY718
	(DESC "718")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY719
	(DESC "719")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY720
	(DESC "720")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY721
	(DESC "721")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY722
	(DESC "722")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY723
	(DESC "723")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY724
	(DESC "724")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY725
	(DESC "725")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY726
	(DESC "726")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY727
	(DESC "727")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY728
	(DESC "728")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY729
	(DESC "729")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY730
	(DESC "730")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY731
	(DESC "731")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY732
	(DESC "732")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY733
	(DESC "733")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY734
	(DESC "734")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY735
	(DESC "735")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<CONSTANT TEXT736 "Out of the corner of your eye you see an old man wandering along the beach gathering driftwood. He glances in your direction but doesn't come over. Perhaps he mistakes you for a patch of seaweed -- or perhaps he is simply afraid. Whatever the reason, he soon hobbles off carrying his armload of wood. When he is out of sight, you rise unsteadily to your feet and consider your next move.">
<CONSTANT CHOICES736 <LTABLE "Explore the coast" "Head into the nearby forest">>

<ROOM STORY736
	(DESC "736")
	(STORY TEXT736)
	(CHOICES CHOICES736)
	(DESTINATIONS <LTABLE STORY128 STORY257>)
	(TYPES TWO-CHOICES)
	(CODEWORDS <LTABLE CODEWORD-AURIC>)
	(FLAGS LIGHTBIT)>

<ROOM STORY737
	(DESC "737")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY738
	(DESC "738")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY739
	(DESC "739")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY740
	(DESC "740")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY741
	(DESC "741")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY742
	(DESC "742")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY743
	(DESC "743")
	(BACKGROUND NONE)
	(STORY NONE)
	(EVENTS NONE)
	(CHOICES NONE)
	(DESTINATIONS NONE)
	(REQUIREMENTS NONE)
	(TYPES NONE)
	(CONTINUE NONE)
	(ITEMS NONE)
	(CODEWORDS NONE)
	(GOD NONE)
	(BLESSINGS NONE)
	(TITLES NONE)
	(DOOM F)
	(VICTORY F)
	(FLAGS LIGHTBIT)>

<ROOM STORY-BLOOD-DARK-SEA
	(DESC "Over the Blood-Dark Sea")
	(VICTORY ENDING-BLOOD-DARK-SEA)
	(FLAGS LIGHTBIT)>

<ROOM STORY-CITIES-GOLD-GLORY
	(DESC "Cities of Gold and Glory")
	(VICTORY ENDING-CITIES-GOLD-GLORY)
	(FLAGS LIGHTBIT)>

<ROOM STORY-PLAINS-HOWLING-DARKNESS
	(DESC "Plains of Howling Darkness")
	(VICTORY ENDING-PLAINS-HOWLING-DARKNESS)
	(FLAGS LIGHTBIT)>

<ROOM STORY-KILLED
	(DESC "The End")
	(STORY "You were killed")
	(DOOM T)
	(FLAGS LIGHTBIT)>
